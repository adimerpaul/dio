import{_ as y,c as u,o as l,w as d,b as o,a as i,a6 as x,$ as c,f,d as C,bj as I,a0 as p,a1 as A,a2 as b,t as n,bB as S,Z as g}from"./index-Ck1IPAoR.js";import{Q as N}from"./QSelect-xPZFifrf.js";import{Q as k}from"./QMenu-__-4PpXr.js";import{Q as P}from"./QMarkupTable-BlKZP-aA.js";import{Q as w}from"./QPagination-Ddvrtn7X.js";import{Q as O}from"./QPage-CpqTTILT.js";import"./QItemLabel-BaLiswTg.js";import"./format-BuuyVaDy.js";const V={name:"LugaresAcogidaNnaTabla",props:{tipo:{type:String,required:!1},subtipo:{type:String,default:""},tipologia:{type:String,default:""},leerOnlyPendientesDeRuta:{type:Boolean,default:!0},placeholder:{type:String,default:""},perPageInit:{type:Number,default:10}},data(){return{dialogFormat:!1,casos:[],loading:!1,page:1,perPage:this.perPageInit,meta:{current_page:1,last_page:1,total:0,from:0,to:0},search:"",onlyPendientes:!1,showExtra:!1}},computed:{isSLIM(){return String(this.tipo).toUpperCase()==="SLIM"},placeholderComputed(){return this.placeholder?this.placeholder:`Buscar por N° ${this.tipo?.toUpperCase()||"CASO"}, denunciante, denunciado, tipología, zona…`},baseColspan(){return this.isSLIM&&this.showExtra?21:9}},mounted(){this.leerOnlyPendientesDeRuta&&(this.onlyPendientes=String(this.$route?.query?.only_pendientes||"")==="1"),this.fetchCasos()},watch:{"$route.query.only_pendientes"(t){this.leerOnlyPendientesDeRuta&&(this.onlyPendientes=String(t||"")==="1",this.goFirstPage())}},methods:{tipoAcogidaConfig(t){const e={chipColor:"grey-3",iconColor:"grey-8",textClass:"text-grey-8"};switch(t){case"ACOGIDA INSTITUCIONAL (AI)":return{chipColor:"blue-3",iconColor:"blue-10",textClass:"text-blue-10"};case"ACOGIMIENTO CON FAMILIA AMPLIADA (AFA)":return{chipColor:"green-3",iconColor:"green-10",textClass:"text-green-10"};case"ACOGIMIENTO CON FAMILIA COMUNITARIA (AFC)":return{chipColor:"pink-3",iconColor:"pink-9",textClass:"text-pink-9"};case"RESTITUCIÓN DE FAMILIA ORIGEN (RFO)":return{chipColor:"purple-3",iconColor:"purple-10",textClass:"text-purple-10"};default:return e}},openDialogFormat(){this.dialogFormat=!0},refresh(){this.fetchCasos()},fetchCasos(){this.loading=!0,this.$axios.get("/casos",{params:{q:this.search||"",tipologia:"Acogimiento circunstancial",tipo:"DNA",page:this.page,per_page:this.perPage,only_pendientes:this.onlyPendientes?1:0}}).then(t=>{const e=t.data||{};this.casos=e.data||[],this.meta={current_page:e.current_page||1,last_page:e.last_page||1,total:e.total||0,from:e.from||0,to:e.to||0},this.page=this.meta.current_page}).catch(t=>this.$alert?.error?.(t.response?.data?.message||"Error cargando casos")||console.error(t)).finally(()=>{this.loading=!1})},onSearch(){this.page=1,this.fetchCasos()},clearSearch(){this.search="",this.onSearch()},goFirstPage(){this.page=1,this.fetchCasos()},rowIndex(t){return(this.meta.from||0)+t},goToDetalle(t){this.$router.push({name:"lugar-acogida-nna",params:{id:t.id}})},nombrePersona(t,e="denunciante"){return t&&(e==="denunciante"?[t.denunciante_nombres,t.denunciante_paterno,t.denunciante_materno]:[t.denunciado_nombres,t.denunciado_paterno,t.denunciado_materno]).filter(Boolean).join(" ")||"—"},fmt(t){return(t??"")!==""?t:"—"},fmtFecha(t){if(!t)return"—";try{const e=new Date(String(t).replace(" ","T")),m=String(e.getDate()).padStart(2,"0"),h=String(e.getMonth()+1).padStart(2,"0"),r=e.getFullYear();return`${m}/${h}/${r}`}catch{return t}}}},F={class:"row items-center q-col-gutter-md q-mb-md"},T={class:"col-12 col-md"},D={class:"col-auto"},M={class:"col-auto row items-center"},L={key:0},Q=["onClick"],v={class:"text-weight-medium"},E={key:0,class:"text-caption text-grey-7"},U={class:"row items-center justify-between q-mt-md"},q={class:"text-caption text-grey-7"};function z(t,e,m,h,r,s){return l(),u(O,{class:"q-pa-md"},{default:d(()=>[o("div",F,[o("div",T,[i(x,{modelValue:r.search,"onUpdate:modelValue":[e[0]||(e[0]=a=>r.search=a),s.onSearch],outlined:"",dense:"",debounce:"400",placeholder:s.placeholderComputed},{prepend:d(()=>[i(C,{name:"search"})]),append:d(()=>[r.search?(l(),u(f,{key:0,flat:"",dense:"",round:"",icon:"close",onClick:s.clearSearch},null,8,["onClick"])):c("",!0)]),_:1},8,["modelValue","placeholder","onUpdate:modelValue"])]),o("div",D,[i(N,{modelValue:r.perPage,"onUpdate:modelValue":[e[1]||(e[1]=a=>r.perPage=a),s.goFirstPage],options:[10,20,50],dense:"",outlined:"",style:{width:"120px"},label:"Por página"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",M,[i(f,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",onClick:e[2]||(e[2]=a=>s.fetchCasos()),loading:r.loading,class:"q-mr-sm",size:"10px"},null,8,["loading"]),s.isSLIM?(l(),u(f,{key:0,color:"green",icon:"visibility","no-caps":"",size:"10px",labelx:r.showExtra?"Ocultar columnas extra":"Visualizar Casos/Estado",label:"Visualizar Casos/Estado",onClick:s.openDialogFormat},null,8,["labelx","onClick"])):c("",!0),I(t.$slots,"actions",{},void 0,!0)])]),i(P,{flat:"",bordered:"",dense:""},{default:d(()=>[e[4]||(e[4]=o("thead",null,[o("tr",{class:"bg-primary text-white"},[o("th",{style:{width:"60px"}},"#"),o("th",null,"Nº"),o("th",null,"Nurej"),o("th",null,"NNA"),o("th",null,"Juzgado"),o("th",null,"Tipo de Acogida"),o("th",null,"Cuidador(a)")])],-1)),!r.loading&&r.casos.length?(l(),p("tbody",L,[(l(!0),p(A,null,b(r.casos,(a,_)=>(l(),p("tr",{key:a.id,onClick:B=>s.goToDetalle(a),class:"cursor-pointer"},[o("td",null,n(s.rowIndex(_)),1),o("td",null,n(a.caso_numero||"—"),1),o("td",null,n(s.fmt(a.nurej)),1),o("td",null,[o("div",v,n(a.victimas?.[0]?.nombres_apellidos||"—"),1),a.victimas?.[0]?.ci?(l(),p("div",E," CI: "+n(a.victimas?.[0]?.ci),1)):c("",!0)]),o("td",null,n(s.fmt(a.numero_juzgado)),1),o("td",null,[a.acogimientos.length?(l(),u(k,{key:0,dense:"",outlined:"",color:s.tipoAcogidaConfig(a.acogimientos[0]?.tipo_de_acogida).chipColor},{default:d(()=>[i(C,{name:"check_circle",size:"16px",class:"q-mr-xs",color:s.tipoAcogidaConfig(a.acogimientos[0]?.tipo_de_acogida).iconColor},null,8,["color"]),o("span",{class:S(s.tipoAcogidaConfig(a.acogimientos[0]?.tipo_de_acogida).textClass)},n(a.acogimientos[0]?.tipo_de_acogida||"—"),3)]),_:2},1032,["color"])):c("",!0)]),o("td",null,n(a.acogimientos[0]?.tipo_de_acogida=="ACOGIDA INSTITUCIONAL (AI)"?a.acogimientos[0]?.centro_de_acogida:a.acogimientos[0]?.cuidadora_nombre_completo),1)],8,Q))),128))])):c("",!0)]),_:1}),o("div",U,[o("div",q,[e[5]||(e[5]=g(" Mostrando ")),o("b",null,n(r.meta.from||0),1),e[6]||(e[6]=g(" – ")),o("b",null,n(r.meta.to||0),1),e[7]||(e[7]=g(" de ")),o("b",null,n(r.meta.total||0),1),e[8]||(e[8]=g(" registros "))]),i(w,{modelValue:r.page,"onUpdate:modelValue":[e[3]||(e[3]=a=>r.page=a),s.fetchCasos],max:r.meta.last_page||1,"max-pages":"10","boundary-numbers":"","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])])]),_:3})}const W=y(V,[["render",z],["__scopeId","data-v-300d0f0d"]]);export{W as default};
