import{_ as x,Y as y,c as g,o as u,w as l,a as t,b as o,$ as C,Q as d,e as h,a6 as b,f as _,a0 as v,a1 as w,a2 as T,t as p,a3 as q,Z as k}from"./index-36E5Hofp.js";import{Q as D}from"./QSelect-D9pKbzPp.js";import{Q,a as V}from"./QTable-BlLcBLZd.js";import{Q as E}from"./QPage-laCLgaak.js";import{m as O}from"./vue3-apexcharts-B8elKmuy.js";import"./QMenu-6tqLkurl.js";import"./format-c3k1d8Gq.js";import"./QItemLabel-C9gGRl8Q.js";import"./QList-DwGI5gZO.js";import"./QMarkupTable-C1KhuBr9.js";import"./use-fullscreen-C8StUPRn.js";const S={name:"IndexPage",components:{apexchart:O},data(){return{loading:!1,filters:{from:"",to:"",area:null},rango:{from:null,to:null},totales:{casos:0,denunciantes:0,denunciados:0},porArea:{labels:[],data:[]},porTipo:{labels:[],data:[]},porTipologia:{labels:[],data:[]},porEdad:{labels:[],data:[]},seriesTiempo:{labels:[],data:[]},filterOptions:{areas:[]},detalle:{titulo:"",rows:[],loading:!1},detalleColumns:[{name:"id",label:"ID",field:"id",sortable:!0,align:"left"},{name:"area",label:"Área",field:"area",align:"left"},{name:"tipo",label:"Tipo",field:"tipo",align:"left"},{name:"caso_tipologia",label:"Tipología",field:"caso_tipologia",align:"left"},{name:"caso_numero",label:"N° Caso",field:"caso_numero",align:"left"},{name:"caso_fecha_hecho",label:"Fecha hecho",field:"caso_fecha_hecho",align:"left"},{name:"caso_lugar_hecho",label:"Lugar",field:"caso_lugar_hecho",align:"left"},{name:"principal",label:"Principal",field:"principal",align:"left"}]}},computed:{cards(){return[{key:"casos",label:"Casos",value:this.totales.casos},{key:"denunciante",label:"Denunciantes",value:this.totales.denunciantes},{key:"denunciado",label:"Denunciados",value:this.totales.denunciados}]},rangoTexto(){return!this.rango.from||!this.rango.to?"":`Del ${this.rango.from} al ${this.rango.to}`},barEdadOptions(){return{chart:{toolbar:{show:!1}},xaxis:{categories:this.porEdad.labels},dataLabels:{enabled:!1},plotOptions:{bar:{horizontal:!1,columnWidth:"40%"}},grid:{borderColor:"#eee"}}},barEdadSeries(){return[{name:"Casos",data:this.porEdad.data}]},areaOptions(){return{chart:{toolbar:{show:!1}},stroke:{curve:"smooth",width:2},dataLabels:{enabled:!1},xaxis:{categories:this.seriesTiempo.labels},grid:{borderColor:"#eee"},legend:{position:"top"}}},areaSeries(){return[{name:"Casos",data:this.seriesTiempo.data}]}},mounted(){this.fetchDashboard()},methods:{formatDate(i){return i||""},getDonutOptions(i,e,n){const f=this;return{labels:e,legend:{position:"bottom"},dataLabels:{enabled:!0},chart:{toolbar:{show:!1},events:{dataPointSelection(a,r,c){const s=c.dataPointIndex,m=e[s];m&&f.onDonutClick(n,m)}}},title:{text:"",align:"left"}}},async onDonutClick(i,e){this.detalle.titulo=i==="tipo"?`Casos - Tipo: ${e}`:i==="tipologia"?`Casos - Tipología: ${e}`:`Casos - ${e}`,this.detalle.loading=!0,this.detalle.rows=[];try{const n=await this.$axios.get("dashboard-casos-detalle",{params:{from:this.filters.from,to:this.filters.to,area:this.filters.area,group_by:i,value:e}});this.detalle.rows=n.data||[]}catch(n){console.error(n),this.$q.notify({type:"negative",message:"Error cargando detalle de casos"})}finally{this.detalle.loading=!1}},async fetchDashboard(){this.loading=!0;try{const e=(await this.$axios.get("dashboard-casos",{params:this.filters})).data||{};this.totales=e.totales||this.totales,this.porArea=e.por_area||this.porArea,this.porTipo=e.por_tipo||this.porTipo,this.porTipologia=e.por_tipologia||this.porTipologia,this.porEdad=e.por_edad||this.porEdad,this.seriesTiempo=e.series_tiempo||this.seriesTiempo,this.filterOptions.areas=e.filtros?.areas||[],this.rango=e.rango||this.rango}catch(i){console.error(i),this.$q.notify({type:"negative",message:"Error cargando dashboard de casos"})}finally{this.loading=!1}}}},P={class:"col-12 col-sm-3"},I={class:"col-12 col-sm-3"},L={class:"col-12 col-sm-3"},N={class:"col-12 col-sm-auto"},A={class:"row q-col-gutter-md q-mb-md"},B={class:"text-caption text-grey-7"},F={class:"text-h4 q-my-sm"},U={class:"text-caption text-positive"},j={class:"row q-col-gutter-md q-mb-md"},z={class:"col-12 col-md-6"},H={class:"col-12 col-md-6"},R={class:"row q-col-gutter-md"},W={class:"col-12 col-md-6"},Y={class:"col-12 col-md-6"},Z={class:"text-subtitle2"},G={class:"text-caption text-grey-7"};function J(i,e,n,f,a,r){const c=y("apexchart");return u(),g(E,{class:"q-pa-md bg-grey-2"},{default:l(()=>[t(d,{flat:"",bordered:"",class:"q-mb-md"},{default:l(()=>[t(h,{class:"row q-col-gutter-sm items-end"},{default:l(()=>[o("div",P,[t(b,{modelValue:a.filters.from,"onUpdate:modelValue":e[0]||(e[0]=s=>a.filters.from=s),type:"date",label:"Desde",dense:"",outlined:""},null,8,["modelValue"])]),o("div",I,[t(b,{modelValue:a.filters.to,"onUpdate:modelValue":e[1]||(e[1]=s=>a.filters.to=s),type:"date",label:"Hasta",dense:"",outlined:""},null,8,["modelValue"])]),o("div",L,[t(D,{modelValue:a.filters.area,"onUpdate:modelValue":e[2]||(e[2]=s=>a.filters.area=s),options:a.filterOptions.areas,label:"Área",dense:"",outlined:"",clearable:""},null,8,["modelValue","options"])]),o("div",N,[t(_,{color:"primary",icon:"search",label:"Filtrar","no-caps":"",loading:a.loading,onClick:r.fetchDashboard},null,8,["loading","onClick"])])]),_:1})]),_:1}),o("div",A,[(u(!0),v(w,null,T(r.cards,s=>(u(),v("div",{class:"col-12 col-sm-4",key:s.key},[t(d,{flat:"",bordered:"",class:"q-pa-md text-center"},{default:l(()=>[o("div",B,p(s.label),1),o("div",F,p(s.value??"—"),1),o("div",U,p(r.rangoTexto),1)]),_:2},1024)]))),128))]),o("div",j,[o("div",z,[t(d,{flat:"",bordered:"",class:"q-pa-md"},{default:l(()=>[e[5]||(e[5]=o("div",{class:"text-subtitle2 q-mb-sm"},"Casos por tipo (click para ver detalle)",-1)),t(c,{type:"donut",height:"260",options:r.getDonutOptions("Casos por tipo",a.porTipo.labels,"tipo"),series:a.porTipo.data},null,8,["options","series"])]),_:1})]),o("div",H,[t(d,{flat:"",bordered:"",class:"q-pa-md"},{default:l(()=>[e[6]||(e[6]=o("div",{class:"text-subtitle2 q-mb-sm"},"Casos por tipología (click para ver detalle)",-1)),t(c,{type:"donut",height:"260",options:r.getDonutOptions("Casos por tipología",a.porTipologia.labels,"tipologia"),series:a.porTipologia.data},null,8,["options","series"])]),_:1})])]),o("div",R,[o("div",W,[t(d,{flat:"",bordered:"",class:"q-pa-md"},{default:l(()=>[e[7]||(e[7]=o("div",{class:"text-subtitle2 q-mb-sm"},"Casos por rango de edad (denunciante)",-1)),t(c,{type:"bar",height:"300",options:r.barEdadOptions,series:r.barEdadSeries},null,8,["options","series"])]),_:1})]),o("div",Y,[t(d,{flat:"",bordered:"",class:"q-pa-md"},{default:l(()=>[e[8]||(e[8]=o("div",{class:"text-subtitle2 q-mb-sm"},"Casos por mes",-1)),t(c,{type:"area",height:"300",options:r.areaOptions,series:r.areaSeries},null,8,["options","series"])]),_:1})])]),a.detalle.rows.length?(u(),g(d,{key:0,flat:"",bordered:"",class:"q-mt-md"},{default:l(()=>[t(h,{class:"row items-center justify-between"},{default:l(()=>[o("div",null,[o("div",Z,p(a.detalle.titulo),1),o("div",G," Total: "+p(a.detalle.rows.length)+" registro(s) ",1)]),t(_,{dense:"",flat:"",icon:"close",round:"",onClick:e[3]||(e[3]=s=>a.detalle.rows=[])})]),_:1}),t(q),t(h,null,{default:l(()=>[t(Q,{rows:a.detalle.rows,columns:a.detalleColumns,"row-key":"id",dense:"",flat:"",bordered:"",loading:a.detalle.loading,"no-data-label":"Sin casos para mostrar",onRowClick:e[4]||(e[4]=(s,m,K)=>{this.$router.push("/casos/"+m.id)})},{"body-cell-caso_fecha_hecho":l(s=>[t(V,{props:s},{default:l(()=>[k(p(r.formatDate(s.row.caso_fecha_hecho)),1)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])]),_:1})]),_:1})):C("",!0)]),_:1})}const de=x(S,[["render",J]]);export{de as default};
