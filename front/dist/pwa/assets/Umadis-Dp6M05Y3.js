import{_ as x,c as p,o as l,w as r,b as o,a as i,a6 as b,$ as g,f as y,d as k,a7 as w,a0 as d,a1 as _,a2 as P,t as n,Z as a}from"./index-C4KiTdPA.js";import{Q as S}from"./QSelect-DrcRHziJ.js";import{Q as h}from"./format-CaecFcve.js";import{Q as c}from"./QBadge-vgp5cFdh.js";import{Q}from"./QTooltip-DyMMrCRG.js";import{Q as V}from"./QSpinnerDots-DYTDIrtn.js";import{Q as v}from"./QMarkupTable-R95QuCd0.js";import{Q as q}from"./QPagination-Bc1rQk1p.js";import{Q as A}from"./QPage-C8tIjSZL.js";const C={name:"SlimsPage",data(){return{umadis:[],loading:!1,page:1,perPage:10,meta:{current_page:1,last_page:1,total:0,from:0,to:0},search:"",onlyPendientes:!1}},mounted(){this.onlyPendientes=String(this.$route.query.only_pendientes||"")==="1",this.fetchSlims()},watch:{"$route.query.only_pendientes"(m){this.onlyPendientes=String(m||"")==="1",this.goFirstPage()}},methods:{fetchSlims(){this.loading=!0,this.$axios.get("/umadis",{params:{q:this.search||"",page:this.page,per_page:this.perPage,only_pendientes:this.onlyPendientes?1:0}}).then(m=>{const e=m.data||{};this.umadis=e.data||[],this.meta={current_page:e.current_page||1,last_page:e.last_page||1,total:e.total||0,from:e.from||0,to:e.to||0},this.page=this.meta.current_page}).catch(m=>this.$alert.error(m.response?.data?.message||"Error cargando SLAMs")).finally(()=>{this.loading=!1})},onSearch(){this.page=1,this.fetchSlims()},clearSearch(){this.search="",this.onSearch()},goFirstPage(){this.page=1,this.fetchSlims()},rowIndex(m){return(this.meta.from||0)+m}}},F={class:"row items-center q-col-gutter-md q-mb-md"},U={class:"col-12 col-md"},z={class:"col-auto"},B={class:"col-auto"},I={class:"col-auto"},N={key:0},M=["onClick"],T={class:"text-no-wrap"},D={class:"text-no-wrap"},L={class:"text-weight-medium"},j={class:"text-weight-medium"},E={key:4,class:"text-grey-6"},Z={key:1,class:"text-grey-6"},R={key:1},G={key:2},H={colspan:"9",class:"text-center"},J={class:"row items-center justify-between q-mt-md"},K={class:"text-caption text-grey-7"};function O(m,e,W,X,s,u){return l(),p(A,{class:"q-pa-md"},{default:r(()=>[o("div",F,[o("div",U,[i(b,{modelValue:s.search,"onUpdate:modelValue":[e[0]||(e[0]=t=>s.search=t),u.onSearch],outlined:"",dense:"",debounce:"400",placeholder:"Buscar por N° SLAM, denunciante, denunciado, tipología, zona…"},{prepend:r(()=>[i(k,{name:"search"})]),append:r(()=>[s.search?(l(),p(y,{key:0,flat:"",dense:"",round:"",icon:"close",onClick:u.clearSearch},null,8,["onClick"])):g("",!0)]),_:1},8,["modelValue","onUpdate:modelValue"])]),o("div",z,[i(w,{modelValue:s.onlyPendientes,"onUpdate:modelValue":[e[1]||(e[1]=t=>s.onlyPendientes=t),u.goFirstPage],color:"primary",label:"Solo mis pendientes"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",B,[i(S,{modelValue:s.perPage,"onUpdate:modelValue":[e[2]||(e[2]=t=>s.perPage=t),u.goFirstPage],options:[10,20,50],dense:"",outlined:"",style:{width:"120px"},label:"Por página"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",I,[i(y,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",onClick:e[3]||(e[3]=t=>u.fetchSlims()),loading:s.loading},null,8,["loading"])])]),i(v,{flat:"",bordered:"",dense:""},{default:r(()=>[e[16]||(e[16]=o("thead",null,[o("tr",null,[o("th",{style:{width:"60px"}},"#"),o("th",null,"Nº SLAM"),o("th",null,"Fecha"),o("th",null,"Denunciante"),o("th",null,"Denunciado"),o("th",null,"Tipología"),o("th",null,"Zona"),o("th",null,"Tipo"),o("th",null,"Alerta")])],-1)),!s.loading&&s.umadis.length?(l(),d("tbody",N,[(l(!0),d(_,null,P(s.umadis,(t,f)=>(l(),d("tr",{key:t.id,onClick:Y=>m.$router.push("/umadis/"+t.id),class:"cursor-pointer"},[o("td",null,n(u.rowIndex(f)),1),o("td",T,n(t.numero_caso||"—"),1),o("td",D,n(m.$filters.date(t.fecha_registro)),1),o("td",null,[o("div",L,n(t.nombres+" "+t.paterno+" "+t.materno),1)]),o("td",null,[o("div",j,n(t.denunciado_nombres+" "+t.denunciado_paterno+" "+t.denunciado_materno),1)]),o("td",null,[t.tip_violencia_fisica?(l(),p(h,{key:0,color:"red","text-color":"white",size:"sm",class:"q-mr-xs"},{default:r(()=>e[5]||(e[5]=[a(" Física ")])),_:1})):g("",!0),t.tip_violencia_psicologica?(l(),p(h,{key:1,color:"orange","text-color":"white",size:"sm",class:"q-mr-xs"},{default:r(()=>e[6]||(e[6]=[a(" Psicológica ")])),_:1})):g("",!0),t.tip_abandono?(l(),p(h,{key:2,color:"blue","text-color":"white",size:"sm",class:"q-mr-xs"},{default:r(()=>e[7]||(e[7]=[a(" Abandono ")])),_:1})):g("",!0),t.tip_apoyo_integral?(l(),p(h,{key:3,color:"purple","text-color":"white",size:"sm",class:"q-mr-xs"},{default:r(()=>e[8]||(e[8]=[a(" Apoyo Integral ")])),_:1})):g("",!0),!t.tip_violencia_fisica&&!t.tip_violencia_psicologica&&!t.tip_abandono&&!t.tip_apoyo_integral?(l(),d("div",E,"—")):g("",!0)]),o("td",null,n(t.zona||"—"),1),o("td",null,[i(c,{color:t.numero_apoyo_integral?"green":"grey-5","text-color":t.numero_apoyo_integral?"white":"black",label:t.numero_apoyo_integral?"Apoyo Integral":"Regular",rounded:"",dense:""},null,8,["color","text-color","label"])]),o("td",null,[t.mi_estado?.me_asignado?(l(),d(_,{key:0},[t.mi_estado.primer_informe_hecho?(l(),p(c,{key:0,color:"green","text-color":"white",class:"q-mr-xs"},{default:r(()=>[a(n(t.mi_estado.label_listo||"Primer informe listo"),1)]),_:2},1024)):(l(),d(_,{key:1},[i(c,{color:t.mi_estado.atrasado?"red":"orange","text-color":t.mi_estado.atrasado?"white":"black",class:"q-mr-xs"},{default:r(()=>[t.mi_estado.atrasado?(l(),d(_,{key:0},[a(" Atrasado "+n(Math.abs(t.mi_estado.dias_restantes))+" d ",1)],64)):(l(),d(_,{key:1},[a(" Faltan "+n(t.mi_estado.dias_restantes)+" d ",1)],64))]),_:2},1032,["color","text-color"]),i(Q,{"transition-show":"jump-down","transition-hide":"jump-up"},{default:r(()=>[e[9]||(e[9]=a(" Debes cargar tu ")),o("b",null,n(t.mi_estado.rol==="Psicologo"?"primera sesión":"primer informe"),1),e[10]||(e[10]=a(".")),e[11]||(e[11]=o("br",null,null,-1)),e[12]||(e[12]=a(" Fecha límite: ")),o("b",null,n(t.mi_estado.deadline),1),e[13]||(e[13]=a(". "))]),_:2},1024)],64))],64)):(l(),d("span",Z,"—"))])],8,M))),128))])):!s.loading&&!s.umadis.length?(l(),d("tbody",R,e[14]||(e[14]=[o("tr",null,[o("td",{colspan:"9",class:"text-center text-grey"}," No hay resultados para tu búsqueda. ")],-1)]))):(l(),d("tbody",G,[o("tr",null,[o("td",H,[i(V,{size:"24px",class:"q-mr-sm"}),e[15]||(e[15]=a(" Cargando… "))])])]))]),_:1}),o("div",J,[o("div",K,[e[17]||(e[17]=a(" Mostrando ")),o("b",null,n(s.meta.from||0),1),e[18]||(e[18]=a(" – ")),o("b",null,n(s.meta.to||0),1),e[19]||(e[19]=a(" de ")),o("b",null,n(s.meta.total||0),1),e[20]||(e[20]=a(" registros "))]),i(q,{modelValue:s.page,"onUpdate:modelValue":[e[4]||(e[4]=t=>s.page=t),u.fetchSlims],max:s.meta.last_page||1,"max-pages":"10","boundary-numbers":"","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])])]),_:1})}const ie=x(C,[["render",O],["__scopeId","data-v-19050ddb"]]);export{ie as default};
