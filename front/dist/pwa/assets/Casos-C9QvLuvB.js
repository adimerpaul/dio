import{_,c as m,o as n,w as u,b as e,a as r,al as f,a0 as p,f as h,d as x,$ as i,a1 as y,a2 as b,t as a,Z as c}from"./index-D7Cm6sAG.js";import{Q as C}from"./QSelect-DeNJPlJQ.js";import{Q as k}from"./QSpinnerDots-K85J8Y39.js";import{Q as V}from"./QMarkupTable-CjOUbuyY.js";import{Q as v}from"./QPagination-DF13Vl7I.js";import{Q as w}from"./QPage-DNwC6DIF.js";import"./format-lLrkQFCh.js";const Q={name:"CasosPage",data(){return{casos:[],loading:!1,page:1,perPage:10,meta:{current_page:1,last_page:1,total:0,from:0,to:0},search:"",_searchTimer:null}},mounted(){this.fetchCasos()},methods:{fetchCasos(){this.loading=!0,this.$axios.get("casos",{params:{q:this.search||"",page:this.page,per_page:this.perPage}}).then(l=>{const t=l.data||{};this.casos=t.data||[],this.meta={current_page:t.current_page||1,last_page:t.last_page||1,total:t.total||0,from:t.from||0,to:t.to||0},this.page=this.meta.current_page}).catch(l=>this.$alert.error(l.response?.data?.message||"Error cargando casos")).finally(()=>{this.loading=!1})},onSearch(){this.page=1,this.fetchCasos()},clearSearch(){this.search="",this.onSearch()},goFirstPage(){this.page=1,this.fetchCasos()},rowIndex(l){return(this.meta.from||0)+l}}},P={class:"row items-center q-col-gutter-md q-mb-md"},S={class:"col-12 col-md"},q={class:"col-auto"},I={class:"col-auto"},N={key:0},B=["onClick"],U={class:"text-no-wrap"},D={class:"text-no-wrap"},z={class:"text-weight-medium"},F={key:0,class:"text-caption text-grey-7"},T={class:"text-weight-medium"},E={key:0,class:"text-caption text-grey-7"},M=["title"],Z={key:1},j={key:2},A={colspan:"8",class:"text-center"},L={class:"row items-center justify-between q-mt-md"},G={class:"text-caption text-grey-7"};function H(l,t,J,K,o,d){return n(),m(w,{class:"q-pa-md"},{default:u(()=>[e("div",P,[e("div",S,[r(f,{modelValue:o.search,"onUpdate:modelValue":[t[0]||(t[0]=s=>o.search=s),d.onSearch],outlined:"",dense:"",debounce:"400",placeholder:"Buscar por N° de caso, denunciante, denunciado, tipología, zona…"},{prepend:u(()=>[r(x,{name:"search"})]),append:u(()=>[o.search?(n(),m(h,{key:0,flat:"",dense:"",round:"",icon:"close",onClick:d.clearSearch},null,8,["onClick"])):p("",!0)]),_:1},8,["modelValue","onUpdate:modelValue"])]),e("div",q,[r(C,{modelValue:o.perPage,"onUpdate:modelValue":[t[1]||(t[1]=s=>o.perPage=s),d.goFirstPage],options:[10,20,50],dense:"",outlined:"",style:{width:"120px"},label:"Por página"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",I,[r(h,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",onClick:t[2]||(t[2]=s=>d.fetchCasos()),loading:o.loading},null,8,["loading"])])]),r(V,{flat:"",bordered:"",dense:""},{default:u(()=>[t[6]||(t[6]=e("thead",null,[e("tr",null,[e("th",{style:{width:"60px"}},"#"),e("th",null,"Nº Caso"),e("th",null,"Fecha"),e("th",null,"Denunciante"),e("th",null,"Denunciado"),e("th",null,"Tipología"),e("th",null,"Zona"),e("th",null,"Descripción")])],-1)),!o.loading&&o.casos.length?(n(),i("tbody",N,[(n(!0),i(y,null,b(o.casos,(s,g)=>(n(),i("tr",{key:s.id,onClick:O=>l.$router.push("/casos/"+s.id),class:"cursor-pointer"},[e("td",null,a(d.rowIndex(g)),1),e("td",U,a(s.caso_numero||"—"),1),e("td",D,a(l.$filters.date(s.caso_fecha_hecho)),1),e("td",null,[e("div",z,a(s.denunciante_nombre_completo),1),s.denunciante_nro?(n(),i("div",F,"CI: "+a(s.denunciante_nro),1)):p("",!0)]),e("td",null,[e("div",T,a(s.denunciado_nombre_completo||"—"),1),s.denunciado_nro?(n(),i("div",E,"CI: "+a(s.denunciado_nro),1)):p("",!0)]),e("td",null,a(s.caso_tipologia||"—"),1),e("td",null,a(s.caso_zona||"—"),1),e("td",null,[e("div",{class:"ellipsis-2-lines",title:s.caso_descripcion},a(s.caso_descripcion||"—"),9,M)])],8,B))),128))])):!o.loading&&!o.casos.length?(n(),i("tbody",Z,t[4]||(t[4]=[e("tr",null,[e("td",{colspan:"8",class:"text-center text-grey"}," No hay resultados para tu búsqueda. ")],-1)]))):(n(),i("tbody",j,[e("tr",null,[e("td",A,[r(k,{size:"24px",class:"q-mr-sm"}),t[5]||(t[5]=c(" Cargando… "))])])]))]),_:1}),e("div",L,[e("div",G,[t[7]||(t[7]=c(" Mostrando ")),e("b",null,a(o.meta.from||0),1),t[8]||(t[8]=c(" – ")),e("b",null,a(o.meta.to||0),1),t[9]||(t[9]=c(" de ")),e("b",null,a(o.meta.total||0),1),t[10]||(t[10]=c(" registros "))]),r(v,{modelValue:o.page,"onUpdate:modelValue":[t[3]||(t[3]=s=>o.page=s),d.fetchCasos],max:o.meta.last_page||1,"max-pages":"10","boundary-numbers":"","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])])]),_:1})}const se=_(Q,[["render",H],["__scopeId","data-v-310f80ea"]]);export{se as default};
