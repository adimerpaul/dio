import{_ as S,a0 as d,o as r,a as i,w as c,b as e,a6 as v,c as f,$ as g,f as p,d as F,a7 as D,ac as Q,bk as U,a1 as m,a2 as b,bl as z,t as s,Z as u,Q as I,e as A,a8 as E,V as j,h as q}from"./index-tEaV_suc.js";import{Q as C}from"./QSelect-7SV4y04Y.js";import{Q as x}from"./QBadge-CFDHE5lk.js";import{Q as k}from"./QTooltip-C3gcl_lA.js";import{Q as w}from"./QMarkupTable-C0DQYA4_.js";import{Q as T}from"./QPagination-chcKicCY.js";import{Q as M}from"./QPage-CezfwX8s.js";import{Q as N}from"./QSpace-BBiF7Ypc.js";import{C as B}from"./ClosePopup-DU3BIei5.js";import{h as P}from"./moment-C5S46NFB.js";const L={name:"CasoTable",props:{tipo:{type:String,required:!0},subtipo:{type:String,default:""},tipologia:{type:String,default:""},leerOnlyPendientesDeRuta:{type:Boolean,default:!0},placeholder:{type:String,default:""},perPageInit:{type:Number,default:10}},data(){return{estado_caso:null,fragancia:!1,dialogFormat:!1,casos:[],loading:!1,page:1,perPage:this.perPageInit,meta:{current_page:1,last_page:1,total:0,from:0,to:0},search:"",onlyPendientes:!1,showExtra:!1}},computed:{isSLIM(){return String(this.tipo).toUpperCase()==="SLIM"},placeholderComputed(){return this.placeholder?this.placeholder:`Buscar por N° ${this.tipo?.toUpperCase()||"CASO"}, denunciante, denunciado, tipología, zona…`},baseColspan(){return this.isSLIM&&this.showExtra?21:9}},mounted(){this.leerOnlyPendientesDeRuta&&(this.onlyPendientes=String(this.$route?.query?.only_pendientes||"")==="1"),this.fetchCasos()},watch:{"$route.query.only_pendientes"(o){this.leerOnlyPendientesDeRuta&&(this.onlyPendientes=String(o||"")==="1",this.goFirstPage())}},methods:{AniosMesesdiasAgo(o){if(!o)return"—";const a=P(o),h=P(),_=h.diff(a,"years");a.add(_,"years");const n=h.diff(a,"months");a.add(n,"months");const l=h.diff(a,"days");return(_>0?_+" a ":"")+(n>0?n+" m ":"")+l+" d"},openDialogFormat(){this.dialogFormat=!0},refresh(){this.fetchCasos()},fetchCasos(){this.loading=!0,this.$axios.get("/casos",{params:{q:this.search||"",fragancia:this.fragancia?1:0,tipologia:this.tipologia||"",tipo:this.tipo,page:this.page,per_page:this.perPage,only_pendientes:this.onlyPendientes?1:0,estado_caso:this.estado_caso||""}}).then(o=>{const a=o.data||{};this.casos=a.data||[],this.meta={current_page:a.current_page||1,last_page:a.last_page||1,total:a.total||0,from:a.from||0,to:a.to||0},this.page=this.meta.current_page}).catch(o=>this.$alert?.error?.(o.response?.data?.message||"Error cargando casos")||console.error(o)).finally(()=>{this.loading=!1})},onSearch(){this.page=1,this.fetchCasos()},clearSearch(){this.search="",this.onSearch()},goFirstPage(){this.page=1,this.fetchCasos()},rowIndex(o){return(this.meta.from||0)+o},goToDetalle(o){this.subtipo==="AntecedentesDna"?this.$router.push("/casos/"+o.id+"/dna"):this.$router.push("/casos/"+o.id)},nombrePersona(o,a="denunciante"){return o&&(a==="denunciante"?[o.denunciante_nombres,o.denunciante_paterno,o.denunciante_materno]:[o.denunciado_nombres,o.denunciado_paterno,o.denunciado_materno]).filter(Boolean).join(" ")||"—"},fmt(o){return(o??"")!==""?o:"—"},fmtFecha(o){if(!o)return"—";try{const a=new Date(String(o).replace(" ","T")),h=String(a.getDate()).padStart(2,"0"),_=String(a.getMonth()+1).padStart(2,"0"),n=a.getFullYear();return`${h}/${_}/${n}`}catch{return o}}}},O={class:"row"},R={class:"col-12 col-md-2"},J={class:"col-12 col-md-2"},Z={class:"col-12 col-md-2"},Y={class:"col-12 col-md-2"},G={class:"col-12 col-md-2 flex flex-center"},H={class:"col-12 col-md-2 flex flex-center"},K={key:0},W=["onClick"],X={class:"text-no-wrap"},$={class:"text-no-wrap"},ee={class:"text-weight-medium"},te={key:0,class:"text-caption text-grey-7"},ae={class:"text-weight-medium"},se={key:0,class:"text-caption text-grey-7"},oe={class:"ellipsis-2-lines"},le={key:1,class:"text-grey-6"},ne={class:"col-12 col-md-2"},re={class:"row items-center justify-between q-mt-md"},ie={class:"text-caption text-grey-7"},de=["onClick"],ue={class:"text-no-wrap"},ce={class:"text-no-wrap"},me={class:"text-weight-medium"},he={key:0,class:"text-caption text-grey-7"},_e={class:"text-weight-medium"},ge={key:0,class:"text-caption text-grey-7"},pe={key:1,class:"text-grey-6"},fe={class:"col-extra"},xe={class:"col-extra"},ye={class:"col-extra"},be={class:"col-extra"},Ce={class:"col-extra"},ke={class:"col-extra"},we={class:"col-extra"},Pe={class:"col-extra"},Ve={class:"col-extra"},Se={class:"col-extra ellipsis-2-lines"},ve={class:"col-extra"};function Fe(o,a,h,_,n,l){return r(),d(m,null,[i(M,{class:"q-pa-md"},{default:c(()=>[e("div",O,[e("div",R,[i(v,{modelValue:n.search,"onUpdate:modelValue":[a[0]||(a[0]=t=>n.search=t),l.onSearch],outlined:"",dense:"",debounce:"400",placeholder:l.placeholderComputed},{prepend:c(()=>[i(F,{name:"search"})]),append:c(()=>[n.search?(r(),f(p,{key:0,flat:"",dense:"",round:"",icon:"close",onClick:l.clearSearch},null,8,["onClick"])):g("",!0)]),_:1},8,["modelValue","placeholder","onUpdate:modelValue"])]),e("div",J,[i(D,{modelValue:n.onlyPendientes,"onUpdate:modelValue":[a[1]||(a[1]=t=>n.onlyPendientes=t),l.goFirstPage],color:"primary",label:"Solo mis pendientes"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",Z,[i(Q,{modelValue:n.fragancia,"onUpdate:modelValue":[a[2]||(a[2]=t=>n.fragancia=t),l.goFirstPage],label:"Fragancia"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",Y,[i(C,{modelValue:n.estado_caso,"onUpdate:modelValue":[a[3]||(a[3]=t=>n.estado_caso=t),l.goFirstPage],options:o.$estado_casos,outlined:"",label:"Estado del Caso",dense:"",clearable:"",disable:!["Abogado","Administrador"].includes(o.$store.user.role)},null,8,["modelValue","options","disable","onUpdate:modelValue"])]),e("div",G,[i(p,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",onClick:a[4]||(a[4]=t=>l.fetchCasos()),loading:n.loading,class:"q-mr-sm",size:"10px"},null,8,["loading"])]),e("div",H,[l.isSLIM?(r(),f(p,{key:0,color:"green",icon:"visibility","no-caps":"",size:"9px",labelx:n.showExtra?"Ocultar columnas extra":"Visualizar Casos/Estado",label:"Visualizar Casos/Estado",onClick:l.openDialogFormat},null,8,["labelx","onClick"])):g("",!0),U(o.$slots,"actions",{},void 0,!0)])]),i(w,{flat:"",bordered:"",dense:""},{default:c(()=>[a[14]||(a[14]=e("thead",null,[e("tr",{class:"bg-primary text-white"},[e("th",{style:{width:"60px"}},"#"),e("th",null,"Nº"),e("th",null,"Fecha"),e("th",null,"Denunciante"),e("th",null,"Denunciado"),e("th",null,"Tipología"),e("th",null,"Zona"),e("th",{class:"col-extra"},"NUREJ"),e("th",{class:"col-extra"},"CUD"),e("th",{class:"col-extra"},"Juzgado"),e("th",null,"Estado del caso"),e("th",null,"Observaciones"),e("th",null,"Alerta"),e("th",null,"Dias")])],-1)),!n.loading&&n.casos.length?(r(),d("tbody",K,[(r(!0),d(m,null,b(n.casos,(t,y)=>(r(),d("tr",{key:t.id,onClick:V=>l.goToDetalle(t),class:z("cursor-pointer "+(o.$store.casoSelect.id===t.id?"bg-red-3":""))},[e("td",null,s(l.rowIndex(y)),1),e("td",X,s(h.tipo)+" "+s(t.caso_numero||"—"),1),e("td",$,s(o.$filters.date?.(t.fecha_apertura_caso)??t.fecha_apertura_caso),1),e("td",null,[e("div",ee,s(l.nombrePersona(t.denunciantes?.[0],"denunciante")),1),t.denunciantes?.[0]?.denunciante_nro?(r(),d("div",te," CI: "+s(t.denunciantes?.[0]?.denunciante_nro),1)):g("",!0)]),e("td",null,[e("div",ae,s(l.nombrePersona(t.denunciados?.[0],"denunciado")),1),t.denunciados?.[0]?.denunciado_nro?(r(),d("div",se," CI: "+s(t.denunciados?.[0]?.denunciado_nro),1)):g("",!0)]),e("td",null,s(t.caso_tipologia||"—"),1),e("td",null,s(t.zona||"—"),1),e("td",null,s(l.fmt(t.nurej)),1),e("td",null,s(l.fmt(t.cud)),1),e("td",null,s(l.fmt(t.numero_juzgado)),1),e("td",null,s(t.estado_caso||"—"),1),e("td",oe,s(l.fmt(t.observaciones)),1),e("td",null,s(l.AniosMesesdiasAgo(t.fecha_apertura_caso))+" Dias ",1),e("td",null,[t.mi_estado?.me_asignado?(r(),d(m,{key:0},[t.mi_estado.primer_informe_hecho?(r(),f(x,{key:0,color:"green","text-color":"white",class:"q-mr-xs"},{default:c(()=>[u(s(t.mi_estado.label_listo||"Primer informe listo"),1)]),_:2},1024)):(r(),d(m,{key:1},[i(x,{color:t.mi_estado.atrasado?"red":"orange","text-color":t.mi_estado.atrasado?"white":"black",class:"q-mr-xs"},{default:c(()=>[t.mi_estado.atrasado?(r(),d(m,{key:0},[u(" Atrasado "+s(Math.abs(t.mi_estado.dias_restantes))+" d ",1)],64)):(r(),d(m,{key:1},[u(" Faltan "+s(t.mi_estado.dias_restantes)+" d ",1)],64))]),_:2},1032,["color","text-color"]),i(k,{"transition-show":"jump-down","transition-hide":"jump-up"},{default:c(()=>[a[9]||(a[9]=u(" Debes cargar tu ")),e("b",null,s(t.mi_estado.rol==="Psicologo"?"primera sesión":"primer informe"),1),a[10]||(a[10]=u(".")),a[11]||(a[11]=e("br",null,null,-1)),a[12]||(a[12]=u(" Fecha límite: ")),e("b",null,s(t.mi_estado.deadline),1),a[13]||(a[13]=u(". "))]),_:2},1024)],64))],64)):(r(),d("span",le,"—"))])],10,W))),128))])):g("",!0)]),_:1}),e("div",ne,[i(C,{modelValue:n.perPage,"onUpdate:modelValue":[a[5]||(a[5]=t=>n.perPage=t),l.goFirstPage],options:[10,20,50],dense:"",outlined:"",style:{width:"120px"},label:"Por página"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",re,[e("div",ie,[a[15]||(a[15]=u(" Mostrando ")),e("b",null,s(n.meta.from||0),1),a[16]||(a[16]=u(" – ")),e("b",null,s(n.meta.to||0),1),a[17]||(a[17]=u(" de ")),e("b",null,s(n.meta.total||0),1),a[18]||(a[18]=u(" registros "))]),i(T,{modelValue:n.page,"onUpdate:modelValue":[a[6]||(a[6]=t=>n.page=t),l.fetchCasos],max:n.meta.last_page||1,"max-pages":"10","boundary-numbers":"","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])])]),_:3}),i(q,{modelValue:n.dialogFormat,"onUpdate:modelValue":a[8]||(a[8]=t=>n.dialogFormat=t),persistent:"",maximized:""},{default:c(()=>[i(I,{class:"q-pa-md"},{default:c(()=>[i(A,{class:"row items-center"},{default:c(()=>[a[19]||(a[19]=e("div",{class:"text-h6"},"Visualizar Casos/Estado",-1)),i(N),i(p,{icon:"close",flat:"",round:"",dense:"",onClick:a[7]||(a[7]=t=>n.dialogFormat=!1)})]),_:1}),i(w,{flat:"",bordered:"",dense:"",separator:"cell"},{default:c(()=>[a[26]||(a[26]=e("thead",null,[e("tr",{class:"bg-primary text-white"},[e("th",{style:{width:"60px"}},"#"),e("th",null,"Nº"),e("th",null,"Fecha"),e("th",null,"Denunciante"),e("th",null,"Denunciado"),e("th",null,"Tipología"),e("th",null,"Zona"),e("th",null,"Estado"),e("th",null,"Alerta"),e("th",{class:"col-extra"},"—"),e("th",{class:"col-extra"},"Legal"),e("th",{class:"col-extra"},"Psicológica"),e("th",{class:"col-extra"},"Trabajo Social"),e("th",{class:"col-extra"},"CUD"),e("th",{class:"col-extra"},"NUREJ"),e("th",{class:"col-extra"},"Juzgado"),e("th",{class:"col-extra"},"Fiscal"),e("th",{class:"col-extra"},"Estado (Legal)"),e("th",{class:"col-extra"},"Fecha Sentencia"),e("th",{class:"col-extra"},"Observaciones"),e("th",{class:"col-extra"},"Entrega/Derivación")])],-1)),e("tbody",null,[(r(!0),d(m,null,b(n.casos,(t,y)=>(r(),d("tr",{key:t.id,onClick:V=>l.goToDetalle(t),class:"cursor-pointer"},[e("td",null,s(l.rowIndex(y)),1),e("td",ue,s(h.tipo)+" "+s(t.caso_numero||"—"),1),e("td",ce,s(o.$filters.date?.(t.fecha_apertura_caso)??t.fecha_apertura_caso),1),e("td",null,[e("div",me,s(l.nombrePersona(t.denunciantes?.[0],"denunciante")),1),t.denunciantes?.[0]?.denunciante_nro?(r(),d("div",he," CI: "+s(t.denunciantes?.[0]?.denunciante_nro),1)):g("",!0)]),e("td",null,[e("div",_e,s(l.nombrePersona(t.denunciados?.[0],"denunciado")),1),t.denunciados?.[0]?.denunciado_nro?(r(),d("div",ge," CI: "+s(t.denunciados?.[0]?.denunciado_nro),1)):g("",!0)]),e("td",null,s(t.caso_tipologia||"—"),1),e("td",null,s(t.zona||"—"),1),e("td",null,s(t.estado_caso||"—"),1),e("td",null,[t.mi_estado?.me_asignado?(r(),d(m,{key:0},[t.mi_estado.primer_informe_hecho?(r(),f(x,{key:0,color:"green","text-color":"white",class:"q-mr-xs"},{default:c(()=>[u(s(t.mi_estado.label_listo||"Primer informe listo"),1)]),_:2},1024)):(r(),d(m,{key:1},[i(x,{color:t.mi_estado.atrasado?"red":"orange","text-color":t.mi_estado.atrasado?"white":"black",class:"q-mr-xs"},{default:c(()=>[t.mi_estado.atrasado?(r(),d(m,{key:0},[u(" Atrasado "+s(Math.abs(t.mi_estado.dias_restantes))+" d ",1)],64)):(r(),d(m,{key:1},[u(" Faltan "+s(t.mi_estado.dias_restantes)+" d ",1)],64))]),_:2},1032,["color","text-color"]),i(k,{"transition-show":"jump-down","transition-hide":"jump-up"},{default:c(()=>[a[20]||(a[20]=u(" Debes cargar tu ")),e("b",null,s(t.mi_estado.rol==="Psicologo"?"primera sesión":"primer informe"),1),a[21]||(a[21]=u(".")),a[22]||(a[22]=e("br",null,null,-1)),a[23]||(a[23]=u(" Fecha límite: ")),e("b",null,s(t.mi_estado.deadline),1),a[24]||(a[24]=u(". "))]),_:2},1024)],64))],64)):(r(),d("span",pe,"—"))]),a[25]||(a[25]=e("td",{class:"col-extra"},"—",-1)),e("td",fe,s(t.legal_user?.name??"—"),1),e("td",xe,s(t.psicologica_user?.name??"—"),1),e("td",ye,s(t.trabajo_social_user?.name??"—"),1),e("td",be,s(l.fmt(t.cud)),1),e("td",Ce,s(l.fmt(t.nurej)),1),e("td",ke,s(l.fmt(t.numero_juzgado)),1),e("td",we,s(l.fmt(t.responsable_fiscalia)),1),e("td",Pe,s(l.fmt(t.estado_caso||t.estado_caso_otro)),1),e("td",Ve,s(l.fmtFecha(t.fecha_sentencia)),1),e("td",Se,s(l.fmt(t.observaciones)),1),e("td",ve,s(t.numero_apoyo_integral?l.fmtFecha(t.fecha_entrega_juzgado||t.fecha_derivacion_area_legal):"—"),1)],8,de))),128))])]),_:1}),i(E,{align:"center",class:"q-pt-md"},{default:c(()=>[j(i(p,{label:"Cerrar",color:"grey-7",dense:"","no-caps":"",icon:"close"},null,512),[[B]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const Me=S(L,[["render",Fe],["__scopeId","data-v-9c8f5212"]]);export{Me as C};
