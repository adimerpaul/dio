import{_ as b,Y as v,c as y,o as n,w as a,b as t,a as e,a6 as g,f as x,a0 as d,a1 as k,a2 as w,Q as u,e as m,t as h,Z as _}from"./index-Q9Nkdiq1.js";import{Q as z}from"./QPage-xCbE-O3p.js";import{m as V}from"./vue3-apexcharts-UmJZ5sbE.js";const q={name:"Kpis",components:{apexchart:V},data(){const l=new Date,s=f=>f.toISOString().slice(0,10),i=new Date(l.getTime()-89*24*60*60*1e3);return{loading:!1,start:s(i),end:s(l),totals:{casos:0,problematicas:0,sesiones:0,informes:0},avgHours:{to_first_problematica:null,to_first_sesion:null,to_first_informe:null},mensual:{labels:[],casos:[],prob:[],ses:[],inf:[]},tipologia:[],zona:[],tipologiaLabels:[],tipologiaVals:[],zonaLabels:[],zonaVals:[]}},computed:{cards(){return[{key:"casos",label:"Casos",value:this.totals.casos},{key:"problematicas",label:"Problemáticas",value:this.totals.problematicas},{key:"sesiones",label:"Sesiones Psicológicas",value:this.totals.sesiones},{key:"informes",label:"Informes",value:this.totals.informes}]},areaOptions(){return{chart:{toolbar:{show:!0},foreColor:"#666"},stroke:{curve:"smooth",width:2},dataLabels:{enabled:!1},xaxis:{categories:this.mensual.labels},legend:{position:"top"},grid:{borderColor:"#eee"}}},areaSeries(){return[{name:"Casos",data:this.mensual.casos},{name:"Problemáticas",data:this.mensual.prob},{name:"Sesiones",data:this.mensual.ses},{name:"Informes",data:this.mensual.inf}]}},mounted(){this.fetchKpis()},methods:{async fetchKpis(){this.loading=!0;try{const s=(await this.$axios.get("/kpis",{params:{start:this.start,end:this.end}})).data||{};this.totals=s.totals||this.totals,this.avgHours=s.avg_hours||this.avgHours,this.mensual=s.mensual||this.mensual,this.tipologia=s.por_tipologia||[],this.tipologiaLabels=this.tipologia.map(i=>i.name||"—"),this.tipologiaVals=this.tipologia.map(i=>i.value||0),this.zona=s.por_zona||[],this.zonaLabels=this.zona.map(i=>i.name||"—"),this.zonaVals=this.zona.map(i=>i.value||0)}catch(l){this.$q.notify({type:"negative",message:l?.response?.data?.message||"No se pudo cargar KPIs"})}finally{this.loading=!1}},toPerc(l){if(l==null)return 0;const i=Math.max(0,Math.min(100,l/168*100));return Math.round(i)},gaugeOptions(l){return{chart:{sparkline:{enabled:!0}},plotOptions:{radialBar:{hollow:{size:"60%"},dataLabels:{name:{show:!1},value:{show:!0,fontSize:"22px",formatter:s=>`${s}%`}}}},labels:[l]}},barOptions(l){return{chart:{toolbar:{show:!1}},xaxis:{categories:l==="Tipología"?this.tipologiaLabels:this.zonaLabels},plotOptions:{bar:{horizontal:!0,borderRadius:4}},dataLabels:{enabled:!1},grid:{borderColor:"#eee"}}}}},P={class:"row items-center q-col-gutter-md q-mb-md"},C={class:"col-12 col-sm-5"},H={class:"col-12 col-sm-5"},O={class:"col-12 col-sm-2"},S={class:"row q-col-gutter-md q-mb-md"},L={class:"text-caption text-grey-7"},B={class:"text-h4"},I={class:"row q-col-gutter-md q-mb-md"},Q={class:"col-12 col-md-4"},T={class:"text-center q-pb-md text-grey-7"},K={key:0},D={key:1},M={class:"col-12 col-md-4"},N={class:"text-center q-pb-md text-grey-7"},A={key:0},Z={key:1},U={class:"col-12 col-md-4"},X={class:"text-center q-pb-md text-grey-7"},E={key:0},F={key:1},R={class:"row q-col-gutter-md q-mb-md"},Y={class:"col-12"},j={class:"row q-col-gutter-md"},G={class:"col-12 col-md-6"},J={class:"col-12 col-md-6"};function W(l,s,i,f,o,r){const p=v("apexchart");return n(),y(z,{class:"q-pa-md"},{default:a(()=>[t("div",P,[t("div",C,[e(g,{modelValue:o.start,"onUpdate:modelValue":s[0]||(s[0]=c=>o.start=c),type:"date",dense:"",outlined:"",label:"Desde"},null,8,["modelValue"])]),t("div",H,[e(g,{modelValue:o.end,"onUpdate:modelValue":s[1]||(s[1]=c=>o.end=c),type:"date",dense:"",outlined:"",label:"Hasta"},null,8,["modelValue"])]),t("div",O,[e(x,{color:"primary",icon:"refresh",label:"Actualizar",loading:o.loading,onClick:r.fetchKpis},null,8,["loading","onClick"])])]),t("div",S,[(n(!0),d(k,null,w(r.cards,c=>(n(),d("div",{class:"col-12 col-sm-3",key:c.key},[e(u,{flat:"",bordered:"",class:"kpi-card"},{default:a(()=>[e(m,null,{default:a(()=>[t("div",L,h(c.label),1),t("div",B,h(c.value??"—"),1)]),_:2},1024)]),_:2},1024)]))),128))]),t("div",I,[t("div",Q,[e(u,{flat:"",bordered:""},{default:a(()=>[e(m,{class:"text-subtitle1"},{default:a(()=>s[2]||(s[2]=[_("Promedio a 1ª Problemática (h)")])),_:1}),e(p,{type:"radialBar",height:"240",options:r.gaugeOptions("Problemática"),series:[r.toPerc(o.avgHours.to_first_problematica)]},null,8,["options","series"]),t("div",T,[o.avgHours.to_first_problematica!=null?(n(),d("span",K,h(o.avgHours.to_first_problematica)+" h",1)):(n(),d("span",D,"—"))])]),_:1})]),t("div",M,[e(u,{flat:"",bordered:""},{default:a(()=>[e(m,{class:"text-subtitle1"},{default:a(()=>s[3]||(s[3]=[_("Promedio a 1ª Sesión (h)")])),_:1}),e(p,{type:"radialBar",height:"240",options:r.gaugeOptions("Sesión"),series:[r.toPerc(o.avgHours.to_first_sesion)]},null,8,["options","series"]),t("div",N,[o.avgHours.to_first_sesion!=null?(n(),d("span",A,h(o.avgHours.to_first_sesion)+" h",1)):(n(),d("span",Z,"—"))])]),_:1})]),t("div",U,[e(u,{flat:"",bordered:""},{default:a(()=>[e(m,{class:"text-subtitle1"},{default:a(()=>s[4]||(s[4]=[_("Promedio a 1º Informe (h)")])),_:1}),e(p,{type:"radialBar",height:"240",options:r.gaugeOptions("Informe"),series:[r.toPerc(o.avgHours.to_first_informe)]},null,8,["options","series"]),t("div",X,[o.avgHours.to_first_informe!=null?(n(),d("span",E,h(o.avgHours.to_first_informe)+" h",1)):(n(),d("span",F,"—"))])]),_:1})])]),t("div",R,[t("div",Y,[e(u,{flat:"",bordered:""},{default:a(()=>[e(m,{class:"text-subtitle1"},{default:a(()=>s[5]||(s[5]=[_("Series mensuales")])),_:1}),e(p,{type:"area",height:"340",options:r.areaOptions,series:r.areaSeries},null,8,["options","series"])]),_:1})])]),t("div",j,[t("div",G,[e(u,{flat:"",bordered:""},{default:a(()=>[e(m,{class:"text-subtitle1"},{default:a(()=>s[6]||(s[6]=[_("Top Tipologías")])),_:1}),e(p,{type:"bar",height:"360",options:r.barOptions("Tipología"),series:[{name:"Casos",data:o.tipologiaVals}]},null,8,["options","series"])]),_:1})]),t("div",J,[e(u,{flat:"",bordered:""},{default:a(()=>[e(m,{class:"text-subtitle1"},{default:a(()=>s[7]||(s[7]=[_("Top Zonas")])),_:1}),e(p,{type:"bar",height:"360",options:r.barOptions("Zona"),series:[{name:"Casos",data:o.zonaVals}]},null,8,["options","series"])]),_:1})])])]),_:1})}const ts=b(q,[["render",W],["__scopeId","data-v-d8fc168b"]]);export{ts as default};
