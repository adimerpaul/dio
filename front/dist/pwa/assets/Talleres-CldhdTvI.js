import{_ as S,Y as w,c as v,o as _,w as n,b as r,a as i,f as p,Q as C,e as f,h as I,d as x,t as g,a3 as D,a6 as u,a9 as y,Z as E,aa as q,ab as A,a8 as O,W as T,$ as R}from"./index-DJ6CKpc9.js";import{Q as L}from"./QSpace-CnoOZxcV.js";import{Q as h}from"./QSelect-ClX-p7Sx.js";import{Q as b,b as k,c as V}from"./QMenu-GDpnRToN.js";import{Q}from"./QPage-BSxG1T99.js";import{C as F}from"./ClosePopup-Ched2WLW.js";import{F as P,l as U,i as M,a as z,b as B}from"./es-BJJvMSS5.js";import"./format-Db6jwZln.js";const G={name:"TalleresCalendar",components:{FullCalendar:P},data(){return{dialog:{open:!1,isEdit:!1,currentId:null},solicitadoOpts:["DIRECTOR","SECRETARIA","PERSONAL UE"],colorOptions:[{label:"Azul",value:"#1976D2"},{label:"Verde",value:"#2E7D32"},{label:"Naranja",value:"#FB8C00"},{label:"Rojo",value:"#C62828"},{label:"Morado",value:"#6A1B9A"},{label:"Turquesa",value:"#0097A7"},{label:"Rosa",value:"#C2185B"}],form:{solicitado:null,fecha_inicio:"",fecha_final:"",colegio:"",curso:"",numero_asistentes:0,tema:"",descripcion:"",dirigido_a:"",color:"#1976D2"},saving:!1,deleting:!1,calendarOptions:{plugins:[M,z,B],locale:U,timeZone:"local",initialView:"timeGridWeek",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},slotMinTime:"06:00:00",slotMaxTime:"22:00:00",selectable:!0,editable:!0,eventOverlap:!1,events:(e,t,d)=>this.fetchEvents(e,t,d),select:e=>this.handleSelect(e),eventClick:e=>this.handleEventClick(e),eventDrop:e=>this.handleEventDrop(e),eventResize:e=>this.handleEventResize(e),eventDisplay:"block",nowIndicator:!0,height:"auto"}}},methods:{textColor(e){},req(e){return!!e||"Requerido"},reqNumber(e){return e===0||e==="0"?!0:!!e&&Number(e)>=0||"Número válido"},toApiLocal(e){return e?(e.length===16?`${e}:00`:e).replace("T"," "):null},toLocalInputValue(e){return(e||"").slice(0,16)},dateToLocalString(e){const t=e instanceof Date?e:new Date(e),d=N=>String(N).padStart(2,"0"),c=t.getFullYear(),l=d(t.getMonth()+1),s=d(t.getDate()),a=d(t.getHours()),o=d(t.getMinutes()),m=d(t.getSeconds());return`${c}-${l}-${s} ${a}:${o}:${m}`},async fetchEvents(e,t,d){try{const c=new URLSearchParams;c.set("start",e.startStr.slice(0,19)),c.set("end",e.endStr.slice(0,19));const{data:l}=await this.$axios.get(`/talleres?${c.toString()}`),s=l.map(a=>{const o=a.color||"#1976D2";return{id:a.id,title:`${a.colegio||"Taller"} - ${a.tema||"Sin tema"}`,start:a.fecha_inicio,end:a.fecha_final,backgroundColor:o,borderColor:o,textColor:this.textColor(o),extendedProps:{solicitado:a.solicitado,colegio:a.colegio,curso:a.curso,numero_asistentes:a.numero_asistentes,tema:a.tema,descripcion:a.descripcion,dirigido_a:a.dirigido_a,color:a.color}}});t(s)}catch(c){this.$q.notify({type:"negative",message:"No se pudo cargar los talleres"}),d(c)}},clearForm(){this.form={solicitado:null,fecha_inicio:"",fecha_final:"",colegio:"",curso:"",numero_asistentes:0,tema:"",descripcion:"",dirigido_a:"",color:"#1976D2"}},openCreate(e,t){this.clearForm(),this.dialog.isEdit=!1,this.dialog.currentId=null,this.form.fecha_inicio=this.toLocalInputValue(e),this.form.fecha_final=t?this.toLocalInputValue(t):"",this.dialog.open=!0},openEdit(e){this.clearForm(),this.dialog.isEdit=!0,this.dialog.currentId=e.id;const t=e.extendedProps;this.form.solicitado=t.solicitado,this.form.fecha_inicio=this.toLocalInputValue(e.startStr),this.form.fecha_final=e.endStr?this.toLocalInputValue(e.endStr):"",this.form.colegio=t.colegio||"",this.form.curso=t.curso||"",this.form.numero_asistentes=t.numero_asistentes||0,this.form.tema=t.tema||"",this.form.descripcion=t.descripcion||"",this.form.dirigido_a=t.dirigido_a||"",this.form.color=t.color||"#1976D2",this.dialog.open=!0},handleSelect(e){this.openCreate(e.startStr,e.endStr)},handleEventClick(e){this.openEdit(e.event)},async handleEventDrop(e){try{await this.$axios.put(`/talleres/${e.event.id}`,{fecha_inicio:this.dateToLocalString(e.event.start),fecha_final:e.event.end?this.dateToLocalString(e.event.end):null}),this.$q.notify({type:"positive",message:"Taller reprogramado"}),await this.refetch()}catch{e.revert(),this.$q.notify({type:"negative",message:"No se pudo reprogramar"})}},async handleEventResize(e){try{await this.$axios.put(`/talleres/${e.event.id}`,{fecha_final:e.event.end?this.dateToLocalString(e.event.end):null}),this.$q.notify({type:"positive",message:"Duración actualizada"}),await this.refetch()}catch{e.revert(),this.$q.notify({type:"negative",message:"No se pudo actualizar la duración"})}},async saveEvent(){if(!this.form.solicitado||!this.form.fecha_inicio||this.form.numero_asistentes===null){this.$q.notify({type:"warning",message:"Completa los campos obligatorios"});return}this.saving=!0;try{const e={...this.form};e.fecha_inicio=this.toApiLocal(this.form.fecha_inicio),e.fecha_final=this.form.fecha_final?this.toApiLocal(this.form.fecha_final):null,this.dialog.isEdit&&this.dialog.currentId?(await this.$axios.put(`/talleres/${this.dialog.currentId}`,e),this.$q.notify({type:"positive",message:"Taller actualizado"})):(await this.$axios.post("/talleres",e),this.$q.notify({type:"positive",message:"Taller creado"})),this.dialog.open=!1,await this.refetch()}catch(e){this.$q.notify({type:"negative",message:e?.response?.data?.message||"Error al guardar"})}finally{this.saving=!1}},async deleteEvent(){this.dialog.currentId&&this.$q.dialog({title:"Confirmar",message:"¿Eliminar este taller?",cancel:!0,persistent:!0}).onOk(async()=>{this.deleting=!0;try{await this.$axios.delete(`/talleres/${this.dialog.currentId}`),this.$q.notify({type:"warning",message:"Taller eliminado"}),this.dialog.open=!1,await this.refetch()}catch{this.$q.notify({type:"negative",message:"No se pudo eliminar"})}finally{this.deleting=!1}})},async refetch(){const e=this.$refs.calendar?.getApi?.();e&&e.refetchEvents()},openCreateForNow(){const e=new Date,t=m=>String(m).padStart(2,"0"),d=e.getFullYear(),c=t(e.getMonth()+1),l=t(e.getDate()),s=t(e.getHours()),a=t(e.getMinutes()),o=`${d}-${c}-${l}T${s}:${a}`;this.openCreate(o,"")}}},$={class:"row items-center q-mb-md"},H={class:"col-auto"},Y={class:"text-subtitle1 text-weight-medium"},W={class:"row q-col-gutter-sm"},Z={class:"col-6"},j={class:"col-6"},J={class:"row q-col-gutter-sm"},K={class:"col-6"},X={class:"col-6"},ee={class:"row q-col-gutter-sm"},te={class:"col-6"},oe={class:"col-6"};function le(e,t,d,c,l,s){const a=w("FullCalendar");return _(),v(Q,{class:"q-pa-md bg-grey-2"},{default:n(()=>[r("div",$,[t[11]||(t[11]=r("div",{class:"col"},[r("div",{class:"text-h6 text-weight-bold"},"Talleres"),r("div",{class:"text-caption text-grey-7"},"Gestión en calendario")],-1)),r("div",H,[i(p,{color:"primary",icon:"add",label:"Nuevo Taller",onClick:s.openCreateForNow},null,8,["onClick"]),i(p,{flat:"",icon:"refresh",class:"q-ml-sm",onClick:s.refetch},null,8,["onClick"])])]),i(C,{flat:"",bordered:"",class:"section-card"},{default:n(()=>[i(f,null,{default:n(()=>[i(a,{ref:"calendar",options:l.calendarOptions},null,8,["options"])]),_:1})]),_:1}),i(I,{modelValue:l.dialog.open,"onUpdate:modelValue":t[10]||(t[10]=o=>l.dialog.open=o),persistent:""},{default:n(()=>[i(C,{style:{"min-width":"500px","max-width":"700px"}},{default:n(()=>[i(f,{class:"row items-center q-gutter-sm"},{default:n(()=>[i(x,{name:"workshop"}),r("div",Y,g(l.dialog.isEdit?"Editar Taller":"Nuevo Taller"),1),i(L)]),_:1}),i(D),i(f,{class:"q-gutter-md"},{default:n(()=>[i(h,{modelValue:l.form.solicitado,"onUpdate:modelValue":t[0]||(t[0]=o=>l.form.solicitado=o),options:l.solicitadoOpts,label:"Solicitado *",dense:"",outlined:"",rules:[s.req]},null,8,["modelValue","options","rules"]),r("div",W,[r("div",Z,[i(u,{modelValue:l.form.fecha_inicio,"onUpdate:modelValue":t[1]||(t[1]=o=>l.form.fecha_inicio=o),type:"datetime-local",label:"Fecha inicio *",dense:"",outlined:"",rules:[s.req]},null,8,["modelValue","rules"])]),r("div",j,[i(u,{modelValue:l.form.fecha_final,"onUpdate:modelValue":t[2]||(t[2]=o=>l.form.fecha_final=o),type:"datetime-local",label:"Fecha final",dense:"",outlined:""},null,8,["modelValue"])])]),r("div",J,[r("div",K,[i(u,{modelValue:l.form.colegio,"onUpdate:modelValue":t[3]||(t[3]=o=>l.form.colegio=o),label:"Colegio",dense:"",outlined:""},null,8,["modelValue"])]),r("div",X,[i(u,{modelValue:l.form.curso,"onUpdate:modelValue":t[4]||(t[4]=o=>l.form.curso=o),label:"Curso",dense:"",outlined:""},null,8,["modelValue"])])]),r("div",ee,[r("div",te,[i(u,{modelValue:l.form.numero_asistentes,"onUpdate:modelValue":t[5]||(t[5]=o=>l.form.numero_asistentes=o),modelModifiers:{number:!0},type:"number",min:"0",label:"Nº asistentes *",dense:"",outlined:"",rules:[s.reqNumber]},null,8,["modelValue","rules"])]),r("div",oe,[i(h,{modelValue:l.form.dirigido_a,"onUpdate:modelValue":t[6]||(t[6]=o=>l.form.dirigido_a=o),options:["ESTUDIANTE","PADRES DE FAMILIA","PROFESORES/PERSONAL UE"],label:"Dirigido a",dense:"",outlined:""},null,8,["modelValue"])])]),i(h,{modelValue:l.form.tema,"onUpdate:modelValue":t[7]||(t[7]=o=>l.form.tema=o),options:["PREVENCION DE ALCOHOLIMO","PREVENCION DE ALCOHOLIMO Y DROGADICCION","PREVENCION DE VIOLENCIA (BULLING)","PREVENCION DE EMBARAZON NNA","PRIMERA INFANCIA"],label:"Tema",dense:"",outlined:""},null,8,["modelValue"]),i(u,{modelValue:l.form.descripcion,"onUpdate:modelValue":t[8]||(t[8]=o=>l.form.descripcion=o),type:"textarea",autogrow:"",label:"Descripción",dense:"",outlined:""},null,8,["modelValue"]),i(h,{modelValue:l.form.color,"onUpdate:modelValue":t[9]||(t[9]=o=>l.form.color=o),options:l.colorOptions,"option-value":"value","option-label":"label","emit-value":"","map-options":"",dense:"",outlined:"",clearable:"",label:"Color del taller"},{option:n(o=>[i(k,q(A(o.itemProps)),{default:n(()=>[i(V,{avatar:""},{default:n(()=>[i(b,{square:"",style:y({background:o.opt.value,color:s.textColor(o.opt.value)})},null,8,["style"])]),_:2},1024),i(V,null,{default:n(()=>[E(g(o.opt.label),1)]),_:2},1024)]),_:2},1040)]),"selected-item":n(o=>[i(b,{square:"",style:y({background:o.opt,color:s.textColor(o.opt)}),size:"sm"},{default:n(()=>[E(g((l.colorOptions.find(m=>m.value===o.opt)||{}).label||"Color"),1)]),_:2},1032,["style"])]),_:1},8,["modelValue","options"])]),_:1}),i(O,{align:"right"},{default:n(()=>[T(i(p,{flat:"",label:"Cancelar"},null,512),[[F]]),i(p,{color:"primary",label:l.dialog.isEdit?"Actualizar":"Crear",loading:l.saving,onClick:s.saveEvent},null,8,["label","loading","onClick"]),l.dialog.isEdit?(_(),v(p,{key:0,flat:"",color:"negative",label:"Eliminar",loading:l.deleting,onClick:s.deleteEvent},null,8,["loading","onClick"])):R("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const me=S(G,[["render",le],["__scopeId","data-v-86285030"]]);export{me as default};
