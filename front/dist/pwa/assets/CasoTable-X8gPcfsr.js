import{_ as x,c as g,o as r,w as m,b as t,a as u,a6 as C,$ as p,f,d as P,a7 as w,ag as k,a0 as d,a1 as c,a2 as S,t as a,Z as i}from"./index-BytFJZqo.js";import{Q as V}from"./QSelect-BNkSTSfC.js";import{Q as y}from"./QBadge-CYPGQ_Km.js";import{Q}from"./QTooltip-B-FvqnbI.js";import{Q as v}from"./QMarkupTable-K8HlLNlJ.js";import{Q as I}from"./QPagination-BMyjj9fw.js";import{Q as q}from"./QPage-DNKhu0wz.js";const D={name:"CasoTable",props:{tipo:{type:String,required:!0},leerOnlyPendientesDeRuta:{type:Boolean,default:!0},placeholder:{type:String,default:""},perPageInit:{type:Number,default:10}},data(){return{casos:[],loading:!1,page:1,perPage:this.perPageInit,meta:{current_page:1,last_page:1,total:0,from:0,to:0},search:"",onlyPendientes:!1,showExtra:!1}},computed:{isSLIM(){return String(this.tipo).toUpperCase()==="SLIM"},placeholderComputed(){return this.placeholder?this.placeholder:`Buscar por N° ${this.tipo?.toUpperCase()||"CASO"}, denunciante, denunciado, tipología, zona…`},baseColspan(){return this.isSLIM&&this.showExtra?21:9}},mounted(){this.leerOnlyPendientesDeRuta&&(this.onlyPendientes=String(this.$route?.query?.only_pendientes||"")==="1"),this.fetchCasos()},watch:{"$route.query.only_pendientes"(n){this.leerOnlyPendientesDeRuta&&(this.onlyPendientes=String(n||"")==="1",this.goFirstPage())}},methods:{refresh(){this.fetchCasos()},fetchCasos(){this.loading=!0,this.$axios.get("/casos",{params:{q:this.search||"",tipo:this.tipo,page:this.page,per_page:this.perPage,only_pendientes:this.onlyPendientes?1:0}}).then(n=>{const e=n.data||{};this.casos=e.data||[],this.meta={current_page:e.current_page||1,last_page:e.last_page||1,total:e.total||0,from:e.from||0,to:e.to||0},this.page=this.meta.current_page}).catch(n=>this.$alert?.error?.(n.response?.data?.message||"Error cargando casos")||console.error(n)).finally(()=>{this.loading=!1})},onSearch(){this.page=1,this.fetchCasos()},clearSearch(){this.search="",this.onSearch()},goFirstPage(){this.page=1,this.fetchCasos()},rowIndex(n){return(this.meta.from||0)+n},goToDetalle(n){this.$router.push("/casos/"+n.id)},nombrePersona(n,e="denunciante"){return n&&(e==="denunciante"?[n.denunciante_nombres,n.denunciante_paterno,n.denunciante_materno]:[n.denunciado_nombres,n.denunciado_paterno,n.denunciado_materno]).filter(Boolean).join(" ")||"—"},fmt(n){return(n??"")!==""?n:"—"},fmtFecha(n){if(!n)return"—";try{const e=new Date(String(n).replace(" ","T")),h=String(e.getDate()).padStart(2,"0"),_=String(e.getMonth()+1).padStart(2,"0"),s=e.getFullYear();return`${h}/${_}/${s}`}catch{return n}}}},F={class:"row items-center q-col-gutter-md q-mb-md"},T={class:"col-12 col-md"},U={class:"col-auto"},B={class:"col-auto"},E={class:"col-auto row items-center"},M={key:0},N=["onClick"],z={class:"text-no-wrap"},L={class:"text-no-wrap"},O={class:"text-weight-medium"},j={key:0,class:"text-caption text-grey-7"},A={class:"text-weight-medium"},R={key:0,class:"text-caption text-grey-7"},Z={key:1,class:"text-grey-6"},Y={class:"row items-center justify-between q-mt-md"},G={class:"text-caption text-grey-7"};function H(n,e,h,_,s,l){return r(),g(q,{class:"q-pa-md"},{default:m(()=>[t("div",F,[t("div",T,[u(C,{modelValue:s.search,"onUpdate:modelValue":[e[0]||(e[0]=o=>s.search=o),l.onSearch],outlined:"",dense:"",debounce:"400",placeholder:l.placeholderComputed},{prepend:m(()=>[u(P,{name:"search"})]),append:m(()=>[s.search?(r(),g(f,{key:0,flat:"",dense:"",round:"",icon:"close",onClick:l.clearSearch},null,8,["onClick"])):p("",!0)]),_:1},8,["modelValue","placeholder","onUpdate:modelValue"])]),t("div",U,[u(w,{modelValue:s.onlyPendientes,"onUpdate:modelValue":[e[1]||(e[1]=o=>s.onlyPendientes=o),l.goFirstPage],color:"primary",label:"Solo mis pendientes"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",B,[u(V,{modelValue:s.perPage,"onUpdate:modelValue":[e[2]||(e[2]=o=>s.perPage=o),l.goFirstPage],options:[10,20,50],dense:"",outlined:"",style:{width:"120px"},label:"Por página"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",E,[u(f,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",onClick:e[3]||(e[3]=o=>l.fetchCasos()),loading:s.loading,class:"q-mr-sm",size:"10px"},null,8,["loading"]),l.isSLIM?(r(),g(f,{key:0,color:"green",icon:"visibility","no-caps":"",size:"10px",label:s.showExtra?"Ocultar columnas extra":"Visualizar Casos",onClick:e[4]||(e[4]=o=>s.showExtra=!s.showExtra)},null,8,["label"])):p("",!0),k(n.$slots,"actions",{},void 0,!0)])]),u(v,{flat:"",bordered:"",dense:""},{default:m(()=>[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",{style:{width:"60px"}},"#"),t("th",null,"Nº"),t("th",null,"Fecha"),t("th",null,"Denunciante"),t("th",null,"Denunciado"),t("th",null,"Tipología"),t("th",null,"Zona"),t("th",null,"Estado"),t("th",null,"Alerta")])],-1)),!s.loading&&s.casos.length?(r(),d("tbody",M,[(r(!0),d(c,null,S(s.casos,(o,b)=>(r(),d("tr",{key:o.id,onClick:J=>l.goToDetalle(o),class:"cursor-pointer"},[t("td",null,a(l.rowIndex(b)),1),t("td",z,a(h.tipo)+" "+a(o.caso_numero||"—"),1),t("td",L,a(n.$filters.date?.(o.fecha_apertura_caso)??o.fecha_apertura_caso),1),t("td",null,[t("div",O,a(l.nombrePersona(o.denunciantes?.[0],"denunciante")),1),o.denunciantes?.[0]?.denunciante_nro?(r(),d("div",j," CI: "+a(o.denunciantes?.[0]?.denunciante_nro),1)):p("",!0)]),t("td",null,[t("div",A,a(l.nombrePersona(o.denunciados?.[0],"denunciado")),1),o.denunciados?.[0]?.denunciado_nro?(r(),d("div",R," CI: "+a(o.denunciados?.[0]?.denunciado_nro),1)):p("",!0)]),t("td",null,a(o.caso_tipologia||"—"),1),t("td",null,a(o.zona||"—"),1),t("td",null,a(o.estado_caso||"—"),1),t("td",null,[o.mi_estado?.me_asignado?(r(),d(c,{key:0},[o.mi_estado.primer_informe_hecho?(r(),g(y,{key:0,color:"green","text-color":"white",class:"q-mr-xs"},{default:m(()=>[i(a(o.mi_estado.label_listo||"Primer informe listo"),1)]),_:2},1024)):(r(),d(c,{key:1},[u(y,{color:o.mi_estado.atrasado?"red":"orange","text-color":o.mi_estado.atrasado?"white":"black",class:"q-mr-xs"},{default:m(()=>[o.mi_estado.atrasado?(r(),d(c,{key:0},[i(" Atrasado "+a(Math.abs(o.mi_estado.dias_restantes))+" d ",1)],64)):(r(),d(c,{key:1},[i(" Faltan "+a(o.mi_estado.dias_restantes)+" d ",1)],64))]),_:2},1032,["color","text-color"]),u(Q,{"transition-show":"jump-down","transition-hide":"jump-up"},{default:m(()=>[e[6]||(e[6]=i(" Debes cargar tu ")),t("b",null,a(o.mi_estado.rol==="Psicologo"?"primera sesión":"primer informe"),1),e[7]||(e[7]=i(".")),e[8]||(e[8]=t("br",null,null,-1)),e[9]||(e[9]=i(" Fecha límite: ")),t("b",null,a(o.mi_estado.deadline),1),e[10]||(e[10]=i(". "))]),_:2},1024)],64))],64)):(r(),d("span",Z,"—"))])],8,N))),128))])):p("",!0)]),_:1}),t("div",Y,[t("div",G,[e[12]||(e[12]=i(" Mostrando ")),t("b",null,a(s.meta.from||0),1),e[13]||(e[13]=i(" – ")),t("b",null,a(s.meta.to||0),1),e[14]||(e[14]=i(" de ")),t("b",null,a(s.meta.total||0),1),e[15]||(e[15]=i(" registros "))]),u(I,{modelValue:s.page,"onUpdate:modelValue":[e[5]||(e[5]=o=>s.page=o),l.fetchCasos],max:s.meta.last_page||1,"max-pages":"10","boundary-numbers":"","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])])]),_:3})}const ne=x(D,[["render",H],["__scopeId","data-v-89a287a0"]]);export{ne as C};
