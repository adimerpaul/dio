import{_ as b,c as g,o as a,w as u,b as o,a as r,a6 as x,$ as h,f as _,d as k,a7 as w,a0 as i,a1 as c,a2 as S,t as s,Z as d}from"./index-CJkF-2xs.js";import{Q as P}from"./QSelect-BwLskIkO.js";import{Q as y}from"./QBadge-Cic-RBco.js";import{Q as V}from"./QTooltip-CR_jBYjg.js";import{Q}from"./QSpinnerDots-CtXMBrOz.js";import{Q as v}from"./QMarkupTable-Baj0S7sh.js";import{Q as I}from"./QPagination-Cmd4TnTS.js";import{Q as U}from"./QPage-BVfCMHyM.js";import"./QMenu-CuLTUHuz.js";import"./format-DDiNVORe.js";const q={name:"SlimsPage",data(){return{slims:[],loading:!1,page:1,perPage:10,meta:{current_page:1,last_page:1,total:0,from:0,to:0},search:"",onlyPendientes:!1}},mounted(){this.onlyPendientes=String(this.$route.query.only_pendientes||"")==="1",this.fetchSlims()},watch:{"$route.query.only_pendientes"(l){this.onlyPendientes=String(l||"")==="1",this.goFirstPage()}},methods:{imprimir(){this.$axios.get("/slimsImprimir").then(l=>{const e=new Blob([l.data],{type:"application/pdf"}),p=document.createElement("a");p.href=window.URL.createObjectURL(e),p.download="slims.pdf",p.click(),window.URL.revokeObjectURL(p.href)}).catch(l=>this.$alert.error(l.response?.data?.message||"Error imprimiendo SLIMs"))},fetchSlims(){this.loading=!0,this.$axios.get("/casos",{params:{q:this.search||"",tipo:"SLIM",page:this.page,per_page:this.perPage,only_pendientes:this.onlyPendientes?1:0}}).then(l=>{const e=l.data||{};this.slims=e.data||[],this.meta={current_page:e.current_page||1,last_page:e.last_page||1,total:e.total||0,from:e.from||0,to:e.to||0},this.page=this.meta.current_page}).catch(l=>this.$alert.error(l.response?.data?.message||"Error cargando SLIMs")).finally(()=>{this.loading=!1})},onSearch(){this.page=1,this.fetchSlims()},clearSearch(){this.search="",this.onSearch()},goFirstPage(){this.page=1,this.fetchSlims()},rowIndex(l){return(this.meta.from||0)+l}}},C={class:"row items-center q-col-gutter-md q-mb-md"},L={class:"col-12 col-md"},B={class:"col-auto"},F={class:"col-auto"},M={class:"col-auto"},N={key:0},T=["onClick"],j={class:"text-no-wrap"},D={class:"text-no-wrap"},R={class:"text-weight-medium"},z={key:0,class:"text-caption text-grey-7"},A={class:"text-weight-medium"},E={key:0,class:"text-caption text-grey-7"},O={key:1,class:"text-grey-6"},Z={key:1},G={key:2},H={colspan:"9",class:"text-center"},J={class:"row items-center justify-between q-mt-md"},K={class:"text-caption text-grey-7"};function W(l,e,p,X,n,m){return a(),g(U,{class:"q-pa-md"},{default:u(()=>[o("div",C,[o("div",L,[r(x,{modelValue:n.search,"onUpdate:modelValue":[e[0]||(e[0]=t=>n.search=t),m.onSearch],outlined:"",dense:"",debounce:"400",placeholder:"Buscar por N° SLIM, denunciante, denunciado, tipología, zona…"},{prepend:u(()=>[r(k,{name:"search"})]),append:u(()=>[n.search?(a(),g(_,{key:0,flat:"",dense:"",round:"",icon:"close",onClick:m.clearSearch},null,8,["onClick"])):h("",!0)]),_:1},8,["modelValue","onUpdate:modelValue"])]),o("div",B,[r(w,{modelValue:n.onlyPendientes,"onUpdate:modelValue":[e[1]||(e[1]=t=>n.onlyPendientes=t),m.goFirstPage],color:"primary",label:"Solo mis pendientes"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",F,[r(P,{modelValue:n.perPage,"onUpdate:modelValue":[e[2]||(e[2]=t=>n.perPage=t),m.goFirstPage],options:[10,20,50],dense:"",outlined:"",style:{width:"120px"},label:"Por página"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",M,[r(_,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",onClick:e[3]||(e[3]=t=>m.fetchSlims()),loading:n.loading},null,8,["loading"]),r(_,{color:"secondary",icon:"print",label:"Imprimir","no-caps":"",onClick:e[4]||(e[4]=t=>m.imprimir())})])]),r(v,{flat:"",bordered:"",dense:""},{default:u(()=>[e[13]||(e[13]=o("thead",null,[o("tr",null,[o("th",{style:{width:"60px"}},"#"),o("th",null,"Nº "),o("th",null,"Fecha"),o("th",null,"Denunciante"),o("th",null,"Denunciado"),o("th",null,"Tipología"),o("th",null,"Zona"),o("th",null,"Tipo"),o("th",null,"Alerta")])],-1)),!n.loading&&n.slims.length?(a(),i("tbody",N,[(a(!0),i(c,null,S(n.slims,(t,f)=>(a(),i("tr",{key:t.id,onClick:Y=>l.$router.push("/casos/"+t.id),class:"cursor-pointer"},[o("td",null,s(m.rowIndex(f)),1),o("td",j,s(t.tipo)+" "+s(t.caso_numero||"—"),1),o("td",D,s(l.$filters.date(t.fecha_apertura_caso)),1),o("td",null,[o("div",R,s(t.denunciantes[0].denunciante_nombres==null?"—":t.denunciantes[0].denunciante_nombres+" "+(t.denunciantes[0].denunciante_paterno||"")+" "+(t.denunciantes[0].denunciante_materno||"")),1),t.denunciantes[0].denunciante_nro?(a(),i("div",z,"CI: "+s(t.denunciantes[0].denunciante_nro),1)):h("",!0)]),o("td",null,[o("div",A,s(t.denunciados[0]?.denunciado_nombres==null?"—":t.denunciados[0]?.denunciado_nombres+" "+(t.denunciados[0]?.denunciado_paterno||"")+" "+(t.denunciados[0]?.denunciado_materno||"")),1),t.denunciados[0]?.denunciado_nro?(a(),i("div",E,"CI: "+s(t.denunciados[0]?.denunciado_nro),1)):h("",!0)]),o("td",null,s(t.caso_tipologia||"—"),1),o("td",null,s(t.zona||"—"),1),o("td",null,[r(y,{color:t.numero_apoyo_integral?"green":"grey-5","text-color":t.numero_apoyo_integral?"white":"black",label:t.numero_apoyo_integral?"Apoyo Integral":"Regular",rounded:"",dense:""},null,8,["color","text-color","label"])]),o("td",null,[t.mi_estado?.me_asignado?(a(),i(c,{key:0},[t.mi_estado.primer_informe_hecho?(a(),g(y,{key:0,color:"green","text-color":"white",class:"q-mr-xs"},{default:u(()=>[d(s(t.mi_estado.label_listo||"Primer informe listo"),1)]),_:2},1024)):(a(),i(c,{key:1},[r(y,{color:t.mi_estado.atrasado?"red":"orange","text-color":t.mi_estado.atrasado?"white":"black",class:"q-mr-xs"},{default:u(()=>[t.mi_estado.atrasado?(a(),i(c,{key:0},[d(" Atrasado "+s(Math.abs(t.mi_estado.dias_restantes))+" d ",1)],64)):(a(),i(c,{key:1},[d(" Faltan "+s(t.mi_estado.dias_restantes)+" d ",1)],64))]),_:2},1032,["color","text-color"]),r(V,{"transition-show":"jump-down","transition-hide":"jump-up"},{default:u(()=>[e[6]||(e[6]=d(" Debes cargar tu ")),o("b",null,s(t.mi_estado.rol==="Psicologo"?"primera sesión":"primer informe"),1),e[7]||(e[7]=d(".")),e[8]||(e[8]=o("br",null,null,-1)),e[9]||(e[9]=d(" Fecha límite: ")),o("b",null,s(t.mi_estado.deadline),1),e[10]||(e[10]=d(". "))]),_:2},1024)],64))],64)):(a(),i("span",O,"—"))])],8,T))),128))])):!n.loading&&!n.slims.length?(a(),i("tbody",Z,e[11]||(e[11]=[o("tr",null,[o("td",{colspan:"9",class:"text-center text-grey"}," No hay resultados para tu búsqueda. ")],-1)]))):(a(),i("tbody",G,[o("tr",null,[o("td",H,[r(Q,{size:"24px",class:"q-mr-sm"}),e[12]||(e[12]=d(" Cargando… "))])])]))]),_:1}),o("div",J,[o("div",K,[e[14]||(e[14]=d(" Mostrando ")),o("b",null,s(n.meta.from||0),1),e[15]||(e[15]=d(" – ")),o("b",null,s(n.meta.to||0),1),e[16]||(e[16]=d(" de ")),o("b",null,s(n.meta.total||0),1),e[17]||(e[17]=d(" registros "))]),r(I,{modelValue:n.page,"onUpdate:modelValue":[e[5]||(e[5]=t=>n.page=t),m.fetchSlims],max:n.meta.last_page||1,"max-pages":"10","boundary-numbers":"","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])])]),_:1})}const de=b(q,[["render",W],["__scopeId","data-v-a6d89386"]]);export{de as default};
