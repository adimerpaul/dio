import{_ as E,Y as I,a0 as v,o as f,b as l,$ as x,t as r,c as p,f as h,a1 as q,a as i,w as n,e as b,d as y,a3 as w,Z as c,Q as V,a6 as m,a7 as ae,aa as W,a2 as M,W as k,h as O,a8 as L}from"./index-D0BWmPW-.js";import{a as U,d as g,Q as oe}from"./format-Ca8Yi27f.js";import{Q,a as ee}from"./QList-BsVcAQMn.js";import{S as F,Q as le,a as ne,b as de,c as re,d as N,e as ce,f as S}from"./QFile-cqCYDp9w.js";import{Q as ue}from"./QPage-C6t6BI-N.js";import{C}from"./ClosePopup-BXqE_iMM.js";import{Q as R}from"./QSelect-C0H1cK3W.js";import{M as me}from"./MapPicker-4MPc14CD.js";import{Q as K}from"./QMarkupTable-CguuwvQl.js";import{Q as z}from"./QSpace-C-pXF1F4.js";import{Q as ie}from"./QImg-BI3RujQv.js";import{Q as te,a as P}from"./QTimeline-Be8C5YNY.js";import"./QResizeObserver-6v3LyEUm.js";import"./touch-BjYP5sR0.js";import"./QTooltip-Bd2172wv.js";import"./use-fullscreen-BqDCohB8.js";import"./_commonjsHelpers-Cpj98o6Y.js";const fe={name:"UmadiInfoGeneral",components:{MapPicker:me},props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:()=>null}},data(){return{loading:!1,editing:!1,backup:null,oruroCenter:[-17.9667,-67.1167],psicologos:[],abogados:[],sociales:[],form:{}}},computed:{canEdit(){const t=this.$store.user?.role||"";return t==="Administrador"||t==="Asistente"},nombreDenunciante(){const t=this.form||{};return[t.nombres,t.paterno,t.materno].filter(Boolean).join(" ").trim()||"—"},nombreDenunciado(){const t=this.form||{};return[t.denunciado_nombres,t.denunciado_paterno,t.denunciado_materno].filter(Boolean).join(" ").trim()||"—"},optPsicologos(){return this.psicologos.map(t=>({label:t.name,value:t.id}))},optAbogados(){return this.abogados.map(t=>({label:t.name,value:t.id}))},optSociales(){return this.sociales.map(t=>({label:t.name,value:t.id}))},mapModel:{get(){return{latitud:this.form.latitud,longitud:this.form.longitud}},set(t){this.form.latitud=t?.latitud??t?.lat??null,this.form.longitud=t?.longitud??t?.lng??null}}},watch:{caso:{immediate:!0,deep:!0,handler(t){if(!t)return;const e=t.umadi?t.umadi:t,u=this.normalizeFromBackend(e);this.form={...u},!this.form.psicologica_user_id&&e.psicologica_user?.id&&(this.form.psicologica_user_id=e.psicologica_user.id),!this.form.trabajo_social_user_id&&e.trabajo_social_user?.id&&(this.form.trabajo_social_user_id=e.trabajo_social_user.id),!this.form.legal_user_id&&e.legal_user?.id&&(this.form.legal_user_id=e.legal_user.id)}}},created(){this.fetchRoles()},methods:{orDash(t){return t!=null&&t!==""?t:"—"},yesNo(t){return t===!0||t===1||t==="1"?"Sí":"No"},onBirthChange(t){const e=t==="denunciado"?"denunciado":"",u=e?`${e}_fecha_nacimiento`:"fecha_nacimiento";if(!this.form[u])return;const _=new Date(this.form[u]),o=Date.now()-_.getTime(),s=Math.abs(new Date(o).getUTCFullYear()-1970);e?this.form.denunciado_edad=String(s):this.form.edad=String(s)},nombreUsuario(t,e,u){if(t&&t.name)return t.name;const _=(u||[]).find(o=>Number(o.id)===Number(e));return _&&(_.name||_.username)||"—"},normalizeFromBackend(t={}){const e=["trabaja","doc_ci","doc_frontal_denunciado","doc_frontal_denunciante","doc_croquis"],u={...t};return e.forEach(_=>{_ in u&&(u[_]=u[_]===1||u[_]===!0||u[_]==="1")}),u},prepareForSave(t={}){const e=["trabaja","doc_ci","doc_frontal_denunciado","doc_frontal_denunciante","doc_croquis"],u={...t};return e.forEach(_=>{_ in u&&(u[_]=u[_]?1:0)}),u},async fetchRoles(){try{const{data:t}=await this.$axios.get("/usuariosRole");this.psicologos=t.psicologos||[],this.abogados=t.abogados||[],this.sociales=t.sociales||[]}catch{this.$alert?.error?.("No se pudo cargar los usuarios por rol")||this.$q.notify({type:"negative",message:"No se pudo cargar los usuarios por rol"})}},startEdit(){this.canEdit&&(this.backup=JSON.parse(JSON.stringify(this.form)),this.editing=!0)},cancelEdit(){this.form=JSON.parse(JSON.stringify(this.backup||{})),this.editing=!1,this.$q.notify({type:"info",message:"Cambios descartados"})},async save(){if(this.canEdit){this.loading=!0;try{const t={umadi:this.prepareForSave(this.form)},{data:e}=await this.$axios.put(`/umadis/${this.caseId}`,t),u=e?.umadi?this.normalizeFromBackend(e.umadi):this.normalizeFromBackend(e);this.form={...u},this.editing=!1,this.$alert?.success?.("Información general actualizada")||this.$q.notify({type:"positive",message:"Información general actualizada"}),this.$emit("update")}catch(t){this.$alert?.error?.(t?.response?.data?.message||"No se pudo actualizar")||this.$q.notify({type:"negative",message:t?.response?.data?.message||"No se pudo actualizar"})}finally{this.loading=!1}}}}},_e={class:"row items-center q-mb-sm"},pe={class:"col"},ge={class:"text-caption text-grey-7"},he={key:0,class:"col-auto row q-gutter-sm"},be={class:"col-6 col-md-3"},ve={class:"col-6 col-md-3"},ye={class:"col-6 col-md-3"},Ve={class:"col-12 col-md-6"},xe={class:"col-6 col-md-3"},we={class:"col-6 col-md-3"},ke={class:"col-6 col-md-3"},Ce={class:"col-6 col-md-3"},Ue={class:"col-6 col-md-3"},qe={class:"col-6 col-md-3"},De={class:"col-12 col-md-6"},Ie={class:"col-12 col-md-6"},Ee={class:"col-6 col-md-3"},je={class:"col-6 col-md-3"},Se={class:"col-6 col-md-3"},Ne={class:"col-6 col-md-3"},Pe={class:"col-6 col-md-3"},Te={class:"col-6 col-md-3"},Ae={class:"col-6 col-md-3"},Fe={class:"col-6 col-md-3"},Re={class:"col-6 col-md-3"},Oe={class:"col-6 col-md-3"},Le={class:"col-6 col-md-3"},Qe={class:"col-6 col-md-3"},ze={class:"col-6 col-md-3"},Me={class:"col-6 col-md-3"},Ge={class:"col-12 col-md-6"},Be={class:"col-6 col-md-2"},He={class:"col-6 col-md-2"},We={class:"col-6 col-md-2"},Ye={class:"col-6 col-md-3"},Je={class:"col-6 col-md-3"},Ze={class:"col-12 col-md-6"},Xe={class:"col-6 col-md-3"},Ke={class:"col-6 col-md-3"},$e={class:"col-6 col-md-3"},eo={class:"col-6 col-md-3"},oo={class:"col-6 col-md-3"},lo={class:"col-6 col-md-3"},io={class:"col-6 col-md-3"},to={class:"col-6 col-md-3"},so={class:"col-12 col-md-6"},ao={class:"col-6 col-md-3"},no={class:"col-6 col-md-4"},ro={class:"col-12 col-md-5"},co={class:"col-12"},uo={class:"ellipsis-3"},mo={class:"col-12 col-md-4"},fo={class:"col-12 col-md-4"},_o={class:"col-12 col-md-4"},po={class:"col-6 col-md-3"},go={class:"col-6 col-md-3"},ho={class:"col-6 col-md-3"},bo={class:"col-6 col-md-3"},vo={class:"row q-col-gutter-md"},yo={class:"col-12 col-md-3"},Vo={class:"col-12 col-md-3"},xo={class:"col-12 col-md-3"},wo={class:"col-12 col-md-3"},ko={class:"col-6 col-md-2"},Co={class:"col-6 col-md-2"},Uo={class:"col-6 col-md-2"},qo={class:"col-6 col-md-3"},Do={class:"col-6 col-md-2"},Io={class:"col-6 col-md-3"},Eo={class:"col-6 col-md-3"},jo={class:"col-6 col-md-2"},So={class:"col-12 col-md-6"},No={class:"col-6 col-md-3"},Po={class:"col-6 col-md-3"},To={class:"col-6 col-md-3"},Ao={class:"col-6 col-md-3"},Fo={class:"col-6 col-md-3"},Ro={class:"col-6 col-md-3"},Oo={class:"col-6 col-md-3"},Lo={class:"col-6 col-md-3"},Qo={class:"col-6 col-md-3"},zo={class:"col-6 col-md-3"},Mo={class:"col-6 col-md-3"},Go={class:"col-6 col-md-3"},Bo={class:"col-12 col-md-9"},Ho={class:"col-12"},Wo={class:"row q-col-gutter-md"},Yo={class:"col-12 col-md-4"},Jo={class:"col-6 col-md-2"},Zo={class:"col-6 col-md-2"},Xo={class:"col-6 col-md-2"},Ko={class:"col-6 col-md-2"},$o={class:"col-6 col-md-2"},el={class:"col-6 col-md-2"},ol={class:"col-6 col-md-3"},ll={class:"col-6 col-md-3"},il={class:"col-12 col-md-6"},tl={class:"col-6 col-md-3"},sl={class:"col-6 col-md-3"},al={class:"col-6 col-md-3"},nl={class:"col-6 col-md-3"},dl={class:"col-6 col-md-3"},rl={class:"col-6 col-md-3"},cl={class:"col-6 col-md-3"},ul={class:"col-6 col-md-3"},ml={class:"col-12 col-md-6"},fl={class:"row q-col-gutter-md"},_l={class:"col-6 col-md-3"},pl={class:"col-6 col-md-4"},gl={class:"col-12 col-md-5"},hl={class:"col-12"},bl={class:"row q-col-gutter-md"},vl={class:"col-12 col-md-4"},yl={class:"col-12 col-md-4"},Vl={class:"col-12 col-md-4"},xl={class:"row q-col-gutter-md"},wl={class:"col-12 col-md-2"},kl={class:"col-12 col-md-2"},Cl={class:"col-12 col-md-2"},Ul={class:"col-12 col-md-2"};function ql(t,e,u,_,o,s){const a=I("MapPicker");return f(),v("div",null,[l("div",_e,[l("div",pe,[e[59]||(e[59]=l("div",{class:"text-subtitle1 text-weight-medium"},"Información General",-1)),l("div",ge,"UMADI #"+r(s.orDash(o.form.numero_caso)),1)]),s.canEdit?(f(),v("div",he,[o.editing?(f(),v(q,{key:1},[i(h,{flat:"",color:"negative",icon:"close",label:"Cancelar",onClick:s.cancelEdit,loading:o.loading},null,8,["onClick","loading"]),i(h,{color:"primary",icon:"save",label:"Guardar",onClick:s.save,loading:o.loading},null,8,["onClick","loading"])],64)):(f(),p(h,{key:0,color:"primary",icon:"edit",label:"Editar",onClick:s.startEdit,loading:o.loading},null,8,["onClick","loading"]))])):x("",!0)]),o.editing?(f(),v(q,{key:1},[i(V,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:n(()=>[i(b,{class:"row items-center"},{default:n(()=>[i(y,{name:"badge",class:"q-mr-sm"}),e[119]||(e[119]=l("div",{class:"text-subtitle1 text-weight-medium"},"1) Adulto mayor / denunciante",-1))]),_:1}),i(w),i(b,null,{default:n(()=>[l("div",vo,[l("div",yo,[i(m,{modelValue:o.form.numero_apoyo_integral,"onUpdate:modelValue":e[0]||(e[0]=d=>o.form.numero_apoyo_integral=d),dense:"",outlined:"",clearable:"",label:"Nº Apoyo Integral"},null,8,["modelValue"])]),l("div",Vo,[i(m,{modelValue:o.form.numero_caso,"onUpdate:modelValue":e[1]||(e[1]=d=>o.form.numero_caso=d),dense:"",outlined:"",clearable:"",label:"Nº de caso"},null,8,["modelValue"])]),l("div",xo,[i(m,{modelValue:o.form.fecha_registro,"onUpdate:modelValue":e[2]||(e[2]=d=>o.form.fecha_registro=d),type:"date",dense:"",outlined:"",label:"Fecha registro"},null,8,["modelValue"])]),e[120]||(e[120]=l("div",{class:"col-12 text-subtitle2 q-mt-sm"},"Identificación",-1)),l("div",wo,[i(m,{modelValue:o.form.nombres,"onUpdate:modelValue":e[3]||(e[3]=d=>o.form.nombres=d),dense:"",outlined:"",clearable:"",label:"Nombres"},null,8,["modelValue"])]),l("div",ko,[i(m,{modelValue:o.form.paterno,"onUpdate:modelValue":e[4]||(e[4]=d=>o.form.paterno=d),dense:"",outlined:"",clearable:"",label:"Paterno"},null,8,["modelValue"])]),l("div",Co,[i(m,{modelValue:o.form.materno,"onUpdate:modelValue":e[5]||(e[5]=d=>o.form.materno=d),dense:"",outlined:"",clearable:"",label:"Materno"},null,8,["modelValue"])]),l("div",Uo,[i(m,{modelValue:o.form.tipo_documento,"onUpdate:modelValue":e[6]||(e[6]=d=>o.form.tipo_documento=d),dense:"",outlined:"",clearable:"",label:"Documento"},null,8,["modelValue"])]),l("div",qo,[i(m,{modelValue:o.form.numero_documento,"onUpdate:modelValue":e[7]||(e[7]=d=>o.form.numero_documento=d),dense:"",outlined:"",clearable:"",label:"Nº documento"},null,8,["modelValue"])]),l("div",Do,[i(m,{modelValue:o.form.sexo,"onUpdate:modelValue":e[8]||(e[8]=d=>o.form.sexo=d),dense:"",outlined:"",clearable:"",label:"Sexo"},null,8,["modelValue"])]),l("div",Io,[i(m,{modelValue:o.form.lugar_nacimiento,"onUpdate:modelValue":e[9]||(e[9]=d=>o.form.lugar_nacimiento=d),dense:"",outlined:"",clearable:"",label:"Lugar de nacimiento"},null,8,["modelValue"])]),l("div",Eo,[i(m,{modelValue:o.form.fecha_nacimiento,"onUpdate:modelValue":[e[10]||(e[10]=d=>o.form.fecha_nacimiento=d),e[11]||(e[11]=d=>s.onBirthChange("denunciante"))],type:"date",dense:"",outlined:"",label:"Fecha de nacimiento"},null,8,["modelValue"])]),l("div",jo,[i(m,{modelValue:o.form.edad,"onUpdate:modelValue":e[12]||(e[12]=d=>o.form.edad=d),dense:"",outlined:"",clearable:"",label:"Edad"},null,8,["modelValue"])]),l("div",So,[i(m,{modelValue:o.form.direccion,"onUpdate:modelValue":e[13]||(e[13]=d=>o.form.direccion=d),dense:"",outlined:"",clearable:"",label:"Dirección"},null,8,["modelValue"])]),l("div",No,[i(m,{modelValue:o.form.estado_civil,"onUpdate:modelValue":e[14]||(e[14]=d=>o.form.estado_civil=d),dense:"",outlined:"",clearable:"",label:"Estado civil"},null,8,["modelValue"])]),l("div",Po,[i(m,{modelValue:o.form.relacion_denunciado,"onUpdate:modelValue":e[15]||(e[15]=d=>o.form.relacion_denunciado=d),dense:"",outlined:"",clearable:"",label:"Relación con denunciado"},null,8,["modelValue"])]),l("div",To,[i(m,{modelValue:o.form.grado_instruccion,"onUpdate:modelValue":e[16]||(e[16]=d=>o.form.grado_instruccion=d),dense:"",outlined:"",clearable:"",label:"Grado de instrucción"},null,8,["modelValue"])]),l("div",Ao,[i(ae,{modelValue:o.form.trabaja,"onUpdate:modelValue":e[17]||(e[17]=d=>o.form.trabaja=d),label:"Trabaja"},null,8,["modelValue"])]),l("div",Fo,[i(m,{modelValue:o.form.ocupacion,"onUpdate:modelValue":e[18]||(e[18]=d=>o.form.ocupacion=d),dense:"",outlined:"",clearable:"",label:"Ocupación"},null,8,["modelValue"])]),l("div",Ro,[i(m,{modelValue:o.form.edad_aprox,"onUpdate:modelValue":e[19]||(e[19]=d=>o.form.edad_aprox=d),dense:"",outlined:"",clearable:"",label:"Edad aprox."},null,8,["modelValue"])]),l("div",Oo,[i(m,{modelValue:o.form.edada_exacto,"onUpdate:modelValue":e[20]||(e[20]=d=>o.form.edada_exacto=d),dense:"",outlined:"",clearable:"",label:"Edad exacta"},null,8,["modelValue"])]),l("div",Lo,[i(m,{modelValue:o.form.idioma,"onUpdate:modelValue":e[21]||(e[21]=d=>o.form.idioma=d),dense:"",outlined:"",clearable:"",label:"Idioma"},null,8,["modelValue"])]),e[121]||(e[121]=l("div",{class:"col-12 text-subtitle2 q-mt-sm"},"Teléfonos",-1)),l("div",Qo,[i(m,{modelValue:o.form.celular1,"onUpdate:modelValue":e[22]||(e[22]=d=>o.form.celular1=d),dense:"",outlined:"",clearable:"",label:"Celular 1"},null,8,["modelValue"])]),l("div",zo,[i(m,{modelValue:o.form.celular2,"onUpdate:modelValue":e[23]||(e[23]=d=>o.form.celular2=d),dense:"",outlined:"",clearable:"",label:"Celular 2"},null,8,["modelValue"])]),l("div",Mo,[i(m,{modelValue:o.form.telefono_fijo1,"onUpdate:modelValue":e[24]||(e[24]=d=>o.form.telefono_fijo1=d),dense:"",outlined:"",clearable:"",label:"Teléfono fijo 1"},null,8,["modelValue"])]),l("div",Go,[i(m,{modelValue:o.form.telefono_fijo2,"onUpdate:modelValue":e[25]||(e[25]=d=>o.form.telefono_fijo2=d),dense:"",outlined:"",clearable:"",label:"Teléfono fijo 2"},null,8,["modelValue"])]),l("div",Bo,[i(m,{modelValue:o.form.direccion_actual,"onUpdate:modelValue":e[26]||(e[26]=d=>o.form.direccion_actual=d),dense:"",outlined:"",clearable:"",label:"Dirección actual"},null,8,["modelValue"])]),e[122]||(e[122]=l("div",{class:"col-12 text-subtitle2 q-mt-sm"},"Ubicación (lat/lng)",-1)),l("div",Ho,[i(a,{modelValue:s.mapModel,"onUpdate:modelValue":e[27]||(e[27]=d=>s.mapModel=d),center:o.oruroCenter,"zoom-init":13},null,8,["modelValue","center"])])])]),_:1})]),_:1}),i(V,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:n(()=>[i(b,{class:"row items-center"},{default:n(()=>[i(y,{name:"person_off",class:"q-mr-sm"}),e[123]||(e[123]=l("div",{class:"text-subtitle1 text-weight-medium"},"2) Denunciado",-1))]),_:1}),i(w),i(b,null,{default:n(()=>[l("div",Wo,[l("div",Yo,[i(m,{modelValue:o.form.denunciado_nombres,"onUpdate:modelValue":e[28]||(e[28]=d=>o.form.denunciado_nombres=d),dense:"",outlined:"",clearable:"",label:"Nombres"},null,8,["modelValue"])]),l("div",Jo,[i(m,{modelValue:o.form.denunciado_paterno,"onUpdate:modelValue":e[29]||(e[29]=d=>o.form.denunciado_paterno=d),dense:"",outlined:"",clearable:"",label:"Paterno"},null,8,["modelValue"])]),l("div",Zo,[i(m,{modelValue:o.form.denunciado_materno,"onUpdate:modelValue":e[30]||(e[30]=d=>o.form.denunciado_materno=d),dense:"",outlined:"",clearable:"",label:"Materno"},null,8,["modelValue"])]),l("div",Xo,[i(m,{modelValue:o.form.denunciado_edad,"onUpdate:modelValue":e[31]||(e[31]=d=>o.form.denunciado_edad=d),dense:"",outlined:"",clearable:"",label:"Edad"},null,8,["modelValue"])]),l("div",Ko,[i(m,{modelValue:o.form.denunciado_ci,"onUpdate:modelValue":e[32]||(e[32]=d=>o.form.denunciado_ci=d),dense:"",outlined:"",clearable:"",label:"CI"},null,8,["modelValue"])]),l("div",$o,[i(m,{modelValue:o.form.denunciado_ciudad_nacimiento,"onUpdate:modelValue":e[33]||(e[33]=d=>o.form.denunciado_ciudad_nacimiento=d),dense:"",outlined:"",clearable:"",label:"Ciudad nac."},null,8,["modelValue"])]),l("div",el,[i(m,{modelValue:o.form.denunciado_sexo,"onUpdate:modelValue":e[34]||(e[34]=d=>o.form.denunciado_sexo=d),dense:"",outlined:"",clearable:"",label:"Sexo"},null,8,["modelValue"])]),l("div",ol,[i(m,{modelValue:o.form.denunciado_lugar_nacimiento,"onUpdate:modelValue":e[35]||(e[35]=d=>o.form.denunciado_lugar_nacimiento=d),dense:"",outlined:"",clearable:"",label:"Lugar nac."},null,8,["modelValue"])]),l("div",ll,[i(m,{modelValue:o.form.denunciado_fecha_nacimiento,"onUpdate:modelValue":[e[36]||(e[36]=d=>o.form.denunciado_fecha_nacimiento=d),e[37]||(e[37]=d=>s.onBirthChange("denunciado"))],type:"date",dense:"",outlined:"",label:"Fecha nac."},null,8,["modelValue"])]),l("div",il,[i(m,{modelValue:o.form.denunciado_direccion,"onUpdate:modelValue":e[38]||(e[38]=d=>o.form.denunciado_direccion=d),dense:"",outlined:"",clearable:"",label:"Dirección"},null,8,["modelValue"])]),l("div",tl,[i(m,{modelValue:o.form.denunciado_estado_civil,"onUpdate:modelValue":e[39]||(e[39]=d=>o.form.denunciado_estado_civil=d),dense:"",outlined:"",clearable:"",label:"Estado civil"},null,8,["modelValue"])]),l("div",sl,[i(m,{modelValue:o.form.denunciado_idioma,"onUpdate:modelValue":e[40]||(e[40]=d=>o.form.denunciado_idioma=d),dense:"",outlined:"",clearable:"",label:"Idioma"},null,8,["modelValue"])]),l("div",al,[i(m,{modelValue:o.form.denunciado_grado_instruccion,"onUpdate:modelValue":e[41]||(e[41]=d=>o.form.denunciado_grado_instruccion=d),dense:"",outlined:"",clearable:"",label:"Grado de instrucción"},null,8,["modelValue"])]),l("div",nl,[i(m,{modelValue:o.form.denunciado_ocupacion,"onUpdate:modelValue":e[42]||(e[42]=d=>o.form.denunciado_ocupacion=d),dense:"",outlined:"",clearable:"",label:"Ocupación"},null,8,["modelValue"])]),l("div",dl,[i(m,{modelValue:o.form.denunciado_celular1,"onUpdate:modelValue":e[43]||(e[43]=d=>o.form.denunciado_celular1=d),dense:"",outlined:"",clearable:"",label:"Celular 1"},null,8,["modelValue"])]),l("div",rl,[i(m,{modelValue:o.form.denunciado_celular2,"onUpdate:modelValue":e[44]||(e[44]=d=>o.form.denunciado_celular2=d),dense:"",outlined:"",clearable:"",label:"Celular 2"},null,8,["modelValue"])]),l("div",cl,[i(m,{modelValue:o.form.denunciado_telefono_fijo1,"onUpdate:modelValue":e[45]||(e[45]=d=>o.form.denunciado_telefono_fijo1=d),dense:"",outlined:"",clearable:"",label:"Teléfono fijo 1"},null,8,["modelValue"])]),l("div",ul,[i(m,{modelValue:o.form.denunciado_telefono_fijo2,"onUpdate:modelValue":e[46]||(e[46]=d=>o.form.denunciado_telefono_fijo2=d),dense:"",outlined:"",clearable:"",label:"Teléfono fijo 2"},null,8,["modelValue"])]),l("div",ml,[i(m,{modelValue:o.form.denunciado_direccion_actual,"onUpdate:modelValue":e[47]||(e[47]=d=>o.form.denunciado_direccion_actual=d),dense:"",outlined:"",clearable:"",label:"Dirección actual"},null,8,["modelValue"])])])]),_:1})]),_:1}),i(V,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:n(()=>[i(b,{class:"row items-center"},{default:n(()=>[i(y,{name:"description",class:"q-mr-sm"}),e[124]||(e[124]=l("div",{class:"text-subtitle1 text-weight-medium"},"3) Hecho / denuncia",-1))]),_:1}),i(w),i(b,null,{default:n(()=>[l("div",fl,[l("div",_l,[i(m,{modelValue:o.form.fecha_hecho,"onUpdate:modelValue":e[48]||(e[48]=d=>o.form.fecha_hecho=d),type:"date",dense:"",outlined:"",label:"Fecha del hecho"},null,8,["modelValue"])]),l("div",pl,[i(m,{modelValue:o.form.relacion_denunciante,"onUpdate:modelValue":e[49]||(e[49]=d=>o.form.relacion_denunciante=d),dense:"",outlined:"",clearable:"",label:"Relación con denunciante"},null,8,["modelValue"])]),l("div",gl,[i(m,{modelValue:o.form.direccion_hecho,"onUpdate:modelValue":e[50]||(e[50]=d=>o.form.direccion_hecho=d),dense:"",outlined:"",clearable:"",label:"Dirección del hecho"},null,8,["modelValue"])]),l("div",hl,[i(m,{modelValue:o.form.descripcion_hecho,"onUpdate:modelValue":e[51]||(e[51]=d=>o.form.descripcion_hecho=d),type:"textarea",autogrow:"",outlined:"",dense:"",clearable:"",label:"Breve circunstancia del hecho / denuncia",maxlength:"4000"},null,8,["modelValue"])])])]),_:1})]),_:1}),i(V,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:n(()=>[i(b,{class:"row items-center"},{default:n(()=>[i(y,{name:"task_alt",class:"q-mr-sm"}),e[125]||(e[125]=l("div",{class:"text-subtitle1 text-weight-medium"},"4) Seguimiento",-1))]),_:1}),i(w),i(b,null,{default:n(()=>[l("div",bl,[l("div",vl,[i(R,{modelValue:o.form.psicologica_user_id,"onUpdate:modelValue":e[52]||(e[52]=d=>o.form.psicologica_user_id=d),dense:"",outlined:"","emit-value":"","map-options":"",clearable:"",options:s.optPsicologos,label:"Psicológica (responsable)"},null,8,["modelValue","options"])]),l("div",yl,[i(R,{modelValue:o.form.trabajo_social_user_id,"onUpdate:modelValue":e[53]||(e[53]=d=>o.form.trabajo_social_user_id=d),dense:"",outlined:"","emit-value":"","map-options":"",clearable:"",options:s.optSociales,label:"Trabajo social (responsable)"},null,8,["modelValue","options"])]),l("div",Vl,[i(R,{modelValue:o.form.legal_user_id,"onUpdate:modelValue":e[54]||(e[54]=d=>o.form.legal_user_id=d),dense:"",outlined:"","emit-value":"","map-options":"",clearable:"",options:s.optAbogados,label:"Legal (responsable)"},null,8,["modelValue","options"])])])]),_:1})]),_:1}),i(V,{flat:"",bordered:"",class:"section-card q-mb-xl"},{default:n(()=>[i(b,{class:"row items-center"},{default:n(()=>[i(y,{name:"inventory_2",class:"q-mr-sm"}),e[126]||(e[126]=l("div",{class:"text-subtitle1 text-weight-medium"},"5) Check documentos adjuntos",-1))]),_:1}),i(w),i(b,null,{default:n(()=>[l("div",xl,[l("div",wl,[i(W,{modelValue:o.form.doc_ci,"onUpdate:modelValue":e[55]||(e[55]=d=>o.form.doc_ci=d),label:"Fotocopia CI denunciante"},null,8,["modelValue"])]),l("div",kl,[i(W,{modelValue:o.form.doc_frontal_denunciado,"onUpdate:modelValue":e[56]||(e[56]=d=>o.form.doc_frontal_denunciado=d),label:"Foto frontal denunciado"},null,8,["modelValue"])]),l("div",Cl,[i(W,{modelValue:o.form.doc_frontal_denunciante,"onUpdate:modelValue":e[57]||(e[57]=d=>o.form.doc_frontal_denunciante=d),label:"Foto frontal denunciante"},null,8,["modelValue"])]),l("div",Ul,[i(W,{modelValue:o.form.doc_croquis,"onUpdate:modelValue":e[58]||(e[58]=d=>o.form.doc_croquis=d),label:"Croquis del hecho"},null,8,["modelValue"])])])]),_:1})]),_:1})],64)):(f(),v(q,{key:0},[i(V,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:n(()=>[i(b,{class:"row items-center"},{default:n(()=>[i(y,{name:"badge",class:"q-mr-sm"}),e[60]||(e[60]=l("div",{class:"text-subtitle1 text-weight-medium"},"1) Adulto mayor / denunciante",-1))]),_:1}),i(w),i(b,{class:"row q-col-gutter-md"},{default:n(()=>[l("div",be,[e[61]||(e[61]=l("b",null,"Nº Apoyo Integral:",-1)),c(" "+r(s.orDash(o.form.numero_apoyo_integral)),1)]),l("div",ve,[e[62]||(e[62]=l("b",null,"Nº de caso:",-1)),c(" "+r(s.orDash(o.form.numero_caso)),1)]),l("div",ye,[e[63]||(e[63]=l("b",null,"Fecha registro:",-1)),c(" "+r(s.orDash(o.form.fecha_registro)),1)]),e[87]||(e[87]=l("div",{class:"col-12 text-subtitle2 q-mt-sm"},"Identificación",-1)),l("div",Ve,[e[64]||(e[64]=l("b",null,"Nombre:",-1)),c(" "+r(s.nombreDenunciante),1)]),l("div",xe,[e[65]||(e[65]=l("b",null,"Documento:",-1)),c(" "+r(s.orDash(o.form.tipo_documento)),1)]),l("div",we,[e[66]||(e[66]=l("b",null,"Nº documento:",-1)),c(" "+r(s.orDash(o.form.numero_documento)),1)]),l("div",ke,[e[67]||(e[67]=l("b",null,"Sexo:",-1)),c(" "+r(s.orDash(o.form.sexo)),1)]),l("div",Ce,[e[68]||(e[68]=l("b",null,"Lugar nac.:",-1)),c(" "+r(s.orDash(o.form.lugar_nacimiento)),1)]),l("div",Ue,[e[69]||(e[69]=l("b",null,"Fecha nac.:",-1)),c(" "+r(s.orDash(o.form.fecha_nacimiento)),1)]),l("div",qe,[e[70]||(e[70]=l("b",null,"Edad:",-1)),c(" "+r(s.orDash(o.form.edad)),1)]),e[88]||(e[88]=l("div",{class:"col-12 text-subtitle2 q-mt-sm"},"Contacto y dirección",-1)),l("div",De,[e[71]||(e[71]=l("b",null,"Dirección (anterior):",-1)),c(" "+r(s.orDash(o.form.direccion)),1)]),l("div",Ie,[e[72]||(e[72]=l("b",null,"Dirección actual:",-1)),c(" "+r(s.orDash(o.form.direccion_actual)),1)]),l("div",Ee,[e[73]||(e[73]=l("b",null,"Estado civil:",-1)),c(" "+r(s.orDash(o.form.estado_civil)),1)]),l("div",je,[e[74]||(e[74]=l("b",null,"Relación con denunciado:",-1)),c(" "+r(s.orDash(o.form.relacion_denunciado)),1)]),l("div",Se,[e[75]||(e[75]=l("b",null,"Grado de instrucción:",-1)),c(" "+r(s.orDash(o.form.grado_instruccion)),1)]),l("div",Ne,[e[76]||(e[76]=l("b",null,"Trabaja:",-1)),c(" "+r(s.yesNo(o.form.trabaja)),1)]),l("div",Pe,[e[77]||(e[77]=l("b",null,"Ocupación:",-1)),c(" "+r(s.orDash(o.form.ocupacion)),1)]),l("div",Te,[e[78]||(e[78]=l("b",null,"Edad aprox.:",-1)),c(" "+r(s.orDash(o.form.edad_aprox)),1)]),l("div",Ae,[e[79]||(e[79]=l("b",null,"Edad exacta:",-1)),c(" "+r(s.orDash(o.form.edada_exacto)),1)]),l("div",Fe,[e[80]||(e[80]=l("b",null,"Idioma:",-1)),c(" "+r(s.orDash(o.form.idioma)),1)]),e[89]||(e[89]=l("div",{class:"col-12 text-subtitle2 q-mt-sm"},"Teléfonos",-1)),l("div",Re,[e[81]||(e[81]=l("b",null,"Celular 1:",-1)),c(" "+r(s.orDash(o.form.celular1)),1)]),l("div",Oe,[e[82]||(e[82]=l("b",null,"Celular 2:",-1)),c(" "+r(s.orDash(o.form.celular2)),1)]),l("div",Le,[e[83]||(e[83]=l("b",null,"Tel. fijo 1:",-1)),c(" "+r(s.orDash(o.form.telefono_fijo1)),1)]),l("div",Qe,[e[84]||(e[84]=l("b",null,"Tel. fijo 2:",-1)),c(" "+r(s.orDash(o.form.telefono_fijo2)),1)]),e[90]||(e[90]=l("div",{class:"col-12 text-subtitle2 q-mt-sm"},"Ubicación",-1)),l("div",ze,[e[85]||(e[85]=l("b",null,"Latitud:",-1)),c(" "+r(s.orDash(o.form.latitud)),1)]),l("div",Me,[e[86]||(e[86]=l("b",null,"Longitud:",-1)),c(" "+r(s.orDash(o.form.longitud)),1)])]),_:1})]),_:1}),i(V,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:n(()=>[i(b,{class:"row items-center"},{default:n(()=>[i(y,{name:"person_off",class:"q-mr-sm"}),e[91]||(e[91]=l("div",{class:"text-subtitle1 text-weight-medium"},"2) Denunciado",-1))]),_:1}),i(w),i(b,{class:"row q-col-gutter-md"},{default:n(()=>[l("div",Ge,[e[92]||(e[92]=l("b",null,"Nombre:",-1)),c(" "+r(s.nombreDenunciado),1)]),l("div",Be,[e[93]||(e[93]=l("b",null,"Edad:",-1)),c(" "+r(s.orDash(o.form.denunciado_edad)),1)]),l("div",He,[e[94]||(e[94]=l("b",null,"CI:",-1)),c(" "+r(s.orDash(o.form.denunciado_ci)),1)]),l("div",We,[e[95]||(e[95]=l("b",null,"Sexo:",-1)),c(" "+r(s.orDash(o.form.denunciado_sexo)),1)]),l("div",Ye,[e[96]||(e[96]=l("b",null,"Lugar nac.:",-1)),c(" "+r(s.orDash(o.form.denunciado_lugar_nacimiento)),1)]),l("div",Je,[e[97]||(e[97]=l("b",null,"Fecha nac.:",-1)),c(" "+r(s.orDash(o.form.denunciado_fecha_nacimiento)),1)]),l("div",Ze,[e[98]||(e[98]=l("b",null,"Dirección:",-1)),c(" "+r(s.orDash(o.form.denunciado_direccion)),1)]),l("div",Xe,[e[99]||(e[99]=l("b",null,"Estado civil:",-1)),c(" "+r(s.orDash(o.form.denunciado_estado_civil)),1)]),l("div",Ke,[e[100]||(e[100]=l("b",null,"Idioma:",-1)),c(" "+r(s.orDash(o.form.denunciado_idioma)),1)]),l("div",$e,[e[101]||(e[101]=l("b",null,"Grado de instrucción:",-1)),c(" "+r(s.orDash(o.form.denunciado_grado_instruccion)),1)]),l("div",eo,[e[102]||(e[102]=l("b",null,"Ocupación:",-1)),c(" "+r(s.orDash(o.form.denunciado_ocupacion)),1)]),l("div",oo,[e[103]||(e[103]=l("b",null,"Celular 1:",-1)),c(" "+r(s.orDash(o.form.denunciado_celular1)),1)]),l("div",lo,[e[104]||(e[104]=l("b",null,"Celular 2:",-1)),c(" "+r(s.orDash(o.form.denunciado_celular2)),1)]),l("div",io,[e[105]||(e[105]=l("b",null,"Tel. fijo 1:",-1)),c(" "+r(s.orDash(o.form.denunciado_telefono_fijo1)),1)]),l("div",to,[e[106]||(e[106]=l("b",null,"Tel. fijo 2:",-1)),c(" "+r(s.orDash(o.form.denunciado_telefono_fijo2)),1)]),l("div",so,[e[107]||(e[107]=l("b",null,"Dirección actual:",-1)),c(" "+r(s.orDash(o.form.denunciado_direccion_actual)),1)])]),_:1})]),_:1}),i(V,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:n(()=>[i(b,{class:"row items-center"},{default:n(()=>[i(y,{name:"description",class:"q-mr-sm"}),e[108]||(e[108]=l("div",{class:"text-subtitle1 text-weight-medium"},"3) Hecho / denuncia",-1))]),_:1}),i(w),i(b,{class:"row q-col-gutter-md"},{default:n(()=>[l("div",ao,[e[109]||(e[109]=l("b",null,"Fecha del hecho:",-1)),c(" "+r(s.orDash(o.form.fecha_hecho)),1)]),l("div",no,[e[110]||(e[110]=l("b",null,"Relación con denunciante:",-1)),c(" "+r(s.orDash(o.form.relacion_denunciante)),1)]),l("div",ro,[e[111]||(e[111]=l("b",null,"Dirección del hecho:",-1)),c(" "+r(s.orDash(o.form.direccion_hecho)),1)]),l("div",co,[e[112]||(e[112]=l("b",null,"Descripción:",-1)),e[113]||(e[113]=c()),l("span",uo,r(s.orDash(o.form.descripcion_hecho)),1)])]),_:1})]),_:1}),i(V,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:n(()=>[i(b,{class:"row items-center"},{default:n(()=>[i(y,{name:"task_alt",class:"q-mr-sm"}),e[114]||(e[114]=l("div",{class:"text-subtitle1 text-weight-medium"},"4) Seguimiento",-1))]),_:1}),i(w),i(b,{class:"row q-col-gutter-md"},{default:n(()=>[l("div",mo,[e[115]||(e[115]=l("b",null,"Psicología:",-1)),c(" "+r(s.nombreUsuario(o.form.psicologica_user,o.form.psicologica_user_id,o.psicologos)),1)]),l("div",fo,[e[116]||(e[116]=l("b",null,"Trabajo social:",-1)),c(" "+r(s.nombreUsuario(o.form.trabajo_social_user,o.form.trabajo_social_user_id,o.sociales)),1)]),l("div",_o,[e[117]||(e[117]=l("b",null,"Legal:",-1)),c(" "+r(s.nombreUsuario(o.form.legal_user,o.form.legal_user_id,o.abogados)),1)])]),_:1})]),_:1}),i(V,{flat:"",bordered:"",class:"section-card q-mb-xl"},{default:n(()=>[i(b,{class:"row items-center"},{default:n(()=>[i(y,{name:"inventory_2",class:"q-mr-sm"}),e[118]||(e[118]=l("div",{class:"text-subtitle1 text-weight-medium"},"5) Check documentos adjuntos",-1))]),_:1}),i(w),i(b,{class:"row q-col-gutter-md"},{default:n(()=>[l("div",po,"Fotocopia CI denunciante: "+r(s.yesNo(o.form.doc_ci)),1),l("div",go,"Foto frontal denunciado: "+r(s.yesNo(o.form.doc_frontal_denunciado)),1),l("div",ho,"Foto frontal denunciante: "+r(s.yesNo(o.form.doc_frontal_denunciante)),1),l("div",bo,"Croquis del hecho: "+r(s.yesNo(o.form.doc_croquis)),1)]),_:1})]),_:1})],64))])}const Dl=E(fe,[["render",ql],["__scopeId","data-v-5a5c16d5"]]),Il={name:"SesionesPsicologico",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:null}},data(){return{loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dialog:!1,mode:"create",form:{id:null,fecha:"",titulo:"",duracion_min:null,lugar:"",tipo:"Individual",contenido_html:""},plantilla:null,plantillasOptions:[{label:"Consentimiento informado",value:"consentimiento"},{label:"Informe Psicológico (formato DIO)",value:"informe_dio"},{label:"Acta de sesión (DIO)",value:"acta"},{label:"Informe breve (psicológico)",value:"informe"},{label:"Constancia de asistencia",value:"constancia"}]}},computed:{role(){return this.$store.user?.role||""},canEdit(){return this.role==="Administrador"||this.role==="Psicologo"}},methods:{today(){const t=new Date,e=u=>String(u).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`},openCreate(){this.canEdit&&(this.mode="create",this.plantilla="consentimiento",this.form={id:null,fecha:this.today(),titulo:"",duracion_min:null,lugar:"",tipo:"Individual",contenido_html:""},this.dialog=!0,this.$nextTick(()=>this.applyTemplate("consentimiento")))},openView(t){this.mode="view",this.form={...t},this.dialog=!0},openEdit(t){this.canEdit&&(this.mode="edit",this.form={...t},this.dialog=!0)},applyTemplate(t){if(this.mode==="view")return;const e=this.caso||{},u={nombres:e.denunciante_nombres||e.denunciante_nombre_completo||"",apellidos:[e.denunciante_paterno,e.denunciante_materno].filter(Boolean).join(" "),edad:e.denunciante_edad||"",fecha_nacimiento:e.denunciante_fecha_nacimiento||"",lugar_nacimiento:e.denunciante_lugar_nacimiento||"",grado:e.denunciante_grado||"",ocupacion:e.denunciante_ocupacion_exacto||e.denunciante_ocupacion||"",domicilio:e.denunciante_domicilio_actual||e.denunciante_residencia||"",documento:e.denunciante_documento||"Carnet de identidad",nro:e.denunciante_nro||"",telefono:e.denunciante_telefono||e.denunciante_movil||e.denunciante_fijo||"",estado_civil:e.denunciante_estado_civil||""},_=[];for(let j=1;j<=5;j++){const A=e[`familiar${j}_nombre_completo`],B=e[`familiar${j}_edad`],H=e[`familiar${j}_parentesco`],se=e[`familiar${j}_celular`];(A||B||H||se)&&_.push({nombre:A||"",edad:B||"",estado_civil:"",parentesco:H||"",ocupacion:""})}const o=(this.form.fecha||this.today()).slice(0,4),s=e.caso_numero&&String(e.caso_numero).trim()!==""?String(e.caso_numero):`${String(this.caseId).padStart(2,"0")}/${o}`,a=e.legal_user?.name||e.legal_user?.username||"",d=e.psicologica_user?.name||e.psicologica_user?.username||this.$store?.state?.user?.name||"",Y=e.caso_tipologia||e.caso_modalidad?`Evaluación psicológica en el marco de presunta(s) ${[e.caso_tipologia,e.caso_modalidad].filter(Boolean).join(" / ")}.`:"Evaluación psicológica para determinar los efectos emocionales y psicológicos en la evaluada.",J=(()=>{const j=e.caso_fecha_hecho?`el ${e.caso_fecha_hecho}`:"en fecha no precisada",A=[e.caso_lugar_hecho,e.caso_zona,e.caso_direccion].filter(Boolean).join(", "),B=A?`, en ${A}`:"",H=e.caso_descripcion?` ${e.caso_descripcion}`:"";return`Según la apertura del caso, el hecho habría ocurrido ${j}${B}.${H}`})(),Z=["Entrevista clínica y observación conductual","Aplicación de instrumentos psicométricos según pertinencia (Goldberg, IES-R, Rosenberg)"].join("; ")+".",G=[e.violencia_fisica?"violencia física":null,e.violencia_psicologica?"violencia psicológica":null,e.violencia_sexual?"violencia sexual":null,e.violencia_economica?"violencia económica/patrimonial":null].filter(Boolean),X="Se evidencian reacciones emocionales congruentes con el evento referido, con impacto en el equilibrio afectivo y la autoestima."+(G.length?` Se consideran indicadores asociados a ${G.join(", ")}.`:"")+" No se evidencian signos de psicosis. Se sugiere seguimiento clínico y contención.",D=["Intervención psicológica: terapia focalizada en manejo de ansiedad/estrés y fortalecimiento de recursos personales.","Orientación/asesoramiento legal para evitar revictimización y garantizar medidas de protección, si corresponde."].join(" "),T={casoId:this.caseId,fecha:this.form.fecha||this.today(),titulo:this.form.titulo||"Sesión psicológica",lugar:this.form.lugar||"",tipo:this.form.tipo||"Individual",nombre:e.denunciante_nombre_completo,documento:e.denunciante_nro,numeroCaso:s,abogadoNombre:a,psicologoNombre:d,denunciante:u,familiares:_,motivo:Y,antecedentes:J,tecnicas:Z,conclusiones:X,recomendaciones:D};t==="acta"?this.form.contenido_html=F.acta(T):t==="informe"?this.form.contenido_html=F.informe(T):t==="constancia"?this.form.contenido_html=F.constancia(T):t==="consentimiento"?this.form.contenido_html=F.consentimiento(T):t==="informe_dio"&&(this.form.contenido_html=F.informe_dio(T))},async save(){if(this.canEdit){if(!this.form.titulo){this.$q.notify({type:"negative",message:"El título es obligatorio"});return}if(!this.form.contenido_html){this.$q.notify({type:"negative",message:"El contenido está vacío"});return}this.saving=!0;try{this.form.id?await this.$axios.put(`/umadis/sesiones-psicologicas/${this.form.id}`,this.form):await this.$axios.post(`/umadis/${this.caseId}/sesiones-psicologicas`,this.form),this.$q.notify({type:"positive",message:"Guardado"}),this.dialog=!1,this.$emit("refresh")}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}}},remove(t){if(!this.canEdit)return;const e=async()=>{try{await this.$axios.delete(`/umadis/sesiones-psicologicas/${t.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.$emit("refresh")}catch(u){this.$q.notify({type:"negative",message:u?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar la sesión?").onOk(e):confirm("¿Eliminar la sesión?")&&e()},printPdf(t){const e=this.$axios?.defaults?.baseURL||"";window.open(`${e}/umadis/sesiones-psicologicas/${t.id}/pdf`,"_blank")}}},El={class:"row items-center q-mb-sm"},jl={class:"col"},Sl={class:"text-caption text-grey-7"},Nl={class:"col-auto row items-center q-gutter-sm"},Pl={class:"text-grey-8"},Tl={key:0},Al={class:"text-subtitle1"},Fl={class:"row"},Rl={class:"col-12 col-md-3"},Ol={class:"col-12 col-md-5"},Ll={class:"col-6 col-md-2"},Ql={class:"col-6 col-md-2"},zl={class:"col-12"},Ml={key:0};function Gl(t,e,u,_,o,s){return f(),p(V,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[l("div",El,[l("div",jl,[e[9]||(e[9]=l("div",{class:"text-subtitle1 text-weight-medium"},"Sesiones (Psicológico)",-1)),l("div",Sl,"Vinculadas al caso #"+r(u.caseId),1)]),l("div",Nl,[i(h,{flat:"",color:"primary",icon:"refresh",loading:o.loading,onClick:e[0]||(e[0]=a=>t.$emit("refresh"))},null,8,["loading"]),s.canEdit?(f(),p(h,{key:0,color:"green",icon:"add_circle_outline","no-caps":"",label:"Crear sesión",onClick:s.openCreate},null,8,["onClick"])):x("",!0)])]),i(w),i(K,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:n(()=>[e[15]||(e[15]=l("thead",null,[l("tr",{class:"bg-primary text-white"},[l("th",{style:{width:"70px"}},"ID"),l("th",{style:{width:"140px"}},"Acciones"),l("th",null,"Título"),l("th",{style:{width:"120px"}},"Fecha"),l("th",{style:{width:"120px"}},"Tipo"),l("th",{style:{width:"180px"}},"Usuario")])],-1)),l("tbody",null,[(f(!0),v(q,null,M(u.caso.psicologicas,a=>(f(),v("tr",{key:a.id},[l("td",Pl,"#"+r(a.id),1),l("td",null,[i(Q,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:n(()=>[k((f(),p(U,{clickable:"",onClick:d=>s.openView(a)},{default:n(()=>[i(g,{avatar:""},{default:n(()=>[i(y,{name:"visibility"})]),_:1}),i(g,null,{default:n(()=>e[10]||(e[10]=[c("Ver")])),_:1})]),_:2},1032,["onClick"])),[[C]]),k((f(),p(U,{clickable:"",onClick:d=>s.printPdf(a)},{default:n(()=>[i(g,{avatar:""},{default:n(()=>[i(y,{name:"print"})]),_:1}),i(g,null,{default:n(()=>e[11]||(e[11]=[c("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[C]]),s.canEdit?(f(),v(q,{key:0},[i(w),k((f(),p(U,{clickable:"",onClick:d=>s.openEdit(a)},{default:n(()=>[i(g,{avatar:""},{default:n(()=>[i(y,{name:"edit"})]),_:1}),i(g,null,{default:n(()=>e[12]||(e[12]=[c("Editar")])),_:1})]),_:2},1032,["onClick"])),[[C]]),k((f(),p(U,{clickable:"",onClick:d=>s.remove(a)},{default:n(()=>[i(g,{avatar:""},{default:n(()=>[i(y,{name:"delete",color:"negative"})]),_:1}),i(g,{class:"text-negative"},{default:n(()=>e[13]||(e[13]=[c("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[C]])],64)):x("",!0)]),_:2},1024)]),l("td",null,r(a.titulo),1),l("td",null,r(a.fecha||"s/f"),1),l("td",null,r(a.tipo||"—"),1),l("td",null,r(a.user?.name||a.user?.username||"—"),1)]))),128)),!u.caso.psicologicas||u.caso.psicologicas.length===0?(f(),v("tr",Tl,e[14]||(e[14]=[l("td",{colspan:"6",class:"text-center text-grey"},"Sin registros",-1)]))):x("",!0)])]),_:1}),i(O,{modelValue:o.dialog,"onUpdate:modelValue":e[8]||(e[8]=a=>o.dialog=a),persistent:""},{default:n(()=>[i(V,{style:{"max-width":"900px",width:"95vw"}},{default:n(()=>[i(b,{class:"row items-center q-pb-none"},{default:n(()=>[l("div",Al,r(o.mode==="view"?"Ver sesión":o.form.id?"Editar sesión":"Nueva sesión"),1),i(z),k(i(h,{flat:"",round:"",dense:"",icon:"close"},null,512),[[C]])]),_:1}),i(b,{class:"q-gutter-md"},{default:n(()=>[l("div",Fl,[l("div",Rl,[i(m,{modelValue:o.form.fecha,"onUpdate:modelValue":e[1]||(e[1]=a=>o.form.fecha=a),type:"date",dense:"",outlined:"",label:"Fecha",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),l("div",Ol,[i(m,{modelValue:o.form.titulo,"onUpdate:modelValue":e[2]||(e[2]=a=>o.form.titulo=a),dense:"",outlined:"",label:"Título *",readonly:o.mode==="view",rules:[a=>!!a||"Requerido"]},null,8,["modelValue","readonly","rules"])]),l("div",Ll,[i(m,{modelValue:o.form.duracion_min,"onUpdate:modelValue":e[3]||(e[3]=a=>o.form.duracion_min=a),modelModifiers:{number:!0},type:"number",dense:"",outlined:"",label:"Minutos",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),l("div",Ql,[i(m,{modelValue:o.form.tipo,"onUpdate:modelValue":e[4]||(e[4]=a=>o.form.tipo=a),dense:"",outlined:"",label:"Tipo",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),l("div",zl,[i(m,{modelValue:o.form.lugar,"onUpdate:modelValue":e[5]||(e[5]=a=>o.form.lugar=a),dense:"",outlined:"",label:"Lugar",readonly:o.mode==="view"},null,8,["modelValue","readonly"])])]),o.mode!=="view"?(f(),v("div",Ml,[i(R,{modelValue:o.plantilla,"onUpdate:modelValue":[e[6]||(e[6]=a=>o.plantilla=a),s.applyTemplate],options:o.plantillasOptions,label:"Plantilla",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])])):x("",!0),l("div",null,[e[16]||(e[16]=l("div",{class:"text-caption text-grey-7 q-mb-xs"},"Contenido (WYSIWYG / se guarda HTML)",-1)),i(le,{modelValue:o.form.contenido_html,"onUpdate:modelValue":e[7]||(e[7]=a=>o.form.contenido_html=a),readonly:o.mode==="view","min-height":"320px",placeholder:"Escriba aquí el contenido de la sesión...",toolbar:[["left","center","right","justify"],["bold","italic","strike","underline"],["quote","unordered","ordered","outdent","indent"],["hr","link"],["undo","redo"],["removeFormat"]]},null,8,["modelValue","readonly"])])]),_:1}),i(w),i(L,{align:"right"},{default:n(()=>[k(i(h,{flat:"",label:"Cerrar"},null,512),[[C]]),o.mode!=="view"&&s.canEdit?(f(),p(h,{key:0,color:"primary",label:"Guardar",loading:o.saving,onClick:s.save},null,8,["loading","onClick"])):x("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Bl=E(Il,[["render",Gl]]),Hl={name:"InformesLegal",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:null}},data(){return{loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dialog:!1,mode:"create",form:{id:null,fecha:"",titulo:"",numero:"",contenido_html:""},plantilla:"informe_legal",plantillasOptions:[{label:"Informe Legal (SLIM)",value:"informe_legal"},{label:"Memorial (simple)",value:"memorial"},{label:"Oficio / Nota",value:"oficio"},{label:"Acta de Compromiso",value:"acta"},{label:"Denuncia penal — Ministerio Público",value:"denuncia_mp"}]}},computed:{role(){return this.$store.user?.role||""},canEdit(){return this.role==="Administrador"||this.role==="Abogado"}},methods:{today(){const t=new Date,e=u=>String(u).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`},openCreate(){this.canEdit&&(this.mode="create",this.form={id:null,fecha:this.today(),titulo:"",numero:"",contenido_html:""},this.dialog=!0,this.$nextTick(()=>this.applyTemplate(this.plantilla)))},openView(t){this.mode="view",this.form={...t},this.dialog=!0},openEdit(t){this.canEdit&&(this.mode="edit",this.form={...t},this.dialog=!0)},applyTemplate(t){if(this.mode==="view")return;const e=this.form.fecha||this.today(),u=e.slice(0,4),o=`
        <div style="text-align:center; margin-bottom:8px;">
          <div style="font-size:16px; font-weight:bold;">DIRECCIÓN DE IGUALDAD DE OPORTUNIDADES</div>
          <div style="font-size:12px;">Gobierno Autónomo Municipal de Oruro</div>
          <div style="font-size:12px; font-weight:bold;">${this.form.numero?`N° ${this.form.numero}`:""}</div>
          <hr/>
        </div>
      `;if(t==="memorial"){this.form.contenido_html=o+`
          <p><b>Señor(a) Juez/Fiscal</b></p>
          <p>De mi consideración:</p>
          <p style="text-align:justify">Por medio del presente, ...</p>
          <p>Oruro, ${e}</p>
        `;return}if(t==="oficio"){this.form.contenido_html=o+`
          <p><b>Ref.:</b> Solicitud de información</p>
          <p>De nuestra consideración:</p>
          <p style="text-align:justify">Solicitamos remitir la información ...</p>
          <p>Oruro, ${e}</p>
        `;return}if(t==="acta"){this.form.contenido_html=o+`
          <p style="text-align:center"><b>ACTA DE COMPROMISO</b></p>
          <p style="text-align:justify">En la ciudad de Oruro, a ${e}, las partes acuerdan ...</p>
        `;return}if(t==="denuncia_mp"){const a=(this.caso||{}).denunciante_nombre_completo||"";this.form.contenido_html=o+`
          <p style="text-align:center"><b>SEÑOR(A) REPRESENTANTE DEL MINISTERIO PÚBLICO — ORURO</b></p>
          <p><b>DENUNCIANTE:</b> ${a||"—"}</p>
          <p style="text-align:justify">Que, en mérito a los antecedentes ...</p>
          <p>Oruro, ${e}</p>
        `;return}this.form.contenido_html=o+`
        <p><b>Informe Legal ${u}</b></p>
        <p style="text-align:justify">En atención a los antecedentes, se emite el presente informe con el siguiente análisis jurídico:</p>
        <p><b>Fundamentos de derecho:</b></p>
        <ul>
          <li>Ley N° 348 y reglamentación.</li>
          <li>Constitución Política del Estado.</li>
          <li>Normativa municipal vigente.</li>
        </ul>
        <p><b>Recomendaciones:</b> …</p>
        <p>Oruro, ${e}</p>
      `},async save(){if(this.canEdit){if(!this.form.titulo)return this.$q.notify({type:"negative",message:"El título es obligatorio"});if(!this.form.contenido_html)return this.$q.notify({type:"negative",message:"El contenido está vacío"});this.saving=!0;try{this.form.id?await this.$axios.put(`/umadis/informes-legales/${this.form.id}`,this.form):await this.$axios.post(`/umadis/${this.caseId}/informes-legales`,this.form),this.$q.notify({type:"positive",message:"Guardado"}),this.dialog=!1,this.$emit("refresh")}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}}},removeIt(t){if(!this.canEdit)return;const e=async()=>{try{await this.$axios.delete(`/umadis/informes-legales/${t.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.$emit("refresh")}catch(u){this.$q.notify({type:"negative",message:u?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar el informe?").onOk(e):confirm("¿Eliminar el informe?")&&e()},printPdf(t){const e=this.$axios?.defaults?.baseURL||"";window.open(`${e}/umadis/informes-legales/${t.id}/pdf`,"_blank")}}},Wl={class:"row items-center q-mb-sm"},Yl={class:"col"},Jl={class:"text-caption text-grey-7"},Zl={class:"col-auto row items-center q-gutter-sm"},Xl={key:0},Kl={class:"text-subtitle1"},$l={class:"row q-col-gutter-md"},ei={class:"col-12 col-md-3"},oi={class:"col-12 col-md-7"},li={class:"col-12 col-md-2"},ii={key:0};function ti(t,e,u,_,o,s){return f(),p(V,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[l("div",Wl,[l("div",Yl,[e[7]||(e[7]=l("div",{class:"text-subtitle1 text-weight-medium"},"Informes legales",-1)),l("div",Jl,"Vinculados al caso #"+r(u.caseId),1)]),l("div",Zl,[i(h,{flat:"",color:"primary",icon:"refresh",loading:o.loading,onClick:e[0]||(e[0]=a=>t.$emit("refresh"))},null,8,["loading"]),s.canEdit?(f(),p(h,{key:0,color:"green",icon:"add_circle_outline","no-caps":"",label:"Crear informe",onClick:s.openCreate},null,8,["onClick"])):x("",!0)])]),i(w),i(K,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:n(()=>[e[13]||(e[13]=l("thead",null,[l("tr",{class:"bg-primary text-white"},[l("th",{style:{width:"70px"}},"ID"),l("th",{style:{width:"140px"}},"Acciones"),l("th",null,"Título"),l("th",{style:{width:"120px"}},"Fecha"),l("th",{style:{width:"120px"}},"Nro"),l("th",{style:{width:"180px"}},"Usuario")])],-1)),l("tbody",null,[(f(!0),v(q,null,M(u.caso.informes_legales,a=>(f(),v("tr",{key:a.id},[l("td",null,"#"+r(a.id),1),l("td",null,[i(Q,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:n(()=>[k((f(),p(U,{clickable:"",onClick:d=>s.openView(a)},{default:n(()=>[i(g,{avatar:""},{default:n(()=>[i(y,{name:"visibility"})]),_:1}),i(g,null,{default:n(()=>e[8]||(e[8]=[c("Ver")])),_:1})]),_:2},1032,["onClick"])),[[C]]),k((f(),p(U,{clickable:"",onClick:d=>s.printPdf(a)},{default:n(()=>[i(g,{avatar:""},{default:n(()=>[i(y,{name:"picture_as_pdf"})]),_:1}),i(g,null,{default:n(()=>e[9]||(e[9]=[c("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[C]]),s.canEdit?(f(),v(q,{key:0},[i(w),k((f(),p(U,{clickable:"",onClick:d=>s.openEdit(a)},{default:n(()=>[i(g,{avatar:""},{default:n(()=>[i(y,{name:"edit"})]),_:1}),i(g,null,{default:n(()=>e[10]||(e[10]=[c("Editar")])),_:1})]),_:2},1032,["onClick"])),[[C]]),k((f(),p(U,{clickable:"",onClick:d=>s.removeIt(a)},{default:n(()=>[i(g,{avatar:""},{default:n(()=>[i(y,{name:"delete",color:"negative"})]),_:1}),i(g,{class:"text-negative"},{default:n(()=>e[11]||(e[11]=[c("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[C]])],64)):x("",!0)]),_:2},1024)]),l("td",null,r(a.titulo),1),l("td",null,r(a.fecha||"s/f"),1),l("td",null,r(a.numero||"—"),1),l("td",null,r(a.user?.name||a.user?.username||"—"),1)]))),128)),!u.caso.informes_legales.length&&!o.loading?(f(),v("tr",Xl,e[12]||(e[12]=[l("td",{colspan:"6",class:"text-center text-grey"},"Sin registros",-1)]))):x("",!0)])]),_:1}),i(O,{modelValue:o.dialog,"onUpdate:modelValue":e[6]||(e[6]=a=>o.dialog=a),persistent:"",maximized:""},{default:n(()=>[i(V,null,{default:n(()=>[i(ne,{class:"bg-white text-dark"},{default:n(()=>[l("div",Kl,r(o.mode==="view"?"Ver informe":o.form.id?"Editar informe":"Nuevo informe"),1),i(z),k(i(h,{flat:"",dense:"",round:"",icon:"close"},null,512),[[C]])]),_:1}),i(w),i(b,{class:""},{default:n(()=>[l("div",$l,[l("div",ei,[i(m,{modelValue:o.form.fecha,"onUpdate:modelValue":e[1]||(e[1]=a=>o.form.fecha=a),type:"date",dense:"",outlined:"",label:"Fecha",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),l("div",oi,[i(m,{modelValue:o.form.titulo,"onUpdate:modelValue":e[2]||(e[2]=a=>o.form.titulo=a),dense:"",outlined:"",label:"Título *",readonly:o.mode==="view",rules:[a=>!!a||"Requerido"]},null,8,["modelValue","readonly","rules"])]),l("div",li,[i(m,{modelValue:o.form.numero,"onUpdate:modelValue":e[3]||(e[3]=a=>o.form.numero=a),dense:"",outlined:"",label:"Nro",readonly:o.mode==="view"},null,8,["modelValue","readonly"])])]),o.mode!=="view"?(f(),v("div",ii,[i(R,{modelValue:o.plantilla,"onUpdate:modelValue":[e[4]||(e[4]=a=>o.plantilla=a),s.applyTemplate],options:o.plantillasOptions,label:"Plantilla",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])])):x("",!0),l("div",null,[e[14]||(e[14]=l("div",{class:"text-caption text-grey-7 q-mb-xs"},"Contenido (WYSIWYG / guarda HTML)",-1)),i(le,{modelValue:o.form.contenido_html,"onUpdate:modelValue":e[5]||(e[5]=a=>o.form.contenido_html=a),readonly:o.mode==="view","min-height":"320px",placeholder:"Escriba el informe legal...",toolbar:[["left","center","right","justify"],["bold","italic","strike","underline"],["quote","unordered","ordered","outdent","indent"],["hr","link"],["undo","redo"],["removeFormat"]]},null,8,["modelValue","readonly"])])]),_:1}),i(w),i(L,{align:"right"},{default:n(()=>[k(i(h,{flat:"",label:"Cerrar"},null,512),[[C]]),o.mode!=="view"&&s.canEdit?(f(),p(h,{key:0,color:"primary",label:"Guardar",loading:o.saving,onClick:s.save},null,8,["loading","onClick"])):x("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const si=E(Hl,[["render",ti]]),ai={name:"ApoyoIntegral",props:{caseId:{type:[String,Number],required:!0}}},ni={class:"text-grey-7"};function di(t,e,u,_,o,s){return f(),p(V,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[e[0]||(e[0]=l("div",{class:"text-subtitle1 text-weight-medium q-mb-sm"},"Apoyo integral",-1)),l("div",ni,"DIO personal, descripción, impresión (ID: "+r(u.caseId)+")",1)]),_:1})}const ri=E(ai,[["render",di]]),ci={name:"DocumentosGeneral",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,required:!1}},data(){return{loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dlgUpload:!1,file:null,meta:{titulo:"",categoria:"",descripcion:""},accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.odt,.ods,.txt,.zip,.jpg,.jpeg,.png,.webp",dlgEdit:!1,edit:{},editingId:null}},methods:{openUpload(){this.file=null,this.meta={titulo:"",categoria:"",descripcion:""},this.dlgUpload=!0},async upload(){if(!this.file){this.$q.notify({type:"negative",message:"Seleccione un archivo"});return}this.saving=!0;try{const t=new FormData;t.append("file",this.file),this.meta.titulo&&t.append("titulo",this.meta.titulo),this.meta.categoria&&t.append("categoria",this.meta.categoria),this.meta.descripcion&&t.append("descripcion",this.meta.descripcion),await this.$axios.post(`/umadis/${this.caseId}/documentos`,t,{headers:{"Content-Type":"multipart/form-data"}}),this.$q.notify({type:"positive",message:"Archivo subido"}),this.dlgUpload=!1,this.$emit("refresh")}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"No se pudo subir"})}finally{this.saving=!1}},viewDoc(t){const e=this.$axios?.defaults?.baseURL||"";window.open(`${e}/umadis/documentos/${t.id}/view`,"_blank")},downloadDoc(t){const e=this.$axios?.defaults?.baseURL||"";window.open(`${e}/umadis/documentos/${t.id}/download`,"_blank")},editMeta(t){this.editingId=t.id,this.edit={titulo:t.titulo,categoria:t.categoria,descripcion:t.descripcion},this.dlgEdit=!0},async saveMeta(){this.saving=!0;try{await this.$axios.put(`/umadis/documentos/${this.editingId}`,this.edit),this.$q.notify({type:"positive",message:"Actualizado"}),this.dlgEdit=!1,this.$emit("refresh")}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"No se pudo actualizar"})}finally{this.saving=!1}},removeDoc(t){const e=async()=>{try{await this.$axios.delete(`/umadis/documentos/${t.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.$emit("refresh")}catch(u){this.$q.notify({type:"negative",message:u?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar el documento?").onOk(e):confirm("¿Eliminar el documento?")&&e()}}},ui={class:"row items-center q-mb-sm"},mi={class:"col"},fi={class:"text-caption text-grey-7"},_i={class:"col-auto row items-center q-gutter-sm"},pi={class:"text-weight-medium"},gi={key:0};function hi(t,e,u,_,o,s){return f(),p(V,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[l("div",ui,[l("div",mi,[e[10]||(e[10]=l("div",{class:"text-subtitle1 text-weight-medium"},"Documentos (General)",-1)),l("div",fi,"Gestión de adjuntos del caso #"+r(u.caseId),1)]),l("div",_i,[i(h,{flat:"",color:"primary",icon:"refresh",loading:o.loading,onClick:e[0]||(e[0]=a=>t.$emit("refresh"))},null,8,["loading"]),i(h,{color:"green",icon:"upload","no-caps":"",label:"Subir archivo",onClick:s.openUpload},null,8,["onClick"])])]),i(w),i(K,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:n(()=>[e[16]||(e[16]=l("thead",null,[l("tr",{class:"bg-primary text-white"},[l("th",{style:{width:"70px"}},"ID"),l("th",{style:{width:"160px"}},"Acciones"),l("th",null,"Título"),l("th",{style:{width:"130px"}},"Categoría"),l("th",{style:{width:"120px"}},"Tamaño"),l("th",{style:{width:"160px"}},"Tipo"),l("th",{style:{width:"180px"}},"Usuario")])],-1)),l("tbody",null,[(f(!0),v(q,null,M(u.caso.documentos,a=>(f(),v("tr",{key:a.id},[l("td",null,"#"+r(a.id),1),l("td",null,[i(Q,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:n(()=>[k((f(),p(U,{clickable:"",onClick:d=>s.viewDoc(a)},{default:n(()=>[i(g,{avatar:""},{default:n(()=>[i(y,{name:"visibility"})]),_:1}),i(g,null,{default:n(()=>e[11]||(e[11]=[c("Ver")])),_:1})]),_:2},1032,["onClick"])),[[C]]),k((f(),p(U,{clickable:"",onClick:d=>s.downloadDoc(a)},{default:n(()=>[i(g,{avatar:""},{default:n(()=>[i(y,{name:"download"})]),_:1}),i(g,null,{default:n(()=>e[12]||(e[12]=[c("Descargar")])),_:1})]),_:2},1032,["onClick"])),[[C]]),i(w),k((f(),p(U,{clickable:"",onClick:d=>s.editMeta(a)},{default:n(()=>[i(g,{avatar:""},{default:n(()=>[i(y,{name:"edit"})]),_:1}),i(g,null,{default:n(()=>e[13]||(e[13]=[c("Editar")])),_:1})]),_:2},1032,["onClick"])),[[C]]),k((f(),p(U,{clickable:"",onClick:d=>s.removeDoc(a)},{default:n(()=>[i(g,{avatar:""},{default:n(()=>[i(y,{name:"delete",color:"negative"})]),_:1}),i(g,{class:"text-negative"},{default:n(()=>e[14]||(e[14]=[c("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[C]])]),_:2},1024)]),l("td",pi,r(a.titulo),1),l("td",null,r(a.categoria||"—"),1),l("td",null,r(a.size_human),1),l("td",null,r(a.mime||a.extension),1),l("td",null,r(a.user?.name||a.user?.username||"—"),1)]))),128)),!u.caso.documentos||u.caso.documentos.length===0?(f(),v("tr",gi,e[15]||(e[15]=[l("td",{colspan:"7",class:"text-center text-grey"},"Sin registros",-1)]))):x("",!0)])]),_:1}),i(O,{modelValue:o.dlgUpload,"onUpdate:modelValue":e[5]||(e[5]=a=>o.dlgUpload=a),persistent:""},{default:n(()=>[i(V,{style:{"max-width":"700px",width:"95vw"}},{default:n(()=>[i(b,{class:"row items-center q-pb-none"},{default:n(()=>[e[17]||(e[17]=l("div",{class:"text-subtitle1"},"Subir archivo",-1)),i(z),k(i(h,{flat:"",dense:"",round:"",icon:"close"},null,512),[[C]])]),_:1}),i(b,{class:"q-gutter-md"},{default:n(()=>[i(m,{modelValue:o.meta.titulo,"onUpdate:modelValue":e[1]||(e[1]=a=>o.meta.titulo=a),label:"Título",outlined:"",dense:""},null,8,["modelValue"]),i(m,{modelValue:o.meta.categoria,"onUpdate:modelValue":e[2]||(e[2]=a=>o.meta.categoria=a),label:"Categoría",outlined:"",dense:""},null,8,["modelValue"]),i(m,{modelValue:o.meta.descripcion,"onUpdate:modelValue":e[3]||(e[3]=a=>o.meta.descripcion=a),type:"textarea",label:"Descripción",outlined:"",dense:"",autogrow:""},null,8,["modelValue"]),i(de,{modelValue:o.file,"onUpdate:modelValue":e[4]||(e[4]=a=>o.file=a),outlined:"",dense:"","use-chips":"",clearable:!0,accept:o.accept,hint:"Hasta 20MB. PDF, Word, Excel, imágenes, etc."},null,8,["modelValue","accept"])]),_:1}),i(L,{align:"right"},{default:n(()=>[k(i(h,{flat:"",label:"Cancelar"},null,512),[[C]]),i(h,{color:"primary",label:"Subir",loading:o.saving,onClick:s.upload},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(O,{modelValue:o.dlgEdit,"onUpdate:modelValue":e[9]||(e[9]=a=>o.dlgEdit=a)},{default:n(()=>[i(V,{style:{"max-width":"600px",width:"95vw"}},{default:n(()=>[i(b,{class:"row items-center q-pb-none"},{default:n(()=>[e[18]||(e[18]=l("div",{class:"text-subtitle1"},"Editar metadatos",-1)),i(z),k(i(h,{flat:"",dense:"",round:"",icon:"close"},null,512),[[C]])]),_:1}),i(b,{class:"q-gutter-md"},{default:n(()=>[i(m,{modelValue:o.edit.titulo,"onUpdate:modelValue":e[6]||(e[6]=a=>o.edit.titulo=a),label:"Título",outlined:"",dense:""},null,8,["modelValue"]),i(m,{modelValue:o.edit.categoria,"onUpdate:modelValue":e[7]||(e[7]=a=>o.edit.categoria=a),label:"Categoría",outlined:"",dense:""},null,8,["modelValue"]),i(m,{modelValue:o.edit.descripcion,"onUpdate:modelValue":e[8]||(e[8]=a=>o.edit.descripcion=a),type:"textarea",label:"Descripción",outlined:"",dense:"",autogrow:""},null,8,["modelValue"])]),_:1}),i(L,{align:"right"},{default:n(()=>[k(i(h,{flat:"",label:"Cancelar"},null,512),[[C]]),i(h,{color:"primary",label:"Guardar",loading:o.saving,onClick:s.saveMeta},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const bi=E(ci,[["render",hi]]),vi={name:"Fotografias",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,required:!0}},data(){return{rows:{data:[],last_page:1},page:1,perPage:12,loading:!1,uploading:!1}},methods:{toPublicUrl(t){return console.log("url",t),t?/^https?:\/\//i.test(t)?t:`${(this.$axios?.defaults?.baseURL||"").replace(/\/api\/?$/,"")}${t}`:""},pickFile(){this.$refs.file.click()},async upload(t){const e=t.target.files?.[0];if(e){this.uploading=!0;try{const u=new FormData;u.append("file",e),await this.$axios.post(`/umadis/${this.caseId}/fotografias`,u,{headers:{"Content-Type":"multipart/form-data"}}),this.$q.notify({type:"positive",message:"Foto subida"}),this.$emit("refresh")}catch(u){this.$q.notify({type:"negative",message:u?.response?.data?.message||"No se pudo subir"})}finally{this.uploading=!1,this.$refs.file&&(this.$refs.file.value="")}}},async remove(t){if(confirm("¿Eliminar foto?"))try{await this.$axios.delete(`/umadis/fotografias/${t.id}`),this.$q.notify({type:"positive",message:"Eliminada"}),this.$emit("refresh")}catch(e){this.$q.notify({type:"negative",message:e?.response?.data?.message||"No se pudo eliminar"})}},view(t){t&&window.open(t,"_blank")}}},yi={class:"row items-center q-mb-sm"},Vi={class:"col"},xi={class:"text-caption text-grey-7"},wi={class:"col-auto"},ki={class:"row q-col-gutter-md q-mt-sm"},Ci={class:"absolute-bottom text-subtitle2 bg-black bg-opacity-40 q-pa-xs ellipsis"};function Ui(t,e,u,_,o,s){return f(),p(V,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[l("div",yi,[l("div",Vi,[e[1]||(e[1]=l("div",{class:"text-subtitle1 text-weight-medium"},"Fotografías",-1)),l("div",xi,"Sube/ver fotos del caso #"+r(u.caseId),1)]),l("div",wi,[i(h,{color:"primary",icon:"add_photo_alternate","no-caps":"",label:"Subir",onClick:s.pickFile,loading:o.uploading},null,8,["onClick","loading"]),l("input",{type:"file",ref:"file",accept:"image/*",class:"hidden",onChange:e[0]||(e[0]=(...a)=>s.upload&&s.upload(...a))},null,544)])]),i(w),l("div",ki,[(f(!0),v(q,null,M(u.caso.fotografias,a=>(f(),v("div",{key:a.id,class:"col-6 col-sm-4 col-md-3"},[i(V,{flat:"",bordered:""},{default:n(()=>[i(ie,{src:s.toPublicUrl(a.thumb_url||a.url),ratio:4/3,onClick:d=>s.view(s.toPublicUrl(a.url)),style:{cursor:"pointer"}},{default:n(()=>[l("div",Ci,r(a.titulo),1)]),_:2},1032,["src","onClick"]),i(L,{align:"between"},{default:n(()=>[i(h,{dense:"",flat:"",icon:"delete",color:"negative",onClick:d=>s.remove(a)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))])]),_:1})}const qi=E(vi,[["render",Ui]]),Di={name:"HojaRuta",props:{caseId:{type:[String,Number],required:!0}},data(){return{loading:!1,editing:!1,backup:null,form:{caso_numero:"",fecha_apertura_caso:"",fecha_derivacion_psicologica:"",fecha_informe_area_psicologica:"",fecha_informe_trabajo_social:"",fecha_derivacion_area_legal:""}}},computed:{canEdit(){const t=this.$store.user?.role||"";return t==="Administrador"||t==="Asistente"},isReadOnly(){return!this.editing||!this.canEdit},total(){return 5},done(){return["fecha_apertura_caso","fecha_derivacion_psicologica","fecha_informe_area_psicologica","fecha_informe_trabajo_social","fecha_derivacion_area_legal"].filter(e=>!!this.form[e]).length}},created(){this.fetch()},methods:{format(t){return t||"—"},async fetch(){this.loading=!0;try{const{data:t}=await this.$axios.get(`/slims/${this.caseId}`);this.form={caso_numero:t.caso_numero||"",fecha_apertura_caso:t.fecha_apertura_caso||"",fecha_derivacion_psicologica:t.fecha_derivacion_psicologica||"",fecha_informe_area_psicologica:t.fecha_informe_area_psicologica||"",fecha_informe_trabajo_social:t.fecha_informe_trabajo_social||"",fecha_derivacion_area_legal:t.fecha_derivacion_area_legal||""},this.backup={...this.form}}catch(t){this.$alert?.error(t?.response?.data?.message||"No se pudo cargar la hoja de ruta")}finally{this.loading=!1}},startEdit(){this.canEdit&&(this.editing=!0,this.backup={...this.form})},cancelEdit(){this.form={...this.backup},this.editing=!1,this.$q.notify({type:"info",message:"Cambios descartados"})},async save(){if(!this.canEdit)return;const t={fecha_derivacion_psicologica:this.form.fecha_derivacion_psicologica||null,fecha_informe_area_psicologica:this.form.fecha_informe_area_psicologica||null,fecha_informe_trabajo_social:this.form.fecha_informe_trabajo_social||null,fecha_derivacion_area_legal:this.form.fecha_derivacion_area_legal||null};this.loading=!0;try{const{data:e}=await this.$axios.put(`/slims/${this.caseId}`,t);this.form={...this.form,fecha_derivacion_psicologica:e.data?.fecha_derivacion_psicologica??this.form.fecha_derivacion_psicologica,fecha_informe_area_psicologica:e.data?.fecha_informe_area_psicologica??this.form.fecha_informe_area_psicologica,fecha_informe_trabajo_social:e.data?.fecha_informe_trabajo_social??this.form.fecha_informe_trabajo_social,fecha_derivacion_area_legal:e.data?.fecha_derivacion_area_legal??this.form.fecha_derivacion_area_legal},this.backup={...this.form},this.editing=!1,this.$alert?.success("Hoja de ruta actualizada")}catch(e){this.$alert?.error(e?.response?.data?.message||"No se pudo actualizar")}finally{this.loading=!1}}}},Ii={class:"row items-center q-mb-sm"},Ei={class:"col"},ji={class:"text-caption text-grey-7"},Si={class:"col-auto row items-center q-gutter-sm"},Ni={class:"row q-col-gutter-md"},Pi={class:"col-12 col-md-3"},Ti={class:"col-12 col-md-3"},Ai={class:"col-12 col-md-3"},Fi={class:"col-12 col-md-3"},Ri={class:"col-12 col-md-3"},Oi={class:"col-12 col-md-3"};function Li(t,e,u,_,o,s){return f(),v("div",null,[l("div",Ii,[l("div",Ei,[e[6]||(e[6]=l("div",{class:"text-subtitle1 text-weight-medium"},"Hoja de ruta",-1)),l("div",ji," Completa las fechas clave del caso ("+r(s.done)+"/"+r(s.total)+" completadas) ",1)]),l("div",Si,[s.canEdit?x("",!0):(f(),p(oe,{key:0,dense:"",color:"grey-3","text-color":"grey-9",icon:"visibility_off"},{default:n(()=>e[7]||(e[7]=[c(" Solo lectura ")])),_:1})),i(h,{flat:"",color:"secondary",icon:"refresh",loading:o.loading,onClick:s.fetch},null,8,["loading","onClick"]),s.canEdit?(f(),v(q,{key:1},[o.editing?(f(),v(q,{key:1},[i(h,{flat:"",color:"negative",icon:"close",label:"Cancelar",onClick:s.cancelEdit,loading:o.loading},null,8,["onClick","loading"]),i(h,{color:"primary",icon:"save",label:"Guardar",onClick:s.save,loading:o.loading},null,8,["onClick","loading"])],64)):(f(),p(h,{key:0,color:"primary",icon:"edit",label:"Editar",onClick:s.startEdit,loading:o.loading},null,8,["onClick","loading"]))],64)):x("",!0)])]),i(V,{flat:"",bordered:"",class:"section-card"},{default:n(()=>[i(b,null,{default:n(()=>[l("div",Ni,[l("div",Pi,[i(m,{modelValue:o.form.caso_numero,"onUpdate:modelValue":e[0]||(e[0]=a=>o.form.caso_numero=a),label:"Código de caso",dense:"",outlined:"",readonly:""},null,8,["modelValue"])]),l("div",Ti,[i(m,{modelValue:o.form.fecha_apertura_caso,"onUpdate:modelValue":e[1]||(e[1]=a=>o.form.fecha_apertura_caso=a),type:"date",label:"Fecha de apertura del caso",dense:"",outlined:"",readonly:""},null,8,["modelValue"])]),l("div",Ai,[i(m,{modelValue:o.form.fecha_derivacion_psicologica,"onUpdate:modelValue":e[2]||(e[2]=a=>o.form.fecha_derivacion_psicologica=a),type:"date",readonly:s.isReadOnly,dense:"",outlined:"",label:"Fecha de derivación psicológica"},null,8,["modelValue","readonly"])]),l("div",Fi,[i(m,{modelValue:o.form.fecha_informe_area_psicologica,"onUpdate:modelValue":e[3]||(e[3]=a=>o.form.fecha_informe_area_psicologica=a),type:"date",readonly:s.isReadOnly,dense:"",outlined:"",label:"Fecha de entrega informe (Área psicológica)"},null,8,["modelValue","readonly"])]),l("div",Ri,[i(m,{modelValue:o.form.fecha_informe_trabajo_social,"onUpdate:modelValue":e[4]||(e[4]=a=>o.form.fecha_informe_trabajo_social=a),type:"date",readonly:s.isReadOnly,dense:"",outlined:"",label:"Fecha de entrega (Trabajo social)"},null,8,["modelValue","readonly"])]),l("div",Oi,[i(m,{modelValue:o.form.fecha_derivacion_area_legal,"onUpdate:modelValue":e[5]||(e[5]=a=>o.form.fecha_derivacion_area_legal=a),type:"date",readonly:s.isReadOnly,dense:"",outlined:"",label:"Fecha de derivación (Área legal)"},null,8,["modelValue","readonly"])])])]),_:1}),i(w),i(b,null,{default:n(()=>[i(te,{color:"primary",layout:"comfortable",side:"right"},{default:n(()=>[i(P,{title:"Apertura del caso",subtitle:s.format(o.form.fecha_apertura_caso),icon:"flag"},null,8,["subtitle"]),i(P,{title:"Derivación psicológica",subtitle:s.format(o.form.fecha_derivacion_psicologica),icon:"psychology",color:o.form.fecha_derivacion_psicologica?"primary":"grey-5"},null,8,["subtitle","color"]),i(P,{title:"Informe área psicológica",subtitle:s.format(o.form.fecha_informe_area_psicologica),icon:"assignment_turned_in",color:o.form.fecha_informe_area_psicologica?"primary":"grey-5"},null,8,["subtitle","color"]),i(P,{title:"Entrega trabajo social",subtitle:s.format(o.form.fecha_informe_trabajo_social),icon:"diversity_3",color:o.form.fecha_informe_trabajo_social?"primary":"grey-5"},null,8,["subtitle","color"]),i(P,{title:"Derivación área legal",subtitle:s.format(o.form.fecha_derivacion_area_legal),icon:"gavel",color:o.form.fecha_derivacion_area_legal?"primary":"grey-5"},null,8,["subtitle","color"])]),_:1})]),_:1})]),_:1})])}const Qi=E(Di,[["render",Li],["__scopeId","data-v-3bf1ae6b"]]),zi={name:"SeguimientoUmadi",props:{caso:{type:Object,required:!0}},data(){return{header:{},history:[],dialog:{show:!1,title:"",html:""}}},mounted(){this.hydrate()},watch:{caso:{handler(){this.hydrate()},deep:!0}},methods:{hydrate(){const t=this.caso?.umadi?this.caso.umadi:this.caso||{},e=[t.nombres,t.paterno,t.materno].filter(Boolean).join(" "),u=[t.denunciado_nombres,t.denunciado_paterno,t.denunciado_materno].filter(Boolean).join(" ");this.header={area:t.area,zona:t.zona,fecha_registro:t.fecha_registro,numero_caso:t.numero_caso||t.numero_apoyo_integral,direccion_actual:t.direccion_actual||t.direccion,fecha_hecho:t.fecha_hecho,registrado_por:t.user?.name||"—",denunciante:e||"—",denunciado:u||"—"};const _=[];(t.psicologicas||[]).forEach(o=>{_.push({uid:`psy-${o.id}`,kind:"psy",icon:"psychology",side:"left",date:(o.fecha||o.created_at||"").slice(0,10)||"0000-00-00",title:`Psicológico · ${o.titulo||"Sin título"}`,subtitle:`${(o.fecha||"").slice(0,10)} · ${o.tipo||"—"} · ${o.user?.name||"—"}`,brief:o.lugar?`Lugar: ${o.lugar}`:"",html:o.contenido_html||o.contenido||null})}),(t.informes_legales||[]).forEach(o=>{_.push({uid:`legal-${o.id}`,kind:"legal",icon:"gavel",side:"right",date:(o.fecha||o.created_at||"").slice(0,10)||"0000-00-00",title:`Legal · ${o.titulo||"Informe"}`,subtitle:`${(o.fecha||"").slice(0,10)} · ${o.user?.name||"—"}`,brief:o.numero?`Informe N° ${o.numero}`:o.descripcion||"",html:o.contenido_html||o.contenido||null})}),(t.documentos||[]).forEach(o=>{_.push({uid:`doc-${o.id}`,kind:"doc",icon:"description",side:"left",date:(o.created_at||o.fecha||"").slice(0,10)||"0000-00-00",title:`Documento · ${o.titulo||o.original_name||o.filename||"Archivo"}`,subtitle:`${o.size_human||""} ${o.extension?"· "+String(o.extension).toUpperCase():""} · ${o.user?.name||"—"}`,brief:o.descripcion||"",url:this.firstUrl(o)})}),(t.fotografias||[]).forEach(o=>{_.push({uid:`photo-${o.id}`,kind:"photo",icon:"photo",side:"right",date:(o.created_at||o.fecha||"").slice(0,10)||"0000-00-00",title:`Fotografía · ${o.titulo||o.original_name||o.filename||"Imagen"}`,subtitle:`${o.width&&o.height?`${o.width}×${o.height}`:""} ${o.user?.name?"· "+o.user.name:""}`,brief:o.descripcion||"",url:this.firstUrl(o),thumbUrl:o.thumb_url||o.thumbPath||o.thumb||null})}),_.sort((o,s)=>{const a=o.date||"0000-00-00",d=s.date||"0000-00-00";return a===d?o.uid>s.uid?1:-1:d.localeCompare(a)}),this.history=_},firstUrl(t={}){const e=t.url||t.public_url||t.path||t.file_url||"";return this.toPublicUrl(e)},toPublicUrl(t){return t?/^https?:\/\//i.test(t)?t:`${(this.$axios?.defaults?.baseURL||"").replace(/\/api\/?$/,"")}${t.startsWith("/")?t:`/${t}`}`:""},open(t){const e=this.toPublicUrl(t);e&&window.open(e,"_blank")},openHtml(t,e){this.dialog.title=t||"Contenido",this.dialog.html=e||"<em>Sin contenido</em>",this.dialog.show=!0}}},Mi={class:"row items-start q-col-gutter-sm"},Gi={class:"col-12 col-md-8"},Bi={class:"text-caption text-grey-7"},Hi={class:"text-caption"},Wi={class:"col-12 col-md-4 flex items-center justify-end"},Yi={class:"row q-col-gutter-sm"},Ji={class:"col-12 col-md-3"},Zi={class:"val"},Xi={class:"col-12 col-md-3"},Ki={class:"val"},$i={class:"col-12 col-md-3"},et={class:"val ellipsis"},ot={class:"col-12 col-md-3"},lt={class:"val"},it={class:"q-mt-sm"},tt={class:"row q-gutter-xs"},st={key:0,class:"text-grey-7 text-center q-mt-lg"},at={class:"text-subtitle1 text-weight-medium"},nt=["innerHTML"];function dt(t,e,u,_,o,s){return f(),v("div",null,[i(V,{flat:"",bordered:"",class:"q-pa-sm q-mb-md"},{default:n(()=>[l("div",Mi,[l("div",Gi,[e[6]||(e[6]=l("div",{class:"text-subtitle1 text-weight-bold"},"Seguimiento del Caso — UMADI",-1)),l("div",Bi,[e[1]||(e[1]=c(" Área ")),l("b",null,r(o.header.area||"—"),1),e[2]||(e[2]=c(" · Zona ")),l("b",null,r(o.header.zona||"—"),1)]),l("div",Hi,[e[3]||(e[3]=c(" N° Caso: ")),l("b",null,r(o.header.numero_caso||"—"),1),e[4]||(e[4]=l("span",{class:"text-grey-7"}," · Registrado:",-1)),e[5]||(e[5]=c()),l("b",null,r(o.header.fecha_registro||"—"),1)])]),l("div",Wi,[i(oe,{dense:"",color:"indigo-1","text-color":"indigo-9",class:"q-mr-xs"},{default:n(()=>[c(r(o.header.registrado_por||"—"),1)]),_:1})])]),i(w,{class:"q-my-sm"}),l("div",Yi,[l("div",Ji,[e[7]||(e[7]=l("div",{class:"lbl"},"Denunciante",-1)),l("div",Zi,r(o.header.denunciante||"—"),1)]),l("div",Xi,[e[8]||(e[8]=l("div",{class:"lbl"},"Denunciado",-1)),l("div",Ki,r(o.header.denunciado||"—"),1)]),l("div",$i,[e[9]||(e[9]=l("div",{class:"lbl"},"Dirección (actual)",-1)),l("div",et,r(o.header.direccion_actual||"—"),1)]),l("div",ot,[e[10]||(e[10]=l("div",{class:"lbl"},"Fecha del hecho",-1)),l("div",lt,r(o.header.fecha_hecho||"—"),1)])])]),_:1}),i(V,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[e[11]||(e[11]=l("div",{class:"text-subtitle1 text-weight-medium q-mb-md"},"Historial",-1)),i(te,{color:"primary",layout:"comfortable"},{default:n(()=>[(f(!0),v(q,null,M(o.history,a=>(f(),p(P,{key:a.uid,title:a.title,subtitle:a.subtitle,body:a.brief,icon:a.icon,side:a.side},{default:n(()=>[l("div",it,[l("div",tt,[a.kind==="doc"&&a.url?(f(),p(h,{key:0,dense:"",flat:"",icon:"download",label:"Descargar / Abrir",onClick:d=>s.open(a.url)},null,8,["onClick"])):x("",!0),a.kind==="photo"&&a.url?(f(),p(h,{key:1,dense:"",flat:"",icon:"image",label:"Ver imagen",onClick:d=>s.open(a.url)},null,8,["onClick"])):x("",!0),(a.kind==="psy"||a.kind==="legal")&&a.html?(f(),p(h,{key:2,dense:"",flat:"",icon:"visibility",label:"Ver contenido",onClick:d=>s.openHtml(a.title,a.html)},null,8,["onClick"])):x("",!0)]),a.kind==="photo"&&a.thumbUrl?(f(),p(ie,{key:0,src:s.toPublicUrl(a.thumbUrl),ratio:16/9,class:"q-mt-sm rounded-borders",style:{"max-width":"380px"},alt:a.title,"spinner-color":"primary"},null,8,["src","alt"])):x("",!0)])]),_:2},1032,["title","subtitle","body","icon","side"]))),128))]),_:1}),o.history.length?x("",!0):(f(),v("div",st," Sin actividades registradas. "))]),_:1}),i(O,{modelValue:o.dialog.show,"onUpdate:modelValue":e[0]||(e[0]=a=>o.dialog.show=a),maximized:""},{default:n(()=>[i(V,{style:{"max-width":"1000px",width:"100%"}},{default:n(()=>[i(b,{class:"row items-center"},{default:n(()=>[l("div",at,r(o.dialog.title),1),i(z),k(i(h,{dense:"",flat:"",icon:"close"},null,512),[[C]])]),_:1}),i(w),i(b,null,{default:n(()=>[l("div",{class:"html-content",innerHTML:o.dialog.html},null,8,nt)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const rt=E(zi,[["render",dt],["__scopeId","data-v-c963b9a9"]]),ct={name:"UmadiDetalle",components:{InfoGeneral:Dl,SesionesPsicologico:Bl,InformesLegal:si,ApoyoIntegral:ri,DocumentosGeneral:bi,Fotografias:qi,HojaRuta:Qi,Seguimiento:rt},data(){return{loading:!1,tab:"info",umadis:null,defaultCountryCallingCode:"591"}},computed:{caseId(){return this.$route.params.id},role(){return this.$store.user?.role||""},hasAnyWa(){const t=this.umadis||{};return!!(t?.psicologica_user?.celular||t?.legal_user?.celular||t?.trabajo_social_user?.celular)}},created(){this.fetchUmadi()},methods:{normalizePhone(t){if(!t)return"";let e=String(t).replace(/\D+/g,"");return/^(\d{11,13})$/.test(e)?e:e.length===8?this.defaultCountryCallingCode+e:e.length===9&&!e.startsWith(this.defaultCountryCallingCode)?this.defaultCountryCallingCode+e:e},waUrl(t,e){const u=this.normalizePhone(t),_=encodeURIComponent(e||"");return`https://wa.me/${u}${_?`?text=${_}`:""}`},waMessage(t){const e=this.umadis||{},u=e.caso_numero?e.caso_numero.replace(/\\\//g,"/"):`#${this.caseId}`,_=(this.$axios?.defaults?.baseURL||"")+`/umadis/${this.caseId}`,o=t==="psico"?"Psicología":t==="legal"?"Legal":"Trabajo Social";return["*Umadi - Notificación de Caso*",`Nro: ${u}`,`Área: ${o}`,`Denunciante: ${e.denunciante_nombre_completo||"—"}`,e.caso_tipologia?`Tipología: ${e.caso_tipologia}`:null,e.caso_modalidad?`Modalidad: ${e.caso_modalidad}`:null,e.caso_fecha_hecho?`Fecha del hecho: ${e.caso_fecha_hecho}`:null,"",`Ver Umadi: ${_}`].filter(Boolean).join(`
`)},sendWhatsApp(t){const e=this.umadis||{},u=t==="psico"?e.psicologica_user:t==="legal"?e.legal_user:t==="social"?e.trabajo_social_user:null;if(!u?.celular){this.$q.notify({type:"warning",message:"No hay número de celular configurado para ese responsable"});return}const _=this.waUrl(u.celular,this.waMessage(t));window.open(_,"_blank")},async fetchUmadi(){this.loading=!0;try{const t=await this.$axios.get(`/umadis/${this.caseId}`);this.umadis=t.data.umadi}catch(t){this.$alert.error(t?.response?.data?.message||"No se pudo cargar el Umadi")}finally{this.loading=!1}},printPdf(){const t=this.$axios.defaults.baseURL+`/umadis/${this.caseId}/pdf`;window.open(t,"_blank")},printPdfHojaRuta(t="denunciante"){const e=this.$axios.defaults.baseURL+`/umadis/${this.caseId}/pdf/hoja-ruta?tipo=${t}`;window.open(e,"_blank")}}},ut={class:"row items-center q-mb-md"},mt={class:"col"},ft={class:"text-h6 text-weight-bold"},_t={class:"col-auto row q-gutter-sm"};function pt(t,e,u,_,o,s){const a=I("InfoGeneral"),d=I("Seguimiento"),Y=I("HojaRuta"),J=I("SesionesPsicologico"),Z=I("InformesLegal"),G=I("ApoyoIntegral"),$=I("DocumentosGeneral"),X=I("Fotografias");return f(),p(ue,{class:"q-pa-md bg-grey-2"},{default:n(()=>[l("div",ut,[l("div",mt,[l("div",ft,"Umadi #"+r(o.umadis?.id||"..."),1),e[6]||(e[6]=l("div",{class:"text-caption text-grey-7"},"Detalle y gestión integral",-1))]),l("div",_t,[s.hasAnyWa?(f(),p(Q,{key:0,flat:"",color:"positive",icon:"chat",label:"WhatsApp"},{default:n(()=>[i(ee,null,{default:n(()=>[o.umadis?.psicologica_user?.celular?(f(),p(U,{key:0,clickable:"",onClick:e[0]||(e[0]=D=>s.sendWhatsApp("psico"))},{default:n(()=>[i(g,{avatar:""},{default:n(()=>[i(y,{name:"psychology"})]),_:1}),i(g,null,{default:n(()=>[c("Psicología ("+r(o.umadis.psicologica_user.name)+")",1)]),_:1}),i(g,{side:"",class:"text-caption text-grey"},{default:n(()=>[c(r(o.umadis.psicologica_user.celular),1)]),_:1})]),_:1})):x("",!0),o.umadis?.legal_user?.celular?(f(),p(U,{key:1,clickable:"",onClick:e[1]||(e[1]=D=>s.sendWhatsApp("legal"))},{default:n(()=>[i(g,{avatar:""},{default:n(()=>[i(y,{name:"gavel"})]),_:1}),i(g,null,{default:n(()=>[c("Legal ("+r(o.umadis.legal_user.name)+")",1)]),_:1}),i(g,{side:"",class:"text-caption text-grey"},{default:n(()=>[c(r(o.umadis.legal_user.celular),1)]),_:1})]),_:1})):x("",!0),o.umadis?.trabajo_social_user?.celular?(f(),p(U,{key:2,clickable:"",onClick:e[2]||(e[2]=D=>s.sendWhatsApp("social"))},{default:n(()=>[i(g,{avatar:""},{default:n(()=>[i(y,{name:"people"})]),_:1}),i(g,null,{default:n(()=>[c("Trabajo social ("+r(o.umadis.trabajo_social_user.name)+")",1)]),_:1}),i(g,{side:"",class:"text-caption text-grey"},{default:n(()=>[c(r(o.umadis.trabajo_social_user.celular),1)]),_:1})]),_:1})):x("",!0)]),_:1})]),_:1})):x("",!0),i(Q,{flat:"",color:"secondary",icon:"print",label:"Imprimir PDF"},{default:n(()=>[i(ee,null,{default:n(()=>[k((f(),p(U,{clickable:"",onClick:s.printPdf},{default:n(()=>[i(g,null,{default:n(()=>e[7]||(e[7]=[c("Ficha del Umadi")])),_:1})]),_:1},8,["onClick"])),[[C]]),i(w),k((f(),p(U,{clickable:"",onClick:e[3]||(e[3]=D=>s.printPdfHojaRuta("denunciante"))},{default:n(()=>[i(g,null,{default:n(()=>e[8]||(e[8]=[c("Ubicación")])),_:1})]),_:1})),[[C]])]),_:1})]),_:1}),i(h,{flat:"",color:"primary",icon:"refresh",onClick:s.fetchUmadi,loading:o.loading},null,8,["onClick","loading"])])]),i(V,{flat:"",bordered:"",class:"q-mb-md"},{default:n(()=>[i(re,{modelValue:o.tab,"onUpdate:modelValue":e[4]||(e[4]=D=>o.tab=D),class:"text-primary",dense:"",align:"left","active-color":"primary","indicator-color":"primary","outside-arrows":"","mobile-arrows":""},{default:n(()=>[i(N,{name:"info",label:"1 Información General",icon:"dashboard","no-caps":""}),i(N,{name:"seguimiento",label:"2 Seguimiento",icon:"track_changes","no-caps":""}),s.role==="Administrador"||s.role==="Psicologo"?(f(),p(N,{key:0,name:"psico",label:"3 Área Psicológico",icon:"psychology","no-caps":""})):x("",!0),s.role==="Administrador"||s.role==="Abogado"?(f(),p(N,{key:1,name:"legal",label:"4 Área Legal",icon:"gavel","no-caps":""})):x("",!0),i(N,{name:"docs",label:"5 Documentos General",icon:"folder","no-caps":""}),i(N,{name:"fotos",label:"6 Fotografías",icon:"photo_library","no-caps":""})]),_:1},8,["modelValue"])]),_:1}),i(ce,{modelValue:o.tab,"onUpdate:modelValue":e[5]||(e[5]=D=>o.tab=D),animated:"","keep-alive":""},{default:n(()=>[i(S,{name:"info"},{default:n(()=>[i(a,{"case-id":s.caseId,caso:o.umadis,onUpdate:s.fetchUmadi},null,8,["case-id","caso","onUpdate"])]),_:1}),i(S,{name:"seguimiento"},{default:n(()=>[i(d,{"case-id":s.caseId,caso:o.umadis,onRefresh:s.fetchUmadi},null,8,["case-id","caso","onRefresh"])]),_:1}),i(S,{name:"hoja"},{default:n(()=>[i(Y,{"case-id":s.caseId},null,8,["case-id"])]),_:1}),i(S,{name:"psico"},{default:n(()=>[i(J,{"case-id":s.caseId,caso:o.umadis,onRefresh:s.fetchUmadi},null,8,["case-id","caso","onRefresh"])]),_:1}),i(S,{name:"legal"},{default:n(()=>[i(Z,{"case-id":s.caseId,caso:o.umadis,onRefresh:s.fetchUmadi},null,8,["case-id","caso","onRefresh"])]),_:1}),i(S,{name:"apoyo"},{default:n(()=>[i(G,{"case-id":s.caseId},null,8,["case-id"])]),_:1}),i(S,{name:"docs"},{default:n(()=>[i($,{"case-id":s.caseId,caso:o.umadis,onRefresh:s.fetchUmadi},null,8,["case-id","caso","onRefresh"])]),_:1}),i(S,{name:"fotos"},{default:n(()=>[i(X,{"case-id":s.caseId,caso:o.umadis,onRefresh:s.fetchUmadi},null,8,["case-id","caso","onRefresh"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Nt=E(ct,[["render",pt],["__scopeId","data-v-1533bde1"]]);export{Nt as default};
