import{_ as j,Y as S,a0 as V,o as c,b as i,$ as y,c as g,f as _,a1 as I,a as o,w as a,e as v,Z as f,t as r,Q as w,d as b,a3 as C,a6 as m,a7 as me,aa as L,a2 as K,W as x,h as J,a8 as z,j as de,n as fe,p as oe,ab as re,k as Z,x as ge,l as U,m as ie,L as pe,O as _e,g as he,ac as be}from"./index-6VkIjhqe.js";import{a as q,d as p,Q as te}from"./format-C-AzdLyV.js";import{Q as G,a as ne}from"./QList-DUsTJ4mW.js";import{S as M,Q as ce,a as ve,b as ye,c as Ve,d as T,e as we,f as P}from"./QFile-C9hcFyur.js";import{Q as xe}from"./QPage-DzTIvfIT.js";import{C as k}from"./ClosePopup-CDY0NxG9.js";import{Q as E}from"./QSelect-BJ7TsnOB.js";import{M as ke}from"./MapPicker-BZCHstPA.js";import{Q as se}from"./QMarkupTable-DOG7CcEn.js";import{Q as $}from"./QPagination-VQdNU7D5.js";import{Q as X}from"./QSpace-CZm0oBCz.js";import{Q as Ce}from"./QImg-B3bjMTD0.js";import{a as Y,Q as qe}from"./QTable-_jehuVtm.js";import"./QResizeObserver-EHUx9HJA.js";import"./touch-BjYP5sR0.js";import"./QTooltip-CtEuTGWM.js";import"./_commonjsHelpers-Cpj98o6Y.js";const Ue={name:"InfoGeneral",components:{MapPicker:ke},props:{caseId:{type:[String,Number],required:!0}},data(){return{documentos:[{label:"Carnet de identidad",value:"Carnet de identidad"},{label:"Pasaporte",value:"Pasaporte"},{label:"Libreta de servicio militar",value:"Libreta de servicio militar"},{label:"Libreta de conducir",value:"Libreta de conducir"}],loading:!1,editing:!1,form:{},backup:null,oruroCenter:[-17.9667,-67.1167],psicologos:[],abogados:[],sociales:[]}},computed:{canEdit(){const t=this.$store.user?.role||"";return t==="Administrador"||t==="Asistente"},denunciantePos:{get(){return{latitud:this.form.latitud,longitud:this.form.longitud}},set(t){this.form.latitud=t.latitud,this.form.longitud=t.longitud}},denunciadoPos:{get(){return{latitud:this.form.denunciado_latitud,longitud:this.form.denunciado_longitud}},set(t){this.form.denunciado_latitud=t.latitud,this.form.denunciado_longitud=t.longitud}},optPsicologos(){return this.psicologos.map(t=>({label:t.name,value:t.id}))},optAbogados(){return this.abogados.map(t=>({label:t.name,value:t.id}))},optSociales(){return this.sociales.map(t=>({label:t.name,value:t.id}))},nombreDenunciante(){const t=this.form||{},e=t.denunciante_nombre_completo&&t.denunciante_nombre_completo.trim();return e||[t.denunciante_nombres,t.denunciante_paterno,t.denunciante_materno].filter(Boolean).join(" ")||"—"}},created(){this.fetch(),this.fetchRoles()},methods:{req(t){return!!t||"Requerido"},orDash(t){return t||"—"},nombreUsuario(t,e,u){if(t&&t.name)return t.name;const h=(u||[]).find(l=>Number(l.id)===Number(e));return h?h.name||h.name:"—"},onBirthChange(t){const e=t==="denunciado"?"denunciado":"denunciante",u=this.form[`${e}_fecha_nacimiento`];if(!u){this.form[`${e}_edad`]="";return}const h=new Date(u),l=Date.now()-h.getTime(),n=new Date(l);this.form[`${e}_edad`]=Math.abs(n.getUTCFullYear()-1970)},async fetchRoles(){try{const{data:t}=await this.$axios.get("/usuariosRole");this.psicologos=t.psicologos||[],this.abogados=t.abogados||[],this.sociales=t.sociales||[]}catch{this.$alert.error("No se pudo cargar los usuarios por rol")}},async fetch(){this.loading=!0;try{const t=await this.$axios.get(`/slims/${this.caseId}`);this.form={...t.data},!this.form.psicologica_user_id&&this.form.psicologica_user?.id&&(this.form.psicologica_user_id=this.form.psicologica_user.id),!this.form.trabajo_social_user_id&&this.form.trabajo_social_user?.id&&(this.form.trabajo_social_user_id=this.form.trabajo_social_user.id),!this.form.legal_user_id&&this.form.legal_user?.id&&(this.form.legal_user_id=this.form.legal_user.id),this.backup={...this.form}}catch(t){this.$alert.error(t?.response?.data?.message||"No se pudo cargar el SLIM")}finally{this.loading=!1}},startEdit(){this.canEdit&&(this.editing=!0,this.backup={...this.form})},cancelEdit(){this.form={...this.backup},this.editing=!1,this.$q.notify({type:"info",message:"Cambios descartados"})},async save(){if(this.canEdit){this.loading=!0;try{const t=await this.$axios.put(`/slims/${this.caseId}`,this.form);this.form={...t.data.data},this.backup={...this.form},this.editing=!1,this.$alert.success("Información general actualizada")}catch(t){this.$alert.error(t?.response?.data?.message||"No se pudo actualizar")}finally{this.loading=!1}}}}},Ie={class:"row items-center q-mb-sm"},De={key:0,class:"col-auto row q-gutter-sm"},Ee={class:"col-6 col-md-3"},Se={class:"col-6 col-md-3"},je={class:"col-12 col-md-6"},Re={class:"col-6 col-md-4"},Pe={class:"col-6 col-md-4"},Te={class:"col-12"},Ne={class:"ellipsis-3"},Ae={class:"col-6 col-md-2"},Le={class:"col-6 col-md-2"},Qe={class:"col-12 col-md-6"},Fe={class:"col-6 col-md-3"},Me={class:"col-6 col-md-3"},Oe={class:"col-6 col-md-3"},ze={class:"col-6 col-md-3"},Ge={class:"col-6 col-md-3"},Be={class:"col-6 col-md-3"},He={class:"col-6 col-md-3"},We={class:"col-6 col-md-3"},Ye={class:"col-12"},Ze={class:"col-12 col-md-6"},Je={class:"col-6 col-md-3"},Xe={class:"col-6 col-md-3"},Ke={class:"col-6 col-md-3"},$e={class:"col-6 col-md-3"},el={class:"col-6 col-md-3"},ll={class:"col-6 col-md-3"},ol={class:"col-12"},il={class:"col-12 col-md-4"},tl={class:"col-12 col-md-4"},sl={class:"col-12 col-md-4"},al={class:"row q-col-gutter-md"},nl={class:"col-12 col-md-3"},dl={class:"col-12 col-md-3"},rl={class:"col-12 col-md-6"},cl={class:"col-12 col-md-4"},ul={class:"col-12"},ml={class:"row q-col-gutter-md"},fl={class:"col-12 col-md-2"},gl={class:"col-12 col-md-2"},pl={class:"col-12 col-md-2"},_l={class:"col-12 col-md-2"},hl={class:"col-12 col-md-2"},bl={class:"col-6 col-md-3"},vl={class:"col-6 col-md-3"},yl={class:"col-6 col-md-3"},Vl={class:"col-6 col-md-3"},wl={class:"col-6 col-md-3"},xl={class:"col-6 col-md-3"},kl={class:"col-6 col-md-3"},Cl={class:"col-6 col-md-3"},ql={class:"col-6 col-md-3"},Ul={class:"col-6 col-md-3"},Il={class:"col-6 col-md-3"},Dl={class:"col-12 col-md-3"},El={class:"col-12 col-md-3"},Sl={class:"col-12"},jl={class:"col-12"},Rl={class:"row q-col-gutter-md"},Pl={class:"col-12 col-md-6"},Tl={class:"col-6 col-md-3"},Nl={class:"col-6 col-md-3"},Al={class:"col-6 col-md-3"},Ll={class:"col-6 col-md-3"},Ql={class:"col-6 col-md-3"},Fl={class:"col-6 col-md-3"},Ml={class:"col-6 col-md-3"},Ol={class:"col-6 col-md-3"},zl={class:"col-6 col-md-3"},Gl={class:"col-12"},Bl={class:"col-12"},Hl={class:"row q-col-gutter-md"},Wl={class:"col-12 col-md-4"},Yl={class:"col-12 col-md-4"},Zl={class:"col-12 col-md-4"},Jl={class:"row q-col-gutter-md"},Xl={class:"col-12 col-md-2"},Kl={class:"col-12 col-md-2"},$l={class:"col-12 col-md-2"},eo={class:"col-12 col-md-2"},lo={class:"col-12 col-md-2"},oo={class:"col-12 col-md-2"};function io(t,e,u,h,l,n){const s=S("MapPicker");return c(),V("div",null,[i("div",Ie,[e[48]||(e[48]=i("div",{class:"col"},[i("div",{class:"text-subtitle1 text-weight-medium"},"Información General")],-1)),n.canEdit?(c(),V("div",De,[l.editing?(c(),V(I,{key:1},[o(_,{flat:"",color:"negative",icon:"close",label:"Cancelar",onClick:n.cancelEdit,loading:l.loading},null,8,["onClick","loading"]),o(_,{color:"primary",icon:"save",label:"Guardar",onClick:n.save,loading:l.loading},null,8,["onClick","loading"])],64)):(c(),g(_,{key:0,color:"primary",icon:"edit",label:"Editar",onClick:n.startEdit,loading:l.loading},null,8,["onClick","loading"]))])):y("",!0)]),n.canEdit?(c(),V(I,{key:1},[o(w,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:a(()=>[o(v,null,{default:a(()=>[i("div",al,[i("div",nl,[o(m,{modelValue:l.form.caso_numero,"onUpdate:modelValue":e[0]||(e[0]=d=>l.form.caso_numero=d),readonly:!0,dense:"",outlined:"",label:"Nro de SLIM"},null,8,["modelValue"])]),i("div",dl,[o(m,{modelValue:l.form.caso_fecha_hecho,"onUpdate:modelValue":e[1]||(e[1]=d=>l.form.caso_fecha_hecho=d),readonly:!l.editing,type:"date",dense:"",outlined:"",label:"Fecha del hecho"},null,8,["modelValue","readonly"])]),i("div",rl,[o(m,{modelValue:l.form.caso_lugar_hecho,"onUpdate:modelValue":e[2]||(e[2]=d=>l.form.caso_lugar_hecho=d),readonly:!l.editing,dense:"",outlined:"",clearable:"",label:"Lugar del hecho"},null,8,["modelValue","readonly"])]),i("div",cl,[o(m,{modelValue:l.form.caso_tipologia,"onUpdate:modelValue":e[3]||(e[3]=d=>l.form.caso_tipologia=d),readonly:!l.editing,dense:"",outlined:"",clearable:"",label:"Tipología"},null,8,["modelValue","readonly"])]),i("div",ul,[o(m,{modelValue:l.form.caso_descripcion,"onUpdate:modelValue":e[4]||(e[4]=d=>l.form.caso_descripcion=d),readonly:!l.editing,type:"textarea",autogrow:"",outlined:"",dense:"",clearable:"",label:"Descripción del hecho",counter:"",maxlength:"3000"},null,8,["modelValue","readonly"])])])]),_:1})]),_:1}),o(w,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:a(()=>[o(v,{class:"row items-center"},{default:a(()=>[o(b,{name:"assignment_ind",class:"q-mr-sm"}),e[82]||(e[82]=i("div",{class:"text-subtitle1 text-weight-medium"},"Denunciante",-1))]),_:1}),o(C),o(v,null,{default:a(()=>[i("div",ml,[i("div",fl,[o(E,{modelValue:l.form.area,"onUpdate:modelValue":e[5]||(e[5]=d=>l.form.area=d),dense:"",outlined:"",readonly:!l.editing,options:t.$areas,label:"Área *",rules:[n.req]},null,8,["modelValue","readonly","options","rules"])]),i("div",gl,[o(E,{modelValue:l.form.zona,"onUpdate:modelValue":e[6]||(e[6]=d=>l.form.zona=d),dense:"",outlined:"",readonly:!l.editing,options:t.$zonas,label:"Zona *",rules:[n.req]},null,8,["modelValue","readonly","options","rules"])]),i("div",pl,[o(m,{modelValue:l.form.denunciante_nombres,"onUpdate:modelValue":e[7]||(e[7]=d=>l.form.denunciante_nombres=d),dense:"",outlined:"",clearable:"",readonly:!l.editing,label:"Nombres *",rules:[n.req]},null,8,["modelValue","readonly","rules"])]),i("div",_l,[o(m,{modelValue:l.form.denunciante_paterno,"onUpdate:modelValue":e[8]||(e[8]=d=>l.form.denunciante_paterno=d),dense:"",outlined:"",clearable:"",readonly:!l.editing,label:"Apellido paterno"},null,8,["modelValue","readonly"])]),i("div",hl,[o(m,{modelValue:l.form.denunciante_materno,"onUpdate:modelValue":e[9]||(e[9]=d=>l.form.denunciante_materno=d),dense:"",outlined:"",clearable:"",readonly:!l.editing,label:"Apellido materno"},null,8,["modelValue","readonly"])]),i("div",bl,[o(m,{modelValue:l.form.denunciante_lugar_nacimiento,"onUpdate:modelValue":e[10]||(e[10]=d=>l.form.denunciante_lugar_nacimiento=d),dense:"",outlined:"",clearable:"",label:"Lugar de nacimiento",readonly:!l.editing},null,8,["modelValue","readonly"])]),i("div",vl,[o(m,{modelValue:l.form.denunciante_fecha_nacimiento,"onUpdate:modelValue":[e[11]||(e[11]=d=>l.form.denunciante_fecha_nacimiento=d),e[12]||(e[12]=d=>n.onBirthChange("denunciante"))],type:"date",dense:"",outlined:"",label:"Fecha de nacimiento",readonly:!l.editing},null,8,["modelValue","readonly"])]),i("div",yl,[o(m,{modelValue:l.form.denunciante_edad,"onUpdate:modelValue":e[13]||(e[13]=d=>l.form.denunciante_edad=d),modelModifiers:{number:!0},dense:"",outlined:"",type:"number",label:"Edad",readonly:!l.editing},null,8,["modelValue","readonly"])]),i("div",Vl,[o(m,{modelValue:l.form.denunciante_telefono,"onUpdate:modelValue":e[14]||(e[14]=d=>l.form.denunciante_telefono=d),dense:"",outlined:"",clearable:"",label:"Teléfono/Celular",readonly:!l.editing},null,8,["modelValue","readonly"])]),i("div",wl,[o(m,{modelValue:l.form.denunciante_grado,"onUpdate:modelValue":e[15]||(e[15]=d=>l.form.denunciante_grado=d),dense:"",outlined:"",clearable:"",label:"Grado de instrucción",readonly:!l.editing},null,8,["modelValue","readonly"])]),i("div",xl,[o(m,{modelValue:l.form.denunciante_documento,"onUpdate:modelValue":e[16]||(e[16]=d=>l.form.denunciante_documento=d),readonly:!l.editing,dense:"",outlined:"",clearable:"",label:"Documento"},null,8,["modelValue","readonly"])]),i("div",kl,[o(m,{modelValue:l.form.denunciante_nro,"onUpdate:modelValue":e[17]||(e[17]=d=>l.form.denunciante_nro=d),readonly:!l.editing,dense:"",outlined:"",clearable:"",label:"Nro documento"},null,8,["modelValue","readonly"])]),i("div",Cl,[o(m,{modelValue:l.form.denunciante_sexo,"onUpdate:modelValue":e[18]||(e[18]=d=>l.form.denunciante_sexo=d),readonly:!l.editing,dense:"",outlined:"",clearable:"",label:"Sexo"},null,8,["modelValue","readonly"])]),i("div",ql,[o(m,{modelValue:l.form.denunciante_estado_civil,"onUpdate:modelValue":e[19]||(e[19]=d=>l.form.denunciante_estado_civil=d),readonly:!l.editing,dense:"",outlined:"",clearable:"",label:"Estado civil"},null,8,["modelValue","readonly"])]),i("div",Ul,[o(m,{modelValue:l.form.denunciante_residencia,"onUpdate:modelValue":e[20]||(e[20]=d=>l.form.denunciante_residencia=d),readonly:!l.editing,dense:"",outlined:"",clearable:"",label:"Residencia"},null,8,["modelValue","readonly"])]),i("div",Il,[o(m,{modelValue:l.form.denunciante_idioma,"onUpdate:modelValue":e[21]||(e[21]=d=>l.form.denunciante_idioma=d),readonly:!l.editing,dense:"",outlined:"",clearable:"",label:"Idioma"},null,8,["modelValue","readonly"])]),i("div",Dl,[o(me,{modelValue:l.form.denunciante_trabaja,"onUpdate:modelValue":e[22]||(e[22]=d=>l.form.denunciante_trabaja=d),disable:!l.editing,label:"Trabaja"},null,8,["modelValue","disable"])]),i("div",El,[o(m,{modelValue:l.form.denunciante_ocupacion,"onUpdate:modelValue":e[23]||(e[23]=d=>l.form.denunciante_ocupacion=d),readonly:!l.editing,dense:"",outlined:"",clearable:"",label:"Ocupación"},null,8,["modelValue","readonly"])]),i("div",Sl,[o(m,{modelValue:l.form.denunciante_domicilio_actual,"onUpdate:modelValue":e[24]||(e[24]=d=>l.form.denunciante_domicilio_actual=d),readonly:!l.editing,dense:"",outlined:"",clearable:"",label:"Domicilio actual"},null,8,["modelValue","readonly"])]),i("div",jl,[e[83]||(e[83]=i("div",{class:"text-caption text-grey-7 q-mb-xs"},"Ubicación (denunciante)",-1)),o(s,{modelValue:n.denunciantePos,"onUpdate:modelValue":e[25]||(e[25]=d=>n.denunciantePos=d),center:l.oruroCenter},null,8,["modelValue","center"])])])]),_:1})]),_:1}),o(w,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:a(()=>[o(v,{class:"row items-center"},{default:a(()=>[o(b,{name:"person_pin_circle",class:"q-mr-sm"}),e[84]||(e[84]=i("div",{class:"text-subtitle1 text-weight-medium"},"Denunciado",-1))]),_:1}),o(C),o(v,null,{default:a(()=>[i("div",Rl,[i("div",Pl,[o(m,{modelValue:l.form.denunciado_nombre_completo,"onUpdate:modelValue":e[26]||(e[26]=d=>l.form.denunciado_nombre_completo=d),readonly:!l.editing,dense:"",outlined:"",clearable:"",label:"Nombre completo"},null,8,["modelValue","readonly"])]),i("div",Tl,[o(E,{modelValue:l.form.denunciado_documento,"onUpdate:modelValue":e[27]||(e[27]=d=>l.form.denunciado_documento=d),dense:"",outlined:"",readonly:!l.editing,"emit-value":"","map-options":"",options:l.documentos,label:"Documento"},null,8,["modelValue","readonly","options"])]),i("div",Nl,[o(m,{modelValue:l.form.denunciado_nro,"onUpdate:modelValue":e[28]||(e[28]=d=>l.form.denunciado_nro=d),readonly:!l.editing,dense:"",outlined:"",clearable:"",label:"Nro documento"},null,8,["modelValue","readonly"])]),i("div",Al,[o(m,{modelValue:l.form.denunciado_sexo,"onUpdate:modelValue":e[29]||(e[29]=d=>l.form.denunciado_sexo=d),readonly:!l.editing,dense:"",outlined:"",clearable:"",label:"Sexo"},null,8,["modelValue","readonly"])]),i("div",Ll,[o(m,{modelValue:l.form.denunciado_lugar_nacimiento,"onUpdate:modelValue":e[30]||(e[30]=d=>l.form.denunciado_lugar_nacimiento=d),dense:"",outlined:"",clearable:"",label:"Lugar de nacimiento",readonly:!l.editing},null,8,["modelValue","readonly"])]),i("div",Ql,[o(m,{modelValue:l.form.denunciado_fecha_nacimiento,"onUpdate:modelValue":[e[31]||(e[31]=d=>l.form.denunciado_fecha_nacimiento=d),e[32]||(e[32]=d=>n.onBirthChange("denunciado"))],type:"date",dense:"",outlined:"",label:"Fecha de nacimiento",readonly:!l.editing},null,8,["modelValue","readonly"])]),i("div",Fl,[o(m,{modelValue:l.form.denunciado_edad,"onUpdate:modelValue":e[33]||(e[33]=d=>l.form.denunciado_edad=d),modelModifiers:{number:!0},dense:"",outlined:"",type:"number",label:"Edad",readonly:!l.editing},null,8,["modelValue","readonly"])]),i("div",Ml,[o(m,{modelValue:l.form.denunciado_telefono,"onUpdate:modelValue":e[34]||(e[34]=d=>l.form.denunciado_telefono=d),dense:"",outlined:"",clearable:"",label:"Teléfono/Celular",readonly:!l.editing},null,8,["modelValue","readonly"])]),i("div",Ol,[o(m,{modelValue:l.form.denunciado_grado,"onUpdate:modelValue":e[35]||(e[35]=d=>l.form.denunciado_grado=d),dense:"",outlined:"",clearable:"",label:"Grado de instrucción",readonly:!l.editing},null,8,["modelValue","readonly"])]),i("div",zl,[o(m,{modelValue:l.form.denunciado_residencia,"onUpdate:modelValue":e[36]||(e[36]=d=>l.form.denunciado_residencia=d),readonly:!l.editing,dense:"",outlined:"",clearable:"",label:"Residencia"},null,8,["modelValue","readonly"])]),i("div",Gl,[o(m,{modelValue:l.form.denunciado_domicilio_actual,"onUpdate:modelValue":e[37]||(e[37]=d=>l.form.denunciado_domicilio_actual=d),readonly:!l.editing,dense:"",outlined:"",clearable:"",label:"Domicilio actual"},null,8,["modelValue","readonly"])]),i("div",Bl,[e[85]||(e[85]=i("div",{class:"text-caption text-grey-7 q-mb-xs"},"Ubicación (denunciado)",-1)),o(s,{modelValue:n.denunciadoPos,"onUpdate:modelValue":e[38]||(e[38]=d=>n.denunciadoPos=d),center:l.oruroCenter},null,8,["modelValue","center"])])])]),_:1})]),_:1}),o(w,{flat:"",bordered:"",class:"section-card q-mb-xl"},{default:a(()=>[o(v,{class:"row items-center"},{default:a(()=>[o(b,{name:"task_alt",class:"q-mr-sm"}),e[86]||(e[86]=i("div",{class:"text-subtitle1 text-weight-medium"},"Seguimiento",-1))]),_:1}),o(C),o(v,null,{default:a(()=>[i("div",Hl,[i("div",Wl,[o(E,{modelValue:l.form.psicologica_user_id,"onUpdate:modelValue":e[39]||(e[39]=d=>l.form.psicologica_user_id=d),dense:"",outlined:"","emit-value":"","map-options":"",options:n.optPsicologos,label:"Área psicológica (responsable)",readonly:!l.editing},null,8,["modelValue","options","readonly"])]),i("div",Yl,[o(E,{modelValue:l.form.trabajo_social_user_id,"onUpdate:modelValue":e[40]||(e[40]=d=>l.form.trabajo_social_user_id=d),dense:"",outlined:"","emit-value":"","map-options":"",options:n.optSociales,label:"Área social (responsable)",readonly:!l.editing},null,8,["modelValue","options","readonly"])]),i("div",Zl,[o(E,{modelValue:l.form.legal_user_id,"onUpdate:modelValue":e[41]||(e[41]=d=>l.form.legal_user_id=d),dense:"",outlined:"","emit-value":"","map-options":"",options:n.optAbogados,label:"Área legal (responsable)",readonly:!l.editing},null,8,["modelValue","options","readonly"])])])]),_:1})]),_:1}),o(w,{flat:"",bordered:"",class:"section-card q-mb-xl"},{default:a(()=>[o(v,{class:"row items-center"},{default:a(()=>[o(b,{name:"task_alt",class:"q-mr-sm"}),e[87]||(e[87]=i("div",{class:"text-subtitle1 text-weight-medium"},"Check documentos adjuntos",-1))]),_:1}),o(C),o(v,null,{default:a(()=>[i("div",Jl,[i("div",Xl,[o(L,{modelValue:l.form.documento_fotocopia_carnet_denunciante,"onUpdate:modelValue":e[42]||(e[42]=d=>l.form.documento_fotocopia_carnet_denunciante=d),label:"Fotocopia CI denunciante","false-value":"0","true-value":"1",disable:!l.editing},null,8,["modelValue","disable"])]),i("div",Kl,[o(L,{modelValue:l.form.documento_fotocopia_carnet_denunciado,"onUpdate:modelValue":e[43]||(e[43]=d=>l.form.documento_fotocopia_carnet_denunciado=d),label:"Fotocopia CI denunciado","false-value":"0","true-value":"1",disable:!l.editing},null,8,["modelValue","disable"])]),i("div",$l,[o(L,{modelValue:l.form.documento_placas_fotograficas_domicilio_denunciante,"onUpdate:modelValue":e[44]||(e[44]=d=>l.form.documento_placas_fotograficas_domicilio_denunciante=d),label:"Placas fotográficas dom. denunciante","false-value":"0","true-value":"1",disable:!l.editing},null,8,["modelValue","disable"])]),i("div",eo,[o(L,{modelValue:l.form.documento_croquis_direccion_denunciado,"onUpdate:modelValue":e[45]||(e[45]=d=>l.form.documento_croquis_direccion_denunciado=d),label:"Croquis dirección denunciado","false-value":"0","true-value":"1",disable:!l.editing},null,8,["modelValue","disable"])]),i("div",lo,[o(L,{modelValue:l.form.documento_placas_fotograficas_domicilio_denunciado,"onUpdate:modelValue":e[46]||(e[46]=d=>l.form.documento_placas_fotograficas_domicilio_denunciado=d),label:"Placas fotográficas dom. denunciado","false-value":"0","true-value":"1",disable:!l.editing},null,8,["modelValue","disable"])]),i("div",oo,[o(L,{modelValue:l.form.documento_ciudadania_digital,"onUpdate:modelValue":e[47]||(e[47]=d=>l.form.documento_ciudadania_digital=d),label:"Ciudadanía digital","false-value":"0","true-value":"1",disable:!l.editing},null,8,["modelValue","disable"])])])]),_:1})]),_:1})],64)):(c(),V(I,{key:0},[o(w,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:a(()=>[o(v,{class:"row q-col-gutter-md"},{default:a(()=>[i("div",Ee,[e[49]||(e[49]=i("b",null,"N° SLIM:",-1)),f(" "+r(n.orDash(l.form.caso_numero)),1)]),i("div",Se,[e[50]||(e[50]=i("b",null,"Fecha del hecho:",-1)),f(" "+r(n.orDash(l.form.caso_fecha_hecho)),1)]),i("div",je,[e[51]||(e[51]=i("b",null,"Lugar del hecho:",-1)),f(" "+r(n.orDash(l.form.caso_lugar_hecho)),1)]),i("div",Re,[e[52]||(e[52]=i("b",null,"Tipología:",-1)),f(" "+r(n.orDash(l.form.caso_tipologia)),1)]),i("div",Pe,[e[53]||(e[53]=i("b",null,"Modalidad:",-1)),f(" "+r(n.orDash(l.form.caso_modalidad)),1)]),i("div",Te,[e[54]||(e[54]=i("b",null,"Descripción:",-1)),e[55]||(e[55]=f()),i("span",Ne,r(n.orDash(l.form.caso_descripcion)),1)])]),_:1})]),_:1}),o(w,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:a(()=>[o(v,{class:"row items-center"},{default:a(()=>[o(b,{name:"assignment_ind",class:"q-mr-sm"}),e[56]||(e[56]=i("div",{class:"text-subtitle1 text-weight-medium"},"Denunciante",-1))]),_:1}),o(C),o(v,{class:"row q-col-gutter-md"},{default:a(()=>[i("div",Ae,[e[57]||(e[57]=i("b",null,"Área:",-1)),f(" "+r(n.orDash(l.form.area)),1)]),i("div",Le,[e[58]||(e[58]=i("b",null,"Zona:",-1)),f(" "+r(n.orDash(l.form.zona)),1)]),i("div",Qe,[e[59]||(e[59]=i("b",null,"Nombre:",-1)),f(" "+r(n.nombreDenunciante),1)]),i("div",Fe,[e[60]||(e[60]=i("b",null,"Documento:",-1)),f(" "+r(n.orDash(l.form.denunciante_documento)),1)]),i("div",Me,[e[61]||(e[61]=i("b",null,"Nro:",-1)),f(" "+r(n.orDash(l.form.denunciante_nro)),1)]),i("div",Oe,[e[62]||(e[62]=i("b",null,"Sexo:",-1)),f(" "+r(n.orDash(l.form.denunciante_sexo)),1)]),i("div",ze,[e[63]||(e[63]=i("b",null,"Estado civil:",-1)),f(" "+r(n.orDash(l.form.denunciante_estado_civil)),1)]),i("div",Ge,[e[64]||(e[64]=i("b",null,"Edad:",-1)),f(" "+r(n.orDash(l.form.denunciante_edad)),1)]),i("div",Be,[e[65]||(e[65]=i("b",null,"Teléfono:",-1)),f(" "+r(n.orDash(l.form.denunciante_telefono)),1)]),i("div",He,[e[66]||(e[66]=i("b",null,"Idioma:",-1)),f(" "+r(n.orDash(l.form.denunciante_idioma)),1)]),i("div",We,[e[67]||(e[67]=i("b",null,"Ocupación:",-1)),f(" "+r(n.orDash(l.form.denunciante_ocupacion)),1)]),i("div",Ye,[e[68]||(e[68]=i("b",null,"Domicilio:",-1)),f(" "+r(n.orDash(l.form.denunciante_domicilio_actual)),1)])]),_:1})]),_:1}),o(w,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:a(()=>[o(v,{class:"row items-center"},{default:a(()=>[o(b,{name:"person_pin_circle",class:"q-mr-sm"}),e[69]||(e[69]=i("div",{class:"text-subtitle1 text-weight-medium"},"Denunciado",-1))]),_:1}),o(C),o(v,{class:"row q-col-gutter-md"},{default:a(()=>[i("div",Ze,[e[70]||(e[70]=i("b",null,"Nombre:",-1)),f(" "+r(n.orDash(l.form.denunciado_nombre_completo)),1)]),i("div",Je,[e[71]||(e[71]=i("b",null,"Documento:",-1)),f(" "+r(n.orDash(l.form.denunciado_documento)),1)]),i("div",Xe,[e[72]||(e[72]=i("b",null,"Nro:",-1)),f(" "+r(n.orDash(l.form.denunciado_nro)),1)]),i("div",Ke,[e[73]||(e[73]=i("b",null,"Sexo:",-1)),f(" "+r(n.orDash(l.form.denunciado_sexo)),1)]),i("div",$e,[e[74]||(e[74]=i("b",null,"Edad:",-1)),f(" "+r(n.orDash(l.form.denunciado_edad)),1)]),i("div",el,[e[75]||(e[75]=i("b",null,"Teléfono:",-1)),f(" "+r(n.orDash(l.form.denunciado_telefono)),1)]),i("div",ll,[e[76]||(e[76]=i("b",null,"Grado:",-1)),f(" "+r(n.orDash(l.form.denunciado_grado)),1)]),i("div",ol,[e[77]||(e[77]=i("b",null,"Domicilio:",-1)),f(" "+r(n.orDash(l.form.denunciado_domicilio_actual)),1)])]),_:1})]),_:1}),o(w,{flat:"",bordered:"",class:"section-card q-mb-xl"},{default:a(()=>[o(v,{class:"row items-center"},{default:a(()=>[o(b,{name:"task_alt",class:"q-mr-sm"}),e[78]||(e[78]=i("div",{class:"text-subtitle1 text-weight-medium"},"Seguimiento",-1))]),_:1}),o(C),o(v,{class:"row q-col-gutter-md"},{default:a(()=>[i("div",il,[e[79]||(e[79]=i("b",null,"Psicología:",-1)),f(" "+r(n.nombreUsuario(l.form.psicologica_user,l.form.psicologica_user_id,l.psicologos)),1)]),i("div",tl,[e[80]||(e[80]=i("b",null,"Trabajo social:",-1)),f(" "+r(n.nombreUsuario(l.form.trabajo_social_user,l.form.trabajo_social_user_id,l.sociales)),1)]),i("div",sl,[e[81]||(e[81]=i("b",null,"Legal:",-1)),f(" "+r(n.nombreUsuario(l.form.legal_user,l.form.legal_user_id,l.abogados)),1)])]),_:1})]),_:1})],64))])}const to=j(Ue,[["render",io],["__scopeId","data-v-fbe5ba7a"]]),so={name:"SesionesPsicologico",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:null}},data(){return{loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dialog:!1,mode:"create",form:{id:null,fecha:"",titulo:"",duracion_min:null,lugar:"",tipo:"Individual",contenido_html:""},plantilla:null,plantillasOptions:[{label:"Consentimiento informado",value:"consentimiento"},{label:"Informe Psicológico (formato DIO)",value:"informe_dio"},{label:"Acta de sesión (DIO)",value:"acta"},{label:"Informe breve (psicológico)",value:"informe"},{label:"Constancia de asistencia",value:"constancia"}]}},computed:{role(){return this.$store.user?.role||""},canEdit(){return this.role==="Administrador"||this.role==="Psicologo"}},watch:{caseId(){this.page=1,this.fetchRows()},search(){this.page=1,this.fetchRows()}},created(){this.fetchRows()},methods:{today(){const t=new Date,e=u=>String(u).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`},async fetchRows(){if(this.caseId){this.loading=!0;try{const t=await this.$axios.get(`/slims/${this.caseId}/sesiones-psicologicas`,{params:{q:this.search,page:this.page,per_page:this.perPage}});this.rows=t.data||{data:[],last_page:1}}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"Error cargando sesiones"})}finally{this.loading=!1}}},openCreate(){this.canEdit&&(this.mode="create",this.plantilla="consentimiento",this.form={id:null,fecha:this.today(),titulo:"",duracion_min:null,lugar:"",tipo:"Individual",contenido_html:""},this.dialog=!0,this.$nextTick(()=>this.applyTemplate("consentimiento")))},openView(t){this.mode="view",this.form={...t},this.dialog=!0},openEdit(t){this.canEdit&&(this.mode="edit",this.form={...t},this.dialog=!0)},applyTemplate(t){if(this.mode==="view")return;const e=this.caso||{},u={nombres:e.denunciante_nombres||e.denunciante_nombre_completo||"",apellidos:[e.denunciante_paterno,e.denunciante_materno].filter(Boolean).join(" "),edad:e.denunciante_edad||"",fecha_nacimiento:e.denunciante_fecha_nacimiento||"",lugar_nacimiento:e.denunciante_lugar_nacimiento||"",grado:e.denunciante_grado||"",ocupacion:e.denunciante_ocupacion_exacto||e.denunciante_ocupacion||"",domicilio:e.denunciante_domicilio_actual||e.denunciante_residencia||"",documento:e.denunciante_documento||"Carnet de identidad",nro:e.denunciante_nro||"",telefono:e.denunciante_telefono||e.denunciante_movil||e.denunciante_fijo||"",estado_civil:e.denunciante_estado_civil||""},h=[];for(let R=1;R<=5;R++){const F=e[`familiar${R}_nombre_completo`],H=e[`familiar${R}_edad`],W=e[`familiar${R}_parentesco`],ue=e[`familiar${R}_celular`];(F||H||W||ue)&&h.push({nombre:F||"",edad:H||"",estado_civil:"",parentesco:W||"",ocupacion:""})}const l=(this.form.fecha||this.today()).slice(0,4),n=e.caso_numero&&String(e.caso_numero).trim()!==""?String(e.caso_numero):`${String(this.caseId).padStart(2,"0")}/${l}`,s=e.legal_user?.name||e.legal_user?.username||"",d=e.psicologica_user?.name||e.psicologica_user?.username||this.$store?.state?.user?.name||"",N=e.caso_tipologia||e.caso_modalidad?`Evaluación psicológica en el marco de presunta(s) ${[e.caso_tipologia,e.caso_modalidad].filter(Boolean).join(" / ")}.`:"Evaluación psicológica para determinar los efectos emocionales y psicológicos en la evaluada.",A=(()=>{const R=e.caso_fecha_hecho?`el ${e.caso_fecha_hecho}`:"en fecha no precisada",F=[e.caso_lugar_hecho,e.caso_zona,e.caso_direccion].filter(Boolean).join(", "),H=F?`, en ${F}`:"",W=e.caso_descripcion?` ${e.caso_descripcion}`:"";return`Según la apertura del caso, el hecho habría ocurrido ${R}${H}.${W}`})(),ee=["Entrevista clínica y observación conductual","Aplicación de instrumentos psicométricos según pertinencia (Goldberg, IES-R, Rosenberg)"].join("; ")+".",B=[e.violencia_fisica?"violencia física":null,e.violencia_psicologica?"violencia psicológica":null,e.violencia_sexual?"violencia sexual":null,e.violencia_economica?"violencia económica/patrimonial":null].filter(Boolean),le="Se evidencian reacciones emocionales congruentes con el evento referido, con impacto en el equilibrio afectivo y la autoestima."+(B.length?` Se consideran indicadores asociados a ${B.join(", ")}.`:"")+" No se evidencian signos de psicosis. Se sugiere seguimiento clínico y contención.",D=["Intervención psicológica: terapia focalizada en manejo de ansiedad/estrés y fortalecimiento de recursos personales.","Orientación/asesoramiento legal para evitar revictimización y garantizar medidas de protección, si corresponde."].join(" "),Q={casoId:this.caseId,fecha:this.form.fecha||this.today(),titulo:this.form.titulo||"Sesión psicológica",lugar:this.form.lugar||"",tipo:this.form.tipo||"Individual",nombre:e.denunciante_nombre_completo,documento:e.denunciante_nro,numeroCaso:n,abogadoNombre:s,psicologoNombre:d,denunciante:u,familiares:h,motivo:N,antecedentes:A,tecnicas:ee,conclusiones:le,recomendaciones:D};t==="acta"?this.form.contenido_html=M.acta(Q):t==="informe"?this.form.contenido_html=M.informe(Q):t==="constancia"?this.form.contenido_html=M.constancia(Q):t==="consentimiento"?this.form.contenido_html=M.consentimiento(Q):t==="informe_dio"&&(this.form.contenido_html=M.informe_dio(Q))},async save(){if(this.canEdit){if(!this.form.titulo){this.$q.notify({type:"negative",message:"El título es obligatorio"});return}if(!this.form.contenido_html){this.$q.notify({type:"negative",message:"El contenido está vacío"});return}this.saving=!0;try{this.form.id?await this.$axios.put(`/slims/sesiones-psicologicas/${this.form.id}`,this.form):await this.$axios.post(`/slims/${this.caseId}/sesiones-psicologicas`,this.form),this.$q.notify({type:"positive",message:"Guardado"}),this.dialog=!1,this.fetchRows()}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}}},remove(t){if(!this.canEdit)return;const e=async()=>{try{await this.$axios.delete(`/slims/sesiones-psicologicas/${t.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.fetchRows()}catch(u){this.$q.notify({type:"negative",message:u?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar la sesión?").onOk(e):confirm("¿Eliminar la sesión?")&&e()},printPdf(t){const e=this.$axios?.defaults?.baseURL||"";window.open(`${e}/slims/sesiones-psicologicas/${t.id}/pdf`,"_blank")}}},ao={class:"row items-center q-mb-sm"},no={class:"col"},ro={class:"text-caption text-grey-7"},co={class:"col-auto row items-center q-gutter-sm"},uo={class:"text-grey-8"},mo={key:0},fo={class:"row justify-end q-mt-sm"},go={class:"text-subtitle1"},po={class:"row q-col-gutter-md"},_o={class:"col-12 col-md-3"},ho={class:"col-12 col-md-5"},bo={class:"col-6 col-md-2"},vo={class:"col-6 col-md-2"},yo={class:"col-12"},Vo={key:0};function wo(t,e,u,h,l,n){return c(),g(w,{flat:"",bordered:"",class:"q-pa-md"},{default:a(()=>[i("div",ao,[i("div",no,[e[10]||(e[10]=i("div",{class:"text-subtitle1 text-weight-medium"},"Sesiones (Psicológico)",-1)),i("div",ro,"Vinculadas al caso #"+r(u.caseId),1)]),i("div",co,[o(m,{dense:"",outlined:"",modelValue:l.search,"onUpdate:modelValue":e[0]||(e[0]=s=>l.search=s),placeholder:"Buscar...",style:{width:"260px"}},{append:a(()=>[o(b,{name:"search"})]),_:1},8,["modelValue"]),o(_,{flat:"",color:"primary",icon:"refresh",loading:l.loading,onClick:n.fetchRows},null,8,["loading","onClick"]),n.canEdit?(c(),g(_,{key:0,color:"green",icon:"add_circle_outline","no-caps":"",label:"Crear sesión",onClick:n.openCreate},null,8,["onClick"])):y("",!0)])]),o(C),o(se,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:a(()=>[e[16]||(e[16]=i("thead",null,[i("tr",{class:"bg-primary text-white"},[i("th",{style:{width:"70px"}},"ID"),i("th",{style:{width:"140px"}},"Acciones"),i("th",null,"Título"),i("th",{style:{width:"120px"}},"Fecha"),i("th",{style:{width:"120px"}},"Tipo"),i("th",{style:{width:"180px"}},"Usuario")])],-1)),i("tbody",null,[(c(!0),V(I,null,K(l.rows.data,s=>(c(),V("tr",{key:s.id},[i("td",uo,"#"+r(s.id),1),i("td",null,[o(G,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:a(()=>[x((c(),g(q,{clickable:"",onClick:d=>n.openView(s)},{default:a(()=>[o(p,{avatar:""},{default:a(()=>[o(b,{name:"visibility"})]),_:1}),o(p,null,{default:a(()=>e[11]||(e[11]=[f("Ver")])),_:1})]),_:2},1032,["onClick"])),[[k]]),x((c(),g(q,{clickable:"",onClick:d=>n.printPdf(s)},{default:a(()=>[o(p,{avatar:""},{default:a(()=>[o(b,{name:"print"})]),_:1}),o(p,null,{default:a(()=>e[12]||(e[12]=[f("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[k]]),n.canEdit?(c(),V(I,{key:0},[o(C),x((c(),g(q,{clickable:"",onClick:d=>n.openEdit(s)},{default:a(()=>[o(p,{avatar:""},{default:a(()=>[o(b,{name:"edit"})]),_:1}),o(p,null,{default:a(()=>e[13]||(e[13]=[f("Editar")])),_:1})]),_:2},1032,["onClick"])),[[k]]),x((c(),g(q,{clickable:"",onClick:d=>n.remove(s)},{default:a(()=>[o(p,{avatar:""},{default:a(()=>[o(b,{name:"delete",color:"negative"})]),_:1}),o(p,{class:"text-negative"},{default:a(()=>e[14]||(e[14]=[f("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[k]])],64)):y("",!0)]),_:2},1024)]),i("td",null,r(s.titulo),1),i("td",null,r(s.fecha||"s/f"),1),i("td",null,r(s.tipo||"—"),1),i("td",null,r(s.user?.name||s.user?.username||"—"),1)]))),128)),!l.rows.data.length&&!l.loading?(c(),V("tr",mo,e[15]||(e[15]=[i("td",{colspan:"6",class:"text-center text-grey"},"Sin registros",-1)]))):y("",!0)])]),_:1}),i("div",fo,[o($,{modelValue:l.page,"onUpdate:modelValue":[e[1]||(e[1]=s=>l.page=s),n.fetchRows],max:l.rows.last_page||1,"boundary-numbers":"","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])]),o(J,{modelValue:l.dialog,"onUpdate:modelValue":e[9]||(e[9]=s=>l.dialog=s),persistent:""},{default:a(()=>[o(w,{style:{"max-width":"900px",width:"95vw"}},{default:a(()=>[o(v,{class:"row items-center q-pb-none"},{default:a(()=>[i("div",go,r(l.mode==="view"?"Ver sesión":l.form.id?"Editar sesión":"Nueva sesión"),1),o(X),x(o(_,{flat:"",round:"",dense:"",icon:"close"},null,512),[[k]])]),_:1}),o(v,{class:"q-gutter-md"},{default:a(()=>[i("div",po,[i("div",_o,[o(m,{modelValue:l.form.fecha,"onUpdate:modelValue":e[2]||(e[2]=s=>l.form.fecha=s),type:"date",dense:"",outlined:"",label:"Fecha",readonly:l.mode==="view"},null,8,["modelValue","readonly"])]),i("div",ho,[o(m,{modelValue:l.form.titulo,"onUpdate:modelValue":e[3]||(e[3]=s=>l.form.titulo=s),dense:"",outlined:"",label:"Título *",readonly:l.mode==="view",rules:[s=>!!s||"Requerido"]},null,8,["modelValue","readonly","rules"])]),i("div",bo,[o(m,{modelValue:l.form.duracion_min,"onUpdate:modelValue":e[4]||(e[4]=s=>l.form.duracion_min=s),modelModifiers:{number:!0},type:"number",dense:"",outlined:"",label:"Minutos",readonly:l.mode==="view"},null,8,["modelValue","readonly"])]),i("div",vo,[o(m,{modelValue:l.form.tipo,"onUpdate:modelValue":e[5]||(e[5]=s=>l.form.tipo=s),dense:"",outlined:"",label:"Tipo",readonly:l.mode==="view"},null,8,["modelValue","readonly"])]),i("div",yo,[o(m,{modelValue:l.form.lugar,"onUpdate:modelValue":e[6]||(e[6]=s=>l.form.lugar=s),dense:"",outlined:"",label:"Lugar",readonly:l.mode==="view"},null,8,["modelValue","readonly"])])]),l.mode!=="view"?(c(),V("div",Vo,[o(E,{modelValue:l.plantilla,"onUpdate:modelValue":[e[7]||(e[7]=s=>l.plantilla=s),n.applyTemplate],options:l.plantillasOptions,label:"Plantilla",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])])):y("",!0),i("div",null,[e[17]||(e[17]=i("div",{class:"text-caption text-grey-7 q-mb-xs"},"Contenido (WYSIWYG / se guarda HTML)",-1)),o(ce,{modelValue:l.form.contenido_html,"onUpdate:modelValue":e[8]||(e[8]=s=>l.form.contenido_html=s),readonly:l.mode==="view","min-height":"320px",placeholder:"Escriba aquí el contenido de la sesión...",toolbar:[["left","center","right","justify"],["bold","italic","strike","underline"],["quote","unordered","ordered","outdent","indent"],["hr","link"],["undo","redo"],["removeFormat"]]},null,8,["modelValue","readonly"])])]),_:1}),o(C),o(z,{align:"right"},{default:a(()=>[x(o(_,{flat:"",label:"Cerrar"},null,512),[[k]]),l.mode!=="view"&&n.canEdit?(c(),g(_,{key:0,color:"primary",label:"Guardar",loading:l.saving,onClick:n.save},null,8,["loading","onClick"])):y("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const xo=j(so,[["render",wo]]),ko={name:"InformesLegal",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:null}},data(){return{loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dialog:!1,mode:"create",form:{id:null,fecha:"",titulo:"",numero:"",contenido_html:""},plantilla:"informe_legal",plantillasOptions:[{label:"Informe Legal (SLIM)",value:"informe_legal"},{label:"Memorial (simple)",value:"memorial"},{label:"Oficio / Nota",value:"oficio"},{label:"Acta de Compromiso",value:"acta"},{label:"Denuncia penal — Ministerio Público",value:"denuncia_mp"}]}},computed:{role(){return this.$store.user?.role||""},canEdit(){return this.role==="Administrador"||this.role==="Abogado"}},watch:{caseId(){this.page=1,this.fetchRows()},search(){this.page=1,this.fetchRows()}},created(){this.fetchRows()},methods:{today(){const t=new Date,e=u=>String(u).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`},async fetchRows(){if(this.caseId){this.loading=!0;try{const t=await this.$axios.get(`/slims/${this.caseId}/informes-legales`,{params:{q:this.search,page:this.page,per_page:this.perPage}});this.rows=t.data||{data:[],last_page:1}}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"Error cargando informes"})}finally{this.loading=!1}}},openCreate(){this.canEdit&&(this.mode="create",this.form={id:null,fecha:this.today(),titulo:"",numero:"",contenido_html:""},this.dialog=!0,this.$nextTick(()=>this.applyTemplate(this.plantilla)))},openView(t){this.mode="view",this.form={...t},this.dialog=!0},openEdit(t){this.canEdit&&(this.mode="edit",this.form={...t},this.dialog=!0)},applyTemplate(t){if(this.mode==="view")return;const e=this.form.fecha||this.today(),u=e.slice(0,4),l=`
        <div style="text-align:center; margin-bottom:8px;">
          <div style="font-size:16px; font-weight:bold;">DIRECCIÓN DE IGUALDAD DE OPORTUNIDADES</div>
          <div style="font-size:12px;">Gobierno Autónomo Municipal de Oruro</div>
          <div style="font-size:12px; font-weight:bold;">${this.form.numero?`N° ${this.form.numero}`:""}</div>
          <hr/>
        </div>
      `;if(t==="memorial"){this.form.contenido_html=l+`
          <p><b>Señor(a) Juez/Fiscal</b></p>
          <p>De mi consideración:</p>
          <p style="text-align:justify">Por medio del presente, ...</p>
          <p>Oruro, ${e}</p>
        `;return}if(t==="oficio"){this.form.contenido_html=l+`
          <p><b>Ref.:</b> Solicitud de información</p>
          <p>De nuestra consideración:</p>
          <p style="text-align:justify">Solicitamos remitir la información ...</p>
          <p>Oruro, ${e}</p>
        `;return}if(t==="acta"){this.form.contenido_html=l+`
          <p style="text-align:center"><b>ACTA DE COMPROMISO</b></p>
          <p style="text-align:justify">En la ciudad de Oruro, a ${e}, las partes acuerdan ...</p>
        `;return}if(t==="denuncia_mp"){const s=(this.caso||{}).denunciante_nombre_completo||"";this.form.contenido_html=l+`
          <p style="text-align:center"><b>SEÑOR(A) REPRESENTANTE DEL MINISTERIO PÚBLICO — ORURO</b></p>
          <p><b>DENUNCIANTE:</b> ${s||"—"}</p>
          <p style="text-align:justify">Que, en mérito a los antecedentes ...</p>
          <p>Oruro, ${e}</p>
        `;return}this.form.contenido_html=l+`
        <p><b>Informe Legal ${u}</b></p>
        <p style="text-align:justify">En atención a los antecedentes, se emite el presente informe con el siguiente análisis jurídico:</p>
        <p><b>Fundamentos de derecho:</b></p>
        <ul>
          <li>Ley N° 348 y reglamentación.</li>
          <li>Constitución Política del Estado.</li>
          <li>Normativa municipal vigente.</li>
        </ul>
        <p><b>Recomendaciones:</b> …</p>
        <p>Oruro, ${e}</p>
      `},async save(){if(this.canEdit){if(!this.form.titulo)return this.$q.notify({type:"negative",message:"El título es obligatorio"});if(!this.form.contenido_html)return this.$q.notify({type:"negative",message:"El contenido está vacío"});this.saving=!0;try{this.form.id?await this.$axios.put(`/slims/informes-legales/${this.form.id}`,this.form):await this.$axios.post(`/slims/${this.caseId}/informes-legales`,this.form),this.$q.notify({type:"positive",message:"Guardado"}),this.dialog=!1,this.fetchRows()}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}}},removeIt(t){if(!this.canEdit)return;const e=async()=>{try{await this.$axios.delete(`/slims/informes-legales/${t.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.fetchRows()}catch(u){this.$q.notify({type:"negative",message:u?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar el informe?").onOk(e):confirm("¿Eliminar el informe?")&&e()},printPdf(t){const e=this.$axios?.defaults?.baseURL||"";window.open(`${e}/slims/informes-legales/${t.id}/pdf`,"_blank")}}},Co={class:"row items-center q-mb-sm"},qo={class:"col"},Uo={class:"text-caption text-grey-7"},Io={class:"col-auto row items-center q-gutter-sm"},Do={key:0},Eo={class:"row justify-end q-mt-sm"},So={class:"text-subtitle1"},jo={class:"row q-col-gutter-md"},Ro={class:"col-12 col-md-3"},Po={class:"col-12 col-md-7"},To={class:"col-12 col-md-2"},No={key:0};function Ao(t,e,u,h,l,n){return c(),g(w,{flat:"",bordered:"",class:"q-pa-md"},{default:a(()=>[i("div",Co,[i("div",qo,[e[8]||(e[8]=i("div",{class:"text-subtitle1 text-weight-medium"},"Informes legales",-1)),i("div",Uo,"Vinculados al caso #"+r(u.caseId),1)]),i("div",Io,[o(m,{dense:"",outlined:"",modelValue:l.search,"onUpdate:modelValue":e[0]||(e[0]=s=>l.search=s),placeholder:"Buscar...",style:{width:"260px"}},{append:a(()=>[o(b,{name:"search"})]),_:1},8,["modelValue"]),o(_,{flat:"",color:"primary",icon:"refresh",loading:l.loading,onClick:n.fetchRows},null,8,["loading","onClick"]),n.canEdit?(c(),g(_,{key:0,color:"green",icon:"add_circle_outline","no-caps":"",label:"Crear informe",onClick:n.openCreate},null,8,["onClick"])):y("",!0)])]),o(C),o(se,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:a(()=>[e[14]||(e[14]=i("thead",null,[i("tr",{class:"bg-primary text-white"},[i("th",{style:{width:"70px"}},"ID"),i("th",{style:{width:"140px"}},"Acciones"),i("th",null,"Título"),i("th",{style:{width:"120px"}},"Fecha"),i("th",{style:{width:"120px"}},"Nro"),i("th",{style:{width:"180px"}},"Usuario")])],-1)),i("tbody",null,[(c(!0),V(I,null,K(l.rows.data,s=>(c(),V("tr",{key:s.id},[i("td",null,"#"+r(s.id),1),i("td",null,[o(G,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:a(()=>[x((c(),g(q,{clickable:"",onClick:d=>n.openView(s)},{default:a(()=>[o(p,{avatar:""},{default:a(()=>[o(b,{name:"visibility"})]),_:1}),o(p,null,{default:a(()=>e[9]||(e[9]=[f("Ver")])),_:1})]),_:2},1032,["onClick"])),[[k]]),x((c(),g(q,{clickable:"",onClick:d=>n.printPdf(s)},{default:a(()=>[o(p,{avatar:""},{default:a(()=>[o(b,{name:"picture_as_pdf"})]),_:1}),o(p,null,{default:a(()=>e[10]||(e[10]=[f("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[k]]),n.canEdit?(c(),V(I,{key:0},[o(C),x((c(),g(q,{clickable:"",onClick:d=>n.openEdit(s)},{default:a(()=>[o(p,{avatar:""},{default:a(()=>[o(b,{name:"edit"})]),_:1}),o(p,null,{default:a(()=>e[11]||(e[11]=[f("Editar")])),_:1})]),_:2},1032,["onClick"])),[[k]]),x((c(),g(q,{clickable:"",onClick:d=>n.removeIt(s)},{default:a(()=>[o(p,{avatar:""},{default:a(()=>[o(b,{name:"delete",color:"negative"})]),_:1}),o(p,{class:"text-negative"},{default:a(()=>e[12]||(e[12]=[f("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[k]])],64)):y("",!0)]),_:2},1024)]),i("td",null,r(s.titulo),1),i("td",null,r(s.fecha||"s/f"),1),i("td",null,r(s.numero||"—"),1),i("td",null,r(s.user?.name||s.user?.username||"—"),1)]))),128)),!l.rows.data.length&&!l.loading?(c(),V("tr",Do,e[13]||(e[13]=[i("td",{colspan:"6",class:"text-center text-grey"},"Sin registros",-1)]))):y("",!0)])]),_:1}),i("div",Eo,[o($,{modelValue:l.page,"onUpdate:modelValue":[e[1]||(e[1]=s=>l.page=s),n.fetchRows],max:l.rows.last_page||1,"boundary-numbers":"","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])]),o(J,{modelValue:l.dialog,"onUpdate:modelValue":e[7]||(e[7]=s=>l.dialog=s),persistent:"",maximized:""},{default:a(()=>[o(w,null,{default:a(()=>[o(ve,{class:"bg-white text-dark"},{default:a(()=>[i("div",So,r(l.mode==="view"?"Ver informe":l.form.id?"Editar informe":"Nuevo informe"),1),o(X),x(o(_,{flat:"",dense:"",round:"",icon:"close"},null,512),[[k]])]),_:1}),o(C),o(v,{class:"q-gutter-md"},{default:a(()=>[i("div",jo,[i("div",Ro,[o(m,{modelValue:l.form.fecha,"onUpdate:modelValue":e[2]||(e[2]=s=>l.form.fecha=s),type:"date",dense:"",outlined:"",label:"Fecha",readonly:l.mode==="view"},null,8,["modelValue","readonly"])]),i("div",Po,[o(m,{modelValue:l.form.titulo,"onUpdate:modelValue":e[3]||(e[3]=s=>l.form.titulo=s),dense:"",outlined:"",label:"Título *",readonly:l.mode==="view",rules:[s=>!!s||"Requerido"]},null,8,["modelValue","readonly","rules"])]),i("div",To,[o(m,{modelValue:l.form.numero,"onUpdate:modelValue":e[4]||(e[4]=s=>l.form.numero=s),dense:"",outlined:"",label:"Nro",readonly:l.mode==="view"},null,8,["modelValue","readonly"])])]),l.mode!=="view"?(c(),V("div",No,[o(E,{modelValue:l.plantilla,"onUpdate:modelValue":[e[5]||(e[5]=s=>l.plantilla=s),n.applyTemplate],options:l.plantillasOptions,label:"Plantilla",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])])):y("",!0),i("div",null,[e[15]||(e[15]=i("div",{class:"text-caption text-grey-7 q-mb-xs"},"Contenido (WYSIWYG / guarda HTML)",-1)),o(ce,{modelValue:l.form.contenido_html,"onUpdate:modelValue":e[6]||(e[6]=s=>l.form.contenido_html=s),readonly:l.mode==="view","min-height":"320px",placeholder:"Escriba el informe legal...",toolbar:[["left","center","right","justify"],["bold","italic","strike","underline"],["quote","unordered","ordered","outdent","indent"],["hr","link"],["undo","redo"],["removeFormat"]]},null,8,["modelValue","readonly"])])]),_:1}),o(C),o(z,{align:"right"},{default:a(()=>[x(o(_,{flat:"",label:"Cerrar"},null,512),[[k]]),l.mode!=="view"&&n.canEdit?(c(),g(_,{key:0,color:"primary",label:"Guardar",loading:l.saving,onClick:n.save},null,8,["loading","onClick"])):y("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Lo=j(ko,[["render",Ao]]),Qo={name:"ApoyoIntegral",props:{caseId:{type:[String,Number],required:!0}}},Fo={class:"text-grey-7"};function Mo(t,e,u,h,l,n){return c(),g(w,{flat:"",bordered:"",class:"q-pa-md"},{default:a(()=>[e[0]||(e[0]=i("div",{class:"text-subtitle1 text-weight-medium q-mb-sm"},"Apoyo integral",-1)),i("div",Fo,"DIO personal, descripción, impresión (ID: "+r(u.caseId)+")",1)]),_:1})}const Oo=j(Qo,[["render",Mo]]),zo={name:"DocumentosGeneral",props:{caseId:{type:[String,Number],required:!0}},data(){return{loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dlgUpload:!1,file:null,meta:{titulo:"",categoria:"",descripcion:""},accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.odt,.ods,.txt,.zip,.jpg,.jpeg,.png,.webp",dlgEdit:!1,edit:{},editingId:null}},watch:{caseId(){this.page=1,this.fetchRows()},search(){this.page=1,this.fetchRows()}},created(){this.fetchRows()},methods:{async fetchRows(){if(this.caseId){this.loading=!0;try{const t=await this.$axios.get(`/slims/${this.caseId}/documentos`,{params:{q:this.search,page:this.page,per_page:this.perPage}});this.rows=t.data||{data:[],last_page:1}}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"Error cargando documentos"})}finally{this.loading=!1}}},openUpload(){this.file=null,this.meta={titulo:"",categoria:"",descripcion:""},this.dlgUpload=!0},async upload(){if(!this.file){this.$q.notify({type:"negative",message:"Seleccione un archivo"});return}this.saving=!0;try{const t=new FormData;t.append("file",this.file),this.meta.titulo&&t.append("titulo",this.meta.titulo),this.meta.categoria&&t.append("categoria",this.meta.categoria),this.meta.descripcion&&t.append("descripcion",this.meta.descripcion),await this.$axios.post(`/slims/${this.caseId}/documentos`,t,{headers:{"Content-Type":"multipart/form-data"}}),this.$q.notify({type:"positive",message:"Archivo subido"}),this.dlgUpload=!1,this.fetchRows()}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"No se pudo subir"})}finally{this.saving=!1}},viewDoc(t){const e=this.$axios?.defaults?.baseURL||"";window.open(`${e}/slims/documentos/${t.id}/view`,"_blank")},downloadDoc(t){const e=this.$axios?.defaults?.baseURL||"";window.open(`${e}/slims/documentos/${t.id}/download`,"_blank")},editMeta(t){this.editingId=t.id,this.edit={titulo:t.titulo,categoria:t.categoria,descripcion:t.descripcion},this.dlgEdit=!0},async saveMeta(){this.saving=!0;try{await this.$axios.put(`/slims/documentos/${this.editingId}`,this.edit),this.$q.notify({type:"positive",message:"Actualizado"}),this.dlgEdit=!1,this.fetchRows()}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"No se pudo actualizar"})}finally{this.saving=!1}},removeDoc(t){const e=async()=>{try{await this.$axios.delete(`/slims/documentos/${t.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.fetchRows()}catch(u){this.$q.notify({type:"negative",message:u?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar el documento?").onOk(e):confirm("¿Eliminar el documento?")&&e()}}},Go={class:"row items-center q-mb-sm"},Bo={class:"col"},Ho={class:"text-caption text-grey-7"},Wo={class:"col-auto row items-center q-gutter-sm"},Yo={class:"text-weight-medium"},Zo={key:0},Jo={class:"row justify-end q-mt-sm"};function Xo(t,e,u,h,l,n){return c(),g(w,{flat:"",bordered:"",class:"q-pa-md"},{default:a(()=>[i("div",Go,[i("div",Bo,[e[11]||(e[11]=i("div",{class:"text-subtitle1 text-weight-medium"},"Documentos (General)",-1)),i("div",Ho,"Gestión de adjuntos del caso #"+r(u.caseId),1)]),i("div",Wo,[o(m,{dense:"",outlined:"",modelValue:l.search,"onUpdate:modelValue":e[0]||(e[0]=s=>l.search=s),placeholder:"Buscar...",style:{width:"260px"}},{append:a(()=>[o(b,{name:"search"})]),_:1},8,["modelValue"]),o(_,{flat:"",color:"primary",icon:"refresh",loading:l.loading,onClick:n.fetchRows},null,8,["loading","onClick"]),o(_,{color:"green",icon:"upload","no-caps":"",label:"Subir archivo",onClick:n.openUpload},null,8,["onClick"])])]),o(C),o(se,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:a(()=>[e[17]||(e[17]=i("thead",null,[i("tr",{class:"bg-primary text-white"},[i("th",{style:{width:"70px"}},"ID"),i("th",{style:{width:"160px"}},"Acciones"),i("th",null,"Título"),i("th",{style:{width:"130px"}},"Categoría"),i("th",{style:{width:"120px"}},"Tamaño"),i("th",{style:{width:"160px"}},"Tipo"),i("th",{style:{width:"180px"}},"Usuario")])],-1)),i("tbody",null,[(c(!0),V(I,null,K(l.rows.data,s=>(c(),V("tr",{key:s.id},[i("td",null,"#"+r(s.id),1),i("td",null,[o(G,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:a(()=>[x((c(),g(q,{clickable:"",onClick:d=>n.viewDoc(s)},{default:a(()=>[o(p,{avatar:""},{default:a(()=>[o(b,{name:"visibility"})]),_:1}),o(p,null,{default:a(()=>e[12]||(e[12]=[f("Ver")])),_:1})]),_:2},1032,["onClick"])),[[k]]),x((c(),g(q,{clickable:"",onClick:d=>n.downloadDoc(s)},{default:a(()=>[o(p,{avatar:""},{default:a(()=>[o(b,{name:"download"})]),_:1}),o(p,null,{default:a(()=>e[13]||(e[13]=[f("Descargar")])),_:1})]),_:2},1032,["onClick"])),[[k]]),o(C),x((c(),g(q,{clickable:"",onClick:d=>n.editMeta(s)},{default:a(()=>[o(p,{avatar:""},{default:a(()=>[o(b,{name:"edit"})]),_:1}),o(p,null,{default:a(()=>e[14]||(e[14]=[f("Editar")])),_:1})]),_:2},1032,["onClick"])),[[k]]),x((c(),g(q,{clickable:"",onClick:d=>n.removeDoc(s)},{default:a(()=>[o(p,{avatar:""},{default:a(()=>[o(b,{name:"delete",color:"negative"})]),_:1}),o(p,{class:"text-negative"},{default:a(()=>e[15]||(e[15]=[f("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[k]])]),_:2},1024)]),i("td",Yo,r(s.titulo),1),i("td",null,r(s.categoria||"—"),1),i("td",null,r(s.size_human),1),i("td",null,r(s.mime||s.extension),1),i("td",null,r(s.user?.name||s.user?.username||"—"),1)]))),128)),!l.rows.data.length&&!l.loading?(c(),V("tr",Zo,e[16]||(e[16]=[i("td",{colspan:"7",class:"text-center text-grey"},"Sin registros",-1)]))):y("",!0)])]),_:1}),i("div",Jo,[o($,{modelValue:l.page,"onUpdate:modelValue":[e[1]||(e[1]=s=>l.page=s),n.fetchRows],max:l.rows.last_page||1,"boundary-numbers":"","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])]),o(J,{modelValue:l.dlgUpload,"onUpdate:modelValue":e[6]||(e[6]=s=>l.dlgUpload=s),persistent:""},{default:a(()=>[o(w,{style:{"max-width":"700px",width:"95vw"}},{default:a(()=>[o(v,{class:"row items-center q-pb-none"},{default:a(()=>[e[18]||(e[18]=i("div",{class:"text-subtitle1"},"Subir archivo",-1)),o(X),x(o(_,{flat:"",dense:"",round:"",icon:"close"},null,512),[[k]])]),_:1}),o(v,{class:"q-gutter-md"},{default:a(()=>[o(m,{modelValue:l.meta.titulo,"onUpdate:modelValue":e[2]||(e[2]=s=>l.meta.titulo=s),label:"Título",outlined:"",dense:""},null,8,["modelValue"]),o(m,{modelValue:l.meta.categoria,"onUpdate:modelValue":e[3]||(e[3]=s=>l.meta.categoria=s),label:"Categoría",outlined:"",dense:""},null,8,["modelValue"]),o(m,{modelValue:l.meta.descripcion,"onUpdate:modelValue":e[4]||(e[4]=s=>l.meta.descripcion=s),type:"textarea",label:"Descripción",outlined:"",dense:"",autogrow:""},null,8,["modelValue"]),o(ye,{modelValue:l.file,"onUpdate:modelValue":e[5]||(e[5]=s=>l.file=s),outlined:"",dense:"","use-chips":"",clearable:!0,accept:l.accept,hint:"Hasta 20MB. PDF, Word, Excel, imágenes, etc."},null,8,["modelValue","accept"])]),_:1}),o(z,{align:"right"},{default:a(()=>[x(o(_,{flat:"",label:"Cancelar"},null,512),[[k]]),o(_,{color:"primary",label:"Subir",loading:l.saving,onClick:n.upload},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(J,{modelValue:l.dlgEdit,"onUpdate:modelValue":e[10]||(e[10]=s=>l.dlgEdit=s)},{default:a(()=>[o(w,{style:{"max-width":"600px",width:"95vw"}},{default:a(()=>[o(v,{class:"row items-center q-pb-none"},{default:a(()=>[e[19]||(e[19]=i("div",{class:"text-subtitle1"},"Editar metadatos",-1)),o(X),x(o(_,{flat:"",dense:"",round:"",icon:"close"},null,512),[[k]])]),_:1}),o(v,{class:"q-gutter-md"},{default:a(()=>[o(m,{modelValue:l.edit.titulo,"onUpdate:modelValue":e[7]||(e[7]=s=>l.edit.titulo=s),label:"Título",outlined:"",dense:""},null,8,["modelValue"]),o(m,{modelValue:l.edit.categoria,"onUpdate:modelValue":e[8]||(e[8]=s=>l.edit.categoria=s),label:"Categoría",outlined:"",dense:""},null,8,["modelValue"]),o(m,{modelValue:l.edit.descripcion,"onUpdate:modelValue":e[9]||(e[9]=s=>l.edit.descripcion=s),type:"textarea",label:"Descripción",outlined:"",dense:"",autogrow:""},null,8,["modelValue"])]),_:1}),o(z,{align:"right"},{default:a(()=>[x(o(_,{flat:"",label:"Cancelar"},null,512),[[k]]),o(_,{color:"primary",label:"Guardar",loading:l.saving,onClick:n.saveMeta},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Ko=j(zo,[["render",Xo]]),$o={name:"Fotografias",props:{caseId:{type:[String,Number],required:!0}},data(){return{rows:{data:[],last_page:1},page:1,perPage:12,loading:!1,uploading:!1}},created(){this.fetchRows()},methods:{toPublicUrl(t){return console.log("url",t),t?/^https?:\/\//i.test(t)?t:`${(this.$axios?.defaults?.baseURL||"").replace(/\/api\/?$/,"")}${t}`:""},async fetchRows(){this.loading=!0;try{const t=await this.$axios.get(`/slims/${this.caseId}/fotografias`,{params:{page:this.page,per_page:this.perPage}});this.rows=t.data||{data:[],last_page:1}}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"Error cargando fotos"})}finally{this.loading=!1}},pickFile(){this.$refs.file.click()},async upload(t){const e=t.target.files?.[0];if(e){this.uploading=!0;try{const u=new FormData;u.append("file",e),await this.$axios.post(`/slims/${this.caseId}/fotografias`,u,{headers:{"Content-Type":"multipart/form-data"}}),this.$q.notify({type:"positive",message:"Foto subida"}),this.fetchRows()}catch(u){this.$q.notify({type:"negative",message:u?.response?.data?.message||"No se pudo subir"})}finally{this.uploading=!1,this.$refs.file&&(this.$refs.file.value="")}}},async remove(t){if(confirm("¿Eliminar foto?"))try{await this.$axios.delete(`/slims/fotografias/${t.id}`),this.$q.notify({type:"positive",message:"Eliminada"}),this.fetchRows()}catch(e){this.$q.notify({type:"negative",message:e?.response?.data?.message||"No se pudo eliminar"})}},view(t){t&&window.open(t,"_blank")}}},ei={class:"row items-center q-mb-sm"},li={class:"col"},oi={class:"text-caption text-grey-7"},ii={class:"col-auto"},ti={class:"row q-col-gutter-md q-mt-sm"},si={class:"absolute-bottom text-subtitle2 bg-black bg-opacity-40 q-pa-xs ellipsis"};function ai(t,e,u,h,l,n){return c(),g(w,{flat:"",bordered:"",class:"q-pa-md"},{default:a(()=>[i("div",ei,[i("div",li,[e[2]||(e[2]=i("div",{class:"text-subtitle1 text-weight-medium"},"Fotografías",-1)),i("div",oi,"Sube/ver fotos del caso #"+r(u.caseId),1)]),i("div",ii,[o(_,{color:"primary",icon:"add_photo_alternate","no-caps":"",label:"Subir",onClick:n.pickFile,loading:l.uploading},null,8,["onClick","loading"]),i("input",{type:"file",ref:"file",accept:"image/*",class:"hidden",onChange:e[0]||(e[0]=(...s)=>n.upload&&n.upload(...s))},null,544)])]),o(C),i("div",ti,[(c(!0),V(I,null,K(l.rows.data,s=>(c(),V("div",{key:s.id,class:"col-6 col-sm-4 col-md-3"},[o(w,{flat:"",bordered:""},{default:a(()=>[o(Ce,{src:n.toPublicUrl(s.thumb_url||s.url),ratio:4/3,onClick:d=>n.view(n.toPublicUrl(s.url)),style:{cursor:"pointer"}},{default:a(()=>[i("div",si,r(s.titulo),1)]),_:2},1032,["src","onClick"]),o(z,{align:"between"},{default:a(()=>[o(_,{dense:"",flat:"",icon:"delete",color:"negative",onClick:d=>n.remove(s)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))]),o($,{modelValue:l.page,"onUpdate:modelValue":[e[1]||(e[1]=s=>l.page=s),n.fetchRows],max:l.rows.last_page||1,class:"q-mt-md flex justify-end"},null,8,["modelValue","max","onUpdate:modelValue"])]),_:1})}const ni=j($o,[["render",ai]]),O=de({name:"QTimelineEntry",props:{heading:Boolean,tag:{type:String,default:"h3"},side:{type:String,default:"right",validator:t=>["left","right"].includes(t)},icon:String,avatar:String,color:String,title:String,subtitle:String,body:String},setup(t,{slots:e}){const u=fe(re,oe);if(u===oe)return console.error("QTimelineEntry needs to be child of QTimeline"),oe;const h=Z(()=>`q-timeline__entry q-timeline__entry--${t.side}`+(t.icon!==void 0||t.avatar!==void 0?" q-timeline__entry--icon":"")),l=Z(()=>`q-timeline__dot text-${t.color||u.color}`),n=Z(()=>u.layout==="comfortable"&&u.side==="left");return()=>{const s=ge(e.default,[]);if(t.body!==void 0&&s.unshift(t.body),t.heading===!0){const A=[U("div"),U("div"),U(t.tag,{class:"q-timeline__heading-title"},s)];return U("div",{class:"q-timeline__heading"},n.value===!0?A.reverse():A)}let d;t.icon!==void 0?d=[U(b,{class:"row items-center justify-center",name:t.icon})]:t.avatar!==void 0&&(d=[U("img",{class:"q-timeline__dot-img",src:t.avatar})]);const N=[U("div",{class:"q-timeline__subtitle"},[U("span",{},ie(e.subtitle,[t.subtitle]))]),U("div",{class:l.value},d),U("div",{class:"q-timeline__content"},[U("h6",{class:"q-timeline__title"},ie(e.title,[t.title]))].concat(s))];return U("li",{class:h.value},n.value===!0?N.reverse():N)}}}),di=de({name:"QTimeline",props:{...pe,color:{type:String,default:"primary"},side:{type:String,default:"right",validator:t=>["left","right"].includes(t)},layout:{type:String,default:"dense",validator:t=>["dense","comfortable","loose"].includes(t)}},setup(t,{slots:e}){const u=he(),h=_e(t,u.proxy.$q);be(re,t);const l=Z(()=>`q-timeline q-timeline--${t.layout} q-timeline--${t.layout}--${t.side}`+(h.value===!0?" q-timeline--dark":""));return()=>U("ul",{class:l.value},ie(e.default))}}),ri={name:"HojaRuta",props:{caseId:{type:[String,Number],required:!0}},data(){return{loading:!1,editing:!1,backup:null,form:{caso_numero:"",fecha_apertura_caso:"",fecha_derivacion_psicologica:"",fecha_informe_area_psicologica:"",fecha_informe_trabajo_social:"",fecha_derivacion_area_legal:""}}},computed:{canEdit(){const t=this.$store.user?.role||"";return t==="Administrador"||t==="Asistente"},isReadOnly(){return!this.editing||!this.canEdit},total(){return 5},done(){return["fecha_apertura_caso","fecha_derivacion_psicologica","fecha_informe_area_psicologica","fecha_informe_trabajo_social","fecha_derivacion_area_legal"].filter(e=>!!this.form[e]).length}},created(){this.fetch()},methods:{format(t){return t||"—"},async fetch(){this.loading=!0;try{const{data:t}=await this.$axios.get(`/slims/${this.caseId}`);this.form={caso_numero:t.caso_numero||"",fecha_apertura_caso:t.fecha_apertura_caso||"",fecha_derivacion_psicologica:t.fecha_derivacion_psicologica||"",fecha_informe_area_psicologica:t.fecha_informe_area_psicologica||"",fecha_informe_trabajo_social:t.fecha_informe_trabajo_social||"",fecha_derivacion_area_legal:t.fecha_derivacion_area_legal||""},this.backup={...this.form}}catch(t){this.$alert?.error(t?.response?.data?.message||"No se pudo cargar la hoja de ruta")}finally{this.loading=!1}},startEdit(){this.canEdit&&(this.editing=!0,this.backup={...this.form})},cancelEdit(){this.form={...this.backup},this.editing=!1,this.$q.notify({type:"info",message:"Cambios descartados"})},async save(){if(!this.canEdit)return;const t={fecha_derivacion_psicologica:this.form.fecha_derivacion_psicologica||null,fecha_informe_area_psicologica:this.form.fecha_informe_area_psicologica||null,fecha_informe_trabajo_social:this.form.fecha_informe_trabajo_social||null,fecha_derivacion_area_legal:this.form.fecha_derivacion_area_legal||null};this.loading=!0;try{const{data:e}=await this.$axios.put(`/slims/${this.caseId}`,t);this.form={...this.form,fecha_derivacion_psicologica:e.data?.fecha_derivacion_psicologica??this.form.fecha_derivacion_psicologica,fecha_informe_area_psicologica:e.data?.fecha_informe_area_psicologica??this.form.fecha_informe_area_psicologica,fecha_informe_trabajo_social:e.data?.fecha_informe_trabajo_social??this.form.fecha_informe_trabajo_social,fecha_derivacion_area_legal:e.data?.fecha_derivacion_area_legal??this.form.fecha_derivacion_area_legal},this.backup={...this.form},this.editing=!1,this.$alert?.success("Hoja de ruta actualizada")}catch(e){this.$alert?.error(e?.response?.data?.message||"No se pudo actualizar")}finally{this.loading=!1}}}},ci={class:"row items-center q-mb-sm"},ui={class:"col"},mi={class:"text-caption text-grey-7"},fi={class:"col-auto row items-center q-gutter-sm"},gi={class:"row q-col-gutter-md"},pi={class:"col-12 col-md-3"},_i={class:"col-12 col-md-3"},hi={class:"col-12 col-md-3"},bi={class:"col-12 col-md-3"},vi={class:"col-12 col-md-3"},yi={class:"col-12 col-md-3"};function Vi(t,e,u,h,l,n){return c(),V("div",null,[i("div",ci,[i("div",ui,[e[6]||(e[6]=i("div",{class:"text-subtitle1 text-weight-medium"},"Hoja de ruta",-1)),i("div",mi," Completa las fechas clave del caso ("+r(n.done)+"/"+r(n.total)+" completadas) ",1)]),i("div",fi,[n.canEdit?y("",!0):(c(),g(te,{key:0,dense:"",color:"grey-3","text-color":"grey-9",icon:"visibility_off"},{default:a(()=>e[7]||(e[7]=[f(" Solo lectura ")])),_:1})),o(_,{flat:"",color:"secondary",icon:"refresh",loading:l.loading,onClick:n.fetch},null,8,["loading","onClick"]),n.canEdit?(c(),V(I,{key:1},[l.editing?(c(),V(I,{key:1},[o(_,{flat:"",color:"negative",icon:"close",label:"Cancelar",onClick:n.cancelEdit,loading:l.loading},null,8,["onClick","loading"]),o(_,{color:"primary",icon:"save",label:"Guardar",onClick:n.save,loading:l.loading},null,8,["onClick","loading"])],64)):(c(),g(_,{key:0,color:"primary",icon:"edit",label:"Editar",onClick:n.startEdit,loading:l.loading},null,8,["onClick","loading"]))],64)):y("",!0)])]),o(w,{flat:"",bordered:"",class:"section-card"},{default:a(()=>[o(v,null,{default:a(()=>[i("div",gi,[i("div",pi,[o(m,{modelValue:l.form.caso_numero,"onUpdate:modelValue":e[0]||(e[0]=s=>l.form.caso_numero=s),label:"Código de caso",dense:"",outlined:"",readonly:""},null,8,["modelValue"])]),i("div",_i,[o(m,{modelValue:l.form.fecha_apertura_caso,"onUpdate:modelValue":e[1]||(e[1]=s=>l.form.fecha_apertura_caso=s),type:"date",label:"Fecha de apertura del caso",dense:"",outlined:"",readonly:""},null,8,["modelValue"])]),i("div",hi,[o(m,{modelValue:l.form.fecha_derivacion_psicologica,"onUpdate:modelValue":e[2]||(e[2]=s=>l.form.fecha_derivacion_psicologica=s),type:"date",readonly:n.isReadOnly,dense:"",outlined:"",label:"Fecha de derivación psicológica"},null,8,["modelValue","readonly"])]),i("div",bi,[o(m,{modelValue:l.form.fecha_informe_area_psicologica,"onUpdate:modelValue":e[3]||(e[3]=s=>l.form.fecha_informe_area_psicologica=s),type:"date",readonly:n.isReadOnly,dense:"",outlined:"",label:"Fecha de entrega informe (Área psicológica)"},null,8,["modelValue","readonly"])]),i("div",vi,[o(m,{modelValue:l.form.fecha_informe_trabajo_social,"onUpdate:modelValue":e[4]||(e[4]=s=>l.form.fecha_informe_trabajo_social=s),type:"date",readonly:n.isReadOnly,dense:"",outlined:"",label:"Fecha de entrega (Trabajo social)"},null,8,["modelValue","readonly"])]),i("div",yi,[o(m,{modelValue:l.form.fecha_derivacion_area_legal,"onUpdate:modelValue":e[5]||(e[5]=s=>l.form.fecha_derivacion_area_legal=s),type:"date",readonly:n.isReadOnly,dense:"",outlined:"",label:"Fecha de derivación (Área legal)"},null,8,["modelValue","readonly"])])])]),_:1}),o(C),o(v,null,{default:a(()=>[o(di,{color:"primary",layout:"comfortable",side:"right"},{default:a(()=>[o(O,{title:"Apertura del caso",subtitle:n.format(l.form.fecha_apertura_caso),icon:"flag"},null,8,["subtitle"]),o(O,{title:"Derivación psicológica",subtitle:n.format(l.form.fecha_derivacion_psicologica),icon:"psychology",color:l.form.fecha_derivacion_psicologica?"primary":"grey-5"},null,8,["subtitle","color"]),o(O,{title:"Informe área psicológica",subtitle:n.format(l.form.fecha_informe_area_psicologica),icon:"assignment_turned_in",color:l.form.fecha_informe_area_psicologica?"primary":"grey-5"},null,8,["subtitle","color"]),o(O,{title:"Entrega trabajo social",subtitle:n.format(l.form.fecha_informe_trabajo_social),icon:"diversity_3",color:l.form.fecha_informe_trabajo_social?"primary":"grey-5"},null,8,["subtitle","color"]),o(O,{title:"Derivación área legal",subtitle:n.format(l.form.fecha_derivacion_area_legal),icon:"gavel",color:l.form.fecha_derivacion_area_legal?"primary":"grey-5"},null,8,["subtitle","color"])]),_:1})]),_:1})]),_:1})])}const wi=j(ri,[["render",Vi],["__scopeId","data-v-f9e50bfe"]]),xi={name:"Seguimiento",props:{caseId:{type:[String,Number],required:!0}},data(){return{loading:!1,header:{},rows:[],filters:{q:"",tipo:"Todos",modulo:"Todos",desde:"",hasta:""},tipos:["Todos","Informe","Sesión","Documento","Fotografía"],modulos:["Todos","General","Psicológico","Legal","Social","Documentos","Multimedia"],columns:[{name:"actividad",label:"Actividad",field:"actividad",align:"left",sortable:!1},{name:"fecha",label:"Fecha / Usuario",field:"fecha",align:"left",sortable:!0},{name:"modulo",label:"Módulo",field:"modulo",align:"left",sortable:!0},{name:"acciones",label:"",field:"acciones",align:"right",sortable:!1,style:"width: 140px"}]}},computed:{rowsFiltered(){let t=this.rows.slice();if(this.filters.q){const e=this.filters.q.toLowerCase();t=t.filter(u=>(u.titulo||"").toLowerCase().includes(e)||(u.descripcion||"").toLowerCase().includes(e)||(u.usuario||"").toLowerCase().includes(e))}return this.filters.tipo&&this.filters.tipo!=="Todos"&&(t=t.filter(e=>e.tipo===this.filters.tipo)),this.filters.modulo&&this.filters.modulo!=="Todos"&&(t=t.filter(e=>(e.modulo||"").toLowerCase()===this.filters.modulo.toLowerCase())),this.filters.desde&&(t=t.filter(e=>(e.fecha||"0000-00-00")>=this.filters.desde)),this.filters.hasta&&(t=t.filter(e=>(e.fecha||"9999-12-31")<=this.filters.hasta)),t}},mounted(){this.fetch()},methods:{async fetch(){this.loading=!0;try{const{data:t}=await this.$axios.get(`/slims/${this.caseId}/seguimiento`);this.header=t.header||{},this.rows=t.items||[]}catch(t){this.$alert?.error?.(t?.response?.data?.message||"No se pudo cargar el seguimiento")}finally{this.loading=!1}},toPublicUrl(t){return t?/^https?:\/\//i.test(t)?t:`${(this.$axios?.defaults?.baseURL||"").replace(/\/api\/?$/,"")}${t}`:""},open(t){const e=this.toPublicUrl(t);e&&window.open(e,"_blank")}}},ki={class:"row items-start q-col-gutter-sm"},Ci={class:"col-12 col-md-8"},qi={class:"text-caption text-grey-7"},Ui={class:"col-12 col-md-4 flex items-center justify-end"},Ii={class:"row q-col-gutter-sm"},Di={class:"col-12 col-md-3"},Ei={class:"val"},Si={class:"col-12 col-md-3"},ji={class:"val"},Ri={class:"col-12 col-md-3"},Pi={class:"val"},Ti={class:"col-12 col-md-3"},Ni={class:"val ellipsis"},Ai={class:"col-12 col-md-3"},Li={class:"val"},Qi={class:"col-12 col-md-3"},Fi={class:"val"},Mi={class:"col-12 col-md-3"},Oi={class:"val"},zi={class:"col-12 col-md-3"},Gi={class:"val"},Bi={class:"row items-center q-col-gutter-sm"},Hi={class:"col-12 col-md-4"},Wi={class:"col-6 col-md-2"},Yi={class:"col-6 col-md-2"},Zi={class:"col-6 col-md-2"},Ji={class:"col-6 col-md-2"},Xi={class:"row no-wrap items-center q-gutter-xs"},Ki={class:"text-weight-medium"},$i={class:"text-caption text-grey-7 ellipsis-2-lines",style:{"max-width":"520px"}},et={class:"text-weight-medium"},lt={class:"text-caption text-grey-7"};function ot(t,e,u,h,l,n){return c(),V("div",null,[o(w,{flat:"",bordered:"",class:"q-pa-sm q-mb-md"},{default:a(()=>[i("div",ki,[i("div",Ci,[e[7]||(e[7]=i("div",{class:"text-subtitle1 text-weight-bold"},"Seguimiento del Caso",-1)),i("div",qi,[e[5]||(e[5]=f(" SLIM ")),i("b",null,"#"+r(l.header.slim_id||l.header.caso_id),1),e[6]||(e[6]=f(" · N° ")),i("b",null,r(l.header.caso_numero||"—"),1)])]),i("div",Ui,[o(te,{dense:"",color:"indigo-1","text-color":"indigo-9",class:"q-mr-xs"},{default:a(()=>[f(r(l.header.fecha_registro||"—"),1)]),_:1}),o(_,{flat:"",color:"primary",icon:"refresh",onClick:n.fetch,loading:l.loading,title:"Actualizar",label:l.loading?"":"Actualizar","no-caps":"",dense:""},null,8,["onClick","loading","label"])])]),o(C,{class:"q-my-sm"}),i("div",Ii,[i("div",Di,[e[8]||(e[8]=i("div",{class:"lbl"},"Tipología",-1)),i("div",Ei,r(l.header.tipologia||"—"),1)]),i("div",Si,[e[9]||(e[9]=i("div",{class:"lbl"},"Modalidad",-1)),i("div",ji,r(l.header.modalidad||"—"),1)]),i("div",Ri,[e[10]||(e[10]=i("div",{class:"lbl"},"Zona",-1)),i("div",Pi,r(l.header.zona||"—"),1)]),i("div",Ti,[e[11]||(e[11]=i("div",{class:"lbl"},"Dirección",-1)),i("div",Ni,r(l.header.direccion||"—"),1)]),i("div",Ai,[e[12]||(e[12]=i("div",{class:"lbl"},"Denunciante",-1)),i("div",Li,r(l.header.denunciante||"—"),1)]),i("div",Qi,[e[13]||(e[13]=i("div",{class:"lbl"},"Denunciado",-1)),i("div",Fi,r(l.header.denunciado||"—"),1)]),i("div",Mi,[e[14]||(e[14]=i("div",{class:"lbl"},"Fecha del hecho",-1)),i("div",Oi,r(l.header.fecha_hecho||"—"),1)]),i("div",zi,[e[15]||(e[15]=i("div",{class:"lbl"},"Registrado por",-1)),i("div",Gi,r(l.header.registrado_por||"—"),1)])])]),_:1}),o(w,{flat:"",bordered:"",class:"q-pa-sm q-mb-sm"},{default:a(()=>[i("div",Bi,[i("div",Hi,[o(m,{modelValue:l.filters.q,"onUpdate:modelValue":e[0]||(e[0]=s=>l.filters.q=s),dense:"",outlined:"",placeholder:"Buscar (título, descripción, usuario)"},{append:a(()=>[o(b,{name:"search"})]),_:1},8,["modelValue"])]),i("div",Wi,[o(E,{modelValue:l.filters.tipo,"onUpdate:modelValue":e[1]||(e[1]=s=>l.filters.tipo=s),options:l.tipos,dense:"",outlined:"",label:"Tipo"},null,8,["modelValue","options"])]),i("div",Yi,[o(E,{modelValue:l.filters.modulo,"onUpdate:modelValue":e[2]||(e[2]=s=>l.filters.modulo=s),options:l.modulos,dense:"",outlined:"",label:"Módulo"},null,8,["modelValue","options"])]),i("div",Zi,[o(m,{modelValue:l.filters.desde,"onUpdate:modelValue":e[3]||(e[3]=s=>l.filters.desde=s),type:"date",dense:"",outlined:"",label:"Desde"},null,8,["modelValue"])]),i("div",Ji,[o(m,{modelValue:l.filters.hasta,"onUpdate:modelValue":e[4]||(e[4]=s=>l.filters.hasta=s),type:"date",dense:"",outlined:"",label:"Hasta"},null,8,["modelValue"])])])]),_:1}),o(qe,{flat:"",bordered:"",rows:n.rowsFiltered,columns:l.columns,"row-key":"uid",loading:l.loading,"hide-bottom":"","rows-per-page-options":[0],class:"rounded-borders"},{"body-cell-actividad":a(s=>[o(Y,{props:s},{default:a(()=>[i("div",Xi,[o(b,{name:s.row.icon||"feed",size:"18px",class:"text-primary"},null,8,["name"]),i("div",null,[i("div",Ki,[f(r(s.row.tipo)+" ",1),e[16]||(e[16]=i("span",{class:"text-grey-7"},"·",-1)),f(" "+r(s.row.titulo||"—"),1)]),i("div",$i,r(s.row.descripcion||"—"),1)])])]),_:2},1032,["props"])]),"body-cell-fecha":a(s=>[o(Y,{props:s},{default:a(()=>[i("div",et,r(s.row.fecha||"—"),1),i("div",lt,r(s.row.usuario||"—"),1)]),_:2},1032,["props"])]),"body-cell-modulo":a(s=>[o(Y,{props:s},{default:a(()=>[o(te,{dense:"",square:""},{default:a(()=>[f(r(s.row.modulo||"—"),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-acciones":a(s=>[o(Y,{props:s,class:"q-gutter-xs"},{default:a(()=>[s.row.links?.pdf?(c(),g(_,{key:0,dense:"",flat:"",icon:"picture_as_pdf",onClick:d=>n.open(s.row.links.pdf),title:"Ver PDF"},null,8,["onClick"])):y("",!0),s.row.links?.view?(c(),g(_,{key:1,dense:"",flat:"",icon:"visibility",onClick:d=>n.open(s.row.links.view),title:"Ver"},null,8,["onClick"])):y("",!0),s.row.links?.download?(c(),g(_,{key:2,dense:"",flat:"",icon:"download",onClick:d=>n.open(s.row.links.download),title:"Descargar"},null,8,["onClick"])):y("",!0),s.row.links?.open?(c(),g(_,{key:3,dense:"",flat:"",icon:"open_in_new",onClick:d=>n.open(s.row.links.open),title:"Abrir"},null,8,["onClick"])):y("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])])}const it=j(xi,[["render",ot],["__scopeId","data-v-7340763d"]]),tt={name:"SlimDetalle",components:{InfoGeneral:to,SesionesPsicologico:xo,InformesLegal:Lo,ApoyoIntegral:Oo,DocumentosGeneral:Ko,Fotografias:ni,HojaRuta:wi,Seguimiento:it},data(){return{loading:!1,tab:"info",slim:null,defaultCountryCallingCode:"591"}},computed:{caseId(){return this.$route.params.id},role(){return this.$store.user?.role||""},hasAnyWa(){const t=this.slim||{};return!!(t?.psicologica_user?.celular||t?.legal_user?.celular||t?.trabajo_social_user?.celular)}},created(){this.fetchSlim()},methods:{normalizePhone(t){if(!t)return"";let e=String(t).replace(/\D+/g,"");return/^(\d{11,13})$/.test(e)?e:e.length===8?this.defaultCountryCallingCode+e:e.length===9&&!e.startsWith(this.defaultCountryCallingCode)?this.defaultCountryCallingCode+e:e},waUrl(t,e){const u=this.normalizePhone(t),h=encodeURIComponent(e||"");return`https://wa.me/${u}${h?`?text=${h}`:""}`},waMessage(t){const e=this.slim||{},u=e.caso_numero?e.caso_numero.replace(/\\\//g,"/"):`#${this.caseId}`,h=(this.$axios?.defaults?.baseURL||"")+`/slims/${this.caseId}`,l=t==="psico"?"Psicología":t==="legal"?"Legal":"Trabajo Social";return["*SLIM - Notificación de Caso*",`Nro: ${u}`,`Área: ${l}`,`Denunciante: ${e.denunciante_nombre_completo||"—"}`,e.caso_tipologia?`Tipología: ${e.caso_tipologia}`:null,e.caso_modalidad?`Modalidad: ${e.caso_modalidad}`:null,e.caso_fecha_hecho?`Fecha del hecho: ${e.caso_fecha_hecho}`:null,"",`Ver SLIM: ${h}`].filter(Boolean).join(`
`)},sendWhatsApp(t){const e=this.slim||{},u=t==="psico"?e.psicologica_user:t==="legal"?e.legal_user:t==="social"?e.trabajo_social_user:null;if(!u?.celular){this.$q.notify({type:"warning",message:"No hay número de celular configurado para ese responsable"});return}const h=this.waUrl(u.celular,this.waMessage(t));window.open(h,"_blank")},async fetchSlim(){this.loading=!0;try{const t=await this.$axios.get(`/slims/${this.caseId}`);this.slim=t.data}catch(t){this.$alert.error(t?.response?.data?.message||"No se pudo cargar el SLIM")}finally{this.loading=!1}},printPdf(){const t=this.$axios.defaults.baseURL+`/slims/${this.caseId}/pdf`;window.open(t,"_blank")},printPdfHojaRuta(t="denunciante"){const e=this.$axios.defaults.baseURL+`/slims/${this.caseId}/pdf/hoja-ruta?tipo=${t}`;window.open(e,"_blank")}}},st={class:"row items-center q-mb-md"},at={class:"col"},nt={class:"text-h6 text-weight-bold"},dt={class:"col-auto row q-gutter-sm"};function rt(t,e,u,h,l,n){const s=S("InfoGeneral"),d=S("Seguimiento"),N=S("HojaRuta"),A=S("SesionesPsicologico"),ee=S("InformesLegal"),B=S("ApoyoIntegral"),ae=S("DocumentosGeneral"),le=S("Fotografias");return c(),g(xe,{class:"q-pa-md bg-grey-2"},{default:a(()=>[i("div",st,[i("div",at,[i("div",nt,"SLIM #"+r(l.slim?.id||"..."),1),e[7]||(e[7]=i("div",{class:"text-caption text-grey-7"},"Detalle y gestión integral",-1))]),i("div",dt,[n.hasAnyWa?(c(),g(G,{key:0,flat:"",color:"positive",icon:"chat",label:"WhatsApp"},{default:a(()=>[o(ne,null,{default:a(()=>[l.slim?.psicologica_user?.celular?(c(),g(q,{key:0,clickable:"",onClick:e[0]||(e[0]=D=>n.sendWhatsApp("psico"))},{default:a(()=>[o(p,{avatar:""},{default:a(()=>[o(b,{name:"psychology"})]),_:1}),o(p,null,{default:a(()=>[f("Psicología ("+r(l.slim.psicologica_user.name)+")",1)]),_:1}),o(p,{side:"",class:"text-caption text-grey"},{default:a(()=>[f(r(l.slim.psicologica_user.celular),1)]),_:1})]),_:1})):y("",!0),l.slim?.legal_user?.celular?(c(),g(q,{key:1,clickable:"",onClick:e[1]||(e[1]=D=>n.sendWhatsApp("legal"))},{default:a(()=>[o(p,{avatar:""},{default:a(()=>[o(b,{name:"gavel"})]),_:1}),o(p,null,{default:a(()=>[f("Legal ("+r(l.slim.legal_user.name)+")",1)]),_:1}),o(p,{side:"",class:"text-caption text-grey"},{default:a(()=>[f(r(l.slim.legal_user.celular),1)]),_:1})]),_:1})):y("",!0),l.slim?.trabajo_social_user?.celular?(c(),g(q,{key:2,clickable:"",onClick:e[2]||(e[2]=D=>n.sendWhatsApp("social"))},{default:a(()=>[o(p,{avatar:""},{default:a(()=>[o(b,{name:"people"})]),_:1}),o(p,null,{default:a(()=>[f("Trabajo social ("+r(l.slim.trabajo_social_user.name)+")",1)]),_:1}),o(p,{side:"",class:"text-caption text-grey"},{default:a(()=>[f(r(l.slim.trabajo_social_user.celular),1)]),_:1})]),_:1})):y("",!0)]),_:1})]),_:1})):y("",!0),o(G,{flat:"",color:"secondary",icon:"print",label:"Imprimir PDF"},{default:a(()=>[o(ne,null,{default:a(()=>[x((c(),g(q,{clickable:"",onClick:n.printPdf},{default:a(()=>[o(p,null,{default:a(()=>e[8]||(e[8]=[f("Ficha del SLIM")])),_:1})]),_:1},8,["onClick"])),[[k]]),o(C),x((c(),g(q,{clickable:"",onClick:e[3]||(e[3]=D=>n.printPdfHojaRuta("denunciante"))},{default:a(()=>[o(p,null,{default:a(()=>e[9]||(e[9]=[f("Ubicación (Denunciante)")])),_:1})]),_:1})),[[k]]),x((c(),g(q,{clickable:"",onClick:e[4]||(e[4]=D=>n.printPdfHojaRuta("denunciado"))},{default:a(()=>[o(p,null,{default:a(()=>e[10]||(e[10]=[f("Ubicación (Denunciado)")])),_:1})]),_:1})),[[k]])]),_:1})]),_:1}),o(_,{flat:"",color:"primary",icon:"refresh",onClick:n.fetchSlim,loading:l.loading},null,8,["onClick","loading"])])]),o(w,{flat:"",bordered:"",class:"q-mb-md"},{default:a(()=>[o(Ve,{modelValue:l.tab,"onUpdate:modelValue":e[5]||(e[5]=D=>l.tab=D),class:"text-primary",dense:"",align:"left","active-color":"primary","indicator-color":"primary","outside-arrows":"","mobile-arrows":""},{default:a(()=>[o(T,{name:"info",label:"1 Información General",icon:"dashboard","no-caps":""}),o(T,{name:"seguimiento",label:"2 Seguimiento",icon:"track_changes","no-caps":""}),n.role==="Administrador"||n.role==="Asistente"?(c(),g(T,{key:0,name:"hoja",label:"3 Hoja de Ruta",icon:"report_problem","no-caps":""})):y("",!0),n.role==="Administrador"||n.role==="Psicologo"?(c(),g(T,{key:1,name:"psico",label:"4 Área Psicológico",icon:"psychology","no-caps":""})):y("",!0),n.role==="Administrador"||n.role==="Abogado"?(c(),g(T,{key:2,name:"legal",label:"5 Área Legal",icon:"gavel","no-caps":""})):y("",!0),o(T,{name:"docs",label:"6 Documentos General",icon:"folder","no-caps":""}),o(T,{name:"fotos",label:"7 Fotografías",icon:"photo_library","no-caps":""})]),_:1},8,["modelValue"])]),_:1}),o(we,{modelValue:l.tab,"onUpdate:modelValue":e[6]||(e[6]=D=>l.tab=D),animated:"","keep-alive":""},{default:a(()=>[o(P,{name:"info"},{default:a(()=>[o(s,{"case-id":n.caseId},null,8,["case-id"])]),_:1}),o(P,{name:"seguimiento"},{default:a(()=>[o(d,{"case-id":n.caseId},null,8,["case-id"])]),_:1}),o(P,{name:"hoja"},{default:a(()=>[o(N,{"case-id":n.caseId},null,8,["case-id"])]),_:1}),o(P,{name:"psico"},{default:a(()=>[o(A,{"case-id":n.caseId,caso:l.slim},null,8,["case-id","caso"])]),_:1}),o(P,{name:"legal"},{default:a(()=>[o(ee,{"case-id":n.caseId},null,8,["case-id"])]),_:1}),o(P,{name:"apoyo"},{default:a(()=>[o(B,{"case-id":n.caseId},null,8,["case-id"])]),_:1}),o(P,{name:"docs"},{default:a(()=>[o(ae,{"case-id":n.caseId},null,8,["case-id"])]),_:1}),o(P,{name:"fotos"},{default:a(()=>[o(le,{"case-id":n.caseId},null,8,["case-id"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Ut=j(tt,[["render",rt],["__scopeId","data-v-a7d06583"]]);export{Ut as default};
