import{_ as w,c as g,o as s,w as i,b as o,a as d,a6 as S,$ as u,f,d as P,a7 as v,a0 as n,a1 as h,a2 as x,t as r,Z as a}from"./index-D0BWmPW-.js";import{Q}from"./QSelect-C0H1cK3W.js";import{Q as c}from"./format-Ca8Yi27f.js";import{Q as y}from"./QBadge-COKm0w4f.js";import{Q as V}from"./QTooltip-Bd2172wv.js";import{Q as q}from"./QSpinnerDots-BWKl9jW1.js";import{Q as C}from"./QMarkupTable-CguuwvQl.js";import{Q as A}from"./QPagination-BkFTKCyC.js";import{Q as F}from"./QPage-C6t6BI-N.js";const z={name:"SlimsPage",data(){return{slams:[],loading:!1,page:1,perPage:10,meta:{current_page:1,last_page:1,total:0,from:0,to:0},search:"",onlyPendientes:!1}},mounted(){this.onlyPendientes=String(this.$route.query.only_pendientes||"")==="1",this.fetchSlims()},watch:{"$route.query.only_pendientes"(m){this.onlyPendientes=String(m||"")==="1",this.goFirstPage()}},methods:{fetchSlims(){this.loading=!0,this.$axios.get("/slams",{params:{q:this.search||"",page:this.page,per_page:this.perPage,only_pendientes:this.onlyPendientes?1:0}}).then(m=>{const e=m.data||{};this.slams=e.data||[],this.meta={current_page:e.current_page||1,last_page:e.last_page||1,total:e.total||0,from:e.from||0,to:e.to||0},this.page=this.meta.current_page}).catch(m=>this.$alert.error(m.response?.data?.message||"Error cargando SLAMs")).finally(()=>{this.loading=!1})},onSearch(){this.page=1,this.fetchSlims()},clearSearch(){this.search="",this.onSearch()},goFirstPage(){this.page=1,this.fetchSlims()},rowIndex(m){return(this.meta.from||0)+m}}},I={class:"row items-center q-col-gutter-md q-mb-md"},U={class:"col-12 col-md"},B={class:"col-auto"},N={class:"col-auto"},M={class:"col-auto"},T={key:0},D=["onClick"],L={class:"text-no-wrap"},j={class:"text-no-wrap"},E={class:"text-weight-medium"},Z={key:0,class:"text-caption text-grey-7"},R={key:0,class:"text-grey-6"},G={class:"text-weight-medium"},H={key:4,class:"text-grey-6"},J={key:1,class:"text-grey-6"},K={key:1},O={key:2},W={colspan:"9",class:"text-center"},X={class:"row items-center justify-between q-mt-md"},Y={class:"text-caption text-grey-7"};function $(m,e,ee,te,l,p){return s(),g(F,{class:"q-pa-md"},{default:i(()=>[o("div",I,[o("div",U,[d(S,{modelValue:l.search,"onUpdate:modelValue":[e[0]||(e[0]=t=>l.search=t),p.onSearch],outlined:"",dense:"",debounce:"400",placeholder:"Buscar por N° SLAM, denunciante, denunciado, tipología, zona…"},{prepend:i(()=>[d(P,{name:"search"})]),append:i(()=>[l.search?(s(),g(f,{key:0,flat:"",dense:"",round:"",icon:"close",onClick:p.clearSearch},null,8,["onClick"])):u("",!0)]),_:1},8,["modelValue","onUpdate:modelValue"])]),o("div",B,[d(v,{modelValue:l.onlyPendientes,"onUpdate:modelValue":[e[1]||(e[1]=t=>l.onlyPendientes=t),p.goFirstPage],color:"primary",label:"Solo mis pendientes"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",N,[d(Q,{modelValue:l.perPage,"onUpdate:modelValue":[e[2]||(e[2]=t=>l.perPage=t),p.goFirstPage],options:[10,20,50],dense:"",outlined:"",style:{width:"120px"},label:"Por página"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",M,[d(f,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",onClick:e[3]||(e[3]=t=>p.fetchSlims()),loading:l.loading},null,8,["loading"])])]),d(C,{flat:"",bordered:"",dense:""},{default:i(()=>[e[16]||(e[16]=o("thead",null,[o("tr",null,[o("th",{style:{width:"60px"}},"#"),o("th",null,"Nº SLAM"),o("th",null,"Fecha"),o("th",null,"Denunciante"),o("th",null,"Denunciado"),o("th",null,"Tipología"),o("th",null,"Zona"),o("th",null,"Tipo"),o("th",null,"Alerta")])],-1)),!l.loading&&l.slams.length?(s(),n("tbody",T,[(s(!0),n(h,null,x(l.slams,(t,b)=>(s(),n("tr",{key:t.id,onClick:_=>m.$router.push("/slams/"+t.id),class:"cursor-pointer"},[o("td",null,r(p.rowIndex(b)),1),o("td",L,r(t.numero_caso||"—"),1),o("td",j,r(m.$filters.date(t.fecha_registro)),1),o("td",null,[(s(!0),n(h,null,x(t.adultos||[],(_,k)=>(s(),n("div",{key:k,class:"q-mb-xs"},[o("div",E,r((_.nombre||"")+" "+(_.paterno||"")+" "+(_.materno||"")),1),_.documento_num?(s(),n("div",Z,"CI: "+r(_.documento_num),1)):u("",!0)]))),128)),(t.adultos||[]).length?u("",!0):(s(),n("div",R,"—"))]),o("td",null,[o("div",G,r(t.den_nombres+" "+t.den_paterno+" "+t.den_materno),1)]),o("td",null,[t.tip_violencia_fisica?(s(),g(c,{key:0,color:"red","text-color":"white",size:"sm",class:"q-mr-xs"},{default:i(()=>e[5]||(e[5]=[a(" Física ")])),_:1})):u("",!0),t.tip_violencia_psicologica?(s(),g(c,{key:1,color:"orange","text-color":"white",size:"sm",class:"q-mr-xs"},{default:i(()=>e[6]||(e[6]=[a(" Psicológica ")])),_:1})):u("",!0),t.tip_abandono?(s(),g(c,{key:2,color:"blue","text-color":"white",size:"sm",class:"q-mr-xs"},{default:i(()=>e[7]||(e[7]=[a(" Abandono ")])),_:1})):u("",!0),t.tip_apoyo_integral?(s(),g(c,{key:3,color:"purple","text-color":"white",size:"sm",class:"q-mr-xs"},{default:i(()=>e[8]||(e[8]=[a(" Apoyo Integral ")])),_:1})):u("",!0),!t.tip_violencia_fisica&&!t.tip_violencia_psicologica&&!t.tip_abandono&&!t.tip_apoyo_integral?(s(),n("div",H,"—")):u("",!0)]),o("td",null,r(t.zona||"—"),1),o("td",null,[d(y,{color:t.numero_apoyo_integral?"green":"grey-5","text-color":t.numero_apoyo_integral?"white":"black",label:t.numero_apoyo_integral?"Apoyo Integral":"Regular",rounded:"",dense:""},null,8,["color","text-color","label"])]),o("td",null,[t.mi_estado?.me_asignado?(s(),n(h,{key:0},[t.mi_estado.primer_informe_hecho?(s(),g(y,{key:0,color:"green","text-color":"white",class:"q-mr-xs"},{default:i(()=>[a(r(t.mi_estado.label_listo||"Primer informe listo"),1)]),_:2},1024)):(s(),n(h,{key:1},[d(y,{color:t.mi_estado.atrasado?"red":"orange","text-color":t.mi_estado.atrasado?"white":"black",class:"q-mr-xs"},{default:i(()=>[t.mi_estado.atrasado?(s(),n(h,{key:0},[a(" Atrasado "+r(Math.abs(t.mi_estado.dias_restantes))+" d ",1)],64)):(s(),n(h,{key:1},[a(" Faltan "+r(t.mi_estado.dias_restantes)+" d ",1)],64))]),_:2},1032,["color","text-color"]),d(V,{"transition-show":"jump-down","transition-hide":"jump-up"},{default:i(()=>[e[9]||(e[9]=a(" Debes cargar tu ")),o("b",null,r(t.mi_estado.rol==="Psicologo"?"primera sesión":"primer informe"),1),e[10]||(e[10]=a(".")),e[11]||(e[11]=o("br",null,null,-1)),e[12]||(e[12]=a(" Fecha límite: ")),o("b",null,r(t.mi_estado.deadline),1),e[13]||(e[13]=a(". "))]),_:2},1024)],64))],64)):(s(),n("span",J,"—"))])],8,D))),128))])):!l.loading&&!l.slams.length?(s(),n("tbody",K,e[14]||(e[14]=[o("tr",null,[o("td",{colspan:"9",class:"text-center text-grey"}," No hay resultados para tu búsqueda. ")],-1)]))):(s(),n("tbody",O,[o("tr",null,[o("td",W,[d(q,{size:"24px",class:"q-mr-sm"}),e[15]||(e[15]=a(" Cargando… "))])])]))]),_:1}),o("div",X,[o("div",Y,[e[17]||(e[17]=a(" Mostrando ")),o("b",null,r(l.meta.from||0),1),e[18]||(e[18]=a(" – ")),o("b",null,r(l.meta.to||0),1),e[19]||(e[19]=a(" de ")),o("b",null,r(l.meta.total||0),1),e[20]||(e[20]=a(" registros "))]),d(A,{modelValue:l.page,"onUpdate:modelValue":[e[4]||(e[4]=t=>l.page=t),p.fetchSlims],max:l.meta.last_page||1,"max-pages":"10","boundary-numbers":"","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])])]),_:1})}const ue=w(z,[["render",$],["__scopeId","data-v-a6268a2b"]]);export{ue as default};
