import{_ as M,Y as P,a0 as h,o as u,b as a,a as t,$ as I,a1 as U,c as v,f as g,w as n,e as S,a6 as p,Q as k,d as A,a3 as V,a7 as Re,ac as he,t as m,a2 as F,Z as C,h as K,V as E,a8 as Z,j as Se,k as Le,l as xe,ad as ke,n as Ee,s as qe,v as B,X as De,K as $e,M as Pe,g as Fe,ae as Me,a5 as je}from"./index-CROM6mgz.js";import{b as w,c as b,Q as Ce}from"./QMenu-B_7dmdf0.js";import{Q as we}from"./QList-gnQT67xl.js";import{Q as ve}from"./QBtnDropdown-W5oDaM86.js";import{Q as W}from"./QSpace-Bx4viD12.js";import{S as Ie,Q as Ve,a as Ue,b as ze,c as X,d as Ge,e as J}from"./QBar-BuJtp2dO.js";import{Q as Be}from"./QPage-Fw5-puWS.js";import{C as x}from"./ClosePopup-B1I2kOIK.js";import{Q as Y}from"./QSelect-BuK3UREg.js";import{M as He}from"./MapPicker-Cx25t4qn.js";import{Q as Ae}from"./QItemLabel-DUYWZNYu.js";import{Q as Oe}from"./QBadge-DI_RHNPW.js";import{Q as Je}from"./QPagination-DSjaeb8w.js";import{Q as ie}from"./QMarkupTable-vFu2pG43.js";import{Q as be}from"./QFile-DteI4YzF.js";import{Q as Qe}from"./QImg-CaMmlccv.js";import{S as Ye}from"./SlimNuevo-CgFOcTA-.js";import{D as Ze}from"./DnaNuevo-CxLz1TFd.js";import{C as We}from"./PropremisNuevo-V63BTb6c.js";import{h as oe}from"./moment-C5S46NFB.js";import{C as Xe}from"./CasoNuevo-BBwuMAsr.js";import"./format-By-ukSE0.js";import"./QBtnGroup-epT7fZQA.js";import"./QResizeObserver-BAvao96K.js";import"./touch-BjYP5sR0.js";import"./QTooltip-CLLofl_D.js";import"./use-fullscreen-BniSpxwo.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./QExpansionItem-CxLR6HTJ.js";import"./QForm-CER1rVyA.js";const Ke={name:"InfoGeneral",components:{MapPicker:He},props:{caseId:{type:[String,Number],required:!0}},data(){return{documentos:[{label:"Carnet de identidad",value:"Carnet de identidad"},{label:"Pasaporte",value:"Pasaporte"},{label:"Libreta de servicio militar",value:"Libreta de servicio militar"},{label:"Libreta de conducir",value:"Libreta de conducir"}],sexos:[{label:"Masculino",value:"Masculino"},{label:"Femenino",value:"Femenino"},{label:"Otro",value:"Otro"}],estadosCiviles:[{label:"Soltero/a",value:"Soltero/a"},{label:"Casado/a",value:"Casado/a"},{label:"Divorciado/a",value:"Divorciado/a"},{label:"Viudo/a",value:"Viudo/a"},{label:"Unión libre",value:"Unión libre"}],loading:!1,editing:!1,form:{},backup:null,oruroCenter:[-17.9667,-67.1167]}},computed:{denunciantePos:{get(){return{latitud:this.form.latitud,longitud:this.form.longitud}},set(o){this.form.latitud=o.latitud,this.form.longitud=o.longitud}},denunciadoPos:{get(){return{latitud:this.form.denunciado_latitud,longitud:this.form.denunciado_longitud}},set(o){this.form.denunciado_latitud=o.latitud,this.form.denunciado_longitud=o.longitud}},role(){return this.$store.user?.role||""}},created(){this.fetch()},methods:{req(o){return!!o||"Requerido"},async fetch(){this.loading=!0;try{const o=await this.$axios.get(`/casos/${this.caseId}`);this.form={...o.data},this.backup={...this.form}}catch(o){this.$alert.error(o?.response?.data?.message||"No se pudo cargar el caso")}finally{this.loading=!1}},startEdit(){this.editing=!0,this.backup={...this.form}},cancelEdit(){this.form={...this.backup},this.editing=!1,this.$q.notify({type:"info",message:"Cambios descartados"})},async save(){this.loading=!0;try{const o=await this.$axios.put(`/casos/${this.caseId}`,this.form);this.form={...o.data.data},this.backup={...this.form},this.editing=!1,this.$alert.success("Información general actualizada")}catch(o){this.$alert.error(o?.response?.data?.message||"No se pudo actualizar")}finally{this.loading=!1}}}},eo={class:"row items-center q-mb-sm"},oo={class:"col-auto row q-gutter-sm"},io={class:"row q-col-gutter-md"},to={class:"col-12 col-md-3"},ao={class:"col-12 col-md-3"},lo={class:"col-12 col-md-6"},no={class:"col-12 col-md-4"},so={class:"col-12 col-md-4"},ro={class:"col-12"},co={class:"row q-col-gutter-md"},uo={class:"col-12 col-md-2"},mo={class:"col-12 col-md-2"},fo={class:"col-12 col-md-2"},po={class:"col-12 col-md-2"},go={class:"col-12 col-md-2"},_o={class:"col-6 col-md-3"},ho={class:"col-6 col-md-3"},vo={class:"col-6 col-md-3"},bo={class:"col-6 col-md-3"},yo={class:"col-6 col-md-3"},Co={class:"col-6 col-md-3"},Io={class:"col-6 col-md-3"},Eo={class:"col-6 col-md-3"},xo={class:"col-6 col-md-3"},Ao={class:"col-6 col-md-3"},No={class:"col-6 col-md-3"},Do={class:"col-12 col-md-3"},wo={class:"col-12 col-md-3"},Vo={class:"col-12"},Oo={class:"col-12"},So={class:"row q-col-gutter-md"},ko={class:"col-12 col-md-6"},Uo={class:"col-6 col-md-3"},To={class:"col-6 col-md-3"},Ro={class:"col-6 col-md-3"},Lo={class:"col-6 col-md-3"},qo={class:"col-6 col-md-3"},$o={class:"col-6 col-md-3"},Po={class:"col-6 col-md-3"},Fo={class:"col-6 col-md-3"},Mo={class:"col-6 col-md-3"},jo={class:"col-12"},zo={class:"col-12"},Go={class:"row q-col-gutter-md"},Bo={class:"col-12 col-md-2"},Ho={class:"col-12 col-md-2"},Jo={class:"col-12 col-md-2"},Qo={class:"col-12 col-md-2"},Yo={class:"col-12 col-md-2"},Zo={class:"col-12 col-md-2"};function Wo(o,e,d,c,i,r){const l=P("MapPicker");return u(),h("div",null,[a("div",eo,[e[46]||(e[46]=a("div",{class:"col"},[a("div",{class:"text-subtitle1 text-weight-medium"},"Información General")],-1)),a("div",oo,[r.role==="Administrador"||r.role==="Asistente"?(u(),h(U,{key:0},[i.editing?(u(),h(U,{key:1},[t(g,{flat:"",color:"negative",icon:"close",label:"Cancelar",onClick:r.cancelEdit,loading:i.loading},null,8,["onClick","loading"]),t(g,{color:"primary",icon:"save",label:"Guardar",onClick:r.save,loading:i.loading},null,8,["onClick","loading"])],64)):(u(),v(g,{key:0,color:"primary",icon:"edit",label:"Editar",onClick:r.startEdit,loading:i.loading},null,8,["onClick","loading"]))],64)):I("",!0)])]),t(k,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:n(()=>[t(S,null,{default:n(()=>[a("div",io,[a("div",to,[t(p,{modelValue:i.form.caso_numero,"onUpdate:modelValue":e[0]||(e[0]=s=>i.form.caso_numero=s),readonly:!0,dense:"",outlined:"",clearable:"",label:"Nro de caso"},null,8,["modelValue"])]),a("div",ao,[t(p,{modelValue:i.form.caso_fecha_hecho,"onUpdate:modelValue":e[1]||(e[1]=s=>i.form.caso_fecha_hecho=s),readonly:!i.editing,type:"date",dense:"",outlined:"",label:"Fecha del hecho"},null,8,["modelValue","readonly"])]),a("div",lo,[t(p,{modelValue:i.form.caso_lugar_hecho,"onUpdate:modelValue":e[2]||(e[2]=s=>i.form.caso_lugar_hecho=s),readonly:!i.editing,dense:"",outlined:"",clearable:"",label:"Lugar del hecho"},null,8,["modelValue","readonly"])]),a("div",no,[t(p,{modelValue:i.form.caso_tipologia,"onUpdate:modelValue":e[3]||(e[3]=s=>i.form.caso_tipologia=s),readonly:!i.editing,dense:"",outlined:"",clearable:"",label:"Tipología"},null,8,["modelValue","readonly"])]),a("div",so,[t(p,{modelValue:i.form.caso_modalidad,"onUpdate:modelValue":e[4]||(e[4]=s=>i.form.caso_modalidad=s),readonly:!i.editing,dense:"",outlined:"",clearable:"",label:"Modalidad"},null,8,["modelValue","readonly"])]),a("div",ro,[t(p,{modelValue:i.form.caso_descripcion,"onUpdate:modelValue":e[5]||(e[5]=s=>i.form.caso_descripcion=s),readonly:!i.editing,type:"textarea",autogrow:"",outlined:"",dense:"",clearable:"",label:"Descripción del hecho",counter:"",maxlength:"3000"},null,8,["modelValue","readonly"])])])]),_:1})]),_:1}),t(k,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:n(()=>[t(S,{class:"row items-center"},{default:n(()=>[t(A,{name:"assignment_ind",class:"q-mr-sm"}),e[47]||(e[47]=a("div",{class:"text-subtitle1 text-weight-medium"},"Denunciante",-1))]),_:1}),t(V),t(S,null,{default:n(()=>[a("div",co,[a("div",uo,[t(Y,{modelValue:i.form.area,"onUpdate:modelValue":e[6]||(e[6]=s=>i.form.area=s),dense:"",outlined:"",readonly:!i.editing,options:o.$areas,label:"Área *",rules:[r.req]},null,8,["modelValue","readonly","options","rules"])]),a("div",mo,[t(Y,{modelValue:i.form.zona,"onUpdate:modelValue":e[7]||(e[7]=s=>i.form.zona=s),dense:"",outlined:"",readonly:!i.editing,options:o.$zonas,label:"Zona *",rules:[r.req]},null,8,["modelValue","readonly","options","rules"])]),a("div",fo,[t(p,{modelValue:i.form.denunciante_nombres,"onUpdate:modelValue":e[8]||(e[8]=s=>i.form.denunciante_nombres=s),dense:"",outlined:"",clearable:"",readonly:!i.editing,label:"Nombres *",rules:[r.req]},null,8,["modelValue","readonly","rules"])]),a("div",po,[t(p,{modelValue:i.form.denunciante_paterno,"onUpdate:modelValue":e[9]||(e[9]=s=>i.form.denunciante_paterno=s),dense:"",outlined:"",clearable:"",readonly:!i.editing,label:"Apellido paterno"},null,8,["modelValue","readonly"])]),a("div",go,[t(p,{modelValue:i.form.denunciante_materno,"onUpdate:modelValue":e[10]||(e[10]=s=>i.form.denunciante_materno=s),dense:"",outlined:"",clearable:"",readonly:!i.editing,label:"Apellido materno"},null,8,["modelValue","readonly"])]),a("div",_o,[t(p,{modelValue:i.form.denunciante_lugar_nacimiento,"onUpdate:modelValue":e[11]||(e[11]=s=>i.form.denunciante_lugar_nacimiento=s),dense:"",outlined:"",clearable:"",label:"Lugar de nacimiento",readonly:!i.editing},null,8,["modelValue","readonly"])]),a("div",ho,[t(p,{modelValue:i.form.denunciante_fecha_nacimiento,"onUpdate:modelValue":[e[12]||(e[12]=s=>i.form.denunciante_fecha_nacimiento=s),e[13]||(e[13]=s=>{if(s){const f=new Date(s),T=Date.now()-f.getTime(),R=new Date(T);this.form.denunciante_edad=Math.abs(R.getUTCFullYear()-1970)}else this.form.denunciante_edad=""})],type:"date",dense:"",outlined:"",label:"Fecha de nacimiento",readonly:!i.editing},null,8,["modelValue","readonly"])]),a("div",vo,[t(p,{modelValue:i.form.denunciante_edad,"onUpdate:modelValue":e[14]||(e[14]=s=>i.form.denunciante_edad=s),modelModifiers:{number:!0},dense:"",outlined:"",type:"number",label:"Edad",readonly:!i.editing},null,8,["modelValue","readonly"])]),a("div",bo,[t(p,{modelValue:i.form.denunciante_telefono,"onUpdate:modelValue":e[15]||(e[15]=s=>i.form.denunciante_telefono=s),dense:"",outlined:"",clearable:"",label:"Teléfono/Celular",readonly:!i.editing},null,8,["modelValue","readonly"])]),a("div",yo,[t(p,{modelValue:i.form.denunciante_grado,"onUpdate:modelValue":e[16]||(e[16]=s=>i.form.denunciante_grado=s),dense:"",outlined:"",clearable:"",label:"Grado de instrucción",readonly:!i.editing},null,8,["modelValue","readonly"])]),a("div",Co,[t(p,{modelValue:i.form.denunciante_documento,"onUpdate:modelValue":e[17]||(e[17]=s=>i.form.denunciante_documento=s),readonly:!i.editing,dense:"",outlined:"",clearable:"",label:"Documento"},null,8,["modelValue","readonly"])]),a("div",Io,[t(p,{modelValue:i.form.denunciante_nro,"onUpdate:modelValue":e[18]||(e[18]=s=>i.form.denunciante_nro=s),readonly:!i.editing,dense:"",outlined:"",clearable:"",label:"Nro documento"},null,8,["modelValue","readonly"])]),a("div",Eo,[t(p,{modelValue:i.form.denunciante_sexo,"onUpdate:modelValue":e[19]||(e[19]=s=>i.form.denunciante_sexo=s),readonly:!i.editing,dense:"",outlined:"",clearable:"",label:"Sexo"},null,8,["modelValue","readonly"])]),a("div",xo,[t(p,{modelValue:i.form.denunciante_estado_civil,"onUpdate:modelValue":e[20]||(e[20]=s=>i.form.denunciante_estado_civil=s),readonly:!i.editing,dense:"",outlined:"",clearable:"",label:"Estado civil"},null,8,["modelValue","readonly"])]),a("div",Ao,[t(p,{modelValue:i.form.denunciante_residencia,"onUpdate:modelValue":e[21]||(e[21]=s=>i.form.denunciante_residencia=s),readonly:!i.editing,dense:"",outlined:"",clearable:"",label:"Residencia"},null,8,["modelValue","readonly"])]),a("div",No,[t(p,{modelValue:i.form.denunciante_idioma,"onUpdate:modelValue":e[22]||(e[22]=s=>i.form.denunciante_idioma=s),readonly:!i.editing,dense:"",outlined:"",clearable:"",label:"Idioma"},null,8,["modelValue","readonly"])]),a("div",Do,[t(Re,{modelValue:i.form.denunciante_trabaja,"onUpdate:modelValue":e[23]||(e[23]=s=>i.form.denunciante_trabaja=s),disable:!i.editing,label:"Trabaja"},null,8,["modelValue","disable"])]),a("div",wo,[t(p,{modelValue:i.form.denunciante_ocupacion,"onUpdate:modelValue":e[24]||(e[24]=s=>i.form.denunciante_ocupacion=s),readonly:!i.editing,dense:"",outlined:"",clearable:"",label:"Ocupación"},null,8,["modelValue","readonly"])]),a("div",Vo,[t(p,{modelValue:i.form.denunciante_domicilio_actual,"onUpdate:modelValue":e[25]||(e[25]=s=>i.form.denunciante_domicilio_actual=s),readonly:!i.editing,dense:"",outlined:"",clearable:"",label:"Domicilio actual"},null,8,["modelValue","readonly"])]),a("div",Oo,[e[48]||(e[48]=a("div",{class:"text-caption text-grey-7 q-mb-xs"},"Ubicación (denunciante)",-1)),t(l,{modelValue:r.denunciantePos,"onUpdate:modelValue":e[26]||(e[26]=s=>r.denunciantePos=s),center:i.oruroCenter},null,8,["modelValue","center"])])])]),_:1})]),_:1}),t(k,{flat:"",bordered:"",class:"section-card q-mb-xl"},{default:n(()=>[t(S,{class:"row items-center"},{default:n(()=>[t(A,{name:"person_pin_circle",class:"q-mr-sm"}),e[49]||(e[49]=a("div",{class:"text-subtitle1 text-weight-medium"},"Denunciado",-1))]),_:1}),t(V),t(S,null,{default:n(()=>[a("div",So,[a("div",ko,[t(p,{modelValue:i.form.denunciado_nombre_completo,"onUpdate:modelValue":e[27]||(e[27]=s=>i.form.denunciado_nombre_completo=s),readonly:!i.editing,dense:"",outlined:"",clearable:"",label:"Nombre completo"},null,8,["modelValue","readonly"])]),a("div",Uo,[t(Y,{modelValue:i.form.denunciado_documento,"onUpdate:modelValue":e[28]||(e[28]=s=>i.form.denunciado_documento=s),dense:"",outlined:"",readonly:!i.editing,"emit-value":"","map-options":"",options:i.documentos,label:"Documento"},null,8,["modelValue","readonly","options"])]),a("div",To,[t(p,{modelValue:i.form.denunciado_nro,"onUpdate:modelValue":e[29]||(e[29]=s=>i.form.denunciado_nro=s),readonly:!i.editing,dense:"",outlined:"",clearable:"",label:"Nro documento"},null,8,["modelValue","readonly"])]),a("div",Ro,[t(p,{modelValue:i.form.denunciado_sexo,"onUpdate:modelValue":e[30]||(e[30]=s=>i.form.denunciado_sexo=s),readonly:!i.editing,dense:"",outlined:"",clearable:"",label:"Sexo"},null,8,["modelValue","readonly"])]),a("div",Lo,[t(p,{modelValue:i.form.denunciado_lugar_nacimiento,"onUpdate:modelValue":e[31]||(e[31]=s=>i.form.denunciado_lugar_nacimiento=s),dense:"",outlined:"",clearable:"",label:"Lugar de nacimiento"},null,8,["modelValue"])]),a("div",qo,[t(p,{modelValue:i.form.denunciado_fecha_nacimiento,"onUpdate:modelValue":[e[32]||(e[32]=s=>i.form.denunciado_fecha_nacimiento=s),e[33]||(e[33]=s=>{if(s){const f=new Date(s),T=Date.now()-f.getTime(),R=new Date(T);this.form.denunciado_edad=Math.abs(R.getUTCFullYear()-1970)}else this.form.denunciado_edad=""})],type:"date",dense:"",outlined:"",label:"Fecha de nacimiento"},null,8,["modelValue"])]),a("div",$o,[t(p,{modelValue:i.form.denunciado_edad,"onUpdate:modelValue":e[34]||(e[34]=s=>i.form.denunciado_edad=s),modelModifiers:{number:!0},dense:"",outlined:"",type:"number",label:"Edad"},null,8,["modelValue"])]),a("div",Po,[t(p,{modelValue:i.form.denunciado_telefono,"onUpdate:modelValue":e[35]||(e[35]=s=>i.form.denunciado_telefono=s),dense:"",outlined:"",clearable:"",label:"Teléfono/Celular"},null,8,["modelValue"])]),a("div",Fo,[t(p,{modelValue:i.form.denunciado_grado,"onUpdate:modelValue":e[36]||(e[36]=s=>i.form.denunciado_grado=s),dense:"",outlined:"",clearable:"",label:"Grado de instrucción"},null,8,["modelValue"])]),a("div",Mo,[t(p,{modelValue:i.form.denunciado_residencia,"onUpdate:modelValue":e[37]||(e[37]=s=>i.form.denunciado_residencia=s),readonly:!i.editing,dense:"",outlined:"",clearable:"",label:"Residencia"},null,8,["modelValue","readonly"])]),a("div",jo,[t(p,{modelValue:i.form.denunciado_domicilio_actual,"onUpdate:modelValue":e[38]||(e[38]=s=>i.form.denunciado_domicilio_actual=s),readonly:!i.editing,dense:"",outlined:"",clearable:"",label:"Domicilio actual"},null,8,["modelValue","readonly"])]),a("div",zo,[e[50]||(e[50]=a("div",{class:"text-caption text-grey-7 q-mb-xs"},"Ubicación (denunciado)",-1)),t(l,{modelValue:r.denunciadoPos,"onUpdate:modelValue":e[39]||(e[39]=s=>r.denunciadoPos=s),center:i.oruroCenter},null,8,["modelValue","center"])])])]),_:1}),t(S,null,{default:n(()=>[a("div",Go,[a("div",Bo,[t(he,{modelValue:i.form.documento_fotocopia_carnet_denunciante,"onUpdate:modelValue":e[40]||(e[40]=s=>i.form.documento_fotocopia_carnet_denunciante=s),label:"Fotocopia CI denunciante","false-value":"0","true-value":"1"},null,8,["modelValue"])]),a("div",Ho,[t(he,{modelValue:i.form.documento_fotocopia_carnet_denunciado,"onUpdate:modelValue":e[41]||(e[41]=s=>i.form.documento_fotocopia_carnet_denunciado=s),label:"Fotocopia CI denunciado","false-value":"0","true-value":"1"},null,8,["modelValue"])]),a("div",Jo,[t(he,{modelValue:i.form.documento_placas_fotograficas_domicilio_denunciante,"onUpdate:modelValue":e[42]||(e[42]=s=>i.form.documento_placas_fotograficas_domicilio_denunciante=s),label:"Placas fotográficas domicilio denunciante","false-value":"0","true-value":"1"},null,8,["modelValue"])]),a("div",Qo,[t(he,{modelValue:i.form.documento_croquis_direccion_denunciado,"onUpdate:modelValue":e[43]||(e[43]=s=>i.form.documento_croquis_direccion_denunciado=s),label:"Croquis dirección denunciado","false-value":"0","true-value":"1"},null,8,["modelValue"])]),a("div",Yo,[t(he,{modelValue:i.form.documento_placas_fotograficas_domicilio_denunciado,"onUpdate:modelValue":e[44]||(e[44]=s=>i.form.documento_placas_fotograficas_domicilio_denunciado=s),label:"Placas fotográficas domicilio denunciado","false-value":"0","true-value":"1"},null,8,["modelValue"])]),a("div",Zo,[t(he,{modelValue:i.form.documento_ciudadania_digital,"onUpdate:modelValue":e[45]||(e[45]=s=>i.form.documento_ciudadania_digital=s),label:"Ciudadanía digital","false-value":"0","true-value":"1"},null,8,["modelValue"])])])]),_:1})]),_:1})])}const Xo=M(Ke,[["render",Wo],["__scopeId","data-v-71a690e4"]]),Ko={name:"Problematica",props:{caseId:{type:[String,Number],required:!0},canEdit:{type:Boolean,default:!0}},data(){return{loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dialog:!1,mode:"create",form:{id:null,fecha:"",titulo:"",detalle:"",acciones_inmediatas:"",observaciones:""}}},watch:{caseId(){this.resetAndFetch()},search(){this.page=1,this.fetchRows()}},created(){this.fetchRows()},methods:{resetAndFetch(){this.page=1,this.fetchRows()},today(){const o=new Date,e=d=>String(d).padStart(2,"0");return`${o.getFullYear()}-${e(o.getMonth()+1)}-${e(o.getDate())}`},async fetchRows(){if(this.caseId){this.loading=!0;try{const o=await this.$axios.get(`/casos/${this.caseId}/problematicas`,{params:{q:this.search,page:this.page,per_page:this.perPage}});this.rows=o.data,this.rows.data||(this.rows.data=[])}catch(o){this.$q.notify({type:"negative",message:o?.response?.data?.message||"Error cargando problemática"})}finally{this.loading=!1}}},openCreate(){this.mode="create",this.form={id:null,fecha:this.today(),titulo:"",detalle:"",acciones_inmediatas:"",observaciones:""},this.dialog=!0},openView(o){this.mode="view",this.form={...o},this.dialog=!0},openEdit(o){this.mode="edit",this.form={...o},this.dialog=!0},async save(){if(!this.form.titulo){this.$q.notify({type:"negative",message:"El título es obligatorio"});return}this.saving=!0;try{this.form.id?await this.$axios.put(`/problematicas/${this.form.id}`,this.form):await this.$axios.post(`/casos/${this.caseId}/problematicas`,this.form),this.dialog=!1,this.$q.notify({type:"positive",message:"Guardado"}),this.fetchRows(),this.$emit("changed")}catch(o){this.$q.notify({type:"negative",message:o?.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}},remove(o){const e=async()=>{try{await this.$axios.delete(`/problematicas/${o.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.fetchRows(),this.$emit("changed")}catch(d){this.$q.notify({type:"negative",message:d?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar registro?").onOk(e):confirm("¿Eliminar registro?")&&e()},print(o){const e=this.$axios.defaults.baseURL+`/problematicas/${o.id}/pdf`;window.open(e,"_blank")}}},ei={class:"row items-center q-gutter-sm q-mb-sm"},oi={class:"col"},ii={class:"text-caption text-grey-7"},ti={class:"col-auto row items-center q-gutter-sm"},ai={class:"row justify-end q-mt-sm"},li={class:"text-subtitle1"},ni={class:"row q-col-gutter-md"},si={class:"col-12 col-md-4"},di={class:"col-12 col-md-8"},ri={class:"col-12"},ci={class:"col-12"},ui={class:"col-12"};function mi(o,e,d,c,i,r){return u(),v(k,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[a("div",ei,[a("div",oi,[e[8]||(e[8]=a("div",{class:"text-subtitle1 text-weight-medium"},"Problemática",-1)),a("div",ii,"Registros vinculados al caso #"+m(d.caseId),1)]),a("div",ti,[t(p,{dense:"",outlined:"",modelValue:i.search,"onUpdate:modelValue":e[0]||(e[0]=l=>i.search=l),placeholder:"Buscar...",style:{width:"260px"}},{append:n(()=>[t(A,{name:"search"})]),_:1},8,["modelValue"]),d.canEdit?(u(),v(g,{key:0,color:"primary",icon:"add_circle",label:"Nueva",onClick:r.openCreate},null,8,["onClick"])):I("",!0),t(g,{flat:"",color:"primary",icon:"refresh",onClick:r.fetchRows,loading:i.loading},null,8,["onClick","loading"])])]),t(V),t(we,{bordered:"",separator:"",class:"q-mt-sm"},{default:n(()=>[(u(!0),h(U,null,F(i.rows.data,l=>(u(),v(w,{key:l.id},{default:n(()=>[t(b,null,{default:n(()=>[t(Ae,{class:"text-weight-medium"},{default:n(()=>[C(m(l.titulo),1)]),_:2},1024),t(Ae,{caption:"",class:"ellipsis-2-lines"},{default:n(()=>[C(m((l.detalle||"").slice(0,220)),1)]),_:2},1024),t(Ae,{caption:""},{default:n(()=>[t(Oe,{outline:"",color:"blue-7",class:"q-mr-xs"},{default:n(()=>[C(m(l.fecha||"s/f"),1)]),_:2},1024),t(Oe,{outline:"",color:"grey-7"},{default:n(()=>[C("Por: "+m(l.user?.name||l.user?.username||"—"),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(b,{side:"",top:""},{default:n(()=>[t(g,{dense:"",flat:"",icon:"visibility",onClick:s=>r.openView(l)},null,8,["onClick"]),d.canEdit?(u(),v(g,{key:0,dense:"",flat:"",icon:"edit",color:"primary",onClick:s=>r.openEdit(l)},null,8,["onClick"])):I("",!0),d.canEdit?(u(),v(g,{key:1,dense:"",flat:"",icon:"delete",color:"negative",onClick:s=>r.remove(l)},null,8,["onClick"])):I("",!0),t(g,{color:"red",outline:"",label:"Imprimir",onClick:s=>r.print(l)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),!i.rows.data.length&&!i.loading?(u(),v(w,{key:0},{default:n(()=>[t(b,null,{default:n(()=>e[9]||(e[9]=[C("Sin resultados")])),_:1})]),_:1})):I("",!0)]),_:1}),a("div",ai,[t(Je,{modelValue:i.page,"onUpdate:modelValue":e[1]||(e[1]=l=>i.page=l),max:i.rows.last_page||1,"boundary-numbers":"","direction-links":"",onInput:r.fetchRows},null,8,["modelValue","max","onInput"])]),t(K,{modelValue:i.dialog,"onUpdate:modelValue":e[7]||(e[7]=l=>i.dialog=l),persistent:""},{default:n(()=>[t(k,{style:{"min-width":"720px","max-width":"95vw"}},{default:n(()=>[t(S,{class:"row items-center"},{default:n(()=>[a("div",li,m(i.mode==="view"?"Detalle de Problemática":i.form.id?"Editar Problemática":"Nueva Problemática"),1),t(W),E(t(g,{flat:"",round:"",dense:"",icon:"close"},null,512),[[x]])]),_:1}),t(V),t(S,null,{default:n(()=>[a("div",ni,[a("div",si,[t(p,{modelValue:i.form.fecha,"onUpdate:modelValue":e[2]||(e[2]=l=>i.form.fecha=l),type:"date",dense:"",outlined:"",label:"Fecha",readonly:i.mode==="view"},null,8,["modelValue","readonly"])]),a("div",di,[t(p,{modelValue:i.form.titulo,"onUpdate:modelValue":e[3]||(e[3]=l=>i.form.titulo=l),dense:"",outlined:"",label:"Problemática principal *",readonly:i.mode==="view",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","readonly","rules"])]),a("div",ri,[t(p,{modelValue:i.form.detalle,"onUpdate:modelValue":e[4]||(e[4]=l=>i.form.detalle=l),type:"textarea",autogrow:"",outlined:"",dense:"",label:"Detalle / antecedentes",readonly:i.mode==="view"},null,8,["modelValue","readonly"])]),a("div",ci,[t(p,{modelValue:i.form.acciones_inmediatas,"onUpdate:modelValue":e[5]||(e[5]=l=>i.form.acciones_inmediatas=l),type:"textarea",autogrow:"",outlined:"",dense:"",label:"Acciones inmediatas y realizadas",readonly:i.mode==="view"},null,8,["modelValue","readonly"])]),a("div",ui,[t(p,{modelValue:i.form.observaciones,"onUpdate:modelValue":e[6]||(e[6]=l=>i.form.observaciones=l),type:"textarea",autogrow:"",outlined:"",dense:"",label:"Observaciones",readonly:i.mode==="view"},null,8,["modelValue","readonly"])])])]),_:1}),t(V),t(Z,{align:"right"},{default:n(()=>[E(t(g,{flat:"",label:"Cerrar"},null,512),[[x]]),i.mode!=="view"?(u(),v(g,{key:0,color:"primary",label:"Guardar",loading:i.saving,onClick:r.save},null,8,["loading","onClick"])):I("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const fi=M(Ko,[["render",mi],["__scopeId","data-v-b7455962"]]),pi={name:"SesionesPsicologico",emits:["refresh"],props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:null}},data(){return{openSubirArchivo:!1,file:null,loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dialog:!1,mode:"create",form:{id:null,fecha:"",titulo:"",duracion_min:null,lugar:"",tipo:"Individual",contenido_html:""},plantilla:null,plantillasOptions:[{label:"Consentimiento informado",value:"consentimiento"},{label:"Informe Psicológico (formato DIO)",value:"informe_dio"},{label:"Acta de sesión (DIO)",value:"acta"}]}},watch:{caseId(){this.page=1,this.fetchRows()},search(){this.page=1,this.fetchRows()}},created(){},methods:{guardarInforme(){if(!this.file){this.$q.notify({type:"negative",message:"Seleccione un archivo"});return}if(!this.form.titulo){this.$q.notify({type:"negative",message:"El título es obligatorio"});return}const o=new FormData;o.append("titulo",this.form.titulo),o.append("file",this.file),o.append("case_id",this.caseId),o.append("tipo","psicologico"),this.saving=!0,this.$axios.post(`/casos/${this.caseId}/uploadFile`,o,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{this.$q.notify({type:"positive",message:"Informe subido"}),this.openSubirArchivo=!1,this.file=null,this.form.titulo="",this.$emit("refresh")}).catch(e=>{this.$q.notify({type:"negative",message:e?.response?.data?.message||"No se pudo subir el informe"})}).finally(()=>{this.saving=!1})},onFileChange(o){this.file=o},today(){const o=new Date,e=d=>String(d).padStart(2,"0");return`${o.getFullYear()}-${e(o.getMonth()+1)}-${e(o.getDate())}`},async fetchRows(){if(this.caseId){this.loading=!0;try{const o=await this.$axios.get(`/casos/${this.caseId}/sesiones-psicologicas`,{params:{q:this.search,page:this.page,per_page:this.perPage}});this.rows=o.data||{data:[],last_page:1}}catch(o){this.$q.notify({type:"negative",message:o?.response?.data?.message||"Error cargando sesiones"})}finally{this.loading=!1}}},openSubirInforme(){this.form.titulo="",this.openSubirArchivo=!0},openCreate(){this.mode="create",this.plantilla="consentimiento",this.form={id:null,fecha:this.today(),titulo:"",duracion_min:null,lugar:"",tipo:"Individual",contenido_html:""},this.dialog=!0,this.$nextTick(()=>this.applyTemplate("consentimiento"))},openView(o){this.mode="view",this.form={...o},this.dialog=!0},openEdit(o){this.mode="edit",this.form={...o},this.dialog=!0},applyTemplate(o){if(this.mode==="view")return;const e=this.caso||{},d={nombres:e.denunciante_nombres||e.denunciante_nombre_completo||"",apellidos:[e.denunciante_paterno,e.denunciante_materno].filter(Boolean).join(" "),edad:e.denunciante_edad||"",fecha_nacimiento:e.denunciante_fecha_nacimiento||"",lugar_nacimiento:e.denunciante_lugar_nacimiento||"",grado:e.denunciante_grado||"",ocupacion:e.denunciante_ocupacion_exacto||e.denunciante_ocupacion||"",domicilio:e.denunciante_domicilio_actual||e.denunciante_residencia||"",documento:e.denunciante_documento||"Carnet de identidad",nro:e.denunciante_nro||"",telefono:e.denunciante_telefono||e.denunciante_movil||e.denunciante_fijo||"",estado_civil:e.denunciante_estado_civil||""};for(let D=1;D<=5;D++)e[`familiar${D}_nombre_completo`],e[`familiar${D}_edad`],e[`familiar${D}_parentesco`],e[`familiar${D}_celular`];const c=(this.form.fecha||this.today()).slice(0,4),i=e.caso_numero&&String(e.caso_numero).trim()!==""?String(e.caso_numero):`${String(this.caseId).padStart(2,"0")}/${c}`,r=e.legal_user?.name||e.legal_user?.username||"",l=e.psicologica_user?.name||e.psicologica_user?.username||this.$store?.state?.user?.name||"",s=e.caso_tipologia||e.caso_modalidad?`Evaluación psicológica en el marco de presunta(s) ${[e.caso_tipologia,e.caso_modalidad].filter(Boolean).join(" / ")}.`:"Evaluación psicológica para determinar los efectos emocionales y psicológicos en la evaluada.",f=(()=>{const D=e.caso_fecha_hecho?`el ${e.caso_fecha_hecho}`:"en fecha no precisada",q=[e.caso_lugar_hecho,e.caso_zona,e.caso_direccion].filter(Boolean).join(", "),G=q?`, en ${q}`:"",O=e.caso_descripcion?` ${e.caso_descripcion}`:"";return`Según la apertura del caso, el hecho habría ocurrido ${D}${G}.${O}`})(),T=["Entrevista clínica y observación conductual","Aplicación de instrumentos psicométricos según pertinencia (Goldberg, IES-R, Rosenberg)"].join("; ")+".",R=[e.violencia_fisica?"violencia física":null,e.violencia_psicologica?"violencia psicológica":null,e.violencia_sexual?"violencia sexual":null,e.violencia_economica?"violencia económica/patrimonial":null].filter(Boolean),j="Se evidencian reacciones emocionales congruentes con el evento referido, con impacto en el equilibrio afectivo y la autoestima."+(R.length?` Se consideran indicadores asociados a ${R.join(", ")}.`:"")+" No se evidencian signos de psicosis. Se sugiere seguimiento clínico y contención.",z=["Intervención psicológica: terapia focalizada en manejo de ansiedad/estrés y fortalecimiento de recursos personales.","Orientación/asesoramiento legal para evitar revictimización y garantizar medidas de protección, si corresponde."].join(" "),L={casoId:this.caseId,fecha:this.form.fecha||this.today(),titulo:this.form.titulo||"Sesión psicológica",lugar:this.form.lugar||"",tipo:this.form.tipo||"Individual",nombre:e.denunciantes[0]?.denunciante_nombres||d.denunciante_paterno+" "+d.denunciante_materno||"—",documento:e.denunciantes[0]?.denunciante_documento||d.documento,numeroCaso:i,abogadoNombre:r,psicologoNombre:l,denunciante:{nombres:e.denunciantes[0].denunciante_nombres||d.nombres||"—",apellidos:e.denunciantes[0].denunciante_apellidos||d.apellidos||"—",edad:e.denunciantes[0].denunciante_edad||d.edad||"—",fecha_nacimiento:e.denunciantes[0].denunciante_fecha_nacimiento||d.fecha_nacimiento||"—",lugar_nacimiento:e.denunciantes[0].denunciante_lugar_nacimiento||d.lugar_nacimiento||"—",grado:e.denunciantes[0].denunciante_grado||d.grado||"—",ocupacion:e.denunciantes[0].denunciante_ocupacion_exacto||e.denunciantes[0].denunciante_ocupacion||d.ocupacion||"—",domicilio:e.denunciantes[0].denunciante_domicilio_actual||e.denunciantes[0].denunciante_residencia||d.domicilio||"—",documento:e.denunciantes[0].denunciante_documento||d.documento},familiares:e.familiares,motivo:s,antecedentes:f,tecnicas:T,conclusiones:j,recomendaciones:z};o==="acta"?this.form.contenido_html=Ie.acta(L):o==="informe"?this.form.contenido_html=Ie.informe(L):o==="constancia"?this.form.contenido_html=Ie.constancia(L):o==="consentimiento"?this.form.contenido_html=Ie.consentimiento(L):o==="informe_dio"&&(this.form.contenido_html=Ie.informe_dio(L))},async save(){if(!this.form.titulo){this.$q.notify({type:"negative",message:"El título es obligatorio"});return}if(!this.form.contenido_html){this.$q.notify({type:"negative",message:"El contenido está vacío"});return}this.saving=!0;try{this.form.id?await this.$axios.put(`/sesiones-psicologicas/${this.form.id}`,this.form):await this.$axios.post(`/casos/${this.caseId}/sesiones-psicologicas`,this.form),this.$q.notify({type:"positive",message:"Guardado"}),this.dialog=!1,this.$emit("refresh")}catch(o){this.$q.notify({type:"negative",message:o?.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}},openFile(o){window.open(this.$url+"/.."+o.archivo,"_blank")},remove(o){const e=async()=>{try{await this.$axios.delete(`/sesiones-psicologicas/${o.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.$emit("refresh")}catch(d){this.$q.notify({type:"negative",message:d?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar la sesión?").onOk(e):confirm("¿Eliminar la sesión?")&&e()},printPdf(o){const e=this.$url||"";window.open(`${e}/sesiones-psicologicas/${o.id}/pdf`,"_blank")}}},gi={class:"row items-center q-mb-sm"},_i={class:"col"},hi={class:"text-caption text-grey-7"},vi={class:"col-auto row items-center q-gutter-sm"},bi={class:"text-grey-8"},yi={key:0},Ci={class:"text-subtitle1"},Ii={class:"row"},Ei={class:"col-12 col-md-3"},xi={class:"col-12 col-md-5"},Ai={class:"col-6 col-md-2"},Ni={class:"col-6 col-md-2"},Di={class:"col-12"},wi={key:0};function Vi(o,e,d,c,i,r){return u(),v(k,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[a("div",gi,[a("div",_i,[e[12]||(e[12]=a("div",{class:"text-subtitle1 text-weight-medium"},"Sesiones (Psicológico)",-1)),a("div",hi,"Vinculadas al caso #"+m(d.caseId),1)]),a("div",vi,[t(g,{flat:"",color:"primary",icon:"refresh",loading:i.loading,onClick:e[0]||(e[0]=l=>o.$emit("refresh"))},null,8,["loading"]),t(g,{color:"green",icon:"add_circle_outline","no-caps":"",label:"Crear Informe",onClick:r.openCreate},null,8,["onClick"]),t(g,{color:"primary",icon:"upload","no-caps":"",label:"Subir informe",onClick:r.openSubirInforme},null,8,["onClick"])])]),t(V),t(ie,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:n(()=>[e[19]||(e[19]=a("thead",null,[a("tr",{class:"bg-primary text-white"},[a("th",{style:{width:"70px"}},"ID"),a("th",{style:{width:"140px"}},"Acciones"),a("th",null,"Título"),a("th",{style:{width:"120px"}},"Fecha"),a("th",{style:{width:"120px"}},"Tipo"),a("th",{style:{width:"180px"}},"Usuario")])],-1)),a("tbody",null,[(u(!0),h(U,null,F(d.caso.psicologicas,l=>(u(),h("tr",{key:l.id},[a("td",bi,"#"+m(l.id),1),a("td",null,[t(ve,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:n(()=>[l.archivo?E((u(),v(w,{key:1,clickable:"",onClick:s=>r.openFile(l)},{default:n(()=>[t(b,{avatar:""},{default:n(()=>[t(A,{name:"download"})]),_:1}),t(b,null,{default:n(()=>e[16]||(e[16]=[C(" Descargar informe ")])),_:1})]),_:2},1032,["onClick"])),[[x]]):(u(),h(U,{key:0},[E((u(),v(w,{clickable:"",onClick:s=>r.openView(l)},{default:n(()=>[t(b,{avatar:""},{default:n(()=>[t(A,{name:"visibility"})]),_:1}),t(b,null,{default:n(()=>e[13]||(e[13]=[C("Ver")])),_:1})]),_:2},1032,["onClick"])),[[x]]),E((u(),v(w,{clickable:"",onClick:s=>r.printPdf(l)},{default:n(()=>[t(b,{avatar:""},{default:n(()=>[t(A,{name:"print"})]),_:1}),t(b,null,{default:n(()=>e[14]||(e[14]=[C("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[x]]),t(V),E((u(),v(w,{clickable:"",onClick:s=>r.openEdit(l)},{default:n(()=>[t(b,{avatar:""},{default:n(()=>[t(A,{name:"edit"})]),_:1}),t(b,null,{default:n(()=>e[15]||(e[15]=[C("Editar")])),_:1})]),_:2},1032,["onClick"])),[[x]])],64)),E((u(),v(w,{clickable:"",onClick:s=>r.remove(l)},{default:n(()=>[t(b,{avatar:""},{default:n(()=>[t(A,{name:"delete",color:"negative"})]),_:1}),t(b,{class:"text-negative"},{default:n(()=>e[17]||(e[17]=[C("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[x]])]),_:2},1024)]),a("td",null,m(l.titulo),1),a("td",null,m(l.fecha||"s/f"),1),a("td",null,m(l.tipo||"—"),1),a("td",null,m(l.user?.name||l.user?.username||"—"),1)]))),128)),!d.caso.psicologicas||d.caso.psicologicas.length===0?(u(),h("tr",yi,e[18]||(e[18]=[a("td",{colspan:"6",class:"text-center text-grey"},"Sin registros",-1)]))):I("",!0)])]),_:1}),t(K,{modelValue:i.dialog,"onUpdate:modelValue":e[8]||(e[8]=l=>i.dialog=l),persistent:""},{default:n(()=>[t(k,{style:{"max-width":"900px",width:"95vw"}},{default:n(()=>[t(S,{class:"row items-center q-pb-none"},{default:n(()=>[a("div",Ci,m(i.mode==="view"?"Ver sesión":i.form.id?"Editar sesión":"Nueva sesión"),1),t(W),E(t(g,{flat:"",round:"",dense:"",icon:"close"},null,512),[[x]])]),_:1}),t(S,{class:"q-gutter-md"},{default:n(()=>[a("div",Ii,[a("div",Ei,[t(p,{modelValue:i.form.fecha,"onUpdate:modelValue":e[1]||(e[1]=l=>i.form.fecha=l),type:"date",dense:"",outlined:"",label:"Fecha",readonly:i.mode==="view"},null,8,["modelValue","readonly"])]),a("div",xi,[t(p,{modelValue:i.form.titulo,"onUpdate:modelValue":e[2]||(e[2]=l=>i.form.titulo=l),dense:"",outlined:"",label:"Título *",readonly:i.mode==="view",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","readonly","rules"])]),a("div",Ai,[t(p,{modelValue:i.form.duracion_min,"onUpdate:modelValue":e[3]||(e[3]=l=>i.form.duracion_min=l),modelModifiers:{number:!0},type:"number",dense:"",outlined:"",label:"Minutos",readonly:i.mode==="view"},null,8,["modelValue","readonly"])]),a("div",Ni,[t(p,{modelValue:i.form.tipo,"onUpdate:modelValue":e[4]||(e[4]=l=>i.form.tipo=l),dense:"",outlined:"",label:"Tipo",readonly:i.mode==="view"},null,8,["modelValue","readonly"])]),a("div",Di,[t(p,{modelValue:i.form.lugar,"onUpdate:modelValue":e[5]||(e[5]=l=>i.form.lugar=l),dense:"",outlined:"",label:"Lugar",readonly:i.mode==="view"},null,8,["modelValue","readonly"])])]),i.mode!=="view"?(u(),h("div",wi,[t(Y,{modelValue:i.plantilla,"onUpdate:modelValue":[e[6]||(e[6]=l=>i.plantilla=l),r.applyTemplate],options:i.plantillasOptions,label:"Plantilla",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])])):I("",!0),a("div",null,[e[20]||(e[20]=a("div",{class:"text-caption text-grey-7 q-mb-xs"},"Contenido (WYSIWYG / se guarda HTML)",-1)),t(Ve,{modelValue:i.form.contenido_html,"onUpdate:modelValue":e[7]||(e[7]=l=>i.form.contenido_html=l),readonly:i.mode==="view","min-height":"320px",placeholder:"Escriba aquí el contenido de la sesión...",toolbar:[["left","center","right","justify"],["bold","italic","strike","underline"],["quote","unordered","ordered","outdent","indent"],["hr","link"],["undo","redo"],["removeFormat"]]},null,8,["modelValue","readonly"])])]),_:1}),t(V),t(Z,{align:"right"},{default:n(()=>[E(t(g,{flat:"",label:"Cerrar"},null,512),[[x]]),i.mode!=="view"?(u(),v(g,{key:0,color:"primary",label:"Guardar",loading:i.saving,onClick:r.save},null,8,["loading","onClick"])):I("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(K,{modelValue:i.openSubirArchivo,"onUpdate:modelValue":e[11]||(e[11]=l=>i.openSubirArchivo=l),persistent:""},{default:n(()=>[t(k,{style:{"max-width":"500px",width:"90vw"}},{default:n(()=>[t(S,{class:"row items-center q-pb-none"},{default:n(()=>[e[21]||(e[21]=a("div",{class:"text-subtitle1"},"Subir informe",-1)),t(W),E(t(g,{flat:"",round:"",dense:"",icon:"close"},null,512),[[x]])]),_:1}),t(S,{class:"q-gutter-md"},{default:n(()=>[e[22]||(e[22]=a("div",{class:"text-body2 q-mb-sm"}," Aquí puede subir un informe psicológico ya elaborado (PDF, Word, etc.) y vincularlo al caso. ",-1)),t(p,{modelValue:i.form.titulo,"onUpdate:modelValue":e[9]||(e[9]=l=>i.form.titulo=l),dense:"",outlined:"",label:"Título del informe *",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","rules"]),t(be,{modelValue:i.file,"onUpdate:modelValue":[e[10]||(e[10]=l=>i.file=l),r.onFileChange],label:"Seleccionar archivo",outlined:"",dense:"",accept:".pdf,.doc,.docx,.odt,.png,.jpg,.jpeg"},null,8,["modelValue","onUpdate:modelValue"]),t(g,{color:"primary",label:"Guardar",disabled:!i.file||!i.form.titulo,onClick:r.guardarInforme},null,8,["disabled","onClick"])]),_:1}),t(V),t(Z,{align:"right"},{default:n(()=>[E(t(g,{flat:"",label:"Cerrar"},null,512),[[x]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Oi=M(pi,[["render",Vi]]),Ne={psicologico({casoId:o,fecha:e,titulo:d,numero:c}){return`
<div style="border:1px solid #333;border-radius:6px;padding:12px;margin-bottom:12px;font-size:12px">
  <div style="display:flex;justify-content:space-between">
    <div>
      <div style="font-weight:700">DIRECCIÓN DE IGUALDAD DE OPORTUNIDADES (D.I.O.)</div>
      <div style="font-size:11px;color:#555">SERVICIO LEGAL INTEGRAL MUNICIPAL</div>
    </div>
    <div style="text-align:right;font-size:11px;color:#555">
      <div><b>Caso:</b> ${o}</div>
      <div><b>Fecha:</b> ${e}</div>
      <div><b>Nro. Informe:</b> ${c||"—"}</div>
    </div>
  </div>
</div>

<h4 style="margin:8px 0 4px 0;">${d||"INFORME PSICOLÓGICO"}</h4>

<h5 style="margin:10px 0 4px 0;">1. Datos personales</h5>
<p>...</p>

<h5 style="margin:10px 0 4px 0;">2. Motivo de consulta</h5>
<p>...</p>

<h5 style="margin:10px 0 4px 0;">3. Antecedentes</h5>
<p>...</p>

<h5 style="margin:10px 0 4px 0;">4. Técnicas e instrumentos empleados</h5>
<ul>
  <li>...</li>
</ul>

<h5 style="margin:10px 0 4px 0;">5. Resultados</h5>
<p>...</p>

<h5 style="margin:10px 0 4px 0;">6. Conclusiones</h5>
<p>...</p>

<h5 style="margin:10px 0 4px 0;">7. Recomendaciones</h5>
<ol>
  <li>...</li>
</ol>

<div style="margin-top:40px;display:flex;justify-content:space-between;font-size:12px;">
  <div style="text-align:center;width:45%;">
    <div>__________________________</div>
    <div>Profesional responsable</div>
  </div>
  <div style="text-align:center;width:45%;">
    <div>__________________________</div>
    <div>Vo.Bo.</div>
  </div>
</div>
    `},legal(o){const e=_=>_==null||_===""?"—":String(_),d=_=>_===!0||_===1||_==="1"?"Sí":_===!1||_===0||_==="0"?"No":"—",c=_=>{if(!_)return"—";const y=new Date(_);if(isNaN(y.getTime()))return e(_);const $=y.getFullYear(),Q=String(y.getMonth()+1).padStart(2,"0"),_e=String(y.getDate()).padStart(2,"0");return`${$}-${Q}-${_e}`},i=()=>{const _=new Date,y=_.getFullYear(),$=String(_.getMonth()+1).padStart(2,"0");return`${String(_.getDate()).padStart(2,"0")}/${$}/${y}`},r=(_={})=>[_.denunciante_nombres,_.denunciante_paterno,_.denunciante_materno].filter(Boolean).join(" ")||"—",l=(_={})=>[_.denunciado_nombres,_.denunciado_paterno,_.denunciado_materno].filter(Boolean).join(" ")||"—",s=o?.denunciantes&&o.denunciantes[0]?o.denunciantes[0]:{},f=o?.denunciados&&o.denunciados[0]?o.denunciados[0]:{},T=e(o?.principal||o?.caso_tipologia),R=d(o?.documento_ciudadania_digital),H=r(s),j=c(s?.denunciante_fecha_nacimiento),z=e(s?.denunciante_lugar_nacimiento),L=e(s?.denunciante_edad),D=e(s?.denunciante_nro),q=e(s?.denunciante_estado_civil),G=e(s?.denunciante_grado),O=e(s?.denunciante_residencia||s?.denunciante_domicilio_actual||o?.caso_direccion),ee=e(s?.denunciante_ocupacion),te=e(s?.denunciante_telefono),ae="—",le=l(f),ne=c(f?.denunciado_fecha_nacimiento),se=e(f?.denunciado_lugar_nacimiento),de=e(f?.denunciado_edad),re=e(f?.denunciado_nro),ce=e(f?.denunciado_estado_civil),ue=e(f?.denunciado_grado),me=e(f?.denunciado_residencia||f?.denunciado_domicilio_actual),fe=e(f?.denunciado_ocupacion),pe=e(f?.denunciado_telefono),ye="—",N=e(o?.legal_user?.name?`ABG. ${o.legal_user.name}`:"ABG.");return`
<div style="border:1px solid #333;border-radius:6px;padding:14px;margin-bottom:12px;font-size:13px; line-height:1.35">
  <div style="text-align:center; font-weight:700; font-size:16px; margin-bottom:10px">INFORME LEGAL</div>

  <div style="margin-bottom:10px">
    <div><b>A :</b> SEÑOR REPRESENTANTE DEL MINISTERIO PUBLICO</div>
    <div><b>DE :</b> ${N}</div>
  </div>

  <div style="margin:14px 0; font-weight:700">I. FORMULACION DE DENUNCIA</div>
  <div style="margin:14px 0; font-weight:700">II. FUNDAMENTO DEL HECHO</div>
  <div style="margin:14px 0; font-weight:700">III. FUNDAMENTO DE DERECHO</div>
  <div style="margin:14px 0; font-weight:700">IV. PETITORIO</div>
  <div style="margin:14px 0; font-weight:700">V. OTROSIS</div>

  <div style="margin:18px 0; font-weight:700">I. FORMULA DENUNCIA POR EL MOTIVO DE :</div>
  <div style="margin:6px 0 14px 0">${T}</div>

  <div style="margin:10px 0; font-weight:700">DATOS GENERALES DEL DENUNCIANTE :</div>
  <div><b>Nombres y Apellidos:</b> ${H}</div>
  <div><b>Fecha de Nacimiento:</b> ${j}</div>
  <div><b>Lugar de Nacimiento:</b> ${z}</div>
  <div><b>Edad:</b> ${L}</div>
  <div><b>C.I.:</b> ${D}</div>
  <div><b>Estado Civil:</b> ${q}</div>
  <div><b>Grado de Instrucción:</b> ${G}</div>
  <div><b>Dirección:</b> ${O}</div>
  <div><b>Ocupación:</b> ${ee}</div>
  <div><b>Teléfono Celular:</b> ${te}</div>
  <div><b>Correo electrónico:</b> ${ae}</div>
  <div><b>Ciudadanía Digital:</b> ${R}</div>

  <div style="margin:16px 0; font-weight:700">DATOS DEL DEMANDADO</div>
  <div><b>Nombres y Apellidos:</b> ${le}</div>
  <div><b>Fecha de Nacimiento:</b> ${ne}</div>
  <div><b>Lugar de Nacimiento:</b> ${se}</div>
  <div><b>Edad:</b> ${de}</div>
  <div><b>C.I.:</b> ${re}</div>
  <div><b>Estado Civil:</b> ${ce}</div>
  <div><b>Grado de Instrucción:</b> ${ue}</div>
  <div><b>Dirección:</b> ${me}</div>
  <div><b>Ocupación:</b> ${fe}</div>
  <div><b>Teléfono Celular:</b> ${pe}</div>
  <div><b>Correo electrónico:</b> ${ye}</div>

  <div style="margin:18px 0; font-weight:700">II. FUNDAMENTO DEL HECHO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">III. FUNDAMENTO DE DERECHO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">IV. PETITORIO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">V. OTROSIS</div>
  <p style="margin:6px 0">Por un derecho y protección a la Mujer…</p>

  <div style="margin-top:24px;">Oruro, ${i()}</div>

  <div style="margin-top:36px;text-align:center">
    __________________________<br>
    ${N}
  </div>
</div>
  `},social({casoId:o,fecha:e,titulo:d,numero:c}){return`
<div style="border:1px solid #333;border-radius:6px;padding:12px;margin-bottom:12px;font-size:12px">
  <div style="display:flex;justify-content:space-between">
    <div><div style="font-weight:700">D.I.O. — ÁREA SOCIAL</div></div>
    <div style="text-align:right;font-size:11px;color:#555">
      <div><b>Caso:</b> ${o}</div>
      <div><b>Fecha:</b> ${e}</div>
      <div><b>Nro. Informe:</b> ${c||"—"}</div>
    </div>
  </div>
</div>

<h4>${d||"INFORME SOCIAL"}</h4>

<h5>1. Datos de la familia</h5>
<p>...</p>

<h5>2. Visita domiciliaria / Observaciones del entorno</h5>
<p>...</p>

<h5>3. Situación socioeconómica</h5>
<p>...</p>

<h5>4. Conclusiones y recomendaciones</h5>
<p>...</p>

<div style="margin-top:36px;text-align:center">
  __________________________<br>
  Trabajadora Social
</div>
    `},dirigido_otros(o){const e=N=>N==null||N===""?"—":String(N),d=N=>N===!0||N===1||N==="1"?"Sí":N===!1||N===0||N==="0"?"No":"—",c=N=>{if(!N)return"—";const _=new Date(N);if(isNaN(_.getTime()))return e(N);const y=_.getFullYear(),$=String(_.getMonth()+1).padStart(2,"0"),Q=String(_.getDate()).padStart(2,"0");return`${y}-${$}-${Q}`},i=()=>{const N=new Date,_=N.getFullYear(),y=String(N.getMonth()+1).padStart(2,"0");return`${String(N.getDate()).padStart(2,"0")}/${y}/${_}`},r=(N={})=>[N.denunciante_nombres,N.denunciante_paterno,N.denunciante_materno].filter(Boolean).join(" ")||"—",l=(N={})=>[N.denunciado_nombres,N.denunciado_paterno,N.denunciado_materno].filter(Boolean).join(" ")||"—",s=o?.denunciantes&&o.denunciantes[0]?o.denunciantes[0]:{},f=o?.denunciados&&o.denunciados[0]?o.denunciados[0]:{},T=e(o?.principal||o?.caso_tipologia),R=d(o?.documento_ciudadania_digital),H=r(s),j=c(s?.denunciante_fecha_nacimiento),z=e(s?.denunciante_lugar_nacimiento||"ORURO"),L=e(s?.denunciante_edad),D=e(s?.denunciante_nro),q=e(s?.denunciante_estado_civil),G=e(s?.denunciante_grado),O=e(s?.denunciante_residencia||s?.denunciante_domicilio_actual||o?.caso_direccion||"ORURO"),ee=e(s?.denunciante_ocupacion),te=e(s?.denunciante_telefono),ae="—",le=l(f),ne=c(f?.denunciado_fecha_nacimiento),se=e(f?.denunciado_lugar_nacimiento||"ORURO"),de=e(f?.denunciado_edad),re=e(f?.denunciado_nro),ce=e(f?.denunciado_estado_civil),ue=e(f?.denunciado_grado||"—"),me=e(f?.denunciado_residencia||f?.denunciado_domicilio_actual||"ORURO"),fe=e(f?.denunciado_ocupacion||f?.denunciado_ocupacion_exacto||"—"),pe=e(f?.denunciado_telefono||f?.denunciado_movil||f?.denunciado_fijo),ye="—";return(o?.legal_user?.name||o?.user?.name||"Responsable").toString(),`
<div style="border:1px solid #333;border-radius:6px;padding:14px;margin-bottom:12px;font-size:13px;line-height:1.35">

  <div style="margin-bottom:10px">
    <div><b>A :</b> __________________________</div>
    <div><b>DE :</b> __________________________</div>
  </div>

  <div style="margin:14px 0; font-weight:700">I. FORMULACION DE DENUNCIA</div>
  <div style="margin:14px 0; font-weight:700">II. FUNDAMENTO DEL HECHO</div>
  <div style="margin:14px 0; font-weight:700">III. FUNDAMENTO DE DERECHO</div>
  <div style="margin:14px 0; font-weight:700">IV. PETITORIO</div>
  <div style="margin:14px 0; font-weight:700">V. OTROSIS</div>

  <div style="margin:18px 0; font-weight:700">I. FORMULA DENUNCIA POR EL MOTIVO DE :</div>
  <div style="margin:6px 0 14px 0">${T}</div>

  <div style="margin:10px 0; font-weight:700">DATOS GENERALES DEL DENUNCIANTE :</div>
  <div><b>Nombres y Apellidos:</b> ${H}</div>
  <div><b>Fecha de Nacimiento:</b> ${j}</div>
  <div><b>Lugar de Nacimiento:</b> ${z}</div>
  <div><b>Edad:</b> ${L}</div>
  <div><b>C.I.:</b> ${D}</div>
  <div><b>Estado Civil:</b> ${q}</div>
  <div><b>Grado de Instrucción:</b> ${G}</div>
  <div><b>Dirección:</b> ${O}</div>
  <div><b>Ocupación:</b> ${ee}</div>
  <div><b>Teléfono Celular:</b> ${te}</div>
  <div><b>Correo electrónico:</b> ${ae}</div>
  <div><b>Ciudadanía Digital:</b> ${R}</div>

  <div style="margin:16px 0; font-weight:700">DATOS DEL DEMANDADO</div>
  <div><b>Nombres y Apellidos:</b> ${le}</div>
  <div><b>Fecha de Nacimiento:</b> ${ne}</div>
  <div><b>Lugar de Nacimiento:</b> ${se}</div>
  <div><b>Edad:</b> ${de}</div>
  <div><b>C.I.:</b> ${re}</div>
  <div><b>Estado Civil:</b> ${ce}</div>
  <div><b>Grado de Instrucción:</b> ${ue}</div>
  <div><b>Dirección:</b> ${me}</div>
  <div><b>Ocupación:</b> ${fe}</div>
  <div><b>Teléfono Celular:</b> ${pe}</div>
  <div><b>Correo electrónico:</b> ${ye}</div>

  <div style="margin:18px 0; font-weight:700">II. FUNDAMENTO DEL HECHO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">III. FUNDAMENTO DE DERECHO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">IV. PETITORIO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">V. OTROSIS</div>
  <p style="margin:6px 0">...</p>

  <div style="margin-top:24px;">Oruro, ${i()}</div>

  <div style="margin-top:36px;display:flex;justify-content:space-between;">
    <div style="text-align:center;width:45%;">
      __________________________<br>
      NOMBRE Y FIRMA DEL DENUNCIANTE
    </div>
    <div style="text-align:center;width:45%;">
      __________________________<br>
      NOMBRE Y FIRMA DEL ABOGADO
    </div>
  </div>
</div>
  `},dirigido_juzgado(o){const e=_=>_==null||_===""?"—":String(_),d=_=>_===!0||_===1||_==="1"?"Sí":_===!1||_===0||_==="0"?"No":"—",c=_=>{if(!_)return"—";const y=new Date(_);if(isNaN(y.getTime()))return e(_);const $=y.getFullYear(),Q=String(y.getMonth()+1).padStart(2,"0"),_e=String(y.getDate()).padStart(2,"0");return`${$}-${Q}-${_e}`},i=()=>{const _=new Date,y=_.getFullYear(),$=String(_.getMonth()+1).padStart(2,"0");return`${String(_.getDate()).padStart(2,"0")}/${$}/${y}`},r=(_={})=>[_.denunciante_nombres,_.denunciante_paterno,_.denunciante_materno].filter(Boolean).join(" ")||"—",l=(_={})=>[_.denunciado_nombres,_.denunciado_paterno,_.denunciado_materno].filter(Boolean).join(" ")||"—",s=o?.denunciantes&&o.denunciantes[0]?o.denunciantes[0]:{},f=o?.denunciados&&o.denunciados[0]?o.denunciados[0]:{},T=e(o?.principal||o?.caso_tipologia),R=d(o?.documento_ciudadania_digital),H=r(s),j=c(s?.denunciante_fecha_nacimiento),z=e(s?.denunciante_lugar_nacimiento),L=e(s?.denunciante_edad),D=e(s?.denunciante_nro),q=e(s?.denunciante_estado_civil),G=e(s?.denunciante_grado),O=e(s?.denunciante_residencia||s?.denunciante_domicilio_actual||o?.caso_direccion||o?.caso_zona||"ORURO"),ee=e(s?.denunciante_ocupacion),te=e(s?.denunciante_telefono),ae="—",le=l(f),ne=c(f?.denunciado_fecha_nacimiento),se=e(f?.denunciado_lugar_nacimiento||"ORURO"),de=e(f?.denunciado_edad),re=e(f?.denunciado_nro),ce=e(f?.denunciado_estado_civil),ue=e(f?.denunciado_grado||"BACHILLER"),me=e(f?.denunciado_residencia||f?.denunciado_domicilio_actual||"ORURO"),fe=e(f?.denunciado_ocupacion||f?.denunciado_ocupacion_exacto||"—"),pe=e(f?.denunciado_telefono||f?.denunciado_movil||f?.denunciado_fijo);return`
<div style="border:1px solid #333;border-radius:6px;padding:14px;margin-bottom:12px;font-size:13px;line-height:1.35">
  <div style="text-align:center; font-weight:700; font-size:15px; margin-bottom:8px;">
    DIRECCION DE IGUALDAD DE OPORTUNIDADES
  </div>

  <div style="margin-bottom:10px">
    <div><b>A :</b> SEÑOR REPRESENTANTE DEL JUZGADO PUBLICO DE FAMILIA LA CIUDAD DE ORURO</div>
    <div><b>DE :</b> ABG. ${(o?.legal_user?.name||o?.user?.name||"Responsable").toString()}</div>
  </div>

  <div style="margin:14px 0; font-weight:700">I. FORMULACION DE DENUNCIA</div>
  <div style="margin:14px 0; font-weight:700">II. FUNDAMENTO DEL HECHO</div>
  <div style="margin:14px 0; font-weight:700">III. FUNDAMENTO DE DERECHO</div>
  <div style="margin:14px 0; font-weight:700">IV. PETITORIO</div>
  <div style="margin:14px 0; font-weight:700">V. OTROSIS</div>

  <div style="margin:18px 0; font-weight:700">I. FORMULA DENUNCIA POR EL MOTIVO DE :</div>
  <div style="margin:6px 0 14px 0">${T}</div>

  <div style="margin:10px 0; font-weight:700">DATOS GENERALES DEL DENUNCIANTE :</div>
  <div><b>Nombres y Apellidos:</b> ${H}</div>
  <div><b>Fecha de Nacimiento:</b> ${j}</div>
  <div><b>Lugar de Nacimiento:</b> ${z}</div>
  <div><b>Edad:</b> ${L}</div>
  <div><b>C.I.:</b> ${D}</div>
  <div><b>Estado Civil:</b> ${q}</div>
  <div><b>Grado de Instrucción:</b> ${G}</div>
  <div><b>Dirección:</b> ${O}</div>
  <div><b>Ocupación:</b> ${ee}</div>
  <div><b>Teléfono Celular:</b> ${te}</div>
  <div><b>Correo electrónico:</b> ${ae}</div>
  <div><b>Ciudadanía Digital:</b> ${R}</div>

  <div style="margin:16px 0; font-weight:700">DATOS DEL DEMANDADO</div>
  <div><b>Nombres y Apellidos:</b> ${le}</div>
  <div><b>Fecha de Nacimiento:</b> ${ne}</div>
  <div><b>Lugar de Nacimiento:</b> ${se}</div>
  <div><b>Edad:</b> ${de}</div>
  <div><b>C.I.:</b> ${re}</div>
  <div><b>Estado Civil:</b> ${ce}</div>
  <div><b>Grado de Instrucción:</b> ${ue}</div>
  <div><b>Dirección:</b> ${me}</div>
  <div><b>Ocupación:</b> ${fe}</div>
  <div><b>Teléfono Celular:</b> ${pe}</div>
  <div><b>Correo electrónico:</b> —</div>

  <div style="margin:18px 0; font-weight:700">II. FUNDAMENTO DE HECHO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">III. FUNDAMENTO DE DERECHO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">IV. PETITORIO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">V. OTROSIS</div>
  <p style="margin:6px 0">Por un derecho y protección a la Mujer…</p>

  <div style="margin-top:24px;">Oruro, ${i()}</div>

  <div style="margin-top:36px;text-align:center">
    __________________________<br>
    NOMBRE Y FIRMA DEL ABOGADO
  </div>
</div>
  `},dirigido_mp(o){const e=y=>y==null||y===""?"—":String(y),d=y=>y===!0||y===1||y==="1"?"Sí":y===!1||y===0||y==="0"?"No":"—",c=y=>{if(!y)return"—";const $=new Date(y);if(isNaN($.getTime()))return e(y);const Q=$.getFullYear(),_e=String($.getMonth()+1).padStart(2,"0"),Te=String($.getDate()).padStart(2,"0");return`${Q}-${_e}-${Te}`},i=()=>{const y=new Date,$=y.getFullYear(),Q=String(y.getMonth()+1).padStart(2,"0");return`${String(y.getDate()).padStart(2,"0")}/${Q}/${$}`},r=(y={})=>[y.denunciante_nombres,y.denunciante_paterno,y.denunciante_materno].filter(Boolean).join(" ")||"—",l=(y={})=>[y.denunciado_nombres,y.denunciado_paterno,y.denunciado_materno].filter(Boolean).join(" ")||"—",s=o?.denunciantes&&o.denunciantes[0]?o.denunciantes[0]:{},f=o?.denunciados&&o.denunciados[0]?o.denunciados[0]:{},T=e(o?.principal||o?.caso_tipologia),R=d(o?.documento_ciudadania_digital),H=r(s),j=c(s?.denunciante_fecha_nacimiento),z=e(s?.denunciante_lugar_nacimiento),L=e(s?.denunciante_edad),D=e(s?.denunciante_nro),q=e(s?.denunciante_estado_civil),G=e(s?.denunciante_grado),O=e(s?.denunciante_residencia||o?.caso_direccion),ee=e(s?.denunciante_ocupacion),te=e(s?.denunciante_telefono),ae="—",le=l(f),ne=c(f?.denunciado_fecha_nacimiento),se=e(f?.denunciado_lugar_nacimiento),de=e(f?.denunciado_edad),re=e(f?.denunciado_nro),ce=e(f?.denunciado_estado_civil),ue=e(f?.denunciado_grado),me=e(f?.denunciado_residencia||f?.denunciado_domicilio_actual),fe=e(f?.denunciado_ocupacion||f?.denunciado_ocupacion_exacto),pe=e(f?.denunciado_telefono||f?.denunciado_movil||f?.denunciado_fijo);return`
<div style="border:1px solid #333;border-radius:6px;padding:14px;margin-bottom:12px;font-size:13px;line-height:1.35">

  <div style="margin-bottom:10px">
    <div><b>A :</b> SEÑOR REPRESENTANTE DEL JUZGADO PUBLICO DE FAMILIA LA CIUDAD DE ORURO</div>
    <div><b>DE :</b> ${`ABG. ${(o?.legal_user?.name||o?.user?.name||"Responsable").toString()}`}</div>
  </div>

  <div style="margin:14px 0; font-weight:700">I. FORMULACION DE DENUNCIA</div>
  <div style="margin:14px 0; font-weight:700">II. FUNDAMENTO DEL HECHO</div>
  <div style="margin:14px 0; font-weight:700">III. FUNDAMENTO DE DERECHO</div>
  <div style="margin:14px 0; font-weight:700">IV. PETITORIO</div>
  <div style="margin:14px 0; font-weight:700">V. OTROSIS</div>

  <div style="margin:18px 0; font-weight:700">I. FORMULA DENUNCIA POR EL MOTIVO DE :</div>
  <div style="margin:6px 0 14px 0">${T}</div>

  <div style="margin:10px 0; font-weight:700">DATOS GENERALES DEL DENUNCIANTE :</div>
  <div><b>Nombres y Apellidos:</b> ${H}</div>
  <div><b>Fecha de Nacimiento:</b> ${j}</div>
  <div><b>Lugar de Nacimiento:</b> ${z}</div>
  <div><b>Edad:</b> ${L}</div>
  <div><b>C.I.:</b> ${D}</div>
  <div><b>Estado Civil:</b> ${q}</div>
  <div><b>Grado de Instrucción:</b> ${G}</div>
  <div><b>Dirección:</b> ${O}</div>
  <div><b>Ocupación:</b> ${ee}</div>
  <div><b>Teléfono Celular:</b> ${te}</div>
  <div><b>Correo electrónico:</b> ${ae}</div>
  <div><b>Ciudadanía Digital:</b> ${R}</div>

  <div style="margin:16px 0; font-weight:700">DATOS DEL DEMANDADO</div>
  <div><b>Nombres y Apellidos:</b> ${le}</div>
  <div><b>Fecha de Nacimiento:</b> ${ne}</div>
  <div><b>Lugar de Nacimiento:</b> ${se}</div>
  <div><b>Edad:</b> ${de}</div>
  <div><b>C.I.:</b> ${re}</div>
  <div><b>Estado Civil:</b> ${ce}</div>
  <div><b>Grado de Instrucción:</b> ${ue}</div>
  <div><b>Dirección:</b> ${me}</div>
  <div><b>Ocupación:</b> ${fe}</div>
  <div><b>Teléfono Celular:</b> ${pe}</div>
  <div><b>Correo electrónico:</b> —</div>

  <div style="margin:18px 0; font-weight:700">II. FUNDAMENTO DE HECHO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">III. FUNDAMENTO DE DERECHO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">IV. PETITORIO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">V. OTROSIS</div>
  <p style="margin:6px 0">Por un derecho y protección a la Mujer…</p>

  <div style="margin-top:24px;">Oruro, ${i()}</div>

  <div style="margin-top:36px;text-align:center">
    __________________________<br>
    NOMBRE Y FIRMA DEL ABOGADO
  </div>
</div>
  `},denuncia_mp(o={}){const e=(f,T="—")=>f==null||f===""?T:f,d=o.denunciante||{},c=o.denunciado||{},i=o.anexos&&o.anexos.length?o.anexos:["Formulario de Registro domiciliario de la denunciante.","Formulario de Registro domiciliario del denunciado.","Croquis denunciante.","Croquis del denunciado.","Fotocopia simple de la Cédula de Identidad de la denunciante.","Fotocopia simple de la Cédula de Identidad del denunciado.","Informe Psicológico emitido por profesional de la D.I.O."],r=e(o.ciudad,"ORURO"),l=e(o.fecha);return e(o.numero),`
<div style="font-size:12px; line-height:1.35">
  <!-- Encabezado simple DomPDF-friendly -->
  <div style="border:1px solid #333;border-radius:6px;padding:10px;margin-bottom:10px;">
    <div style="font-weight:700">DIRECCIÓN DE IGUALDAD DE OPORTUNIDADES — DEFENSORÍA DE LA NIÑEZ Y ADOLESCENCIA</div>
    <div style="font-size:11px;color:#555">SERVICIO LEGAL INTEGRAL MUNICIPAL</div>
  </div>

  <div style="text-align:center; font-weight:700; text-transform:uppercase; margin-top:4px;">
    ${e(o.fiscaliaTitulo,"SEÑOR REPRESENTANTE DEL MINISTERIO PÚBLICO DE LA CIUDAD DE ORURO")}
  </div>

  <div style="margin:10px 0 6px 0;">
    <b>I.</b>&nbsp; <b>FORMULA DENUNCIA POR EL DELITO DE ABUSO SEXUAL</b>, SOLICITANDO EL LEVANTAMIENTO DE DILIGENCIAS PRELIMINARES Y SE PROCEDA CONFORME A LEY.
  </div>

  <div style="margin:6px 0;">
    <b>II.</b>&nbsp; <b>FUNDAMENTO DE HECHO</b>
  </div>

  <div style="margin:6px 0;">
    <b>III.</b>&nbsp; <b>FUNDAMENTO DE DERECHO</b>
  </div>

  <div style="margin:6px 0;">
    <b>IV.</b>&nbsp; <b>PETITORIO</b>
  </div>

  <div style="margin:6px 0;">
    <b>V.</b>&nbsp; <b>OTROSÍES</b>
  </div>

  <hr style="margin:10px 0;">

  <!-- Datos Generales de Denunciante -->
  <h5 style="margin:6px 0 4px 0;">DATOS GENERALES DE DENUNCIANTE</h5>
  <table style="width:100%; border-collapse:collapse; font-size:12px">
    <tr><td style="width:35%"><b>Nombres y apellidos:</b></td><td>${e(d.nombre)}</td></tr>
    <tr><td><b>Fecha de nacimiento:</b></td><td>${e(d.fecha_nac)}</td></tr>
    <tr><td><b>Lugar de nacimiento:</b></td><td>${e(d.lugar_nac)}</td></tr>
    <tr><td><b>Cédula de identidad:</b></td><td>${e(d.ci)}</td></tr>
    <tr><td><b>Edad:</b></td><td>${e(d.edad)}</td></tr>
    <tr><td><b>Ocupación:</b></td><td>${e(d.ocupacion)}</td></tr>
    <tr><td><b>Estado Civil:</b></td><td>${e(d.estado_civil)}</td></tr>
    <tr><td><b>Domicilio:</b></td><td>${e(d.domicilio)}</td></tr>
    <tr><td><b>Teléfono Celular:</b></td><td>${e(d.celular)}</td></tr>
    <tr><td><b>Correo electrónico:</b></td><td>${e(d.correo)}</td></tr>
    <tr><td><b>Ciudadanía Digital:</b></td><td>${e(o.ciudadania_digital_denunciante)}</td></tr>
  </table>

  <h5 style="margin:12px 0 4px 0;">DATOS GENERALES DEL DENUNCIADO</h5>
  <table style="width:100%; border-collapse:collapse; font-size:12px">
    <tr><td style="width:35%"><b>Nombres y apellidos:</b></td><td>${e(c.nombre)}</td></tr>
    <tr><td><b>Fecha de nacimiento:</b></td><td>${e(c.fecha_nac)}</td></tr>
    <tr><td><b>Nacionalidad:</b></td><td>${e(c.nacionalidad,"Boliviana")}</td></tr>
    <tr><td><b>Cédula de identidad:</b></td><td>${e(c.ci)}</td></tr>
    <tr><td><b>Ocupación:</b></td><td>${e(c.ocupacion)}</td></tr>
    <tr><td><b>Estado Civil:</b></td><td>${e(c.estado_civil)}</td></tr>
    <tr><td><b>Domicilio:</b></td><td>${e(c.domicilio)}</td></tr>
    <tr><td><b>Teléfono Celular:</b></td><td>${e(c.celular)}</td></tr>
    <tr><td><b>Correo electrónico:</b></td><td>${e(c.correo,"Se desconoce")}</td></tr>
  </table>

  <h5 style="margin:12px 0 4px 0;">II. FUNDAMENTO DE HECHO — RELACIÓN CIRCUNSTANCIADA</h5>
  <p style="text-align:justify;">
    ${e(o.relato,"La denunciante refiere los hechos ocurridos, consignando fechas, lugares, personas involucradas y las acciones desplegadas.")}
  </p>

  <h5 style="margin:12px 0 4px 0;">III. FUNDAMENTO DE DERECHO</h5>
  <div style="margin-left:6px">
    <div style="margin:4px 0;"><b>a) DE LA CONSTITUCIÓN POLÍTICA DEL ESTADO — Artículo 15</b></div>
    <ul style="margin:0 0 0 16px;">
      <li>Toda persona tiene derecho a la vida y a la integridad física, psicológica y sexual. Nadie será torturado ni sufrirá tratos crueles, inhumanos, degradantes u humillantes.</li>
      <li>Las personas, en particular las mujeres, tienen derecho a no sufrir violencia física, sexual o psicológica.</li>
      <li>El Estado adoptará medidas para prevenir, eliminar y sancionar la violencia de género.</li>
    </ul>

    <div style="margin:8px 0 4px 0;"><b>b) DE LA LEY 348 — Artículo 83 (modifica el Código Penal)</b></div>
    <div style="margin:0 0 6px 0;">Se adecúan tipos penales y se agravan penas cuando la víctima es niña, niño o adolescente.</div>

    <div style="margin:4px 0;"><b>c) CÓDIGO PENAL — Artículo 312 (Abuso Sexual)</b></div>
    <div>Cuando, en las circunstancias previstas por ley, se realicen actos sexuales no constitutivos de penetración o acceso carnal, la pena será de seis (6) a diez (10) años de privación de libertad.</div>

    ${o.fundamentos_derecho_extra?`<div style="margin-top:8px;">${o.fundamentos_derecho_extra}</div>`:""}
  </div>

  <h5 style="margin:12px 0 4px 0;">IV. PETITORIO</h5>
  <p style="text-align:justify;">
    Por lo expuesto y al amparo de las normas citadas, solicito se admita la presente DENUNCIA por el delito de ABUSO SEXUAL, se disponga el levantamiento de diligencias preliminares y se remitan las actuaciones que correspondan, a efectos de que el hecho no quede impune, determinando responsabilidades conforme a derecho.
    ${o.petitorio_extra?` ${o.petitorio_extra}`:""}
  </p>

  <h5 style="margin:12px 0 4px 0;">V. OTROSÍ 1º — Prueba literal</h5>
  <ul style="margin:0 0 0 16px;">
    ${i.map(f=>`<li>${f}</li>`).join("")}
  </ul>

  <h5 style="margin:10px 0 4px 0;">OTROSÍ 2º — Medidas de protección</h5>
  <p>Al amparo de la Ley 348, solicito se evalúen medidas de protección a favor de la víctima y su entorno familiar para precautelar el normal desenvolvimiento de sus actividades.</p>

  <h5 style="margin:10px 0 4px 0;">OTROSÍ 3º — Domicilio procesal y contactos</h5>
  <table style="width:100%; border-collapse:collapse; font-size:12px">
    <tr><td style="width:30%"><b>Ciudadanía digital (víctima):</b></td><td>${e(o.ciudadania_digital_denunciante)}</td></tr>
    <tr><td><b>WhatsApp (víctima):</b></td><td>${e(d.celular)}</td></tr>
    <tr><td><b>Correo electrónico (víctima):</b></td><td>${e(d.correo)}</td></tr>
    <tr><td><b>Ciudadanía digital (abogado/a):</b></td><td>${e(o.abogado?.ciudadania)}</td></tr>
    <tr><td><b>Correo electrónico (abogado/a):</b></td><td>${e(o.abogado?.correo)}</td></tr>
    <tr><td><b>Celular / WhatsApp (abogado/a):</b></td><td>${e(o.abogado?.whatsapp)}</td></tr>
  </table>

  <div style="margin-top:18px;">
    ${e(r)}, ${l||"___ de __________ de _____"}
  </div>

  <div style="margin-top:26px; display:flex; justify-content:space-between;">
    <div style="text-align:center; width:45%;">
      __________________________<br/>
      Firma Denunciante
    </div>
    <div style="text-align:center; width:45%;">
      __________________________<br/>
      Abg. ${e(o.abogado?.nombre,"Responsable")}
    </div>
  </div>
</div>
`}},Si={name:"Informes",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:null}},data(){return{openSubirArchivo:!1,file:null,loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dialog:!1,mode:"create",form:{id:null,fecha:"",titulo:"",area:"psicologico",numero:"",contenido_html:""},plantilla:"dirigido_mp",plantillasOptions:[{label:"Dirigido a Ministerio Público",value:"dirigido_mp",disabled:!0},{label:"Dirigido a Juzgado",value:"dirigido_juzgado",disabled:!0},{label:"Dirigido a Otros",value:"dirigido_otros",disabled:!0}],areas:[{label:"Psicológico",value:"psicologico"},{label:"Legal",value:"legal"},{label:"Social",value:"social"}]}},methods:{today(){const o=new Date,e=d=>String(d).padStart(2,"0");return`${o.getFullYear()}-${e(o.getMonth()+1)}-${e(o.getDate())}`},guardarInforme(){if(!this.file){this.$q.notify({type:"negative",message:"Seleccione un archivo"});return}if(!this.form.titulo){this.$q.notify({type:"negative",message:"El título es obligatorio"});return}const o=new FormData;o.append("titulo",this.form.titulo),o.append("file",this.file),o.append("case_id",this.caseId),o.append("tipo","legal"),this.saving=!0,this.$axios.post(`/casos/${this.caseId}/uploadFile`,o,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{this.$q.notify({type:"positive",message:"Informe subido"}),this.openSubirArchivo=!1,this.file=null,this.form.titulo="",this.$emit("refresh")}).catch(e=>{this.$q.notify({type:"negative",message:e?.response?.data?.message||"No se pudo subir el informe"})}).finally(()=>{this.saving=!1})},onFileChange(o){this.file=o},openSubirInforme(){this.openSubirArchivo=!0},openCreate(){this.mode="create",this.form={id:null,fecha:this.today(),titulo:"",area:"psicologico",numero:"",contenido_html:""},this.dialog=!0,this.$nextTick(()=>this.applyTemplate(this.plantilla))},openFile(o){window.open(this.$url+"/.."+o.archivo,"_blank")},openView(o){this.mode="view",this.form={...o},this.dialog=!0},openEdit(o){this.mode="edit",this.form={...o},this.dialog=!0},applyTemplate(o){this.mode!=="view"&&(this.form.contenido_html="",o==="dirigido_mp"&&(this.form.contenido_html=Ne.dirigido_mp(this.caso)),o==="dirigido_juzgado"&&(this.form.contenido_html=Ne.dirigido_juzgado(this.caso)),o==="dirigido_otros"&&(this.form.contenido_html=Ne.dirigido_otros(this.caso)))},async save(){if(!this.form.titulo)return this.$q.notify({type:"negative",message:"El título es obligatorio"});if(!this.form.contenido_html)return this.$q.notify({type:"negative",message:"El contenido está vacío"});this.saving=!0;try{this.form.id?await this.$axios.put(`/informes-legales/${this.form.id}`,this.form):await this.$axios.post(`/casos/${this.caseId}/informes-legales`,this.form),this.$q.notify({type:"positive",message:"Guardado"}),this.$emit("refresh"),this.dialog=!1}catch(o){this.$q.notify({type:"negative",message:o?.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}},removeIt(o){const e=async()=>{try{await this.$axios.delete(`/informes-legales/${o.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.$emit("refresh")}catch(d){this.$q.notify({type:"negative",message:d?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar el informe?").onOk(e):confirm("¿Eliminar el informe?")&&e()},printPdf(o){const e=this.$url||"";window.open(`${e}/informes/${o.id}/pdf`,"_blank")}}},ki={class:"row items-center q-mb-sm"},Ui={class:"col"},Ti={class:"text-caption text-grey-7"},Ri={class:"col-auto row items-center q-gutter-sm"},Li={key:0},qi={class:"text-subtitle1"},$i={class:"row"},Pi={class:"col-12 col-md-3"},Fi={class:"col-12 col-md-5"},Mi={class:"col-6 col-md-2"},ji={class:"col-6 col-md-2"},zi={key:0};function Gi(o,e,d,c,i,r){return u(),v(k,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[a("div",ki,[a("div",Ui,[e[12]||(e[12]=a("div",{class:"text-subtitle1 text-weight-medium"},"Informes",-1)),a("div",Ti,"Vinculados al caso #"+m(d.caseId),1)]),a("div",Ri,[t(p,{dense:"",outlined:"",modelValue:i.search,"onUpdate:modelValue":e[0]||(e[0]=l=>i.search=l),placeholder:"Buscar...",style:{width:"260px"}},{append:n(()=>[t(A,{name:"search"})]),_:1},8,["modelValue"]),t(g,{flat:"",color:"primary",icon:"refresh",loading:i.loading,onClick:e[1]||(e[1]=l=>o.$emit("refresh"))},null,8,["loading"]),t(g,{color:"green",icon:"add_circle_outline","no-caps":"",label:"Crear Memorial",onClick:r.openCreate},null,8,["onClick"]),t(g,{color:"primary",icon:"upload","no-caps":"",label:"Subir Memorial",onClick:r.openSubirInforme},null,8,["onClick"])])]),t(V),t(ie,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:n(()=>[e[19]||(e[19]=a("thead",null,[a("tr",{class:"bg-primary text-white"},[a("th",{style:{width:"70px"}},"ID"),a("th",{style:{width:"140px"}},"Acciones"),a("th",null,"Título"),a("th",{style:{width:"120px"}},"Fecha"),a("th",{style:{width:"130px"}},"Área"),a("th",{style:{width:"120px"}},"Nro"),a("th",{style:{width:"180px"}},"Usuario")])],-1)),a("tbody",null,[(u(!0),h(U,null,F(d.caso.informes_legales,l=>(u(),h("tr",{key:l.id},[a("td",null,"#"+m(l.id),1),a("td",null,[t(ve,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:n(()=>[l.archivo?E((u(),v(w,{key:1,clickable:"",onClick:s=>r.openFile(l)},{default:n(()=>[t(b,{avatar:""},{default:n(()=>[t(A,{name:"download"})]),_:1}),t(b,null,{default:n(()=>e[16]||(e[16]=[C(" Descargar informe ")])),_:1})]),_:2},1032,["onClick"])),[[x]]):(u(),h(U,{key:0},[E((u(),v(w,{clickable:"",onClick:s=>r.openView(l)},{default:n(()=>[t(b,{avatar:""},{default:n(()=>[t(A,{name:"visibility"})]),_:1}),t(b,null,{default:n(()=>e[13]||(e[13]=[C("Ver")])),_:1})]),_:2},1032,["onClick"])),[[x]]),E((u(),v(w,{clickable:"",onClick:s=>r.printPdf(l)},{default:n(()=>[t(b,{avatar:""},{default:n(()=>[t(A,{name:"print"})]),_:1}),t(b,null,{default:n(()=>e[14]||(e[14]=[C("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[x]]),t(V),E((u(),v(w,{clickable:"",onClick:s=>r.openEdit(l)},{default:n(()=>[t(b,{avatar:""},{default:n(()=>[t(A,{name:"edit"})]),_:1}),t(b,null,{default:n(()=>e[15]||(e[15]=[C("Editar")])),_:1})]),_:2},1032,["onClick"])),[[x]])],64)),E((u(),v(w,{clickable:"",onClick:s=>r.removeIt(l)},{default:n(()=>[t(b,{avatar:""},{default:n(()=>[t(A,{name:"delete",color:"negative"})]),_:1}),t(b,{class:"text-negative"},{default:n(()=>e[17]||(e[17]=[C("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[x]])]),_:2},1024)]),a("td",null,m(l.titulo),1),a("td",null,m(l.fecha||"s/f"),1),a("td",null,m(l.area||"—"),1),a("td",null,m(l.numero||"—"),1),a("td",null,m(l.user?.name||l.user?.username||"—"),1)]))),128)),d.caso.informes_legales.length?I("",!0):(u(),h("tr",Li,e[18]||(e[18]=[a("td",{colspan:"7",class:"text-center text-grey"},"Sin registros",-1)])))])]),_:1}),t(K,{modelValue:i.dialog,"onUpdate:modelValue":e[8]||(e[8]=l=>i.dialog=l),persistent:"",maximized:""},{default:n(()=>[t(k,null,{default:n(()=>[t(Ue,{class:"bg-white text-dark"},{default:n(()=>[a("div",qi,m(i.mode==="view"?"Ver informe":i.form.id?"Editar informe":"Nuevo informe"),1),t(W),E(t(g,{flat:"",dense:"",round:"",icon:"close"},null,512),[[x]])]),_:1}),t(V),t(S,{class:"q-gutter-md"},{default:n(()=>[a("div",$i,[a("div",Pi,[t(p,{modelValue:i.form.fecha,"onUpdate:modelValue":e[2]||(e[2]=l=>i.form.fecha=l),type:"date",dense:"",outlined:"",label:"Fecha",readonly:i.mode==="view"},null,8,["modelValue","readonly"])]),a("div",Fi,[t(p,{modelValue:i.form.titulo,"onUpdate:modelValue":e[3]||(e[3]=l=>i.form.titulo=l),dense:"",outlined:"",label:"Título *",readonly:i.mode==="view",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","readonly","rules"])]),a("div",Mi,[t(Y,{modelValue:i.form.area,"onUpdate:modelValue":e[4]||(e[4]=l=>i.form.area=l),options:i.areas,dense:"",outlined:"",label:"Área",readonly:i.mode==="view","emit-value":"","map-options":""},null,8,["modelValue","options","readonly"])]),a("div",ji,[t(p,{modelValue:i.form.numero,"onUpdate:modelValue":e[5]||(e[5]=l=>i.form.numero=l),dense:"",outlined:"",label:"Nro",readonly:i.mode==="view"},null,8,["modelValue","readonly"])])]),i.mode!=="view"?(u(),h("div",zi,[t(Y,{modelValue:i.plantilla,"onUpdate:modelValue":[e[6]||(e[6]=l=>i.plantilla=l),r.applyTemplate],options:i.plantillasOptions,label:"Plantilla",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])])):I("",!0),a("div",null,[e[20]||(e[20]=a("div",{class:"text-caption text-grey-7 q-mb-xs"},"Contenido (WYSIWYG / guarda HTML)",-1)),t(Ve,{modelValue:i.form.contenido_html,"onUpdate:modelValue":e[7]||(e[7]=l=>i.form.contenido_html=l),readonly:i.mode==="view","min-height":"320px",placeholder:"Escriba el informe...",toolbar:[["left","center","right","justify"],["bold","italic","strike","underline"],["quote","unordered","ordered","outdent","indent"],["hr","link"],["undo","redo"],["removeFormat"]]},null,8,["modelValue","readonly"])])]),_:1}),t(V),t(Z,{align:"right"},{default:n(()=>[E(t(g,{flat:"",label:"Cerrar"},null,512),[[x]]),i.mode!=="view"?(u(),v(g,{key:0,color:"primary",label:"Guardar",loading:i.saving,onClick:r.save},null,8,["loading","onClick"])):I("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(K,{modelValue:i.openSubirArchivo,"onUpdate:modelValue":e[11]||(e[11]=l=>i.openSubirArchivo=l),persistent:""},{default:n(()=>[t(k,{style:{"max-width":"500px",width:"90vw"}},{default:n(()=>[t(S,{class:"row items-center q-pb-none"},{default:n(()=>[e[21]||(e[21]=a("div",{class:"text-subtitle1"},"Subir informe",-1)),t(W),E(t(g,{flat:"",round:"",dense:"",icon:"close"},null,512),[[x]])]),_:1}),t(S,{class:"q-gutter-md"},{default:n(()=>[e[22]||(e[22]=a("div",{class:"text-body2 q-mb-sm"}," Aquí puede subir un informe ya elaborado en formato PDF, Word, OpenDocument o imagen. ",-1)),t(p,{modelValue:i.form.titulo,"onUpdate:modelValue":e[9]||(e[9]=l=>i.form.titulo=l),dense:"",outlined:"",label:"Titulo de Memorial *",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","rules"]),t(be,{modelValue:i.file,"onUpdate:modelValue":[e[10]||(e[10]=l=>i.file=l),r.onFileChange],label:"Seleccionar archivo",outlined:"",dense:"",accept:".pdf,.doc,.docx,.odt,.png,.jpg,.jpeg"},null,8,["modelValue","onUpdate:modelValue"]),t(g,{color:"primary",label:"Guardar",disabled:!i.file||!i.form.titulo,onClick:r.guardarInforme},null,8,["disabled","onClick"])]),_:1}),t(V),t(Z,{align:"right"},{default:n(()=>[E(t(g,{flat:"",label:"Cerrar"},null,512),[[x]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Bi=M(Si,[["render",Gi]]),Hi={name:"ApoyoIntegral",props:{caseId:{type:[String,Number],required:!0}}},Ji={class:"text-grey-7"};function Qi(o,e,d,c,i,r){return u(),v(k,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[e[0]||(e[0]=a("div",{class:"text-subtitle1 text-weight-medium q-mb-sm"},"Apoyo integral",-1)),a("div",Ji,"DIO personal, descripción, impresión (ID: "+m(d.caseId)+")",1)]),_:1})}const Yi=M(Hi,[["render",Qi]]),Zi={name:"DocumentosGeneral",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:()=>({})}},data(){return{loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dlgUpload:!1,file:null,meta:{titulo:"",categoria:"",descripcion:""},accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.odt,.ods,.txt,.zip,.jpg,.jpeg,.png,.webp",dlgEdit:!1,edit:{},editingId:null}},methods:{openUpload(){this.file=null,this.meta={titulo:"",categoria:"",descripcion:""},this.dlgUpload=!0},async upload(){if(!this.file){this.$q.notify({type:"negative",message:"Seleccione un archivo"});return}this.saving=!0;try{const o=new FormData;o.append("file",this.file),this.meta.titulo&&o.append("titulo",this.meta.titulo),this.meta.categoria&&o.append("categoria",this.meta.categoria),this.meta.descripcion&&o.append("descripcion",this.meta.descripcion),await this.$axios.post(`/casos/${this.caseId}/documentos`,o,{headers:{"Content-Type":"multipart/form-data"}}),this.$q.notify({type:"positive",message:"Archivo subido"}),this.dlgUpload=!1,this.$emit("refresh")}catch(o){this.$q.notify({type:"negative",message:o?.response?.data?.message||"No se pudo subir"})}finally{this.saving=!1}},viewDoc(o){const e=this.$url||"";window.open(`${e}/documentos/${o.id}/view`,"_blank")},downloadDoc(o){const e=this.$url||"";console.log("url",`${e}/documentos/${o.id}/download`)},editMeta(o){this.editingId=o.id,this.edit={titulo:o.titulo,categoria:o.categoria,descripcion:o.descripcion},this.dlgEdit=!0},async saveMeta(){this.saving=!0;try{await this.$axios.put(`/documentos/${this.editingId}`,this.edit),this.$q.notify({type:"positive",message:"Actualizado"}),this.dlgEdit=!1,this.$emit("refresh")}catch(o){this.$q.notify({type:"negative",message:o?.response?.data?.message||"No se pudo actualizar"})}finally{this.saving=!1}},removeDoc(o){const e=async()=>{try{await this.$axios.delete(`/documentos/${o.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.$emit("refresh")}catch(d){this.$q.notify({type:"negative",message:d?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar el documento?").onOk(e):confirm("¿Eliminar el documento?")&&e()}}},Wi={class:"row items-center q-mb-sm"},Xi={class:"col"},Ki={class:"text-caption text-grey-7"},et={class:"col-auto row items-center q-gutter-sm"},ot={class:"text-weight-medium"},it={key:0};function tt(o,e,d,c,i,r){return u(),v(k,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[a("div",Wi,[a("div",Xi,[e[8]||(e[8]=a("div",{class:"text-subtitle1 text-weight-medium"},"Documentos (General)",-1)),a("div",Ki,"Gestión de adjuntos del caso #"+m(d.caseId),1)]),a("div",et,[t(g,{flat:"",color:"primary",icon:"refresh",loading:i.loading,onClick:e[0]||(e[0]=l=>o.$emit("refresh"))},null,8,["loading"]),t(g,{color:"green",icon:"upload","no-caps":"",label:"Subir archivo",onClick:r.openUpload},null,8,["onClick"])])]),t(V),t(ie,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:n(()=>[e[14]||(e[14]=a("thead",null,[a("tr",{class:"bg-primary text-white"},[a("th",{style:{width:"70px"}},"ID"),a("th",{style:{width:"160px"}},"Acciones"),a("th",null,"Título"),a("th",{style:{width:"120px"}},"Tamaño"),a("th",{style:{width:"160px"}},"Tipo"),a("th",{style:{width:"180px"}},"Usuario")])],-1)),a("tbody",null,[(u(!0),h(U,null,F(d.caso.documentos,l=>(u(),h("tr",{key:l.id},[a("td",null,"#"+m(l.id),1),a("td",null,[t(ve,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:n(()=>[E((u(),v(w,{clickable:"",onClick:s=>r.viewDoc(l)},{default:n(()=>[t(b,{avatar:""},{default:n(()=>[t(A,{name:"visibility"})]),_:1}),t(b,null,{default:n(()=>e[9]||(e[9]=[C("Ver")])),_:1})]),_:2},1032,["onClick"])),[[x]]),E((u(),v(w,{clickable:"",onClick:s=>r.downloadDoc(l)},{default:n(()=>[t(b,{avatar:""},{default:n(()=>[t(A,{name:"download"})]),_:1}),t(b,null,{default:n(()=>e[10]||(e[10]=[C("Descargar")])),_:1})]),_:2},1032,["onClick"])),[[x]]),t(V),E((u(),v(w,{clickable:"",onClick:s=>r.editMeta(l)},{default:n(()=>[t(b,{avatar:""},{default:n(()=>[t(A,{name:"edit"})]),_:1}),t(b,null,{default:n(()=>e[11]||(e[11]=[C("Editar")])),_:1})]),_:2},1032,["onClick"])),[[x]]),E((u(),v(w,{clickable:"",onClick:s=>r.removeDoc(l)},{default:n(()=>[t(b,{avatar:""},{default:n(()=>[t(A,{name:"delete",color:"negative"})]),_:1}),t(b,{class:"text-negative"},{default:n(()=>e[12]||(e[12]=[C("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[x]])]),_:2},1024)]),a("td",ot,m(l.titulo),1),a("td",null,m(l.size_human),1),a("td",null,m(l.mime||l.extension),1),a("td",null,m(l.user?.name||l.user?.username||"—"),1)]))),128)),!d.caso.documentos.length&&!i.loading?(u(),h("tr",it,e[13]||(e[13]=[a("td",{colspan:"7",class:"text-center text-grey"},"Sin registros",-1)]))):I("",!0)])]),_:1}),t(K,{modelValue:i.dlgUpload,"onUpdate:modelValue":e[4]||(e[4]=l=>i.dlgUpload=l),persistent:""},{default:n(()=>[t(k,{style:{"max-width":"700px",width:"95vw"}},{default:n(()=>[t(S,{class:"row items-center q-pb-none"},{default:n(()=>[e[15]||(e[15]=a("div",{class:"text-subtitle1"},"Subir archivo",-1)),t(W),E(t(g,{flat:"",dense:"",round:"",icon:"close"},null,512),[[x]])]),_:1}),t(S,{class:"q-gutter-md"},{default:n(()=>[t(p,{modelValue:i.meta.titulo,"onUpdate:modelValue":e[1]||(e[1]=l=>i.meta.titulo=l),label:"Título",outlined:"",dense:""},null,8,["modelValue"]),t(p,{modelValue:i.meta.descripcion,"onUpdate:modelValue":e[2]||(e[2]=l=>i.meta.descripcion=l),type:"textarea",label:"Descripción",outlined:"",dense:"",autogrow:""},null,8,["modelValue"]),t(be,{modelValue:i.file,"onUpdate:modelValue":e[3]||(e[3]=l=>i.file=l),outlined:"",dense:"","use-chips":"",clearable:!0,accept:i.accept,hint:"Hasta 20MB. PDF, Word, Excel, imágenes, etc."},null,8,["modelValue","accept"])]),_:1}),t(Z,{align:"right"},{default:n(()=>[E(t(g,{flat:"",label:"Cancelar"},null,512),[[x]]),t(g,{color:"primary",label:"Subir",loading:i.saving,onClick:r.upload},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(K,{modelValue:i.dlgEdit,"onUpdate:modelValue":e[7]||(e[7]=l=>i.dlgEdit=l)},{default:n(()=>[t(k,{style:{"max-width":"600px",width:"95vw"}},{default:n(()=>[t(S,{class:"row items-center q-pb-none"},{default:n(()=>[e[16]||(e[16]=a("div",{class:"text-subtitle1"},"Editar metadatos",-1)),t(W),E(t(g,{flat:"",dense:"",round:"",icon:"close"},null,512),[[x]])]),_:1}),t(S,{class:"q-gutter-md"},{default:n(()=>[t(p,{modelValue:i.edit.titulo,"onUpdate:modelValue":e[5]||(e[5]=l=>i.edit.titulo=l),label:"Título",outlined:"",dense:""},null,8,["modelValue"]),t(p,{modelValue:i.edit.descripcion,"onUpdate:modelValue":e[6]||(e[6]=l=>i.edit.descripcion=l),type:"textarea",label:"Descripción",outlined:"",dense:"",autogrow:""},null,8,["modelValue"])]),_:1}),t(Z,{align:"right"},{default:n(()=>[E(t(g,{flat:"",label:"Cancelar"},null,512),[[x]]),t(g,{color:"primary",label:"Guardar",loading:i.saving,onClick:r.saveMeta},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const at=M(Zi,[["render",tt]]),lt={name:"Fotografias",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,required:!1}},data(){return{rows:{data:[],last_page:1},page:1,perPage:12,loading:!1,uploading:!1,dialog:{show:!1,titulo:"",file:null,fileName:""}}},methods:{toPublicUrl(o){return o?/^https?:\/\//i.test(o)?o:`${(this.$url||"").replace(/\/api\/?$/,"")}${o}`:""},openDialog(){this.dialog.show=!0,this.dialog.titulo="",this.dialog.file=null,this.dialog.fileName="",this.$refs.file&&(this.$refs.file.value="")},closeDialog(){this.uploading||(this.dialog.show=!1)},triggerFile(){this.$refs.file&&this.$refs.file.click()},onFileChosen(o){const e=o.target.files?.[0];if(!e){this.dialog.file=null,this.dialog.fileName="";return}this.dialog.file=e,this.dialog.fileName=e.name},async upload(){const o=this.dialog.file,e=this.dialog.titulo.trim();if(!o){this.$q.notify({type:"negative",message:"Selecciona un archivo de imagen"});return}if(!e){this.$q.notify({type:"negative",message:"Escribe un título para la fotografía"});return}this.uploading=!0;try{const d=new FormData;d.append("file",o),d.append("titulo",e),await this.$axios.post(`/casos/${this.caseId}/fotografias`,d,{headers:{"Content-Type":"multipart/form-data"}}),this.$q.notify({type:"positive",message:"Foto subida"}),this.dialog.show=!1,this.$emit("refresh")}catch(d){this.$q.notify({type:"negative",message:d?.response?.data?.message||"No se pudo subir"})}finally{this.uploading=!1,this.$refs.file&&(this.$refs.file.value=""),this.dialog.file=null,this.dialog.fileName=""}},async remove(o){if(confirm("¿Eliminar foto?"))try{await this.$axios.delete(`/fotografias/${o.id}`),this.$q.notify({type:"positive",message:"Eliminada"}),this.$emit("refresh")}catch(e){this.$q.notify({type:"negative",message:e?.response?.data?.message||"No se pudo eliminar"})}},view(o){o&&window.open(o,"_blank")}}},nt={class:"row items-center q-mb-sm"},st={class:"col"},dt={class:"text-caption text-grey-7"},rt={class:"col-auto"},ct={class:"row q-col-gutter-md q-mt-sm"},ut={class:"absolute-bottom text-subtitle2 bg-black bg-opacity-40 q-pa-xs ellipsis"},mt={key:0,class:"text-caption q-mt-xs ellipsis"},ft={key:1,class:"text-caption text-grey-7 q-mt-xs"};function pt(o,e,d,c,i,r){return u(),v(k,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[a("div",nt,[a("div",st,[e[3]||(e[3]=a("div",{class:"text-subtitle1 text-weight-medium"},"Fotografías",-1)),a("div",dt,"Sube/ver fotos del caso #"+m(d.caseId),1)]),a("div",rt,[t(g,{color:"primary",icon:"add_photo_alternate","no-caps":"",label:"Subir",onClick:r.openDialog,loading:i.uploading},null,8,["onClick","loading"])])]),t(V),a("div",ct,[(u(!0),h(U,null,F(d.caso.fotografias,l=>(u(),h("div",{key:l.id,class:"col-6 col-sm-4 col-md-3"},[t(k,{flat:"",bordered:""},{default:n(()=>[t(Qe,{src:r.toPublicUrl(l.thumb_url||l.url),ratio:4/3,onClick:s=>r.view(r.toPublicUrl(l.url)),style:{cursor:"pointer"}},{default:n(()=>[a("div",ut,m(l.titulo),1)]),_:2},1032,["src","onClick"]),t(Z,{align:"between"},{default:n(()=>[t(g,{dense:"",flat:"",icon:"delete",color:"negative",onClick:s=>r.remove(l)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))]),t(K,{modelValue:i.dialog.show,"onUpdate:modelValue":e[2]||(e[2]=l=>i.dialog.show=l),persistent:""},{default:n(()=>[t(k,{style:{"min-width":"350px","max-width":"500px"}},{default:n(()=>[t(S,{class:"row items-center q-gutter-sm"},{default:n(()=>e[4]||(e[4]=[a("div",{class:"text-h6"},"Subir fotografía",-1)])),_:1}),t(S,{class:"q-gutter-md"},{default:n(()=>[t(p,{modelValue:i.dialog.titulo,"onUpdate:modelValue":e[0]||(e[0]=l=>i.dialog.titulo=l),label:"Título de la foto",dense:"",outlined:"",autofocus:"",rules:[l=>!!l||"El título es obligatorio"]},null,8,["modelValue","rules"]),a("div",null,[t(g,{flat:"",icon:"attach_file",label:"Seleccionar archivo",onClick:r.triggerFile},null,8,["onClick"]),i.dialog.fileName?(u(),h("div",mt,[e[5]||(e[5]=C(" Archivo seleccionado: ")),a("strong",null,m(i.dialog.fileName),1)])):(u(),h("div",ft," Aún no se ha seleccionado ningún archivo ")),a("input",{type:"file",ref:"file",accept:"image/*",class:"hidden",onChange:e[1]||(e[1]=(...l)=>r.onFileChosen&&r.onFileChosen(...l))},null,544)])]),_:1}),t(Z,{align:"right"},{default:n(()=>[t(g,{flat:"",label:"Cancelar",color:"grey",onClick:r.closeDialog,disable:i.uploading},null,8,["onClick","disable"]),t(g,{color:"primary",label:"Subir",loading:i.uploading,onClick:r.upload,disable:!i.dialog.file||!i.dialog.titulo.trim()},null,8,["loading","onClick","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const gt=M(lt,[["render",pt]]),ge=Se({name:"QTimelineEntry",props:{heading:Boolean,tag:{type:String,default:"h3"},side:{type:String,default:"right",validator:o=>["left","right"].includes(o)},icon:String,avatar:String,color:String,title:String,subtitle:String,body:String},setup(o,{slots:e}){const d=Le(ke,xe);if(d===xe)return console.error("QTimelineEntry needs to be child of QTimeline"),xe;const c=Ee(()=>`q-timeline__entry q-timeline__entry--${o.side}`+(o.icon!==void 0||o.avatar!==void 0?" q-timeline__entry--icon":"")),i=Ee(()=>`q-timeline__dot text-${o.color||d.color}`),r=Ee(()=>d.layout==="comfortable"&&d.side==="left");return()=>{const l=qe(e.default,[]);if(o.body!==void 0&&l.unshift(o.body),o.heading===!0){const T=[B("div"),B("div"),B(o.tag,{class:"q-timeline__heading-title"},l)];return B("div",{class:"q-timeline__heading"},r.value===!0?T.reverse():T)}let s;o.icon!==void 0?s=[B(A,{class:"row items-center justify-center",name:o.icon})]:o.avatar!==void 0&&(s=[B("img",{class:"q-timeline__dot-img",src:o.avatar})]);const f=[B("div",{class:"q-timeline__subtitle"},[B("span",{},De(e.subtitle,[o.subtitle]))]),B("div",{class:i.value},s),B("div",{class:"q-timeline__content"},[B("h6",{class:"q-timeline__title"},De(e.title,[o.title]))].concat(l))];return B("li",{class:c.value},r.value===!0?f.reverse():f)}}}),_t=Se({name:"QTimeline",props:{...$e,color:{type:String,default:"primary"},side:{type:String,default:"right",validator:o=>["left","right"].includes(o)},layout:{type:String,default:"dense",validator:o=>["dense","comfortable","loose"].includes(o)}},setup(o,{slots:e}){const d=Fe(),c=Pe(o,d.proxy.$q);Me(ke,o);const i=Ee(()=>`q-timeline q-timeline--${o.layout} q-timeline--${o.layout}--${o.side}`+(c.value===!0?" q-timeline--dark":""));return()=>B("ul",{class:i.value},De(e.default))}}),ht={name:"HojaRuta",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,required:!0}},data(){return{loading:!1,editing:!1,backup:null,form:{caso_numero:"",fecha_apertura_caso:"",fecha_derivacion_psicologica:"",fecha_informe_area_psicologica:"",fecha_informe_trabajo_social:"",fecha_derivacion_area_legal:""}}},computed:{today(){const o=new Date,e=String(o.getMonth()+1).padStart(2,"0"),d=String(o.getDate()).padStart(2,"0");return`${o.getFullYear()}-${e}-${d}`},total(){return 5},done(){return["fecha_apertura_caso","fecha_derivacion_psicologica","fecha_informe_area_psicologica","fecha_informe_trabajo_social","fecha_derivacion_area_legal"].filter(e=>!!this.form[e]).length}},created(){},methods:{format(o){return o||"—"},startEdit(){this.editing=!0,this.backup={...this.form}},cancelEdit(){this.form={...this.backup},this.editing=!1,this.$q.notify({type:"info",message:"Cambios descartados"})},async save(){const o={fecha_derivacion_psicologica:this.caso.fecha_derivacion_psicologica||null,fecha_informe_area_psicologica:this.caso.fecha_informe_area_psicologica||null,fecha_informe_trabajo_social:this.caso.fecha_informe_trabajo_social||null,fecha_derivacion_area_legal:this.caso.fecha_derivacion_area_legal||null};this.loading=!0;try{const{data:e}=await this.$axios.put(`/casos/${this.caseId}`,o);this.form={...this.form,fecha_derivacion_psicologica:e.data?.fecha_derivacion_psicologica||this.caso.fecha_derivacion_psicologica,fecha_informe_area_psicologica:e.data?.fecha_informe_area_psicologica||this.caso.fecha_informe_area_psicologica,fecha_informe_trabajo_social:e.data?.fecha_informe_trabajo_social||this.caso.fecha_informe_trabajo_social,fecha_derivacion_area_legal:e.data?.fecha_derivacion_area_legal||this.caso.fecha_derivacion_area_legal},this.backup={...this.form},this.editing=!1,this.$alert?.success("Hoja de ruta actualizada")}catch(e){this.$alert?.error(e?.response?.data?.message||"No se pudo actualizar")}finally{this.loading=!1}}}},vt={class:"row items-center q-mb-sm"},bt={class:"col"},yt={class:"text-caption text-grey-7"};function Ct(o,e,d,c,i,r){return u(),h("div",null,[a("div",vt,[a("div",bt,[e[0]||(e[0]=a("div",{class:"text-subtitle1 text-weight-medium"},"Hoja de ruta",-1)),a("div",yt," Completa las fechas clave del caso ("+m(r.done)+"/"+m(r.total)+" completadas) ",1)])]),t(k,{flat:"",bordered:"",class:"section-card"},{default:n(()=>[t(V),t(S,null,{default:n(()=>[t(_t,{color:"primary",layout:"comfortable",side:"right"},{default:n(()=>[t(ge,{title:"Apertura del caso",subtitle:r.format(d.caso.fecha_apertura_caso),icon:"flag"},null,8,["subtitle"]),t(ge,{title:"Derivación área legal",subtitle:r.format(d.caso.fecha_derivacion_area_legal),icon:"gavel",color:d.caso.fecha_derivacion_area_legal?"primary":"grey-5"},null,8,["subtitle","color"]),t(ge,{title:"Aceptación área legal",subtitle:r.format(d.caso.fecha_aceptacion_area_legal),icon:"gavel",color:d.caso.fecha_aceptacion_area_legal?"primary":"grey-5"},null,8,["subtitle","color"]),t(ge,{title:"Derivación área psicológica",subtitle:r.format(d.caso.fecha_derivacion_area_psicologica),icon:"psychology",color:d.caso.fecha_derivacion_area_psicologica?"primary":"grey-5"},null,8,["subtitle","color"]),t(ge,{title:"Aceptación área psicológica",subtitle:r.format(d.caso.fecha_aceptacion_area_psicologica),icon:"psychology",color:d.caso.fecha_aceptacion_area_psicologica?"primary":"grey-5"},null,8,["subtitle","color"]),t(ge,{title:"Derivación área social",subtitle:r.format(d.caso.fecha_derivacion_area_social),icon:"people",color:d.caso.fecha_derivacion_area_social?"primary":"grey-5"},null,8,["subtitle","color"]),t(ge,{title:"Aceptación área social",subtitle:r.format(d.caso.fecha_aceptacion_area_social),icon:"people",color:d.caso.fecha_aceptacion_area_social?"primary":"grey-5"},null,8,["subtitle","color"])]),_:1})]),_:1})]),_:1})])}const It=M(ht,[["render",Ct],["__scopeId","data-v-f31ee815"]]),Et={props:{caso:{type:Object,required:!0},role:{type:String,required:!0}},methods:{openDocumento(o){const e=o.id,c=`${this.$axios?.defaults?.baseURL||""}/documentos/${e}/download`;window.open(c,"_blank")},openFotografia(o){console.log(o);const d=`${this.$axios?.defaults?.baseURL||""}/../storage/${o.path}`;window.open(d,"_blank")}}},xt={key:0},At=["onClick"],Nt={key:1},Dt={key:0},wt=["onClick"],Vt={key:1};function Ot(o,e,d,c,i,r){return u(),h(U,null,[(u(!0),h(U,null,F(d.caso.documentos,l=>(u(),h(U,{key:l.id},[l.user?.role===d.role?(u(),h("tr",xt,[e[0]||(e[0]=a("td",null,"Archivo",-1)),a("td",null,m(l.titulo||l.original_name),1),a("td",null,m((l.created_at||"").slice(0,10)||"—"),1),a("td",null,m(l.user?.name||"—"),1),a("td",null,[l.url?(u(),h("a",{key:0,onClick:s=>r.openDocumento(l)}," Ver archivo ",8,At)):(u(),h("span",Nt,"—"))])])):I("",!0)],64))),128)),(u(!0),h(U,null,F(d.caso.fotografias,l=>(u(),h(U,{key:l.id},[l.user?.role===d.role?(u(),h("tr",Dt,[e[1]||(e[1]=a("td",null,"Fotografía",-1)),a("td",null,m(l.titulo||l.original_name),1),a("td",null,m((l.created_at||"").slice(0,10)||"—"),1),a("td",null,m(l.user?.name||"—"),1),a("td",null,[l.url?(u(),h("a",{key:0,onClick:s=>r.openFotografia(l)}," Ver archivo ",8,wt)):(u(),h("span",Vt,"—"))])])):I("",!0)],64))),128))],64)}const St=M(Et,[["render",Ot]]),kt={name:"SeguimientoCaso",components:{ArchivoFoto:St},props:{caso:{type:Object,required:!0}},data(){return{loading:!1,filters:{q:"",tipo:"Todos",modulo:"Todos",desde:"",hasta:""},tipos:["Todos","Informe","Sesión","Documento","Fotografía","Hito"],modulos:["Todos","General","Psicológico","Legal","Social","Documentos","Multimedia"],columns:[{name:"actividad",label:"Actividad",field:"actividad",align:"left",sortable:!1},{name:"fecha",label:"Fecha / Usuario",field:"fecha",align:"left",sortable:!0},{name:"modulo",label:"Módulo",field:"modulo",align:"left",sortable:!0},{name:"acciones",label:"",field:"acciones",align:"right",sortable:!1,style:"width: 150px"}]}},computed:{header(){const o=this.caso||{},e=Array.isArray(o.denunciantes)&&o.denunciantes.length?o.denunciantes[0]:null,d=Array.isArray(o.denunciados)&&o.denunciados.length?o.denunciados[0]:null;return{caso_id:o.id||"—",caso_numero:o.caso_numero||"—",tipologia:o.caso_tipologia||o.caso_tipologia===""?o.caso_tipologia:o.caso_tipologia||o.caso_tipologia,modalidad:(o.caso_modalidad||o.caso_modalidad==="",o.caso_modalidad),zona:o.caso_zona||o.zona||"—",direccion:o.caso_direccion||"—",fecha_hecho:o.caso_fecha_hecho||"—",fecha_registro:o.fecha_apertura_caso||"—",registrado_por:o.user?.name||"—",denunciante:e?this.fullName(e,"denunciante"):"—",denunciado:d?this.fullName(d,"denunciado"):"—"}},violenciaChips(){const o=this.caso||{};return[{key:"violencia_fisica",label:"Física",color:"red-7"},{key:"violencia_psicologica",label:"Psicológica",color:"deep-purple-7"},{key:"violencia_sexual",label:"Sexual",color:"purple-7"},{key:"violencia_economica",label:"Económica",color:"orange-7"},{key:"violencia_patrimonial",label:"Patrimonial",color:"brown-7"},{key:"violencia_simbolica",label:"Simbólica",color:"indigo-7"},{key:"violencia_institucional",label:"Institucional",color:"teal-7"}].map(d=>({...d,on:!!o[d.key]}))},rows(){const o=[],e=this.caso||{};return[{fecha:e.fecha_apertura_caso,titulo:"Apertura del caso"},{fecha:e.fecha_derivacion_psicologica,titulo:"Derivación a Psicología"},{fecha:e.fecha_derivacion_area_legal,titulo:"Derivación a Área Legal"},{fecha:e.fecha_informe_area_social,titulo:"Informe Área Social"},{fecha:e.fecha_informe_area_psicologica,titulo:"Informe Área Psicológica"},{fecha:e.fecha_informe_trabajo_social,titulo:"Informe Trabajo Social"}].forEach((c,i)=>{c.fecha}),Array.isArray(e.informes_sociales)&&e.informes_sociales.forEach(c=>{o.push({uid:`soc-${c.id}`,tipo:"Informe",modulo:"Social",titulo:c.titulo||"Informe Social",descripcion:this.stripHtml(c.contenido_html||""),usuario:c.user?.name||"",fecha:c.fecha||"",icon:"description",links:{}})}),Array.isArray(e.psicologicas)&&e.psicologicas.forEach(c=>{o.push({uid:`psi-${c.id}`,tipo:"Sesión",modulo:"Psicológico",titulo:`${c.tipo||"Sesión"}${c.titulo?` — ${c.titulo}`:""}`,descripcion:this.stripHtml(c.contenido_html||""),usuario:c.user?.name||"",fecha:c.fecha||"",icon:"psychology",links:{}})}),Array.isArray(e.informes_legales)&&e.informes_legales.forEach(c=>{o.push({uid:`leg-${c.id}`,tipo:"Informe",modulo:"Legal",titulo:c.titulo||"Informe Legal",descripcion:this.stripHtml(c.contenido_html||""),usuario:c.user?.name||"",fecha:c.fecha||"",icon:"gavel",links:{}})}),Array.isArray(e.documentos)&&e.documentos.forEach(c=>{o.push({uid:`doc-${c.id}`,tipo:"Documento",modulo:"Documentos",titulo:c.titulo||c.original_name||"Documento",descripcion:[c.categoria,c.descripcion,c.size_human].filter(Boolean).join(" · "),usuario:c.user?.name||"",fecha:(c.created_at||"").slice(0,10),icon:c.extension==="pdf"?"picture_as_pdf":"attach_file",links:{view:c.url,download:c.url,open:c.url}})}),Array.isArray(e.fotografias)&&e.fotografias.forEach(c=>{o.push({uid:`foto-${c.id}`,tipo:"Fotografía",modulo:"Multimedia",titulo:c.titulo||"Fotografía",descripcion:c.descripcion||"",usuario:c.user?.name||"",fecha:(c.created_at||"").slice(0,10),icon:"image",links:{view:c.url,open:c.url,download:c.url}})}),o.sort((c,i)=>(i.fecha||"").localeCompare(c.fecha||"")),o},rowsFiltered(){let o=this.rows.slice();if(this.filters.q){const e=this.filters.q.toLowerCase();o=o.filter(d=>(d.titulo||"").toLowerCase().includes(e)||(d.descripcion||"").toLowerCase().includes(e)||(d.usuario||"").toLowerCase().includes(e))}return this.filters.tipo&&this.filters.tipo!=="Todos"&&(o=o.filter(e=>e.tipo===this.filters.tipo)),this.filters.modulo&&this.filters.modulo!=="Todos"&&(o=o.filter(e=>(e.modulo||"").toLowerCase()===this.filters.modulo.toLowerCase())),this.filters.desde&&(o=o.filter(e=>(e.fecha||"0000-00-00")>=this.filters.desde)),this.filters.hasta&&(o=o.filter(e=>(e.fecha||"9999-12-31")<=this.filters.hasta)),o}},methods:{openSocialInforme(o){if(o.archivo){const d=`${this.$axios?.defaults?.baseURL||""}/../storage/${o.archivo.replace("/storage/","")}`;this.open(d);return}else{const e=o.id,d=this.$axios.defaults.baseURL+`/informesSocial/${e}/pdf`;console.log("url",d),this.open(d)}},clickSeguimiento(o,e){if(e.tipo==="Informe"&&e.modulo==="Social"&&e.uid.startsWith("soc-")){const d=e.uid.split("-")[1],c=this.$axios.defaults.baseURL+`/informesSocial/${d}/pdf`;this.open(c)}if(e.tipo==="Documento"&&e.uid.startsWith("doc-")){const d=e.uid.split("-")[1],c=this.$axios.defaults.baseURL+`/documentos/${d}/view`;this.open(c)}if(e.tipo==="Sesión"&&e.modulo==="Psicológico"&&e.uid.startsWith("psi-")){const d=e.uid.split("-")[1],c=this.$axios.defaults.baseURL+`/sesiones-psicologicas/${d}/pdf`;this.open(c)}if(e.tipo==="Informe"&&e.modulo==="Legal"&&e.uid.startsWith("leg-")){const d=e.uid.split("-")[1],c=this.$axios.defaults.baseURL+`/informes/${d}/pdf`;this.open(c)}},stripHtml(o){const e=document.createElement("div");e.innerHTML=o||"";const d=(e.textContent||e.innerText||"").trim().replace(/\s+/g," ");return d.length>280?d.slice(0,277)+"…":d},fullName(o,e){return[o[`${e}_nombres`],o[`${e}_paterno`],o[`${e}_materno`]].filter(Boolean).join(" ").trim()||o[`${e}_nombre_completo`]||o[`${e}_nombres`]||"—"},open(o){o&&window.open(o,"_blank")},async forceRefresh(){this.loading=!0;try{await new Promise(o=>setTimeout(o,500))}finally{this.loading=!1}}}},Ut={class:"row items-start q-col-gutter-sm"},Tt={class:"col-12 col-md-8"},Rt={class:"text-caption text-grey-7"},Lt={class:"col-12 col-md-4 flex items-center justify-end"},qt={class:"row q-col-gutter-sm"},$t={class:"col-12 col-md-3"},Pt={class:"val"},Ft={class:"col-12 col-md-3"},Mt={class:"val"},jt={class:"col-12 col-md-3"},zt={class:"val"},Gt={class:"col-12 col-md-3"},Bt={class:"col-12 col-md-3"},Ht={class:"val"},Jt={class:"col-12 col-md-3"},Qt={class:"col-12 col-md-3"},Yt={class:"val"},Zt={class:"col-12 col-md-3"},Wt={class:"val"},Xt={class:"row q-col-gutter-xs q-mt-sm items-center"},Kt={class:"col-12 col-md-8"},ea={class:"row q-gutter-xs"},oa={class:"col-12 col-md-4"},ia={class:"row q-gutter-xs justify-end"},ta={class:"row"},aa={class:"col-12 col-md-12"},la={class:"col-12 col-md-12"},na=["onClick"],sa={class:"col-12 col-md-12"},da=["onClick"],ra={class:"col-12 col-md-12"},ca=["onClick"];function ua(o,e,d,c,i,r){const l=P("ArchivoFoto");return u(),h("div",null,[t(k,{flat:"",bordered:"",class:"q-pa-sm q-mb-md rounded-borders"},{default:n(()=>[a("div",Ut,[a("div",Tt,[e[1]||(e[1]=a("div",{class:"text-subtitle1 text-weight-bold"},"Seguimiento del Caso",-1)),a("div",Rt,[C(m(d.caso?.tipo||"SLIM")+" · Caso ",1),a("b",null,"#"+m(r.header.caso_id),1),e[0]||(e[0]=C(" · N° ")),a("b",null,m(r.header.caso_numero||"—"),1)])]),a("div",Lt,[t(Ce,{dense:"",color:"indigo-1","text-color":"indigo-9",class:"q-mr-xs"},{default:n(()=>[C(m(r.header.fecha_registro||"—"),1)]),_:1}),t(g,{flat:"",color:"primary",icon:"refresh",onClick:r.forceRefresh,loading:i.loading,title:"Actualizar",label:i.loading?"":"Actualizar","no-caps":"",dense:""},null,8,["onClick","loading","label"])])]),t(V,{class:"q-my-sm"}),a("div",qt,[a("div",$t,[e[2]||(e[2]=a("div",{class:"lbl"},"Tipología",-1)),a("div",Pt,m(r.header.tipologia||"—"),1)]),a("div",Ft,[e[3]||(e[3]=a("div",{class:"lbl"},"Zona",-1)),a("div",Mt,m(r.header.zona||"—"),1)]),a("div",jt,[e[4]||(e[4]=a("div",{class:"lbl"},"Denunciante",-1)),a("div",zt,m(r.header.denunciante||"—"),1)]),a("div",Gt,[e[5]||(e[5]=a("div",{class:"lbl"},"Direccion Denunciante",-1)),(u(!0),h(U,null,F(d.caso.denunciantes,s=>(u(),h("div",{key:s.id},m(s.denunciante_domicilio_actual||""),1))),128))]),a("div",Bt,[e[6]||(e[6]=a("div",{class:"lbl"},"Denunciado",-1)),a("div",Ht,m(r.header.denunciado||"—"),1)]),a("div",Jt,[e[7]||(e[7]=a("div",{class:"lbl"},"Dirección Denunciado",-1)),(u(!0),h(U,null,F(d.caso.denunciados,s=>(u(),h("div",{key:s.id},m(s.denunciado_domicilio_actual||""),1))),128))]),a("div",Qt,[e[8]||(e[8]=a("div",{class:"lbl"},"Fecha del hecho",-1)),a("div",Yt,m(d.caso.caso_fecha_hecho),1)]),a("div",Zt,[e[9]||(e[9]=a("div",{class:"lbl"},"Registrado por",-1)),a("div",Wt,m(r.header.registrado_por||"—"),1)])]),a("div",Xt,[a("div",Kt,[e[10]||(e[10]=a("div",{class:"lbl q-mb-xs"},"Tipos de violencia",-1)),a("div",ea,[(u(!0),h(U,null,F(r.violenciaChips,s=>(u(),v(Ce,{key:s.label,dense:"",color:s.on?s.color:"grey-3","text-color":s.on?"white":"grey-8",square:""},{default:n(()=>[C(m(s.label),1)]),_:2},1032,["color","text-color"]))),128))])]),a("div",oa,[e[11]||(e[11]=a("div",{class:"lbl q-mb-xs"},"Responsables",-1)),a("div",ia,[d.caso?.psicologica_user?(u(),v(Ce,{key:0,dense:"",color:"pink-2","text-color":"pink-10",square:""},{default:n(()=>[C(" Psic.: "+m(d.caso.psicologica_user.name),1)]),_:1})):I("",!0),d.caso?.trabajo_social_user?(u(),v(Ce,{key:1,dense:"",color:"teal-2","text-color":"teal-10",square:""},{default:n(()=>[C(" TS: "+m(d.caso.trabajo_social_user.name),1)]),_:1})):I("",!0),d.caso?.legal_user?(u(),v(Ce,{key:2,dense:"",color:"amber-2","text-color":"amber-10",square:""},{default:n(()=>[C(" Legal: "+m(d.caso.legal_user.name),1)]),_:1})):I("",!0)])])])]),_:1}),a("div",ta,[a("div",aa,[e[13]||(e[13]=a("span",{class:"text-bold"},"Asistente",-1)),t(ie,{dense:"",bordered:"",flat:""},{default:n(()=>[e[12]||(e[12]=a("thead",{class:"bg-primary text-white"},[a("tr",null,[a("th",null,"Tipo"),a("th",null,"Título"),a("th",null,"Fecha"),a("th",null,"Usuario"),a("th",null,"Archivo")])],-1)),a("tbody",null,[t(l,{role:"Asistente",caso:d.caso},null,8,["caso"]),t(l,{role:"Auxiliar",caso:d.caso},null,8,["caso"])])]),_:1})]),a("div",la,[e[16]||(e[16]=a("span",{class:"text-bold"},"Social",-1)),t(ie,{dense:"",bordered:"",flat:""},{default:n(()=>[e[15]||(e[15]=a("thead",{class:"bg-primary text-white"},[a("tr",null,[a("th",null,"Tipo"),a("th",null,"Título"),a("th",null,"Fecha"),a("th",null,"Usuario"),a("th",null,"Archivo")])],-1)),a("tbody",null,[(u(!0),h(U,null,F(d.caso.informes_sociales,s=>(u(),h("tr",{key:s.id},[e[14]||(e[14]=a("td",null," Informe ",-1)),a("td",null,m(s.titulo),1),a("td",null,m(s.fecha||"—"),1),a("td",null,m(s.user?.name||"—"),1),a("td",null,[a("a",{onClick:f=>r.openSocialInforme(s)}," Ver archivo ",8,na)])]))),128)),t(l,{role:"Social",caso:d.caso},null,8,["caso"])])]),_:1})]),a("div",sa,[e[19]||(e[19]=a("div",{class:"text-bold"},"Psicológia",-1)),t(ie,{dense:"",bordered:"",flat:""},{default:n(()=>[e[18]||(e[18]=a("thead",{class:"bg-primary text-white"},[a("tr",null,[a("th",null,"Tipo"),a("th",null,"Título"),a("th",null,"Fecha"),a("th",null,"Usuario"),a("th",null,"Archivo")])],-1)),a("tbody",null,[(u(!0),h(U,null,F(d.caso.psicologicas,s=>(u(),h("tr",{key:s.id},[e[17]||(e[17]=a("td",null," Informe ",-1)),a("td",null,m(s.tipo)+" — "+m(s.titulo||"Sesión"),1),a("td",null,m(s.fecha||"—"),1),a("td",null,m(s.user?.name||"—"),1),a("td",null,[a("a",{onClick:f=>r.clickSeguimiento(f,{tipo:"Sesión",modulo:"Psicológico",uid:"psi-"+s.id})}," Ver archivo ",8,da)])]))),128)),t(l,{role:"Psicologo",caso:d.caso},null,8,["caso"])])]),_:1})]),a("div",ra,[e[22]||(e[22]=a("span",{class:"text-bold"},"Legal",-1)),t(ie,{dense:"",bordered:"",flat:""},{default:n(()=>[e[21]||(e[21]=a("thead",{class:"bg-primary text-white"},[a("tr",null,[a("th",null,"Tipo"),a("th",null,"Título"),a("th",null,"Fecha"),a("th",null,"Usuario"),a("th",null,"Archivo")])],-1)),a("tbody",null,[(u(!0),h(U,null,F(d.caso.informes_legales,s=>(u(),h("tr",{key:s.id},[e[20]||(e[20]=a("td",null," Informe ",-1)),a("td",null,m(s.titulo),1),a("td",null,m(s.fecha||"—"),1),a("td",null,m(s.user?.name||"—"),1),a("td",null,[a("a",{onClick:f=>r.clickSeguimiento(f,{tipo:"Informe",modulo:"Legal",uid:"leg-"+s.id})}," Ver archivo ",8,ca)])]))),128)),t(l,{role:"Abogado",caso:d.caso},null,8,["caso"])])]),_:1})])])])}const ma=M(kt,[["render",ua],["__scopeId","data-v-855f3a03"]]),fa={informeSocial(o){const e=D=>D==null||D===""?"—":String(D),d=D=>{if(!D)return"—";const q=new Date(D);if(isNaN(q.getTime()))return e(D);const G=q.getFullYear(),O=String(q.getMonth()+1).padStart(2,"0"),ee=String(q.getDate()).padStart(2,"0");return`${G}-${O}-${ee}`},c=(D={})=>[D.denunciante_nombres,D.denunciante_paterno,D.denunciante_materno].filter(Boolean).join(" ")||"—",i=o?.denunciantes&&o.denunciantes[0]?o.denunciantes[0]:{},r=c(i),l=e(i?.denunciante_edad),s=d(i?.denunciante_fecha_nacimiento),f=e(i?.denunciante_lugar_nacimiento||"—"),T=e(i?.denunciante_grado),R=e(i?.denunciante_estado_civil),H=e(i?.denunciante_ocupacion),j=e(i?.denunciante_relacion),z=e(o?.caso_tipologia||o?.principal||"—"),L=e(o?.caso_numero);return`
<div style="border:1px solid #333;border-radius:6px;padding:14px;margin-bottom:12px;font-size:13px;line-height:1.4">

  <div style="text-align:center; font-weight:700; font-size:16px; margin-bottom:12px;">
    INFORME SOCIAL
  </div>

  <div style="margin-bottom:8px"><b>A :</b> __________________________</div>
  <div style="margin-bottom:8px">
    <b>DE :</b> <br/>
    TRABAJADORA SOCIAL - DIRECCION DE IGUALDAD DE OPORTUNIDADES
  </div>

  <div style="margin-top:10px;">
    <b>TIPOLOGIA:</b> ${z}<br/>
    <b>CASO:</b> ${L}
  </div>

  <div style="margin:18px 0; font-weight:700">I. REFERENCIA DEL CASO</div>
  <p>...</p>

  <div style="margin:18px 0; font-weight:700">II. DATOS PERSONALES</div>
  <div><b>NOMBRE Y APELLIDO:</b> ${r}</div>
  <div><b>EDAD:</b> ${l}</div>
  <div><b>FECHA DE NACIMIENTO:</b> ${s}</div>
  <div><b>LUGAR DE NACIMIENTO:</b> ${f}</div>
  <div><b>GRADO DE INSTRUCCIÓN:</b> ${T}</div>
  <div><b>ESTADO CIVIL:</b> ${R}</div>
  <div><b>OCUPACION:</b> ${H}</div>
  <div><b>NOMBRE DE CONTACTO:</b> ${j}</div>

  <div style="margin:18px 0; font-weight:700">III. GRUPO FAMILIAR NUCLEAR</div>
  <p>...</p>

  <div style="margin:18px 0; font-weight:700">IV. INTERVENCION TECNICOS Y/O INSTRUMENTOS UTILIZADOS</div>
  <p>...</p>

  <div style="margin:18px 0; font-weight:700">V. HISTORIA SOCIAL</div>
  <p>...</p>

  <div style="margin:18px 0; font-weight:700">VI. SITUACION ACTUAL</div>
  <p>...</p>

  <div style="margin:18px 0; font-weight:700">VII. DIAGNOSTICO SOCIAL</div>
  <p>...</p>

  <div style="margin:18px 0; font-weight:700">VIII. RECOMENDACIONES</div>
  <p>...</p>

  <div style="margin-top:36px;text-align:center">
    __________________________<br/>
    <br/>
    Trabajadora Social
  </div>
</div>
  `}},pa={name:"SocialInformes",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:null}},data(){return{openSubirArchivo:!1,file:null,loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dialog:!1,mode:"create",form:{id:null,fecha:"",titulo:"",area:"psicologico",numero:"",contenido_html:""},plantilla:"informe_social",plantillasOptions:[{label:"Informe Social",value:"informe_social"},{label:"Acto Social",value:"acto_social"}],areas:[{label:"Psicológico",value:"psicologico"},{label:"Legal",value:"legal"},{label:"Social",value:"social"}]}},methods:{today(){const o=new Date,e=d=>String(d).padStart(2,"0");return`${o.getFullYear()}-${e(o.getMonth()+1)}-${e(o.getDate())}`},guardarInforme(){if(!this.file){this.$q.notify({type:"negative",message:"Seleccione un archivo"});return}if(!this.form.titulo){this.$q.notify({type:"negative",message:"El título es obligatorio"});return}const o=new FormData;o.append("titulo",this.form.titulo),o.append("file",this.file),o.append("case_id",this.caseId),o.append("tipo","social"),this.saving=!0,this.loading=!0,this.$axios.post(`/casos/${this.caseId}/uploadFile`,o,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{this.$q.notify({type:"positive",message:"Informe subido"}),this.openSubirArchivo=!1,this.file=null,this.form.titulo="",this.$emit("refresh")}).catch(e=>{this.$q.notify({type:"negative",message:e?.response?.data?.message||"No se pudo subir el informe"})}).finally(()=>{this.saving=!1,this.loading=!1})},onFileChange(o){this.file=o},openCarpetaDigital(){console.log("Abrir carpeta digital del caso",this.caseId)},openSubirInforme(){this.openSubirArchivo=!0},openCreate(){this.mode="create",this.form={id:null,fecha:this.today(),titulo:"",area:"psicologico",numero:"",contenido_html:""},this.dialog=!0,this.$nextTick(()=>this.applyTemplate(this.plantilla))},openView(o){this.mode="view",this.form={...o},this.dialog=!0},openEdit(o){this.mode="edit",this.form={...o},this.dialog=!0},openFile(o){window.open(this.$url+"/.."+o.archivo,"_blank")},applyTemplate(o){this.mode!=="view"&&(this.form.contenido_html="",o==="informe_social"&&(this.form.contenido_html=fa.informeSocial(this.caso)))},async save(){if(!this.form.titulo)return this.$q.notify({type:"negative",message:"El título es obligatorio"});if(!this.form.contenido_html)return this.$q.notify({type:"negative",message:"El contenido está vacío"});this.saving=!0;try{this.form.id?await this.$axios.put(`/informes-sociales/${this.form.id}`,this.form):await this.$axios.post(`/casos/${this.caseId}/informes-sociales`,this.form),this.$q.notify({type:"positive",message:"Guardado"}),this.$emit("refresh"),this.dialog=!1}catch(o){this.$q.notify({type:"negative",message:o?.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}},removeIt(o){const e=async()=>{try{await this.$axios.delete(`/informes-sociales/${o.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.$emit("refresh")}catch(d){this.$q.notify({type:"negative",message:d?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar el informe?").onOk(e):confirm("¿Eliminar el informe?")&&e()},printPdf(o){const e=this.$url||"";window.open(`${e}/informesSocial/${o.id}/pdf`,"_blank")}}},ga={class:"row items-center q-mb-sm"},_a={class:"col"},ha={class:"text-caption text-grey-7"},va={class:"col-auto row items-center q-gutter-sm"},ba={key:0},ya={class:"text-subtitle1"},Ca={class:"row"},Ia={class:"col-12 col-md-3"},Ea={class:"col-12 col-md-5"},xa={class:"col-6 col-md-2"},Aa={class:"col-6 col-md-2"},Na={key:0};function Da(o,e,d,c,i,r){return u(),v(k,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[a("div",ga,[a("div",_a,[e[12]||(e[12]=a("div",{class:"text-subtitle1 text-weight-medium"},"Informes",-1)),a("div",ha,"Vinculados al caso #"+m(d.caseId),1)]),a("div",va,[t(p,{dense:"",outlined:"",modelValue:i.search,"onUpdate:modelValue":e[0]||(e[0]=l=>i.search=l),placeholder:"Buscar...",style:{width:"260px"}},{append:n(()=>[t(A,{name:"search"})]),_:1},8,["modelValue"]),t(g,{flat:"",color:"primary",icon:"refresh",loading:i.loading,onClick:e[1]||(e[1]=l=>o.$emit("refresh"))},null,8,["loading"]),t(g,{color:"green",icon:"add_circle_outline","no-caps":"",label:"Crear informe",onClick:r.openCreate},null,8,["onClick"]),t(g,{color:"primary",icon:"upload","no-caps":"",label:"Subir Informe",onClick:r.openSubirInforme},null,8,["onClick"])])]),t(V),t(ie,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:n(()=>[e[19]||(e[19]=a("thead",null,[a("tr",{class:"bg-primary text-white"},[a("th",{style:{width:"70px"}},"ID"),a("th",{style:{width:"140px"}},"Acciones"),a("th",null,"Título"),a("th",{style:{width:"120px"}},"Fecha"),a("th",{style:{width:"130px"}},"Área"),a("th",{style:{width:"120px"}},"Nro"),a("th",{style:{width:"180px"}},"Usuario")])],-1)),a("tbody",null,[(u(!0),h(U,null,F(d.caso.informes_sociales,l=>(u(),h("tr",{key:l.id},[a("td",null,"#"+m(l.id),1),a("td",null,[t(ve,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:n(()=>[l.archivo?E((u(),v(w,{key:1,clickable:"",onClick:s=>r.openFile(l)},{default:n(()=>[t(b,{avatar:""},{default:n(()=>[t(A,{name:"download"})]),_:1}),t(b,null,{default:n(()=>e[16]||(e[16]=[C(" Descargar ")])),_:1})]),_:2},1032,["onClick"])),[[x]]):(u(),h(U,{key:0},[E((u(),v(w,{clickable:"",onClick:s=>r.openView(l)},{default:n(()=>[t(b,{avatar:""},{default:n(()=>[t(A,{name:"visibility"})]),_:1}),t(b,null,{default:n(()=>e[13]||(e[13]=[C("Ver")])),_:1})]),_:2},1032,["onClick"])),[[x]]),E((u(),v(w,{clickable:"",onClick:s=>r.printPdf(l)},{default:n(()=>[t(b,{avatar:""},{default:n(()=>[t(A,{name:"print"})]),_:1}),t(b,null,{default:n(()=>e[14]||(e[14]=[C("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[x]]),t(V),E((u(),v(w,{clickable:"",onClick:s=>r.openEdit(l)},{default:n(()=>[t(b,{avatar:""},{default:n(()=>[t(A,{name:"edit"})]),_:1}),t(b,null,{default:n(()=>e[15]||(e[15]=[C("Editar")])),_:1})]),_:2},1032,["onClick"])),[[x]])],64)),E((u(),v(w,{clickable:"",onClick:s=>r.removeIt(l)},{default:n(()=>[t(b,{avatar:""},{default:n(()=>[t(A,{name:"delete",color:"negative"})]),_:1}),t(b,{class:"text-negative"},{default:n(()=>e[17]||(e[17]=[C("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[x]])]),_:2},1024)]),a("td",null,m(l.titulo),1),a("td",null,m(l.fecha||"s/f"),1),a("td",null,m(l.area||"—"),1),a("td",null,m(l.numero||"—"),1),a("td",null,m(l.user?.name||l.user?.username||"—"),1)]))),128)),d.caso.informes_sociales.length?I("",!0):(u(),h("tr",ba,e[18]||(e[18]=[a("td",{colspan:"7",class:"text-center text-grey"},"Sin registros",-1)])))])]),_:1}),t(K,{modelValue:i.dialog,"onUpdate:modelValue":e[8]||(e[8]=l=>i.dialog=l),persistent:"",maximized:""},{default:n(()=>[t(k,null,{default:n(()=>[t(Ue,{class:"bg-white text-dark"},{default:n(()=>[a("div",ya,m(i.mode==="view"?"Ver informe":i.form.id?"Editar informe":"Nuevo informe"),1),t(W),E(t(g,{flat:"",dense:"",round:"",icon:"close"},null,512),[[x]])]),_:1}),t(V),t(S,{class:"q-gutter-md"},{default:n(()=>[a("div",Ca,[a("div",Ia,[t(p,{modelValue:i.form.fecha,"onUpdate:modelValue":e[2]||(e[2]=l=>i.form.fecha=l),type:"date",dense:"",outlined:"",label:"Fecha",readonly:i.mode==="view"},null,8,["modelValue","readonly"])]),a("div",Ea,[t(p,{modelValue:i.form.titulo,"onUpdate:modelValue":e[3]||(e[3]=l=>i.form.titulo=l),dense:"",outlined:"",label:"Título *",readonly:i.mode==="view",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","readonly","rules"])]),a("div",xa,[t(Y,{modelValue:i.form.area,"onUpdate:modelValue":e[4]||(e[4]=l=>i.form.area=l),options:i.areas,dense:"",outlined:"",label:"Área",readonly:i.mode==="view","emit-value":"","map-options":""},null,8,["modelValue","options","readonly"])]),a("div",Aa,[t(p,{modelValue:i.form.numero,"onUpdate:modelValue":e[5]||(e[5]=l=>i.form.numero=l),dense:"",outlined:"",label:"Nro",readonly:i.mode==="view"},null,8,["modelValue","readonly"])])]),i.mode!=="view"?(u(),h("div",Na,[t(Y,{modelValue:i.plantilla,"onUpdate:modelValue":[e[6]||(e[6]=l=>i.plantilla=l),r.applyTemplate],options:i.plantillasOptions,label:"Plantilla",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])])):I("",!0),a("div",null,[e[20]||(e[20]=a("div",{class:"text-caption text-grey-7 q-mb-xs"},"Contenido (WYSIWYG / guarda HTML)",-1)),t(Ve,{modelValue:i.form.contenido_html,"onUpdate:modelValue":e[7]||(e[7]=l=>i.form.contenido_html=l),readonly:i.mode==="view","min-height":"320px",placeholder:"Escriba el informe...",toolbar:[["left","center","right","justify"],["bold","italic","strike","underline"],["quote","unordered","ordered","outdent","indent"],["hr","link"],["undo","redo"],["removeFormat"]]},null,8,["modelValue","readonly"])])]),_:1}),t(V),t(Z,{align:"right"},{default:n(()=>[E(t(g,{flat:"",label:"Cerrar"},null,512),[[x]]),i.mode!=="view"?(u(),v(g,{key:0,color:"primary",label:"Guardar",loading:i.saving,onClick:r.save},null,8,["loading","onClick"])):I("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(K,{modelValue:i.openSubirArchivo,"onUpdate:modelValue":e[11]||(e[11]=l=>i.openSubirArchivo=l),persistent:""},{default:n(()=>[t(k,{style:{"max-width":"500px",width:"90vw"}},{default:n(()=>[t(S,{class:"row items-center q-pb-none"},{default:n(()=>[e[21]||(e[21]=a("div",{class:"text-subtitle1"},"Subir informe",-1)),t(W),E(t(g,{flat:"",round:"",dense:"",icon:"close"},null,512),[[x]])]),_:1}),t(S,{class:"q-gutter-md"},{default:n(()=>[e[22]||(e[22]=a("div",{class:"text-body2 q-mb-sm"}," Aquí puede subir un informe psicológico ya elaborado (PDF, Word, etc.) y vincularlo al caso. ",-1)),t(p,{modelValue:i.form.titulo,"onUpdate:modelValue":e[9]||(e[9]=l=>i.form.titulo=l),dense:"",outlined:"",label:"Título informe *",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","rules"]),t(be,{modelValue:i.file,"onUpdate:modelValue":[e[10]||(e[10]=l=>i.file=l),r.onFileChange],label:"Seleccionar archivo",outlined:"",dense:"",accept:".pdf,.doc,.docx,.odt,.png,.jpg,.jpeg,.xlsx,.xls"},null,8,["modelValue","onUpdate:modelValue"]),t(g,{color:"primary",label:"Guardar",disabled:!i.file||!i.form.titulo,onClick:r.guardarInforme,loading:i.loading},null,8,["disabled","onClick","loading"])]),_:1}),t(V),t(Z,{align:"right"},{default:n(()=>[E(t(g,{flat:"",label:"Cerrar"},null,512),[[x]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const wa=M(pa,[["render",Da]]),Va={name:"CodigoCaso",props:{caso:{type:Object,required:!0}},data(){return{editMode:!1,loading:!1,form:{nurej:null,cud:null},juzgados:["Juzgado Publico de la familia 1","Juzgado Publico de la familia 2","Juzgado Publico de la familia 3","Juzgado Publico de la familia 4","Juzgado Publico de la familia 5","Juzgado Publico de la familia 6","Juzgado Publico de la familia 7","Juzgado Publico de la familia 8","Juzgado Publico de la familia 9"],juzgados_padre:["Juzgado Tribunal Sala","Juzgado Familia"]}},watch:{caso:{immediate:!0,deep:!0,handler(o){this.form.nurej=o?.nurej??null,this.form.cud=o?.cud??null,this.form.numero_juzgado=o?.numero_juzgado??null,this.form.numero_juzgado_padre=o?.numero_juzgado_padre??null,this.form.responsable_fiscalia=o?.responsable_fiscalia??null}}},methods:{uploadFile(o){this.form.archivo_codigo=o;const e=new FormData;e.append("file",o),this.$axios.post(`casos/${this.caso.id}/upload-codigo-file`,e,{headers:{"Content-Type":"multipart/form-data"}}).then(()=>{this.$q.notify({type:"positive",message:"Archivo de código subido correctamente."}),this.$emit("refresh")}).catch(d=>{console.error(d),this.$q.notify({type:"negative",message:"Error al subir el archivo de código."})})},changeJuzgadoPadre(o){this.form.numero_juzgado=null,o==="Juzgado Familia"?this.juzgados=["Juzgado Publico de la familia 1","Juzgado Publico de la familia 2","Juzgado Publico de la familia 3","Juzgado Publico de la familia 4","Juzgado Publico de la familia 5","Juzgado Publico de la familia 6","Juzgado Publico de la familia 7","Juzgado Publico de la familia 8","Juzgado Publico de la familia 9"]:this.juzgados=["JUZGADO - TRIBUNAL - SALA","JUZGADO DE LA NIÑEZ Y ADOLESCENCIA N° 1","JUZGADO DE LA NIÑEZ Y ADOLESCENCIA N° 2","JUZGADO DE INSTRUCCIÓN PENAL ANTICORRUPCIÓN Y CONTRA LA VIOLENCIA HACIA LAS MUJERES N° 1","JUZGADO DE INSTRUCCIÓN PENAL ANTICORRUPCIÓN Y CONTRA LA VIOLENCIA HACIA LAS MUJERES N° 2","JUZGADO DE INSTRUCCIÓN PENAL ANTICORRUPCIÓN Y CONTRA LA VIOLENCIA HACIA LAS MUJERES N° 3","JUZGADO DE INSTRUCCIÓN PENAL ANTICORRUPCIÓN Y CONTRA LA VIOLENCIA HACIA LAS MUJERES N° 4","JUZGADO DE INSTRUCCIÓN PENAL ANTICORRUPCIÓN Y CONTRA LA VIOLENCIA HACIA LAS MUJERES N° 5","JUZGADO DE INSTRUCCIÓN PENAL ANTICORRUPCIÓN Y CONTRA LA VIOLENCIA HACIA LAS MUJERES N° 6","JUZGADO DE INSTRUCCIÓN PENAL ANTICORRUPCIÓN Y CONTRA LA VIOLENCIA HACIA LAS MUJERES N° 7","JUZGADO DE INSTRUCCIÓN PENAL ANTICORRUPCIÓN Y CONTRA LA VIOLENCIA HACIA LAS MUJERES N° 8","TRIBUNAL DE SENTENCIA PENAL N° 1","TRIBUNAL DE SENTENCIA PENAL N° 2","TRIBUNAL DE SENTENCIA PENAL N° 3","JUZGADO DE SENTENCIA PENAL N° 1","JUZGADO DE SENTENCIA PENAL N° 2","JUZGADO DE SENTENCIA PENAL N° 3","JUZGADO DE SENTENCIA PENAL N° 4","JUZGADO DE SENTENCIA PENAL N° 5","JUZGADO DE SENTENCIA PENAL N° 6","JUZGADO DE SENTENCIA PENAL N° 7","SALA PENAL N° 1","SALA PENAL N° 2","SALA PENAL N° 3","JUZGADO DE EJECUCIÓN PENAL 1","JUZGADO CIVIL COMERCIAL","SALA CIVIL, COMERCIAL, DE FAMILIA 1","SALA CIVIL, COMERCIAL, DE FAMILIA 2","SALA CONSTITUCIONAL N° 1","SALA CONSTITUCIONAL N° 2","JUZGADO PÚBLICO DE FAMILIA N° 1","JUZGADO PÚBLICO DE FAMILIA N° 2","JUZGADO PÚBLICO DE FAMILIA N° 3","JUZGADO PÚBLICO DE FAMILIA N° 4","JUZGADO PÚBLICO DE FAMILIA N° 5","JUZGADO PÚBLICO DE FAMILIA N° 6","JUZGADO PÚBLICO DE FAMILIA N° 7","JUZGADO PÚBLICO DE FAMILIA N° 8","JUZGADO PÚBLICO DE FAMILIA N° 9"]},toggleEdit(){this.editMode&&(this.form.nurej=this.caso?.nurej??null,this.form.cud=this.caso?.cud??null),this.editMode=!this.editMode},async guardar(){this.loading=!0;try{const o={nurej:this.form.nurej,cud:this.form.cud,numero_juzgado:this.form.numero_juzgado,responsable_fiscalia:this.form.responsable_fiscalia,numero_juzgado_padre:this.form.numero_juzgado_padre};await this.$axios.put(`casos/${this.caso.id}/codigos`,o),this.$emit("actualizado"),this.editMode=!1,this.$q.notify({type:"positive",message:"Códigos actualizados correctamente."})}catch(o){console.error(o),this.$q.notify({type:"negative",message:"Error al actualizar los códigos."})}finally{this.loading=!1}}}},Oa={class:"row items-center q-gutter-sm q-mb-md"},Sa={class:"row q-col-gutter-md"},ka={class:"col-12 col-md-6"},Ua={class:"col-12 col-md-6"},Ta={class:"col-12 col-md-6"},Ra={class:"col-12 col-md-6"},La={class:"col-12 col-md-6"},qa={key:0,class:"q-mt-md"};function $a(o,e,d,c,i,r){return u(),v(k,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[a("div",Oa,[t(je,{icon:"qr_code_2",color:"primary","text-color":"white"}),e[6]||(e[6]=a("div",null,[a("div",{class:"text-h6 text-weight-bold"},"Códigos del Caso"),a("div",{class:"text-caption text-grey-7"},"NUREJ y CUD")],-1)),t(W),t(g,{label:i.editMode?"Cancelar":"Editar",icon:i.editMode?"close":"edit",flat:"",color:"primary",onClick:r.toggleEdit},null,8,["label","icon","onClick"]),i.editMode?(u(),v(g,{key:0,color:"primary",icon:"save",label:"Guardar",loading:i.loading,onClick:r.guardar},null,8,["loading","onClick"])):I("",!0)]),t(V,{spaced:""}),a("div",Sa,[a("div",ka,[t(p,{modelValue:i.form.nurej,"onUpdate:modelValue":e[0]||(e[0]=l=>i.form.nurej=l),readonly:!i.editMode,filled:"",label:"NUREJ",dense:o.$q.screen.lt.md},{prepend:n(()=>[t(A,{name:"tag"})]),_:1},8,["modelValue","readonly","dense"])]),a("div",Ua,[t(p,{modelValue:i.form.cud,"onUpdate:modelValue":e[1]||(e[1]=l=>i.form.cud=l),readonly:!i.editMode,filled:"",label:"CUD",dense:o.$q.screen.lt.md},{prepend:n(()=>[t(A,{name:"confirmation_number"})]),_:1},8,["modelValue","readonly","dense"])]),a("div",Ta,[t(Y,{modelValue:i.form.numero_juzgado_padre,"onUpdate:modelValue":[e[2]||(e[2]=l=>i.form.numero_juzgado_padre=l),r.changeJuzgadoPadre],options:i.juzgados_padre,readonly:!i.editMode,filled:"",label:"Tipo Juzgado",dense:o.$q.screen.lt.md},{prepend:n(()=>[t(A,{name:"balance"})]),_:1},8,["modelValue","options","onUpdate:modelValue","readonly","dense"])]),a("div",Ra,[t(p,{modelValue:i.form.responsable_fiscalia,"onUpdate:modelValue":e[3]||(e[3]=l=>i.form.responsable_fiscalia=l),readonly:!i.editMode,filled:"",label:"Responsable Fiscalía",dense:o.$q.screen.lt.md},{prepend:n(()=>[t(A,{name:"person"})]),_:1},8,["modelValue","readonly","dense"])]),a("div",La,[t(Y,{modelValue:i.form.numero_juzgado,"onUpdate:modelValue":e[4]||(e[4]=l=>i.form.numero_juzgado=l),options:i.juzgados,readonly:!i.editMode,filled:"",label:"Número de Juzgado",dense:o.$q.screen.lt.md},{prepend:n(()=>[t(A,{name:"gavel"})]),_:1},8,["modelValue","options","readonly","dense"]),d.caso.codigo_file?(u(),h("div",qa,[t(g,{href:`${o.$url}/..${d.caso.codigo_file}`,target:"_blank",rel:"noopener",color:"secondary",icon:"visibility",label:"Ver Archivo de Código",dense:o.$q.screen.lt.md,"no-caps":""},null,8,["href","dense"])])):I("",!0),o.$store.user.role==="Abogado"?(u(),v(be,{key:1,modelValue:i.form.archivo_codigo,"onUpdate:modelValue":[e[5]||(e[5]=l=>i.form.archivo_codigo=l),r.uploadFile],readonly:!i.editMode,outlined:"",label:"Subir Archivo de Código",accept:".pdf,.doc,.docx",dense:""},{prepend:n(()=>[t(A,{name:"upload_file"})]),_:1},8,["modelValue","readonly","onUpdate:modelValue"])):I("",!0)])])]),_:1})}const Pa=M(Va,[["render",$a],["__scopeId","data-v-a6c562d0"]]),Fa={name:"EstadoCaso",props:{caso:{type:Object,required:!0},caseId:{type:[Number,String],required:!0}},data:function(){return{casoNew:{},file:null,loading:!1,estado_casos:["Concluido","Con Representacion","Con Sentencia","En Jugado","En Fiscalia","Archivo","Otros"]}},mounted(){this.casoNew.estado_caso=this.caso.estado_caso,this.casoNew.estado_caso_otro=this.caso.estado_caso_otro,this.casoNew.respaldo=this.caso.respaldo,this.casoNew.observaciones=this.caso.observaciones},emits:["refresh"],methods:{fileDownload(){console.log(this.caso.respaldo),window.open(this.$axios.defaults.baseURL+"/.."+this.caso.respaldo,"_blank")},onFileChange(o){if(!o)return;const e=new FormData;e.append("file",o),this.loading=!0,this.$axios.post(`/casos/${this.caseId}/upload_respaldo/`,e).then(({data:d})=>{this.$q.notify({type:"positive",message:"Archivo subido correctamente"}),this.$emit("refresh")}).catch(d=>{this.$q.notify({type:"negative",message:`Error al subir: ${d?.response?.data?.detail||d.message}`})}).finally(()=>{this.loading=!1})},refresh(){this.$emit("refresh")},guardar(){this.$axios.put(`/casos/${this.caseId}/`,{estado_caso:this.caso.estado_caso,estado_caso_otro:this.caso.estado_caso_otro,respaldo:this.caso.respaldo,observaciones:this.caso.observaciones}).then(()=>{this.$q.notify({type:"positive",message:"Datos guardados correctamente"}),this.refresh()}).catch(o=>{this.$q.notify({type:"negative",message:`Error al guardar los datos: ${o.response.data.detail||o.message}`})})}}},Ma={class:"row q-col-gutter-md"},ja={class:"col-12 col-md-6"},za={key:0,class:"col-12 col-md-6"},Ga={class:"col-12 col-md-12"},Ba={key:0},Ha={class:"col-12"},Ja={class:"col-12"};function Qa(o,e,d,c,i,r){return u(),h("div",Ma,[a("div",ja,[t(Y,{modelValue:d.caso.estado_caso,"onUpdate:modelValue":e[0]||(e[0]=l=>d.caso.estado_caso=l),options:o.estado_casos,outlined:"",label:"Estado del Caso",dense:o.$q.screen.lt.md},{prepend:n(()=>[t(A,{name:"folder_open"})]),_:1},8,["modelValue","options","dense"])]),d.caso.estado_caso==="Otros"?(u(),h("div",za,[t(p,{modelValue:d.caso.estado_caso_otro,"onUpdate:modelValue":e[1]||(e[1]=l=>d.caso.estado_caso_otro=l),outlined:"",label:"Especifique otro estado",dense:o.$q.screen.lt.md},{prepend:n(()=>[t(A,{name:"edit"})]),_:1},8,["modelValue","dense"])])):I("",!0),a("div",Ga,[d.caso.respaldo?(u(),h("div",Ba,[t(A,{name:"attachment"}),t(g,{flat:"",onClick:r.fileDownload,target:"_blank"},{default:n(()=>[C(m(d.caso.respaldo.split("/").pop()),1)]),_:1},8,["onClick"])])):I("",!0),t(be,{modelValue:o.file,"onUpdate:modelValue":[e[2]||(e[2]=l=>o.file=l),r.onFileChange],label:"Subir Archivo Caso",outlined:"",dense:o.$q.screen.lt.md,"prepend-icon":"backup",counter:"","hide-upload-button":!0},null,8,["modelValue","dense","onUpdate:modelValue"])]),a("div",Ha,[t(p,{modelValue:d.caso.observaciones,"onUpdate:modelValue":e[3]||(e[3]=l=>d.caso.observaciones=l),outlined:"",label:"Observaciones",type:"textarea",dense:o.$q.screen.lt.md},{prepend:n(()=>[t(A,{name:"notes"})]),_:1},8,["modelValue","dense"])]),a("div",Ja,[t(g,{"no-caps":"",icon:"save",class:"full-width",label:"Guardar",color:"primary",onClick:r.guardar,loading:o.loading},null,8,["onClick","loading"])])])}const Ya=M(Fa,[["render",Qa]]),Za={name:"CasoDetalle",components:{EstadoCaso:Ya,CasoNuevo:Xe,Codigo:Pa,CasoNuevoPROPREMI:We,CasoNuevoDNA:Ze,SocialInformes:wa,SlimNuevo:Ye,Seguimiento:ma,HojaRuta:It,InfoGeneral:Xo,Problematica:fi,SesionesPsicologico:Oi,InformesLegal:Bi,ApoyoIntegral:Yi,DocumentosGeneral:at,Fotografias:gt},data(){return{loading:!1,tab:"info",caso:null,defaultCountryCallingCode:"591",now:oe(),cronometroTimer:null}},computed:{caseId(){return this.$route.params.id},subtipo(){return this.$route.params.subtipo},role(){return this.$store.user?.role||""},hasAnyWa(){const o=this.caso||{};return!!(o?.psicologica_user?.celular||o?.legal_user?.celular||o?.trabajo_social_user?.celular)},cronometroYmdHis(){if(!this.caso?.fecha_apertura_caso)return"—";const o=oe.duration(this.now.diff(oe(this.caso.fecha_apertura_caso)));Math.floor(o.asDays());const e=o.hours(),d=o.minutes(),c=o.seconds();return`${String(e).padStart(2,"0")}:${String(d).padStart(2,"0")}:${String(c).padStart(2,"0")}`},cronometroDias(){if(!this.caso?.fecha_apertura_caso)return"—";const o=oe.duration(this.now.diff(oe(this.caso.fecha_apertura_caso))),e=o.years(),d=o.months(),c=o.days();o.hours(),o.minutes(),o.seconds();let i=[];return e&&i.push(`${e} año${e!==1?"s":""}`),d&&i.push(`${d} mes${d!==1?"es":""}`),c&&i.push(`${c} día${c!==1?"s":""}`),i.join(", ")},cronometroHorasDiasMesesAnios(){if(!this.caso?.fecha_apertura_caso)return"—";const o=oe.duration(this.now.diff(oe(this.caso.fecha_apertura_caso)));o.years(),o.months(),o.days();const e=o.hours(),d=o.minutes(),c=o.seconds();let i=[];return e&&i.push(`${e}:`),d&&i.push(`${d}:`),c&&i.push(`${c}`),i.join("")}},created(){this.fetchCaso(),this.cronometroTimer=setInterval(()=>{this.now=oe()},1e3)},beforeUnmount(){this.cronometroTimer&&clearInterval(this.cronometroTimer)},methods:{formatYmdHis(o){return oe(o).format("DD/MM/YYYY HH:mm:ss")},aceptarCasoSocial(){this.$q.dialog({title:"Confirmar aceptación",html:!0,message:"Confirma que deseas <b>ACEPTAR </b> el CASO: <b>"+(this.caso?.tipo||"")+" "+(this.caso?.caso_numero||"")+'</b><br><br><span style="font-weight: bold">Denunciante: </span>'+(this.caso?.denunciantes[0]?.denunciante_nombres||"")+" "+(this.caso?.denunciantes[0]?.denunciante_paterno||"")+" "+(this.caso?.denunciantes[0]?.denunciante_materno||"")+'<br><span style="font-weight: bold">Tipologia: </span>'+(this.caso?.caso_tipologia||""),persistent:!0,ok:{label:"Aceptar Caso",color:"positive"},cancel:{label:"Cancelar",color:"red"}}).onOk(async()=>{try{await this.$axios.post(`/casos/${this.caseId}/aceptar-social`),this.$q.notify({type:"positive",message:"Caso social aceptado exitosamente."}),this.fetchCaso()}catch(o){this.$alert.error(o?.response?.data?.message||"No se pudo aceptar el caso social")}})},aceptarCasoPsicolico(){this.$q.dialog({title:"Confirmar aceptación",html:!0,message:"Confirma que deseas <b>ACEPTAR </b> el CASO: <b>"+(this.caso?.tipo||"")+" "+(this.caso?.caso_numero||"")+'</b><br><br><span style="font-weight: bold">Denunciante: </span>'+(this.caso?.denunciantes[0]?.denunciante_nombres||"")+" "+(this.caso?.denunciantes[0]?.denunciante_paterno||"")+" "+(this.caso?.denunciantes[0]?.denunciante_materno||"")+'<br><span style="font-weight: bold">Tipologia: </span>'+(this.caso?.caso_tipologia||""),persistent:!0,ok:{label:"Aceptar Caso",color:"positive"},cancel:{label:"Cancelar",color:"red"}}).onOk(async()=>{try{await this.$axios.post(`/casos/${this.caseId}/aceptar-psicologico`),this.$q.notify({type:"positive",message:"Caso psicológico aceptado exitosamente."}),this.fetchCaso()}catch(o){this.$alert.error(o?.response?.data?.message||"No se pudo aceptar el caso psicológico")}})},aceptarCasoLegal(){this.$q.dialog({title:"Confirmar aceptación",html:!0,message:"Confirma que deseas <b>ACEPTAR </b> el CASO: <b>"+(this.caso?.tipo||"")+" "+(this.caso?.caso_numero||"")+'</b><br><br><span style="font-weight: bold">Denunciante: </span>'+(this.caso?.denunciantes[0]?.denunciante_nombres||"")+" "+(this.caso?.denunciantes[0]?.denunciante_paterno||"")+" "+(this.caso?.denunciantes[0]?.denunciante_materno||"")+'<br><span style="font-weight: bold">Tipologia: </span>'+(this.caso?.caso_tipologia||""),persistent:!0,ok:{label:"Aceptar Caso",color:"positive"},cancel:{label:"Cancelar",color:"red"}}).onOk(async()=>{try{await this.$axios.post(`/casos/${this.caseId}/aceptar-legal`),this.$q.notify({type:"positive",message:"Caso legal aceptado exitosamente."}),this.fetchCaso()}catch(o){this.$alert.error(o?.response?.data?.message||"No se pudo aceptar el caso legal")}})},eliminarCaso(){this.$q.dialog({title:"Confirmar eliminación",message:"¿Estás seguro de que deseas eliminar este caso? Esta acción no se puede deshacer.",cancel:!0,persistent:!0}).onOk(async()=>{try{await this.$axios.delete(`/casos/${this.caseId}`),this.$q.notify({type:"positive",message:"Caso eliminado exitosamente."}),this.$router.back()}catch(o){this.$alert.error(o?.response?.data?.message||"No se pudo eliminar el caso")}})},normalizePhone(o){if(!o)return"";let e=String(o).replace(/\D+/g,"");return/^(\d{11,13})$/.test(e)?e:e.length===8?this.defaultCountryCallingCode+e:e.length===9&&!e.startsWith(this.defaultCountryCallingCode)?this.defaultCountryCallingCode+e:e},waUrl(o,e){const d=this.normalizePhone(o),c=encodeURIComponent(e||"");return`https://wa.me/${d}${c?`?text=${c}`:""}`},waMessage(o){const e=this.caso||{},d=e.caso_numero?e.caso_numero.replace(/\\\//g,"/"):`#${this.caseId}`,c=(this.$axios?.defaults?.baseURL||"")+`/casos/${this.caseId}`,i=o==="psico"?"Psicología":o==="legal"?"Legal":"Trabajo Social";return["*SLIM - Notificación de Caso*",`Nro: ${d}`,`Área: ${i}`,`Denunciante: ${e.denunciante_nombre_completo||"—"}`,e.caso_tipologia?`Tipología: ${e.caso_tipologia}`:null,e.caso_modalidad?`Modalidad: ${e.caso_modalidad}`:null,e.caso_fecha_hecho?`Fecha del hecho: ${e.caso_fecha_hecho}`:null,"",`Ver caso: ${c}`].filter(Boolean).join(`
`)},sendWhatsApp(o){const e=this.caso||{},d=o==="psico"?e.psicologica_user:o==="legal"?e.legal_user:o==="social"?e.trabajo_social_user:null;if(!d?.celular){this.$q.notify({type:"warning",message:"No hay número de celular configurado para ese responsable"});return}const c=this.waUrl(d.celular,this.waMessage(o));window.open(c,"_blank")},async fetchCaso(){this.loading=!0;try{const o=await this.$axios.get(`/casos/${this.caseId}`);this.caso=o.data}catch(o){this.$alert.error(o?.response?.data?.message||"No se pudo cargar el caso")}finally{this.loading=!1}},printPdf(){const o=this.$axios.defaults.baseURL+`/casos/${this.caseId}/pdf`;window.open(o,"_blank")},printPdfHojaRuta(o="denunciante"){const e=this.$axios.defaults.baseURL+`/casos/${this.caseId}/pdf/hoja-ruta?tipo=${o}`;window.open(e,"_blank")}}},Wa={class:"row items-center q-mb-md"},Xa={class:"col-12 col-md-4"},Ka={class:"text-h6 text-weight-bold"},el={class:"text-subtitle2 text-black-7"},ol={key:0},il={class:"text-black text-h4"},tl={class:"col-auto row q-gutter-sm"},al={key:2},ll={key:3},nl={key:4};function sl(o,e,d,c,i,r){const l=P("CasoNuevo"),s=P("Seguimiento"),f=P("Problematica"),T=P("HojaRuta"),R=P("SesionesPsicologico"),H=P("InformesLegal"),j=P("SocialInformes"),z=P("ApoyoIntegral"),L=P("DocumentosGeneral"),D=P("Fotografias"),q=P("Codigo"),G=P("EstadoCaso");return u(),v(Be,{class:"q-pa-md bg-grey-2"},{default:n(()=>[a("div",Wa,[a("div",Xa,[a("div",Ka,[C(m(i.caso?.tipo)+" "+m(i.caso?.caso_numero||"...")+" ",1),t(g,{flat:"",icon:"arrow_back",onClick:e[0]||(e[0]=O=>o.$router.back()),class:"q-mr-sm"})]),a("div",el,[t(A,{name:"calendar_today",class:"q-mr-sm"}),C(" Abierto "+m(r.formatYmdHis(i.caso?.fecha_apertura_caso))+" ",1),i.caso?.fecha_apertura_caso?(u(),h("span",ol," ("+m(r.cronometroDias)+")",1)):I("",!0),e[12]||(e[12]=a("br",null,null,-1)),a("span",il,m(r.cronometroHorasDiasMesesAnios),1)])]),a("div",tl,[r.hasAnyWa?(u(),v(ve,{key:0,flat:"",color:"positive",icon:"chat",label:"WhatsApp"},{default:n(()=>[t(we,null,{default:n(()=>[i.caso?.psicologica_user?.celular?(u(),v(w,{key:0,clickable:"",onClick:e[1]||(e[1]=O=>r.sendWhatsApp("psico"))},{default:n(()=>[t(b,{avatar:""},{default:n(()=>[t(A,{name:"psychology"})]),_:1}),t(b,null,{default:n(()=>[C("Psicología ("+m(i.caso.psicologica_user.name)+")",1)]),_:1}),t(b,{side:"",class:"text-caption text-grey"},{default:n(()=>[C(m(i.caso.psicologica_user.celular),1)]),_:1})]),_:1})):I("",!0),i.caso?.legal_user?.celular?(u(),v(w,{key:1,clickable:"",onClick:e[2]||(e[2]=O=>r.sendWhatsApp("legal"))},{default:n(()=>[t(b,{avatar:""},{default:n(()=>[t(A,{name:"gavel"})]),_:1}),t(b,null,{default:n(()=>[C("Legal ("+m(i.caso.legal_user.name)+")",1)]),_:1}),t(b,{side:"",class:"text-caption text-grey"},{default:n(()=>[C(m(i.caso.legal_user.celular),1)]),_:1})]),_:1})):I("",!0),i.caso?.trabajo_social_user?.celular?(u(),v(w,{key:2,clickable:"",onClick:e[3]||(e[3]=O=>r.sendWhatsApp("social"))},{default:n(()=>[t(b,{avatar:""},{default:n(()=>[t(A,{name:"people"})]),_:1}),t(b,null,{default:n(()=>[C("Trabajo social ("+m(i.caso.trabajo_social_user.name)+")",1)]),_:1}),t(b,{side:"",class:"text-caption text-grey"},{default:n(()=>[C(m(i.caso.trabajo_social_user.celular),1)]),_:1})]),_:1})):I("",!0)]),_:1})]),_:1})):I("",!0),t(ve,{flat:"",color:"secondary",icon:"print",label:"Imprimir PDF"},{default:n(()=>[t(we,null,{default:n(()=>[E((u(),v(w,{clickable:"",onClick:r.printPdf},{default:n(()=>[t(b,null,{default:n(()=>e[13]||(e[13]=[C("Ficha del Caso")])),_:1})]),_:1},8,["onClick"])),[[x]]),t(V),E((u(),v(w,{clickable:"",onClick:e[4]||(e[4]=O=>r.printPdfHojaRuta("denunciante"))},{default:n(()=>[t(b,null,{default:n(()=>e[14]||(e[14]=[C("Ubicacion (Denunciante)")])),_:1})]),_:1})),[[x]]),E((u(),v(w,{clickable:"",onClick:e[5]||(e[5]=O=>r.printPdfHojaRuta("denunciado"))},{default:n(()=>[t(b,null,{default:n(()=>e[15]||(e[15]=[C("Ubicacion (Denunciado)")])),_:1})]),_:1})),[[x]])]),_:1})]),_:1}),t(W),t(g,{flat:"",color:"primary",icon:"refresh",onClick:r.fetchCaso,loading:i.loading},null,8,["onClick","loading"]),r.role==="Administrador"?(u(),v(g,{key:1,flat:"",color:"negative",icon:"delete",label:"Eliminar Caso",onClick:e[6]||(e[6]=O=>r.eliminarCaso()),"no-caps":""})):I("",!0),r.role==="Abogado"&&i.caso?.legal_user_id===o.$store.user?.id&&!i.caso?.fecha_aceptacion_area_legal?(u(),h("div",al,[t(g,{color:"red",icon:"check_circle",label:"Aceptar Caso Legal",onClick:e[7]||(e[7]=O=>r.aceptarCasoLegal()),"no-caps":"",size:"10px"})])):I("",!0),r.role==="Psicologo"&&i.caso?.psicologica_user_id===o.$store.user?.id&&!i.caso?.fecha_aceptacion_area_psicologica?(u(),h("div",ll,[t(g,{color:"red",icon:"check_circle",label:"Aceptar Caso Psicológico",onClick:e[8]||(e[8]=O=>r.aceptarCasoPsicolico()),"no-caps":"",size:"10px"})])):I("",!0),r.role==="Social"&&i.caso?.trabajo_social_user_id===o.$store.user?.id&&!i.caso?.fecha_aceptacion_area_social?(u(),h("div",nl,[t(g,{color:"red",icon:"check_circle",label:"Aceptar Caso Social",onClick:e[9]||(e[9]=O=>r.aceptarCasoSocial()),"no-caps":"",size:"10px"})])):I("",!0)])]),t(k,{flat:"",bordered:"",class:"q-mb-md"},{default:n(()=>[t(ze,{modelValue:i.tab,"onUpdate:modelValue":e[10]||(e[10]=O=>i.tab=O),class:"text-primary",dense:"",align:"left","active-color":"primary","indicator-color":"primary","outside-arrows":"","mobile-arrows":""},{default:n(()=>[t(X,{name:"info",label:"1 Información General",icon:"dashboard","no-caps":""}),t(X,{name:"seguimiento",label:"2 Seguimiento",icon:"track_changes","no-caps":""}),r.subtipo===void 0?(u(),h(U,{key:0},[t(X,{name:"hoja",label:"3 Hoja de Ruta",icon:"report_problem","no-caps":""}),r.role==="Administrador"||r.role==="Psicologo"?(u(),v(X,{key:0,name:"psico",label:"4 Área Psicológico",icon:"psychology","no-caps":""})):I("",!0),r.role==="Administrador"||r.role==="Abogado"?(u(),v(X,{key:1,name:"legal",label:"5 Área Legal",icon:"gavel","no-caps":""})):I("",!0),r.role==="Administrador"||r.role==="Social"?(u(),v(X,{key:2,name:"social",label:"6 Área Social",icon:"people","no-caps":""})):I("",!0),t(X,{name:"docs",label:"7 Documentos General",icon:"folder","no-caps":""}),t(X,{name:"fotos",label:"8 Fotografías",icon:"photo_library","no-caps":""})],64)):I("",!0),t(X,{name:"codigo",label:"9 Codigos",icon:"code","no-caps":""}),t(X,{name:"estados",label:"10 Estado Caso",icon:"warning","no-caps":""})]),_:1},8,["modelValue"])]),_:1}),t(Ge,{modelValue:i.tab,"onUpdate:modelValue":e[11]||(e[11]=O=>i.tab=O),animated:"","keep-alive":""},{default:n(()=>[t(J,{name:"info"},{default:n(()=>[i.caso?(u(),v(l,{key:0,casoId:i.caso.id,showNumeroApoyoIntegral:i.caso?.numero_apoyo_integral,accion:"modificar",onRefresh:r.fetchCaso,caso:i.caso,tipo:i.caso?.tipo,titulo:i.caso?.titulo},null,8,["casoId","showNumeroApoyoIntegral","onRefresh","caso","tipo","titulo"])):I("",!0)]),_:1}),t(J,{name:"seguimiento"},{default:n(()=>[t(s,{caso:i.caso},null,8,["caso"])]),_:1}),t(J,{name:"problematica"},{default:n(()=>[t(f,{"case-id":r.caseId},null,8,["case-id"])]),_:1}),t(J,{name:"hoja"},{default:n(()=>[t(T,{"case-id":r.caseId,caso:i.caso,onRefresh:r.fetchCaso},null,8,["case-id","caso","onRefresh"])]),_:1}),t(J,{name:"psico"},{default:n(()=>[t(R,{"case-id":r.caseId,caso:i.caso,onRefresh:r.fetchCaso},null,8,["case-id","caso","onRefresh"])]),_:1}),t(J,{name:"legal"},{default:n(()=>[t(H,{"case-id":r.caseId,caso:i.caso,onRefresh:r.fetchCaso},null,8,["case-id","caso","onRefresh"])]),_:1}),t(J,{name:"social"},{default:n(()=>[t(j,{caso:i.caso,onRefresh:r.fetchCaso,"case-id":r.caseId},null,8,["caso","onRefresh","case-id"])]),_:1}),t(J,{name:"apoyo"},{default:n(()=>[t(z,{"case-id":r.caseId},null,8,["case-id"])]),_:1}),t(J,{name:"docs"},{default:n(()=>[t(L,{"case-id":r.caseId,caso:i.caso,onRefresh:r.fetchCaso},null,8,["case-id","caso","onRefresh"])]),_:1}),t(J,{name:"fotos"},{default:n(()=>[t(D,{"case-id":r.caseId,caso:i.caso,onRefresh:r.fetchCaso},null,8,["case-id","caso","onRefresh"])]),_:1}),t(J,{name:"codigo"},{default:n(()=>[t(q,{"case-id":r.caseId,caso:i.caso,onRefresh:r.fetchCaso},null,8,["case-id","caso","onRefresh"])]),_:1}),t(J,{name:"estados"},{default:n(()=>[t(G,{"case-id":r.caseId,caso:i.caso,onRefresh:r.fetchCaso},null,8,["case-id","caso","onRefresh"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}const $l=M(Za,[["render",sl],["__scopeId","data-v-5c498858"]]);export{$l as default};
