import{_ as f,c as g,o as a,w as m,b as o,a as i,a6 as b,$ as c,f as h,d as x,a7 as k,a0 as l,a1 as p,a2 as S,t as s,Z as r}from"./index-CpKuO999.js";import{Q as P}from"./QSelect-CdTjOo9Z.js";import{Q as _}from"./QBadge-DVEAe0kW.js";import{Q as V}from"./QTooltip-Cxplzsk9.js";import{Q as w}from"./QSpinnerDots-Cmk_G5Et.js";import{Q}from"./QMarkupTable-DZ91XBx2.js";import{Q as v}from"./QPagination-QrNFubkh.js";import{Q as q}from"./QPage-DFBg4WWL.js";import"./QMenu-alC_O9yj.js";import"./format-CLQBNoWC.js";const I={name:"SlimsPage",data(){return{slims:[],loading:!1,page:1,perPage:10,meta:{current_page:1,last_page:1,total:0,from:0,to:0},search:"",onlyPendientes:!1}},mounted(){this.onlyPendientes=String(this.$route.query.only_pendientes||"")==="1",this.fetchSlims()},watch:{"$route.query.only_pendientes"(d){this.onlyPendientes=String(d||"")==="1",this.goFirstPage()}},methods:{fetchSlims(){this.loading=!0,this.$axios.get("/casos",{params:{q:this.search||"",tipo:"UMADIS",page:this.page,per_page:this.perPage,only_pendientes:this.onlyPendientes?1:0}}).then(d=>{const e=d.data||{};this.slims=e.data||[],this.meta={current_page:e.current_page||1,last_page:e.last_page||1,total:e.total||0,from:e.from||0,to:e.to||0},this.page=this.meta.current_page}).catch(d=>this.$alert.error(d.response?.data?.message||"Error cargando SLIMs")).finally(()=>{this.loading=!1})},onSearch(){this.page=1,this.fetchSlims()},clearSearch(){this.search="",this.onSearch()},goFirstPage(){this.page=1,this.fetchSlims()},rowIndex(d){return(this.meta.from||0)+d}}},C={class:"row items-center q-col-gutter-md q-mb-md"},U={class:"col-12 col-md"},F={class:"col-auto"},B={class:"col-auto"},N={class:"col-auto"},D={key:0},M=["onClick"],T={class:"text-no-wrap"},A={class:"text-no-wrap"},z={class:"text-weight-medium"},j={key:0,class:"text-caption text-grey-7"},L={class:"text-weight-medium"},E={key:0,class:"text-caption text-grey-7"},Z={key:1,class:"text-grey-6"},R={key:1},G={key:2},H={colspan:"9",class:"text-center"},J={class:"row items-center justify-between q-mt-md"},K={class:"text-caption text-grey-7"};function O(d,e,W,X,n,u){return a(),g(q,{class:"q-pa-md"},{default:m(()=>[o("div",C,[o("div",U,[i(b,{modelValue:n.search,"onUpdate:modelValue":[e[0]||(e[0]=t=>n.search=t),u.onSearch],outlined:"",dense:"",debounce:"400",placeholder:"Buscar por N° SLIM, denunciante, denunciado, tipología, zona…"},{prepend:m(()=>[i(x,{name:"search"})]),append:m(()=>[n.search?(a(),g(h,{key:0,flat:"",dense:"",round:"",icon:"close",onClick:u.clearSearch},null,8,["onClick"])):c("",!0)]),_:1},8,["modelValue","onUpdate:modelValue"])]),o("div",F,[i(k,{modelValue:n.onlyPendientes,"onUpdate:modelValue":[e[1]||(e[1]=t=>n.onlyPendientes=t),u.goFirstPage],color:"primary",label:"Solo mis pendientes"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",B,[i(P,{modelValue:n.perPage,"onUpdate:modelValue":[e[2]||(e[2]=t=>n.perPage=t),u.goFirstPage],options:[10,20,50],dense:"",outlined:"",style:{width:"120px"},label:"Por página"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",N,[i(h,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",onClick:e[3]||(e[3]=t=>u.fetchSlims()),loading:n.loading},null,8,["loading"])])]),i(Q,{flat:"",bordered:"",dense:""},{default:m(()=>[e[12]||(e[12]=o("thead",null,[o("tr",null,[o("th",{style:{width:"60px"}},"#"),o("th",null,"Nº "),o("th",null,"Fecha"),o("th",null,"Denunciante"),o("th",null,"Denunciado"),o("th",null,"Tipología"),o("th",null,"Zona"),o("th",null,"Tipo"),o("th",null,"Alerta")])],-1)),!n.loading&&n.slims.length?(a(),l("tbody",D,[(a(!0),l(p,null,S(n.slims,(t,y)=>(a(),l("tr",{key:t.id,onClick:Y=>d.$router.push("/casos/"+t.id),class:"cursor-pointer"},[o("td",null,s(u.rowIndex(y)),1),o("td",T,s(t.tipo)+" "+s(t.caso_numero||"—"),1),o("td",A,s(d.$filters.date(t.fecha_apertura_caso)),1),o("td",null,[o("div",z,s(t.denunciantes[0]?.denunciante_nombres==null?"—":t.denunciantes[0]?.denunciante_nombres+" "+(t.denunciantes[0]?.denunciante_paterno||"")+" "+(t.denunciantes[0]?.denunciante_materno||"")),1),t.denunciantes[0]?.denunciante_nro?(a(),l("div",j,"CI: "+s(t.denunciantes[0]?.denunciante_nro),1)):c("",!0)]),o("td",null,[o("div",L,s(t.denunciados[0]?.denunciado_nombres==null?"—":t.denunciados[0]?.denunciado_nombres+" "+(t.denunciados[0]?.denunciado_paterno||"")+" "+(t.denunciados[0]?.denunciado_materno||"")),1),t.denunciados[0]?.denunciado_nro?(a(),l("div",E,"CI: "+s(t.denunciados[0]?.denunciado_nro),1)):c("",!0)]),o("td",null,s(t.caso_tipologia||"—"),1),o("td",null,s(t.zona||"—"),1),o("td",null,[i(_,{color:t.numero_apoyo_integral?"green":"grey-5","text-color":t.numero_apoyo_integral?"white":"black",label:t.numero_apoyo_integral?"Apoyo Integral":"Regular",rounded:"",dense:""},null,8,["color","text-color","label"])]),o("td",null,[t.mi_estado?.me_asignado?(a(),l(p,{key:0},[t.mi_estado.primer_informe_hecho?(a(),g(_,{key:0,color:"green","text-color":"white",class:"q-mr-xs"},{default:m(()=>[r(s(t.mi_estado.label_listo||"Primer informe listo"),1)]),_:2},1024)):(a(),l(p,{key:1},[i(_,{color:t.mi_estado.atrasado?"red":"orange","text-color":t.mi_estado.atrasado?"white":"black",class:"q-mr-xs"},{default:m(()=>[t.mi_estado.atrasado?(a(),l(p,{key:0},[r(" Atrasado "+s(Math.abs(t.mi_estado.dias_restantes))+" d ",1)],64)):(a(),l(p,{key:1},[r(" Faltan "+s(t.mi_estado.dias_restantes)+" d ",1)],64))]),_:2},1032,["color","text-color"]),i(V,{"transition-show":"jump-down","transition-hide":"jump-up"},{default:m(()=>[e[5]||(e[5]=r(" Debes cargar tu ")),o("b",null,s(t.mi_estado.rol==="Psicologo"?"primera sesión":"primer informe"),1),e[6]||(e[6]=r(".")),e[7]||(e[7]=o("br",null,null,-1)),e[8]||(e[8]=r(" Fecha límite: ")),o("b",null,s(t.mi_estado.deadline),1),e[9]||(e[9]=r(". "))]),_:2},1024)],64))],64)):(a(),l("span",Z,"—"))])],8,M))),128))])):!n.loading&&!n.slims.length?(a(),l("tbody",R,e[10]||(e[10]=[o("tr",null,[o("td",{colspan:"9",class:"text-center text-grey"}," No hay resultados para tu búsqueda. ")],-1)]))):(a(),l("tbody",G,[o("tr",null,[o("td",H,[i(w,{size:"24px",class:"q-mr-sm"}),e[11]||(e[11]=r(" Cargando… "))])])]))]),_:1}),o("div",J,[o("div",K,[e[13]||(e[13]=r(" Mostrando ")),o("b",null,s(n.meta.from||0),1),e[14]||(e[14]=r(" – ")),o("b",null,s(n.meta.to||0),1),e[15]||(e[15]=r(" de ")),o("b",null,s(n.meta.total||0),1),e[16]||(e[16]=r(" registros "))]),i(v,{modelValue:n.page,"onUpdate:modelValue":[e[4]||(e[4]=t=>n.page=t),u.fetchSlims],max:n.meta.last_page||1,"max-pages":"10","boundary-numbers":"","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])])]),_:1})}const de=f(I,[["render",O],["__scopeId","data-v-0a1b46ea"]]);export{de as default};
