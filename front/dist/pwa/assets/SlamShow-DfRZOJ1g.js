import{_ as D,Y as S,a0 as y,o as m,b as i,$ as V,t as d,c as _,f as b,a1 as I,a as l,w as s,e as v,d as x,a3 as q,Z as f,Q as w,a6 as p,a7 as P,aa as X,a2 as Y,W as k,h as G,a8 as B}from"./index-D0BWmPW-.js";import{a as U,d as h,Q as le}from"./format-Ca8Yi27f.js";import{Q as H,a as oe}from"./QList-BsVcAQMn.js";import{S as Q,Q as ie,a as ne,b as re,c as de,d as O,e as ce,f as N}from"./QFile-cqCYDp9w.js";import{Q as ue}from"./QPage-C6t6BI-N.js";import{C}from"./ClosePopup-BXqE_iMM.js";import{Q as z}from"./QSelect-C0H1cK3W.js";import{M as me}from"./MapPicker-4MPc14CD.js";import{Q as $}from"./QMarkupTable-CguuwvQl.js";import{Q as W}from"./QSpace-C-pXF1F4.js";import{Q as te}from"./QImg-BI3RujQv.js";import{Q as ae,a as F}from"./QTimeline-Be8C5YNY.js";import"./QResizeObserver-6v3LyEUm.js";import"./touch-BjYP5sR0.js";import"./QTooltip-Bd2172wv.js";import"./use-fullscreen-BqDCohB8.js";import"./_commonjsHelpers-Cpj98o6Y.js";const fe={name:"InfoGeneral",components:{MapPicker:me},props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:()=>null}},data(){return{loading:!1,editing:!1,backup:null,oruroCenter:[-17.9667,-67.1167],psicologos:[],abogados:[],sociales:[],form:{}}},computed:{canEdit(){const t=this.$store.user?.role||"";return t==="Administrador"||t==="Asistente"},nombreDenunciado(){const t=this.form||{};return[t.den_nombres,t.den_paterno,t.den_materno].filter(Boolean).join(" ").trim()||"—"},optPsicologos(){return this.psicologos.map(t=>({label:t.name,value:t.id}))},optAbogados(){return this.abogados.map(t=>({label:t.name,value:t.id}))},optSociales(){return this.sociales.map(t=>({label:t.name,value:t.id}))},mapModel:{get(){return{latitud:this.form.am_latitud,longitud:this.form.am_longitud}},set(t){this.form.am_latitud=t?.latitud??t?.lat??null,this.form.am_longitud=t?.longitud??t?.lng??null}}},watch:{caso:{immediate:!0,deep:!0,handler(t){if(!t)return;const e=t.slam?t.slam:t,c=this.normalizeFromBackend(e);this.form={...c},!this.form.psicologica_user_id&&e.psicologica_user?.id&&(this.form.psicologica_user_id=e.psicologica_user.id),!this.form.trabajo_social_user_id&&e.trabajo_social_user?.id&&(this.form.trabajo_social_user_id=e.trabajo_social_user.id),!this.form.legal_user_id&&e.legal_user?.id&&(this.form.legal_user_id=e.legal_user.id)}}},created(){this.fetchRoles()},methods:{orDash(t){return t!=null&&t!==""?t:"—"},yesNo(t){return t===!0||t===1||t==="1"?"Sí":"No"},nombreUsuario(t,e,c){if(t&&t.name)return t.name;const g=(c||[]).find(o=>Number(o.id)===Number(e));return g&&(g.name||g.username)||"—"},normalizeFromBackend(t={}){const e=["am_idioma_castellano","am_idioma_quechua","am_idioma_aymara","tip_violencia_fisica","tip_violencia_psicologica","tip_abandono","tip_apoyo_integral","doc_ci","doc_frontal_denunciado","doc_frontal_denunciante","doc_croquis"],c={...t};return e.forEach(g=>{g in c&&(c[g]=c[g]===1||c[g]===!0||c[g]==="1")}),c},prepareForSave(t={}){const e=["am_idioma_castellano","am_idioma_quechua","am_idioma_aymara","tip_violencia_fisica","tip_violencia_psicologica","tip_abandono","tip_apoyo_integral","doc_ci","doc_frontal_denunciado","doc_frontal_denunciante","doc_croquis"],c={...t};return e.forEach(g=>{g in c&&(c[g]=c[g]?1:0)}),c},async fetchRoles(){try{const{data:t}=await this.$axios.get("/usuariosRole");this.psicologos=t.psicologos||[],this.abogados=t.abogados||[],this.sociales=t.sociales||[]}catch{this.$alert?.error?.("No se pudo cargar los usuarios por rol")||this.$q.notify({type:"negative",message:"No se pudo cargar los usuarios por rol"})}},startEdit(){this.canEdit&&(this.backup=JSON.parse(JSON.stringify(this.form)),this.editing=!0)},cancelEdit(){this.form=JSON.parse(JSON.stringify(this.backup||{})),this.editing=!1,this.$q.notify({type:"info",message:"Cambios descartados"})},async save(){if(this.canEdit){this.loading=!0;try{const t={slam:this.prepareForSave(this.form)},{data:e}=await this.$axios.put(`/slams/${this.caseId}`,t),c=e?.slam?this.normalizeFromBackend(e.slam):this.normalizeFromBackend(e);this.form={...c},this.editing=!1,this.$alert?.success?.("Información general actualizada")||this.$q.notify({type:"positive",message:"Información general actualizada"}),this.$emit("update")}catch(t){this.$alert?.error?.(t?.response?.data?.message||"No se pudo actualizar")||this.$q.notify({type:"negative",message:t?.response?.data?.message||"No se pudo actualizar"})}finally{this.loading=!1}}}}},_e={class:"row items-center q-mb-sm"},pe={class:"col"},ge={class:"text-caption text-grey-7"},he={key:0,class:"col-auto row q-gutter-sm"},be={class:"col-6 col-md-3"},ve={class:"col-6 col-md-3"},ye={class:"col-6 col-md-3"},Ve={class:"col-6 col-md-2"},xe={class:"col-6 col-md-2"},we={class:"col-6 col-md-2"},ke={class:"col-12 col-md-6"},Ce={class:"col-12 col-md-4"},qe={class:"col-12 col-md-4"},Ue={class:"col-12 col-md-4"},Ie={class:"col-6 col-md-3"},Ee={class:"col-6 col-md-3"},Se={class:"col-12"},De={class:"ellipsis-3"},je={class:"col-6 col-md-3"},Ne={class:"col-6 col-md-3"},Ae={class:"col-6 col-md-3"},Pe={class:"col-6 col-md-3"},Te={class:"col-12 col-md-6"},Re={class:"col-6 col-md-2"},Oe={class:"col-12 col-md-4"},Fe={class:"col-6 col-md-3"},Le={class:"col-6 col-md-3"},Me={class:"col-6 col-md-3"},Qe={class:"col-6 col-md-3"},ze={class:"col-12 col-md-4"},Ge={class:"col-12 col-md-4"},Be={class:"col-12 col-md-4"},He={class:"col-6 col-md-3"},We={class:"col-6 col-md-3"},Ye={class:"col-6 col-md-3"},Je={class:"col-6 col-md-3"},Ze={class:"row q-col-gutter-md"},Xe={class:"col-12 col-md-3"},Ke={class:"col-12 col-md-3"},$e={class:"col-12 col-md-3"},eo={class:"col-6 col-md-2"},oo={class:"col-6 col-md-2"},lo={class:"col-6 col-md-2"},io={class:"col-12 col-md-6"},to={class:"col-12 col-md-4"},ao={class:"col-12 col-md-4"},so={class:"col-12 col-md-4"},no={class:"col-12"},ro={class:"col-12"},co={class:"col-6 col-md-3"},uo={class:"col-6 col-md-3"},mo={class:"col-6 col-md-3"},fo={class:"col-6 col-md-3"},_o={class:"row q-col-gutter-md"},po={class:"col-12 col-md-4"},go={class:"col-6 col-md-2"},ho={class:"col-6 col-md-2"},bo={class:"col-6 col-md-2"},vo={class:"col-12 col-md-4"},yo={class:"col-6 col-md-3"},Vo={class:"col-6 col-md-3"},xo={class:"col-6 col-md-3"},wo={class:"col-6 col-md-3"},ko={class:"row q-col-gutter-md"},Co={class:"col-12 col-md-4"},qo={class:"col-12 col-md-4"},Uo={class:"col-12 col-md-4"},Io={class:"row q-col-gutter-md"},Eo={class:"col-12 col-md-2"},So={class:"col-12 col-md-2"},Do={class:"col-12 col-md-2"},jo={class:"col-12 col-md-2"};function No(t,e,c,g,o,n){const a=S("MapPicker");return m(),y("div",null,[i("div",_e,[i("div",pe,[e[32]||(e[32]=i("div",{class:"text-subtitle1 text-weight-medium"},"Información General",-1)),i("div",ge,"SLAM #"+d(n.orDash(o.form.numero_caso)),1)]),n.canEdit?(m(),y("div",he,[o.editing?(m(),y(I,{key:1},[l(b,{flat:"",color:"negative",icon:"close",label:"Cancelar",onClick:n.cancelEdit,loading:o.loading},null,8,["onClick","loading"]),l(b,{color:"primary",icon:"save",label:"Guardar",onClick:n.save,loading:o.loading},null,8,["onClick","loading"])],64)):(m(),_(b,{key:0,color:"primary",icon:"edit",label:"Editar",onClick:n.startEdit,loading:o.loading},null,8,["onClick","loading"]))])):V("",!0)]),o.editing?(m(),y(I,{key:1},[l(w,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:s(()=>[l(v,{class:"row items-center"},{default:s(()=>[l(x,{name:"description",class:"q-mr-sm"}),e[61]||(e[61]=i("div",{class:"text-subtitle1 text-weight-medium"},"1) Datos del caso (S.L.A.M.)",-1))]),_:1}),l(q),l(v,null,{default:s(()=>[i("div",Ze,[i("div",Xe,[l(p,{modelValue:o.form.numero_apoyo_integral,"onUpdate:modelValue":e[0]||(e[0]=r=>o.form.numero_apoyo_integral=r),dense:"",outlined:"",clearable:"",label:"Nº Apoyo Integral"},null,8,["modelValue"])]),i("div",Ke,[l(p,{modelValue:o.form.numero_caso,"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.numero_caso=r),dense:"",outlined:"",clearable:"",label:"Nº de caso"},null,8,["modelValue"])]),i("div",$e,[l(p,{modelValue:o.form.fecha_registro,"onUpdate:modelValue":e[2]||(e[2]=r=>o.form.fecha_registro=r),type:"date",dense:"",outlined:"",label:"Fecha registro"},null,8,["modelValue"])]),e[62]||(e[62]=i("div",{class:"col-12 text-subtitle2 q-mt-md"},"Idiomas (AM - marcadores generales)",-1)),i("div",eo,[l(P,{modelValue:o.form.am_idioma_castellano,"onUpdate:modelValue":e[3]||(e[3]=r=>o.form.am_idioma_castellano=r),label:"Castellano"},null,8,["modelValue"])]),i("div",oo,[l(P,{modelValue:o.form.am_idioma_quechua,"onUpdate:modelValue":e[4]||(e[4]=r=>o.form.am_idioma_quechua=r),label:"Quechua"},null,8,["modelValue"])]),i("div",lo,[l(P,{modelValue:o.form.am_idioma_aymara,"onUpdate:modelValue":e[5]||(e[5]=r=>o.form.am_idioma_aymara=r),label:"Aymara"},null,8,["modelValue"])]),i("div",io,[l(p,{modelValue:o.form.am_idioma_otros,"onUpdate:modelValue":e[6]||(e[6]=r=>o.form.am_idioma_otros=r),dense:"",outlined:"",clearable:"",label:"Otros idiomas"},null,8,["modelValue"])]),e[63]||(e[63]=i("div",{class:"col-12 text-subtitle2 q-mt-sm"},"Teléfonos de referencia",-1)),i("div",to,[l(p,{modelValue:o.form.ref_tel_fijo,"onUpdate:modelValue":e[7]||(e[7]=r=>o.form.ref_tel_fijo=r),dense:"",outlined:"",label:"Tel. fijo"},null,8,["modelValue"])]),i("div",ao,[l(p,{modelValue:o.form.ref_tel_movil,"onUpdate:modelValue":e[8]||(e[8]=r=>o.form.ref_tel_movil=r),dense:"",outlined:"",label:"Tel. móvil"},null,8,["modelValue"])]),i("div",so,[l(p,{modelValue:o.form.ref_tel_movil_alt,"onUpdate:modelValue":e[9]||(e[9]=r=>o.form.ref_tel_movil_alt=r),dense:"",outlined:"",label:"Tel. móvil (alt)"},null,8,["modelValue"])]),e[64]||(e[64]=i("div",{class:"col-12 text-subtitle2 q-mt-sm"},"Ubicación (lat/lng)",-1)),i("div",no,[l(a,{modelValue:n.mapModel,"onUpdate:modelValue":e[10]||(e[10]=r=>n.mapModel=r),center:o.oruroCenter,"zoom-init":13},null,8,["modelValue","center"])]),e[65]||(e[65]=i("div",{class:"col-12 text-subtitle2 q-mt-sm"},"Hecho y Tipología",-1)),i("div",ro,[l(p,{modelValue:o.form.hecho_descripcion,"onUpdate:modelValue":e[11]||(e[11]=r=>o.form.hecho_descripcion=r),type:"textarea",autogrow:"",outlined:"",dense:"",clearable:"",label:"Breve circunstancia del hecho / denuncia",maxlength:"3000"},null,8,["modelValue"])]),i("div",co,[l(P,{modelValue:o.form.tip_violencia_fisica,"onUpdate:modelValue":e[12]||(e[12]=r=>o.form.tip_violencia_fisica=r),label:"Violencia física"},null,8,["modelValue"])]),i("div",uo,[l(P,{modelValue:o.form.tip_violencia_psicologica,"onUpdate:modelValue":e[13]||(e[13]=r=>o.form.tip_violencia_psicologica=r),label:"Violencia psicológica"},null,8,["modelValue"])]),i("div",mo,[l(P,{modelValue:o.form.tip_abandono,"onUpdate:modelValue":e[14]||(e[14]=r=>o.form.tip_abandono=r),label:"Abandono"},null,8,["modelValue"])]),i("div",fo,[l(P,{modelValue:o.form.tip_apoyo_integral,"onUpdate:modelValue":e[15]||(e[15]=r=>o.form.tip_apoyo_integral=r),label:"Apoyo integral"},null,8,["modelValue"])])])]),_:1})]),_:1}),l(w,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:s(()=>[l(v,{class:"row items-center"},{default:s(()=>[l(x,{name:"person_off",class:"q-mr-sm"}),e[66]||(e[66]=i("div",{class:"text-subtitle1 text-weight-medium"},"4) Datos del denunciado/a",-1))]),_:1}),l(q),l(v,null,{default:s(()=>[i("div",_o,[i("div",po,[l(p,{modelValue:o.form.den_nombres,"onUpdate:modelValue":e[16]||(e[16]=r=>o.form.den_nombres=r),dense:"",outlined:"",clearable:"",label:"Nombres"},null,8,["modelValue"])]),i("div",go,[l(p,{modelValue:o.form.den_paterno,"onUpdate:modelValue":e[17]||(e[17]=r=>o.form.den_paterno=r),dense:"",outlined:"",clearable:"",label:"Paterno"},null,8,["modelValue"])]),i("div",ho,[l(p,{modelValue:o.form.den_materno,"onUpdate:modelValue":e[18]||(e[18]=r=>o.form.den_materno=r),dense:"",outlined:"",clearable:"",label:"Materno"},null,8,["modelValue"])]),i("div",bo,[l(p,{modelValue:o.form.den_edad,"onUpdate:modelValue":e[19]||(e[19]=r=>o.form.den_edad=r),dense:"",outlined:"",clearable:"",label:"Edad"},null,8,["modelValue"])]),i("div",vo,[l(p,{modelValue:o.form.den_domicilio,"onUpdate:modelValue":e[20]||(e[20]=r=>o.form.den_domicilio=r),dense:"",outlined:"",clearable:"",label:"Domicilio"},null,8,["modelValue"])]),i("div",yo,[l(p,{modelValue:o.form.den_estado_civil,"onUpdate:modelValue":e[21]||(e[21]=r=>o.form.den_estado_civil=r),dense:"",outlined:"",clearable:"",label:"Estado civil"},null,8,["modelValue"])]),i("div",Vo,[l(p,{modelValue:o.form.den_idioma,"onUpdate:modelValue":e[22]||(e[22]=r=>o.form.den_idioma=r),dense:"",outlined:"",clearable:"",label:"Idioma"},null,8,["modelValue"])]),i("div",xo,[l(p,{modelValue:o.form.den_grado_instruccion,"onUpdate:modelValue":e[23]||(e[23]=r=>o.form.den_grado_instruccion=r),dense:"",outlined:"",clearable:"",label:"Grado de instrucción"},null,8,["modelValue"])]),i("div",wo,[l(p,{modelValue:o.form.den_ocupacion,"onUpdate:modelValue":e[24]||(e[24]=r=>o.form.den_ocupacion=r),dense:"",outlined:"",clearable:"",label:"Ocupación"},null,8,["modelValue"])])])]),_:1})]),_:1}),l(w,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:s(()=>[l(v,{class:"row items-center"},{default:s(()=>[l(x,{name:"task_alt",class:"q-mr-sm"}),e[67]||(e[67]=i("div",{class:"text-subtitle1 text-weight-medium"},"5) Seguimiento",-1))]),_:1}),l(q),l(v,null,{default:s(()=>[i("div",ko,[i("div",Co,[l(z,{modelValue:o.form.psicologica_user_id,"onUpdate:modelValue":e[25]||(e[25]=r=>o.form.psicologica_user_id=r),dense:"",outlined:"","emit-value":"","map-options":"",clearable:"",options:n.optPsicologos,label:"Área psicológica (responsable)"},null,8,["modelValue","options"])]),i("div",qo,[l(z,{modelValue:o.form.trabajo_social_user_id,"onUpdate:modelValue":e[26]||(e[26]=r=>o.form.trabajo_social_user_id=r),dense:"",outlined:"","emit-value":"","map-options":"",clearable:"",options:n.optSociales,label:"Área social (responsable)"},null,8,["modelValue","options"])]),i("div",Uo,[l(z,{modelValue:o.form.legal_user_id,"onUpdate:modelValue":e[27]||(e[27]=r=>o.form.legal_user_id=r),dense:"",outlined:"","emit-value":"","map-options":"",clearable:"",options:n.optAbogados,label:"Área legal (responsable)"},null,8,["modelValue","options"])])])]),_:1})]),_:1}),l(w,{flat:"",bordered:"",class:"section-card q-mb-xl"},{default:s(()=>[l(v,{class:"row items-center"},{default:s(()=>[l(x,{name:"inventory_2",class:"q-mr-sm"}),e[68]||(e[68]=i("div",{class:"text-subtitle1 text-weight-medium"},"6) Check documentos adjuntos",-1))]),_:1}),l(q),l(v,null,{default:s(()=>[i("div",Io,[i("div",Eo,[l(X,{modelValue:o.form.doc_ci,"onUpdate:modelValue":e[28]||(e[28]=r=>o.form.doc_ci=r),label:"Fotocopia CI denunciante"},null,8,["modelValue"])]),i("div",So,[l(X,{modelValue:o.form.doc_frontal_denunciado,"onUpdate:modelValue":e[29]||(e[29]=r=>o.form.doc_frontal_denunciado=r),label:"Foto frontal denunciado"},null,8,["modelValue"])]),i("div",Do,[l(X,{modelValue:o.form.doc_frontal_denunciante,"onUpdate:modelValue":e[30]||(e[30]=r=>o.form.doc_frontal_denunciante=r),label:"Foto frontal denunciante"},null,8,["modelValue"])]),i("div",jo,[l(X,{modelValue:o.form.doc_croquis,"onUpdate:modelValue":e[31]||(e[31]=r=>o.form.doc_croquis=r),label:"Croquis del hecho"},null,8,["modelValue"])])])]),_:1})]),_:1})],64)):(m(),y(I,{key:0},[l(w,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:s(()=>[l(v,{class:"row items-center"},{default:s(()=>[l(x,{name:"description",class:"q-mr-sm"}),e[33]||(e[33]=i("div",{class:"text-subtitle1 text-weight-medium"},"1) Datos del caso (S.L.A.M.)",-1))]),_:1}),l(q),l(v,{class:"row q-col-gutter-md"},{default:s(()=>[i("div",be,[e[34]||(e[34]=i("b",null,"Nº Apoyo Integral:",-1)),f(" "+d(n.orDash(o.form.numero_apoyo_integral)),1)]),i("div",ve,[e[35]||(e[35]=i("b",null,"Nº de caso:",-1)),f(" "+d(n.orDash(o.form.numero_caso)),1)]),i("div",ye,[e[36]||(e[36]=i("b",null,"Fecha registro:",-1)),f(" "+d(n.orDash(o.form.fecha_registro)),1)]),e[44]||(e[44]=i("div",{class:"col-12 text-subtitle2 q-mt-sm"},"Idiomas (AM)",-1)),i("div",Ve,"Castellano: "+d(n.yesNo(o.form.am_idioma_castellano)),1),i("div",xe,"Quechua: "+d(n.yesNo(o.form.am_idioma_quechua)),1),i("div",we,"Aymara: "+d(n.yesNo(o.form.am_idioma_aymara)),1),i("div",ke,"Otros: "+d(n.orDash(o.form.am_idioma_otros)),1),e[45]||(e[45]=i("div",{class:"col-12 text-subtitle2 q-mt-sm"},"Teléfonos de referencia",-1)),i("div",Ce,[e[37]||(e[37]=i("b",null,"Tel. fijo:",-1)),f(" "+d(n.orDash(o.form.ref_tel_fijo)),1)]),i("div",qe,[e[38]||(e[38]=i("b",null,"Tel. móvil:",-1)),f(" "+d(n.orDash(o.form.ref_tel_movil)),1)]),i("div",Ue,[e[39]||(e[39]=i("b",null,"Tel. móvil (alt):",-1)),f(" "+d(n.orDash(o.form.ref_tel_movil_alt)),1)]),e[46]||(e[46]=i("div",{class:"col-12 text-subtitle2 q-mt-sm"},"Ubicación",-1)),i("div",Ie,[e[40]||(e[40]=i("b",null,"Latitud:",-1)),f(" "+d(n.orDash(o.form.am_latitud)),1)]),i("div",Ee,[e[41]||(e[41]=i("b",null,"Longitud:",-1)),f(" "+d(n.orDash(o.form.am_longitud)),1)]),e[47]||(e[47]=i("div",{class:"col-12 text-subtitle2 q-mt-sm"},"Hecho y Tipología",-1)),i("div",Se,[e[42]||(e[42]=i("b",null,"Descripción:",-1)),e[43]||(e[43]=f()),i("span",De,d(n.orDash(o.form.hecho_descripcion)),1)]),i("div",je,"Violencia física: "+d(n.yesNo(o.form.tip_violencia_fisica)),1),i("div",Ne,"Violencia psicológica: "+d(n.yesNo(o.form.tip_violencia_psicologica)),1),i("div",Ae,"Abandono: "+d(n.yesNo(o.form.tip_abandono)),1),i("div",Pe,"Apoyo integral: "+d(n.yesNo(o.form.tip_apoyo_integral)),1)]),_:1})]),_:1}),l(w,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:s(()=>[l(v,{class:"row items-center"},{default:s(()=>[l(x,{name:"person_off",class:"q-mr-sm"}),e[48]||(e[48]=i("div",{class:"text-subtitle1 text-weight-medium"},"4) Datos del denunciado/a",-1))]),_:1}),l(q),l(v,{class:"row q-col-gutter-md"},{default:s(()=>[i("div",Te,[e[49]||(e[49]=i("b",null,"Nombre:",-1)),f(" "+d(n.nombreDenunciado),1)]),i("div",Re,[e[50]||(e[50]=i("b",null,"Edad:",-1)),f(" "+d(n.orDash(o.form.den_edad)),1)]),i("div",Oe,[e[51]||(e[51]=i("b",null,"Domicilio:",-1)),f(" "+d(n.orDash(o.form.den_domicilio)),1)]),i("div",Fe,[e[52]||(e[52]=i("b",null,"Estado civil:",-1)),f(" "+d(n.orDash(o.form.den_estado_civil)),1)]),i("div",Le,[e[53]||(e[53]=i("b",null,"Idioma:",-1)),f(" "+d(n.orDash(o.form.den_idioma)),1)]),i("div",Me,[e[54]||(e[54]=i("b",null,"Grado de instrucción:",-1)),f(" "+d(n.orDash(o.form.den_grado_instruccion)),1)]),i("div",Qe,[e[55]||(e[55]=i("b",null,"Ocupación:",-1)),f(" "+d(n.orDash(o.form.den_ocupacion)),1)])]),_:1})]),_:1}),l(w,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:s(()=>[l(v,{class:"row items-center"},{default:s(()=>[l(x,{name:"task_alt",class:"q-mr-sm"}),e[56]||(e[56]=i("div",{class:"text-subtitle1 text-weight-medium"},"5) Seguimiento",-1))]),_:1}),l(q),l(v,{class:"row q-col-gutter-md"},{default:s(()=>[i("div",ze,[e[57]||(e[57]=i("b",null,"Psicología:",-1)),f(" "+d(n.nombreUsuario(o.form.psicologica_user,o.form.psicologica_user_id,o.psicologos)),1)]),i("div",Ge,[e[58]||(e[58]=i("b",null,"Trabajo social:",-1)),f(" "+d(n.nombreUsuario(o.form.trabajo_social_user,o.form.trabajo_social_user_id,o.sociales)),1)]),i("div",Be,[e[59]||(e[59]=i("b",null,"Legal:",-1)),f(" "+d(n.nombreUsuario(o.form.legal_user,o.form.legal_user_id,o.abogados)),1)])]),_:1})]),_:1}),l(w,{flat:"",bordered:"",class:"section-card q-mb-xl"},{default:s(()=>[l(v,{class:"row items-center"},{default:s(()=>[l(x,{name:"inventory_2",class:"q-mr-sm"}),e[60]||(e[60]=i("div",{class:"text-subtitle1 text-weight-medium"},"6) Check documentos adjuntos",-1))]),_:1}),l(q),l(v,{class:"row q-col-gutter-md"},{default:s(()=>[i("div",He,"Fotocopia CI denunciante: "+d(n.yesNo(o.form.doc_ci)),1),i("div",We,"Foto frontal denunciado: "+d(n.yesNo(o.form.doc_frontal_denunciado)),1),i("div",Ye,"Foto frontal denunciante: "+d(n.yesNo(o.form.doc_frontal_denunciante)),1),i("div",Je,"Croquis del hecho: "+d(n.yesNo(o.form.doc_croquis)),1)]),_:1})]),_:1})],64))])}const Ao=D(fe,[["render",No],["__scopeId","data-v-eab17287"]]),Po={name:"SesionesPsicologico",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:null}},data(){return{loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dialog:!1,mode:"create",form:{id:null,fecha:"",titulo:"",duracion_min:null,lugar:"",tipo:"Individual",contenido_html:""},plantilla:null,plantillasOptions:[{label:"Consentimiento informado",value:"consentimiento"},{label:"Informe Psicológico (formato DIO)",value:"informe_dio"},{label:"Acta de sesión (DIO)",value:"acta"},{label:"Informe breve (psicológico)",value:"informe"},{label:"Constancia de asistencia",value:"constancia"}]}},computed:{role(){return this.$store.user?.role||""},canEdit(){return this.role==="Administrador"||this.role==="Psicologo"}},methods:{today(){const t=new Date,e=c=>String(c).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`},openCreate(){this.canEdit&&(this.mode="create",this.plantilla="consentimiento",this.form={id:null,fecha:this.today(),titulo:"",duracion_min:null,lugar:"",tipo:"Individual",contenido_html:""},this.dialog=!0,this.$nextTick(()=>this.applyTemplate("consentimiento")))},openView(t){this.mode="view",this.form={...t},this.dialog=!0},openEdit(t){this.canEdit&&(this.mode="edit",this.form={...t},this.dialog=!0)},applyTemplate(t){if(this.mode==="view")return;const e=this.caso||{},c={nombres:e.denunciante_nombres||e.denunciante_nombre_completo||"",apellidos:[e.denunciante_paterno,e.denunciante_materno].filter(Boolean).join(" "),edad:e.denunciante_edad||"",fecha_nacimiento:e.denunciante_fecha_nacimiento||"",lugar_nacimiento:e.denunciante_lugar_nacimiento||"",grado:e.denunciante_grado||"",ocupacion:e.denunciante_ocupacion_exacto||e.denunciante_ocupacion||"",domicilio:e.denunciante_domicilio_actual||e.denunciante_residencia||"",documento:e.denunciante_documento||"Carnet de identidad",nro:e.denunciante_nro||"",telefono:e.denunciante_telefono||e.denunciante_movil||e.denunciante_fijo||"",estado_civil:e.denunciante_estado_civil||""},g=[];for(let j=1;j<=5;j++){const M=e[`familiar${j}_nombre_completo`],J=e[`familiar${j}_edad`],Z=e[`familiar${j}_parentesco`],se=e[`familiar${j}_celular`];(M||J||Z||se)&&g.push({nombre:M||"",edad:J||"",estado_civil:"",parentesco:Z||"",ocupacion:""})}const o=(this.form.fecha||this.today()).slice(0,4),n=e.caso_numero&&String(e.caso_numero).trim()!==""?String(e.caso_numero):`${String(this.caseId).padStart(2,"0")}/${o}`,a=e.legal_user?.name||e.legal_user?.username||"",r=e.psicologica_user?.name||e.psicologica_user?.username||this.$store?.state?.user?.name||"",u=e.caso_tipologia||e.caso_modalidad?`Evaluación psicológica en el marco de presunta(s) ${[e.caso_tipologia,e.caso_modalidad].filter(Boolean).join(" / ")}.`:"Evaluación psicológica para determinar los efectos emocionales y psicológicos en la evaluada.",T=(()=>{const j=e.caso_fecha_hecho?`el ${e.caso_fecha_hecho}`:"en fecha no precisada",M=[e.caso_lugar_hecho,e.caso_zona,e.caso_direccion].filter(Boolean).join(", "),J=M?`, en ${M}`:"",Z=e.caso_descripcion?` ${e.caso_descripcion}`:"";return`Según la apertura del caso, el hecho habría ocurrido ${j}${J}.${Z}`})(),R=["Entrevista clínica y observación conductual","Aplicación de instrumentos psicométricos según pertinencia (Goldberg, IES-R, Rosenberg)"].join("; ")+".",A=[e.violencia_fisica?"violencia física":null,e.violencia_psicologica?"violencia psicológica":null,e.violencia_sexual?"violencia sexual":null,e.violencia_economica?"violencia económica/patrimonial":null].filter(Boolean),K="Se evidencian reacciones emocionales congruentes con el evento referido, con impacto en el equilibrio afectivo y la autoestima."+(A.length?` Se consideran indicadores asociados a ${A.join(", ")}.`:"")+" No se evidencian signos de psicosis. Se sugiere seguimiento clínico y contención.",E=["Intervención psicológica: terapia focalizada en manejo de ansiedad/estrés y fortalecimiento de recursos personales.","Orientación/asesoramiento legal para evitar revictimización y garantizar medidas de protección, si corresponde."].join(" "),L={casoId:this.caseId,fecha:this.form.fecha||this.today(),titulo:this.form.titulo||"Sesión psicológica",lugar:this.form.lugar||"",tipo:this.form.tipo||"Individual",nombre:e.denunciante_nombre_completo,documento:e.denunciante_nro,numeroCaso:n,abogadoNombre:a,psicologoNombre:r,denunciante:c,familiares:g,motivo:u,antecedentes:T,tecnicas:R,conclusiones:K,recomendaciones:E};t==="acta"?this.form.contenido_html=Q.acta(L):t==="informe"?this.form.contenido_html=Q.informe(L):t==="constancia"?this.form.contenido_html=Q.constancia(L):t==="consentimiento"?this.form.contenido_html=Q.consentimiento(L):t==="informe_dio"&&(this.form.contenido_html=Q.informe_dio(L))},async save(){if(this.canEdit){if(!this.form.titulo){this.$q.notify({type:"negative",message:"El título es obligatorio"});return}if(!this.form.contenido_html){this.$q.notify({type:"negative",message:"El contenido está vacío"});return}this.saving=!0;try{this.form.id?await this.$axios.put(`/slams/sesiones-psicologicas/${this.form.id}`,this.form):await this.$axios.post(`/slams/${this.caseId}/sesiones-psicologicas`,this.form),this.$q.notify({type:"positive",message:"Guardado"}),this.dialog=!1,this.$emit("refresh")}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}}},remove(t){if(!this.canEdit)return;const e=async()=>{try{await this.$axios.delete(`/slams/sesiones-psicologicas/${t.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.$emit("refresh")}catch(c){this.$q.notify({type:"negative",message:c?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar la sesión?").onOk(e):confirm("¿Eliminar la sesión?")&&e()},printPdf(t){const e=this.$axios?.defaults?.baseURL||"";window.open(`${e}/slams/sesiones-psicologicas/${t.id}/pdf`,"_blank")}}},To={class:"row items-center q-mb-sm"},Ro={class:"col"},Oo={class:"text-caption text-grey-7"},Fo={class:"col-auto row items-center q-gutter-sm"},Lo={class:"text-grey-8"},Mo={key:0},Qo={class:"text-subtitle1"},zo={class:"row"},Go={class:"col-12 col-md-3"},Bo={class:"col-12 col-md-5"},Ho={class:"col-6 col-md-2"},Wo={class:"col-6 col-md-2"},Yo={class:"col-12"},Jo={key:0};function Zo(t,e,c,g,o,n){return m(),_(w,{flat:"",bordered:"",class:"q-pa-md"},{default:s(()=>[i("div",To,[i("div",Ro,[e[9]||(e[9]=i("div",{class:"text-subtitle1 text-weight-medium"},"Sesiones (Psicológico)",-1)),i("div",Oo,"Vinculadas al caso #"+d(c.caseId),1)]),i("div",Fo,[l(b,{flat:"",color:"primary",icon:"refresh",loading:o.loading,onClick:e[0]||(e[0]=a=>t.$emit("refresh"))},null,8,["loading"]),n.canEdit?(m(),_(b,{key:0,color:"green",icon:"add_circle_outline","no-caps":"",label:"Crear sesión",onClick:n.openCreate},null,8,["onClick"])):V("",!0)])]),l(q),l($,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:s(()=>[e[15]||(e[15]=i("thead",null,[i("tr",{class:"bg-primary text-white"},[i("th",{style:{width:"70px"}},"ID"),i("th",{style:{width:"140px"}},"Acciones"),i("th",null,"Título"),i("th",{style:{width:"120px"}},"Fecha"),i("th",{style:{width:"120px"}},"Tipo"),i("th",{style:{width:"180px"}},"Usuario")])],-1)),i("tbody",null,[(m(!0),y(I,null,Y(c.caso.psicologicas,a=>(m(),y("tr",{key:a.id},[i("td",Lo,"#"+d(a.id),1),i("td",null,[l(H,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:s(()=>[k((m(),_(U,{clickable:"",onClick:r=>n.openView(a)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"visibility"})]),_:1}),l(h,null,{default:s(()=>e[10]||(e[10]=[f("Ver")])),_:1})]),_:2},1032,["onClick"])),[[C]]),k((m(),_(U,{clickable:"",onClick:r=>n.printPdf(a)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"print"})]),_:1}),l(h,null,{default:s(()=>e[11]||(e[11]=[f("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[C]]),n.canEdit?(m(),y(I,{key:0},[l(q),k((m(),_(U,{clickable:"",onClick:r=>n.openEdit(a)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"edit"})]),_:1}),l(h,null,{default:s(()=>e[12]||(e[12]=[f("Editar")])),_:1})]),_:2},1032,["onClick"])),[[C]]),k((m(),_(U,{clickable:"",onClick:r=>n.remove(a)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"delete",color:"negative"})]),_:1}),l(h,{class:"text-negative"},{default:s(()=>e[13]||(e[13]=[f("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[C]])],64)):V("",!0)]),_:2},1024)]),i("td",null,d(a.titulo),1),i("td",null,d(a.fecha||"s/f"),1),i("td",null,d(a.tipo||"—"),1),i("td",null,d(a.user?.name||a.user?.username||"—"),1)]))),128)),!c.caso.psicologicas||c.caso.psicologicas.length===0?(m(),y("tr",Mo,e[14]||(e[14]=[i("td",{colspan:"6",class:"text-center text-grey"},"Sin registros",-1)]))):V("",!0)])]),_:1}),l(G,{modelValue:o.dialog,"onUpdate:modelValue":e[8]||(e[8]=a=>o.dialog=a),persistent:""},{default:s(()=>[l(w,{style:{"max-width":"900px",width:"95vw"}},{default:s(()=>[l(v,{class:"row items-center q-pb-none"},{default:s(()=>[i("div",Qo,d(o.mode==="view"?"Ver sesión":o.form.id?"Editar sesión":"Nueva sesión"),1),l(W),k(l(b,{flat:"",round:"",dense:"",icon:"close"},null,512),[[C]])]),_:1}),l(v,{class:"q-gutter-md"},{default:s(()=>[i("div",zo,[i("div",Go,[l(p,{modelValue:o.form.fecha,"onUpdate:modelValue":e[1]||(e[1]=a=>o.form.fecha=a),type:"date",dense:"",outlined:"",label:"Fecha",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),i("div",Bo,[l(p,{modelValue:o.form.titulo,"onUpdate:modelValue":e[2]||(e[2]=a=>o.form.titulo=a),dense:"",outlined:"",label:"Título *",readonly:o.mode==="view",rules:[a=>!!a||"Requerido"]},null,8,["modelValue","readonly","rules"])]),i("div",Ho,[l(p,{modelValue:o.form.duracion_min,"onUpdate:modelValue":e[3]||(e[3]=a=>o.form.duracion_min=a),modelModifiers:{number:!0},type:"number",dense:"",outlined:"",label:"Minutos",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),i("div",Wo,[l(p,{modelValue:o.form.tipo,"onUpdate:modelValue":e[4]||(e[4]=a=>o.form.tipo=a),dense:"",outlined:"",label:"Tipo",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),i("div",Yo,[l(p,{modelValue:o.form.lugar,"onUpdate:modelValue":e[5]||(e[5]=a=>o.form.lugar=a),dense:"",outlined:"",label:"Lugar",readonly:o.mode==="view"},null,8,["modelValue","readonly"])])]),o.mode!=="view"?(m(),y("div",Jo,[l(z,{modelValue:o.plantilla,"onUpdate:modelValue":[e[6]||(e[6]=a=>o.plantilla=a),n.applyTemplate],options:o.plantillasOptions,label:"Plantilla",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])])):V("",!0),i("div",null,[e[16]||(e[16]=i("div",{class:"text-caption text-grey-7 q-mb-xs"},"Contenido (WYSIWYG / se guarda HTML)",-1)),l(ie,{modelValue:o.form.contenido_html,"onUpdate:modelValue":e[7]||(e[7]=a=>o.form.contenido_html=a),readonly:o.mode==="view","min-height":"320px",placeholder:"Escriba aquí el contenido de la sesión...",toolbar:[["left","center","right","justify"],["bold","italic","strike","underline"],["quote","unordered","ordered","outdent","indent"],["hr","link"],["undo","redo"],["removeFormat"]]},null,8,["modelValue","readonly"])])]),_:1}),l(q),l(B,{align:"right"},{default:s(()=>[k(l(b,{flat:"",label:"Cerrar"},null,512),[[C]]),o.mode!=="view"&&n.canEdit?(m(),_(b,{key:0,color:"primary",label:"Guardar",loading:o.saving,onClick:n.save},null,8,["loading","onClick"])):V("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Xo=D(Po,[["render",Zo]]),Ko={name:"InformesLegal",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:null}},data(){return{loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dialog:!1,mode:"create",form:{id:null,fecha:"",titulo:"",numero:"",contenido_html:""},plantilla:"informe_legal",plantillasOptions:[{label:"Informe Legal (SLIM)",value:"informe_legal"},{label:"Memorial (simple)",value:"memorial"},{label:"Oficio / Nota",value:"oficio"},{label:"Acta de Compromiso",value:"acta"},{label:"Denuncia penal — Ministerio Público",value:"denuncia_mp"}]}},computed:{role(){return this.$store.user?.role||""},canEdit(){return this.role==="Administrador"||this.role==="Abogado"}},methods:{today(){const t=new Date,e=c=>String(c).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`},openCreate(){this.canEdit&&(this.mode="create",this.form={id:null,fecha:this.today(),titulo:"",numero:"",contenido_html:""},this.dialog=!0,this.$nextTick(()=>this.applyTemplate(this.plantilla)))},openView(t){this.mode="view",this.form={...t},this.dialog=!0},openEdit(t){this.canEdit&&(this.mode="edit",this.form={...t},this.dialog=!0)},applyTemplate(t){if(this.mode==="view")return;const e=this.form.fecha||this.today(),c=e.slice(0,4),o=`
        <div style="text-align:center; margin-bottom:8px;">
          <div style="font-size:16px; font-weight:bold;">DIRECCIÓN DE IGUALDAD DE OPORTUNIDADES</div>
          <div style="font-size:12px;">Gobierno Autónomo Municipal de Oruro</div>
          <div style="font-size:12px; font-weight:bold;">${this.form.numero?`N° ${this.form.numero}`:""}</div>
          <hr/>
        </div>
      `;if(t==="memorial"){this.form.contenido_html=o+`
          <p><b>Señor(a) Juez/Fiscal</b></p>
          <p>De mi consideración:</p>
          <p style="text-align:justify">Por medio del presente, ...</p>
          <p>Oruro, ${e}</p>
        `;return}if(t==="oficio"){this.form.contenido_html=o+`
          <p><b>Ref.:</b> Solicitud de información</p>
          <p>De nuestra consideración:</p>
          <p style="text-align:justify">Solicitamos remitir la información ...</p>
          <p>Oruro, ${e}</p>
        `;return}if(t==="acta"){this.form.contenido_html=o+`
          <p style="text-align:center"><b>ACTA DE COMPROMISO</b></p>
          <p style="text-align:justify">En la ciudad de Oruro, a ${e}, las partes acuerdan ...</p>
        `;return}if(t==="denuncia_mp"){const a=(this.caso||{}).denunciante_nombre_completo||"";this.form.contenido_html=o+`
          <p style="text-align:center"><b>SEÑOR(A) REPRESENTANTE DEL MINISTERIO PÚBLICO — ORURO</b></p>
          <p><b>DENUNCIANTE:</b> ${a||"—"}</p>
          <p style="text-align:justify">Que, en mérito a los antecedentes ...</p>
          <p>Oruro, ${e}</p>
        `;return}this.form.contenido_html=o+`
        <p><b>Informe Legal ${c}</b></p>
        <p style="text-align:justify">En atención a los antecedentes, se emite el presente informe con el siguiente análisis jurídico:</p>
        <p><b>Fundamentos de derecho:</b></p>
        <ul>
          <li>Ley N° 348 y reglamentación.</li>
          <li>Constitución Política del Estado.</li>
          <li>Normativa municipal vigente.</li>
        </ul>
        <p><b>Recomendaciones:</b> …</p>
        <p>Oruro, ${e}</p>
      `},async save(){if(this.canEdit){if(!this.form.titulo)return this.$q.notify({type:"negative",message:"El título es obligatorio"});if(!this.form.contenido_html)return this.$q.notify({type:"negative",message:"El contenido está vacío"});this.saving=!0;try{this.form.id?await this.$axios.put(`/slams/informes-legales/${this.form.id}`,this.form):await this.$axios.post(`/slams/${this.caseId}/informes-legales`,this.form),this.$q.notify({type:"positive",message:"Guardado"}),this.dialog=!1,this.$emit("refresh")}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}}},removeIt(t){if(!this.canEdit)return;const e=async()=>{try{await this.$axios.delete(`/slams/informes-legales/${t.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.$emit("refresh")}catch(c){this.$q.notify({type:"negative",message:c?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar el informe?").onOk(e):confirm("¿Eliminar el informe?")&&e()},printPdf(t){const e=this.$axios?.defaults?.baseURL||"";window.open(`${e}/slams/informes-legales/${t.id}/pdf`,"_blank")}}},$o={class:"row items-center q-mb-sm"},el={class:"col"},ol={class:"text-caption text-grey-7"},ll={class:"col-auto row items-center q-gutter-sm"},il={key:0},tl={class:"text-subtitle1"},al={class:"row q-col-gutter-md"},sl={class:"col-12 col-md-3"},nl={class:"col-12 col-md-7"},rl={class:"col-12 col-md-2"},dl={key:0};function cl(t,e,c,g,o,n){return m(),_(w,{flat:"",bordered:"",class:"q-pa-md"},{default:s(()=>[i("div",$o,[i("div",el,[e[7]||(e[7]=i("div",{class:"text-subtitle1 text-weight-medium"},"Informes legales",-1)),i("div",ol,"Vinculados al caso #"+d(c.caseId),1)]),i("div",ll,[l(b,{flat:"",color:"primary",icon:"refresh",loading:o.loading,onClick:e[0]||(e[0]=a=>t.$emit("refresh"))},null,8,["loading"]),n.canEdit?(m(),_(b,{key:0,color:"green",icon:"add_circle_outline","no-caps":"",label:"Crear informe",onClick:n.openCreate},null,8,["onClick"])):V("",!0)])]),l(q),l($,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:s(()=>[e[13]||(e[13]=i("thead",null,[i("tr",{class:"bg-primary text-white"},[i("th",{style:{width:"70px"}},"ID"),i("th",{style:{width:"140px"}},"Acciones"),i("th",null,"Título"),i("th",{style:{width:"120px"}},"Fecha"),i("th",{style:{width:"120px"}},"Nro"),i("th",{style:{width:"180px"}},"Usuario")])],-1)),i("tbody",null,[(m(!0),y(I,null,Y(c.caso.informes_legales,a=>(m(),y("tr",{key:a.id},[i("td",null,"#"+d(a.id),1),i("td",null,[l(H,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:s(()=>[k((m(),_(U,{clickable:"",onClick:r=>n.openView(a)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"visibility"})]),_:1}),l(h,null,{default:s(()=>e[8]||(e[8]=[f("Ver")])),_:1})]),_:2},1032,["onClick"])),[[C]]),k((m(),_(U,{clickable:"",onClick:r=>n.printPdf(a)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"picture_as_pdf"})]),_:1}),l(h,null,{default:s(()=>e[9]||(e[9]=[f("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[C]]),n.canEdit?(m(),y(I,{key:0},[l(q),k((m(),_(U,{clickable:"",onClick:r=>n.openEdit(a)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"edit"})]),_:1}),l(h,null,{default:s(()=>e[10]||(e[10]=[f("Editar")])),_:1})]),_:2},1032,["onClick"])),[[C]]),k((m(),_(U,{clickable:"",onClick:r=>n.removeIt(a)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"delete",color:"negative"})]),_:1}),l(h,{class:"text-negative"},{default:s(()=>e[11]||(e[11]=[f("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[C]])],64)):V("",!0)]),_:2},1024)]),i("td",null,d(a.titulo),1),i("td",null,d(a.fecha||"s/f"),1),i("td",null,d(a.numero||"—"),1),i("td",null,d(a.user?.name||a.user?.username||"—"),1)]))),128)),!c.caso.informes_legales.length&&!o.loading?(m(),y("tr",il,e[12]||(e[12]=[i("td",{colspan:"6",class:"text-center text-grey"},"Sin registros",-1)]))):V("",!0)])]),_:1}),l(G,{modelValue:o.dialog,"onUpdate:modelValue":e[6]||(e[6]=a=>o.dialog=a),persistent:"",maximized:""},{default:s(()=>[l(w,null,{default:s(()=>[l(ne,{class:"bg-white text-dark"},{default:s(()=>[i("div",tl,d(o.mode==="view"?"Ver informe":o.form.id?"Editar informe":"Nuevo informe"),1),l(W),k(l(b,{flat:"",dense:"",round:"",icon:"close"},null,512),[[C]])]),_:1}),l(q),l(v,{class:""},{default:s(()=>[i("div",al,[i("div",sl,[l(p,{modelValue:o.form.fecha,"onUpdate:modelValue":e[1]||(e[1]=a=>o.form.fecha=a),type:"date",dense:"",outlined:"",label:"Fecha",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),i("div",nl,[l(p,{modelValue:o.form.titulo,"onUpdate:modelValue":e[2]||(e[2]=a=>o.form.titulo=a),dense:"",outlined:"",label:"Título *",readonly:o.mode==="view",rules:[a=>!!a||"Requerido"]},null,8,["modelValue","readonly","rules"])]),i("div",rl,[l(p,{modelValue:o.form.numero,"onUpdate:modelValue":e[3]||(e[3]=a=>o.form.numero=a),dense:"",outlined:"",label:"Nro",readonly:o.mode==="view"},null,8,["modelValue","readonly"])])]),o.mode!=="view"?(m(),y("div",dl,[l(z,{modelValue:o.plantilla,"onUpdate:modelValue":[e[4]||(e[4]=a=>o.plantilla=a),n.applyTemplate],options:o.plantillasOptions,label:"Plantilla",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])])):V("",!0),i("div",null,[e[14]||(e[14]=i("div",{class:"text-caption text-grey-7 q-mb-xs"},"Contenido (WYSIWYG / guarda HTML)",-1)),l(ie,{modelValue:o.form.contenido_html,"onUpdate:modelValue":e[5]||(e[5]=a=>o.form.contenido_html=a),readonly:o.mode==="view","min-height":"320px",placeholder:"Escriba el informe legal...",toolbar:[["left","center","right","justify"],["bold","italic","strike","underline"],["quote","unordered","ordered","outdent","indent"],["hr","link"],["undo","redo"],["removeFormat"]]},null,8,["modelValue","readonly"])])]),_:1}),l(q),l(B,{align:"right"},{default:s(()=>[k(l(b,{flat:"",label:"Cerrar"},null,512),[[C]]),o.mode!=="view"&&n.canEdit?(m(),_(b,{key:0,color:"primary",label:"Guardar",loading:o.saving,onClick:n.save},null,8,["loading","onClick"])):V("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ul=D(Ko,[["render",cl]]),ml={name:"ApoyoIntegral",props:{caseId:{type:[String,Number],required:!0}}},fl={class:"text-grey-7"};function _l(t,e,c,g,o,n){return m(),_(w,{flat:"",bordered:"",class:"q-pa-md"},{default:s(()=>[e[0]||(e[0]=i("div",{class:"text-subtitle1 text-weight-medium q-mb-sm"},"Apoyo integral",-1)),i("div",fl,"DIO personal, descripción, impresión (ID: "+d(c.caseId)+")",1)]),_:1})}const pl=D(ml,[["render",_l]]),gl={name:"DocumentosGeneral",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,required:!1}},data(){return{loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dlgUpload:!1,file:null,meta:{titulo:"",categoria:"",descripcion:""},accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.odt,.ods,.txt,.zip,.jpg,.jpeg,.png,.webp",dlgEdit:!1,edit:{},editingId:null}},methods:{openUpload(){this.file=null,this.meta={titulo:"",categoria:"",descripcion:""},this.dlgUpload=!0},async upload(){if(!this.file){this.$q.notify({type:"negative",message:"Seleccione un archivo"});return}this.saving=!0;try{const t=new FormData;t.append("file",this.file),this.meta.titulo&&t.append("titulo",this.meta.titulo),this.meta.categoria&&t.append("categoria",this.meta.categoria),this.meta.descripcion&&t.append("descripcion",this.meta.descripcion),await this.$axios.post(`/slams/${this.caseId}/documentos`,t,{headers:{"Content-Type":"multipart/form-data"}}),this.$q.notify({type:"positive",message:"Archivo subido"}),this.dlgUpload=!1,this.$emit("refresh")}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"No se pudo subir"})}finally{this.saving=!1}},viewDoc(t){const e=this.$axios?.defaults?.baseURL||"";window.open(`${e}/slams/documentos/${t.id}/view`,"_blank")},downloadDoc(t){const e=this.$axios?.defaults?.baseURL||"";window.open(`${e}/slams/documentos/${t.id}/download`,"_blank")},editMeta(t){this.editingId=t.id,this.edit={titulo:t.titulo,categoria:t.categoria,descripcion:t.descripcion},this.dlgEdit=!0},async saveMeta(){this.saving=!0;try{await this.$axios.put(`/slams/documentos/${this.editingId}`,this.edit),this.$q.notify({type:"positive",message:"Actualizado"}),this.dlgEdit=!1,this.$emit("refresh")}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"No se pudo actualizar"})}finally{this.saving=!1}},removeDoc(t){const e=async()=>{try{await this.$axios.delete(`/slams/documentos/${t.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.$emit("refresh")}catch(c){this.$q.notify({type:"negative",message:c?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar el documento?").onOk(e):confirm("¿Eliminar el documento?")&&e()}}},hl={class:"row items-center q-mb-sm"},bl={class:"col"},vl={class:"text-caption text-grey-7"},yl={class:"col-auto row items-center q-gutter-sm"},Vl={class:"text-weight-medium"},xl={key:0};function wl(t,e,c,g,o,n){return m(),_(w,{flat:"",bordered:"",class:"q-pa-md"},{default:s(()=>[i("div",hl,[i("div",bl,[e[10]||(e[10]=i("div",{class:"text-subtitle1 text-weight-medium"},"Documentos (General)",-1)),i("div",vl,"Gestión de adjuntos del caso #"+d(c.caseId),1)]),i("div",yl,[l(b,{flat:"",color:"primary",icon:"refresh",loading:o.loading,onClick:e[0]||(e[0]=a=>t.$emit("refresh"))},null,8,["loading"]),l(b,{color:"green",icon:"upload","no-caps":"",label:"Subir archivo",onClick:n.openUpload},null,8,["onClick"])])]),l(q),l($,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:s(()=>[e[16]||(e[16]=i("thead",null,[i("tr",{class:"bg-primary text-white"},[i("th",{style:{width:"70px"}},"ID"),i("th",{style:{width:"160px"}},"Acciones"),i("th",null,"Título"),i("th",{style:{width:"130px"}},"Categoría"),i("th",{style:{width:"120px"}},"Tamaño"),i("th",{style:{width:"160px"}},"Tipo"),i("th",{style:{width:"180px"}},"Usuario")])],-1)),i("tbody",null,[(m(!0),y(I,null,Y(c.caso.documentos,a=>(m(),y("tr",{key:a.id},[i("td",null,"#"+d(a.id),1),i("td",null,[l(H,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:s(()=>[k((m(),_(U,{clickable:"",onClick:r=>n.viewDoc(a)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"visibility"})]),_:1}),l(h,null,{default:s(()=>e[11]||(e[11]=[f("Ver")])),_:1})]),_:2},1032,["onClick"])),[[C]]),k((m(),_(U,{clickable:"",onClick:r=>n.downloadDoc(a)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"download"})]),_:1}),l(h,null,{default:s(()=>e[12]||(e[12]=[f("Descargar")])),_:1})]),_:2},1032,["onClick"])),[[C]]),l(q),k((m(),_(U,{clickable:"",onClick:r=>n.editMeta(a)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"edit"})]),_:1}),l(h,null,{default:s(()=>e[13]||(e[13]=[f("Editar")])),_:1})]),_:2},1032,["onClick"])),[[C]]),k((m(),_(U,{clickable:"",onClick:r=>n.removeDoc(a)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"delete",color:"negative"})]),_:1}),l(h,{class:"text-negative"},{default:s(()=>e[14]||(e[14]=[f("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[C]])]),_:2},1024)]),i("td",Vl,d(a.titulo),1),i("td",null,d(a.categoria||"—"),1),i("td",null,d(a.size_human),1),i("td",null,d(a.mime||a.extension),1),i("td",null,d(a.user?.name||a.user?.username||"—"),1)]))),128)),!c.caso.documentos||c.caso.documentos.length===0?(m(),y("tr",xl,e[15]||(e[15]=[i("td",{colspan:"7",class:"text-center text-grey"},"Sin registros",-1)]))):V("",!0)])]),_:1}),l(G,{modelValue:o.dlgUpload,"onUpdate:modelValue":e[5]||(e[5]=a=>o.dlgUpload=a),persistent:""},{default:s(()=>[l(w,{style:{"max-width":"700px",width:"95vw"}},{default:s(()=>[l(v,{class:"row items-center q-pb-none"},{default:s(()=>[e[17]||(e[17]=i("div",{class:"text-subtitle1"},"Subir archivo",-1)),l(W),k(l(b,{flat:"",dense:"",round:"",icon:"close"},null,512),[[C]])]),_:1}),l(v,{class:"q-gutter-md"},{default:s(()=>[l(p,{modelValue:o.meta.titulo,"onUpdate:modelValue":e[1]||(e[1]=a=>o.meta.titulo=a),label:"Título",outlined:"",dense:""},null,8,["modelValue"]),l(p,{modelValue:o.meta.categoria,"onUpdate:modelValue":e[2]||(e[2]=a=>o.meta.categoria=a),label:"Categoría",outlined:"",dense:""},null,8,["modelValue"]),l(p,{modelValue:o.meta.descripcion,"onUpdate:modelValue":e[3]||(e[3]=a=>o.meta.descripcion=a),type:"textarea",label:"Descripción",outlined:"",dense:"",autogrow:""},null,8,["modelValue"]),l(re,{modelValue:o.file,"onUpdate:modelValue":e[4]||(e[4]=a=>o.file=a),outlined:"",dense:"","use-chips":"",clearable:!0,accept:o.accept,hint:"Hasta 20MB. PDF, Word, Excel, imágenes, etc."},null,8,["modelValue","accept"])]),_:1}),l(B,{align:"right"},{default:s(()=>[k(l(b,{flat:"",label:"Cancelar"},null,512),[[C]]),l(b,{color:"primary",label:"Subir",loading:o.saving,onClick:n.upload},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(G,{modelValue:o.dlgEdit,"onUpdate:modelValue":e[9]||(e[9]=a=>o.dlgEdit=a)},{default:s(()=>[l(w,{style:{"max-width":"600px",width:"95vw"}},{default:s(()=>[l(v,{class:"row items-center q-pb-none"},{default:s(()=>[e[18]||(e[18]=i("div",{class:"text-subtitle1"},"Editar metadatos",-1)),l(W),k(l(b,{flat:"",dense:"",round:"",icon:"close"},null,512),[[C]])]),_:1}),l(v,{class:"q-gutter-md"},{default:s(()=>[l(p,{modelValue:o.edit.titulo,"onUpdate:modelValue":e[6]||(e[6]=a=>o.edit.titulo=a),label:"Título",outlined:"",dense:""},null,8,["modelValue"]),l(p,{modelValue:o.edit.categoria,"onUpdate:modelValue":e[7]||(e[7]=a=>o.edit.categoria=a),label:"Categoría",outlined:"",dense:""},null,8,["modelValue"]),l(p,{modelValue:o.edit.descripcion,"onUpdate:modelValue":e[8]||(e[8]=a=>o.edit.descripcion=a),type:"textarea",label:"Descripción",outlined:"",dense:"",autogrow:""},null,8,["modelValue"])]),_:1}),l(B,{align:"right"},{default:s(()=>[k(l(b,{flat:"",label:"Cancelar"},null,512),[[C]]),l(b,{color:"primary",label:"Guardar",loading:o.saving,onClick:n.saveMeta},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const kl=D(gl,[["render",wl]]),Cl={name:"Fotografias",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,required:!0}},data(){return{rows:{data:[],last_page:1},page:1,perPage:12,loading:!1,uploading:!1}},methods:{toPublicUrl(t){return console.log("url",t),t?/^https?:\/\//i.test(t)?t:`${(this.$axios?.defaults?.baseURL||"").replace(/\/api\/?$/,"")}${t}`:""},pickFile(){this.$refs.file.click()},async upload(t){const e=t.target.files?.[0];if(e){this.uploading=!0;try{const c=new FormData;c.append("file",e),await this.$axios.post(`/slams/${this.caseId}/fotografias`,c,{headers:{"Content-Type":"multipart/form-data"}}),this.$q.notify({type:"positive",message:"Foto subida"}),this.$emit("refresh")}catch(c){this.$q.notify({type:"negative",message:c?.response?.data?.message||"No se pudo subir"})}finally{this.uploading=!1,this.$refs.file&&(this.$refs.file.value="")}}},async remove(t){if(confirm("¿Eliminar foto?"))try{await this.$axios.delete(`/slams/fotografias/${t.id}`),this.$q.notify({type:"positive",message:"Eliminada"}),this.$emit("refresh")}catch(e){this.$q.notify({type:"negative",message:e?.response?.data?.message||"No se pudo eliminar"})}},view(t){t&&window.open(t,"_blank")}}},ql={class:"row items-center q-mb-sm"},Ul={class:"col"},Il={class:"text-caption text-grey-7"},El={class:"col-auto"},Sl={class:"row q-col-gutter-md q-mt-sm"},Dl={class:"absolute-bottom text-subtitle2 bg-black bg-opacity-40 q-pa-xs ellipsis"};function jl(t,e,c,g,o,n){return m(),_(w,{flat:"",bordered:"",class:"q-pa-md"},{default:s(()=>[i("div",ql,[i("div",Ul,[e[1]||(e[1]=i("div",{class:"text-subtitle1 text-weight-medium"},"Fotografías",-1)),i("div",Il,"Sube/ver fotos del caso #"+d(c.caseId),1)]),i("div",El,[l(b,{color:"primary",icon:"add_photo_alternate","no-caps":"",label:"Subir",onClick:n.pickFile,loading:o.uploading},null,8,["onClick","loading"]),i("input",{type:"file",ref:"file",accept:"image/*",class:"hidden",onChange:e[0]||(e[0]=(...a)=>n.upload&&n.upload(...a))},null,544)])]),l(q),i("div",Sl,[(m(!0),y(I,null,Y(c.caso.fotografias,a=>(m(),y("div",{key:a.id,class:"col-6 col-sm-4 col-md-3"},[l(w,{flat:"",bordered:""},{default:s(()=>[l(te,{src:n.toPublicUrl(a.thumb_url||a.url),ratio:4/3,onClick:r=>n.view(n.toPublicUrl(a.url)),style:{cursor:"pointer"}},{default:s(()=>[i("div",Dl,d(a.titulo),1)]),_:2},1032,["src","onClick"]),l(B,{align:"between"},{default:s(()=>[l(b,{dense:"",flat:"",icon:"delete",color:"negative",onClick:r=>n.remove(a)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))])]),_:1})}const Nl=D(Cl,[["render",jl]]),Al={name:"HojaRuta",props:{caseId:{type:[String,Number],required:!0}},data(){return{loading:!1,editing:!1,backup:null,form:{caso_numero:"",fecha_apertura_caso:"",fecha_derivacion_psicologica:"",fecha_informe_area_psicologica:"",fecha_informe_trabajo_social:"",fecha_derivacion_area_legal:""}}},computed:{canEdit(){const t=this.$store.user?.role||"";return t==="Administrador"||t==="Asistente"},isReadOnly(){return!this.editing||!this.canEdit},total(){return 5},done(){return["fecha_apertura_caso","fecha_derivacion_psicologica","fecha_informe_area_psicologica","fecha_informe_trabajo_social","fecha_derivacion_area_legal"].filter(e=>!!this.form[e]).length}},created(){this.fetch()},methods:{format(t){return t||"—"},async fetch(){this.loading=!0;try{const{data:t}=await this.$axios.get(`/slims/${this.caseId}`);this.form={caso_numero:t.caso_numero||"",fecha_apertura_caso:t.fecha_apertura_caso||"",fecha_derivacion_psicologica:t.fecha_derivacion_psicologica||"",fecha_informe_area_psicologica:t.fecha_informe_area_psicologica||"",fecha_informe_trabajo_social:t.fecha_informe_trabajo_social||"",fecha_derivacion_area_legal:t.fecha_derivacion_area_legal||""},this.backup={...this.form}}catch(t){this.$alert?.error(t?.response?.data?.message||"No se pudo cargar la hoja de ruta")}finally{this.loading=!1}},startEdit(){this.canEdit&&(this.editing=!0,this.backup={...this.form})},cancelEdit(){this.form={...this.backup},this.editing=!1,this.$q.notify({type:"info",message:"Cambios descartados"})},async save(){if(!this.canEdit)return;const t={fecha_derivacion_psicologica:this.form.fecha_derivacion_psicologica||null,fecha_informe_area_psicologica:this.form.fecha_informe_area_psicologica||null,fecha_informe_trabajo_social:this.form.fecha_informe_trabajo_social||null,fecha_derivacion_area_legal:this.form.fecha_derivacion_area_legal||null};this.loading=!0;try{const{data:e}=await this.$axios.put(`/slims/${this.caseId}`,t);this.form={...this.form,fecha_derivacion_psicologica:e.data?.fecha_derivacion_psicologica??this.form.fecha_derivacion_psicologica,fecha_informe_area_psicologica:e.data?.fecha_informe_area_psicologica??this.form.fecha_informe_area_psicologica,fecha_informe_trabajo_social:e.data?.fecha_informe_trabajo_social??this.form.fecha_informe_trabajo_social,fecha_derivacion_area_legal:e.data?.fecha_derivacion_area_legal??this.form.fecha_derivacion_area_legal},this.backup={...this.form},this.editing=!1,this.$alert?.success("Hoja de ruta actualizada")}catch(e){this.$alert?.error(e?.response?.data?.message||"No se pudo actualizar")}finally{this.loading=!1}}}},Pl={class:"row items-center q-mb-sm"},Tl={class:"col"},Rl={class:"text-caption text-grey-7"},Ol={class:"col-auto row items-center q-gutter-sm"},Fl={class:"row q-col-gutter-md"},Ll={class:"col-12 col-md-3"},Ml={class:"col-12 col-md-3"},Ql={class:"col-12 col-md-3"},zl={class:"col-12 col-md-3"},Gl={class:"col-12 col-md-3"},Bl={class:"col-12 col-md-3"};function Hl(t,e,c,g,o,n){return m(),y("div",null,[i("div",Pl,[i("div",Tl,[e[6]||(e[6]=i("div",{class:"text-subtitle1 text-weight-medium"},"Hoja de ruta",-1)),i("div",Rl," Completa las fechas clave del caso ("+d(n.done)+"/"+d(n.total)+" completadas) ",1)]),i("div",Ol,[n.canEdit?V("",!0):(m(),_(le,{key:0,dense:"",color:"grey-3","text-color":"grey-9",icon:"visibility_off"},{default:s(()=>e[7]||(e[7]=[f(" Solo lectura ")])),_:1})),l(b,{flat:"",color:"secondary",icon:"refresh",loading:o.loading,onClick:n.fetch},null,8,["loading","onClick"]),n.canEdit?(m(),y(I,{key:1},[o.editing?(m(),y(I,{key:1},[l(b,{flat:"",color:"negative",icon:"close",label:"Cancelar",onClick:n.cancelEdit,loading:o.loading},null,8,["onClick","loading"]),l(b,{color:"primary",icon:"save",label:"Guardar",onClick:n.save,loading:o.loading},null,8,["onClick","loading"])],64)):(m(),_(b,{key:0,color:"primary",icon:"edit",label:"Editar",onClick:n.startEdit,loading:o.loading},null,8,["onClick","loading"]))],64)):V("",!0)])]),l(w,{flat:"",bordered:"",class:"section-card"},{default:s(()=>[l(v,null,{default:s(()=>[i("div",Fl,[i("div",Ll,[l(p,{modelValue:o.form.caso_numero,"onUpdate:modelValue":e[0]||(e[0]=a=>o.form.caso_numero=a),label:"Código de caso",dense:"",outlined:"",readonly:""},null,8,["modelValue"])]),i("div",Ml,[l(p,{modelValue:o.form.fecha_apertura_caso,"onUpdate:modelValue":e[1]||(e[1]=a=>o.form.fecha_apertura_caso=a),type:"date",label:"Fecha de apertura del caso",dense:"",outlined:"",readonly:""},null,8,["modelValue"])]),i("div",Ql,[l(p,{modelValue:o.form.fecha_derivacion_psicologica,"onUpdate:modelValue":e[2]||(e[2]=a=>o.form.fecha_derivacion_psicologica=a),type:"date",readonly:n.isReadOnly,dense:"",outlined:"",label:"Fecha de derivación psicológica"},null,8,["modelValue","readonly"])]),i("div",zl,[l(p,{modelValue:o.form.fecha_informe_area_psicologica,"onUpdate:modelValue":e[3]||(e[3]=a=>o.form.fecha_informe_area_psicologica=a),type:"date",readonly:n.isReadOnly,dense:"",outlined:"",label:"Fecha de entrega informe (Área psicológica)"},null,8,["modelValue","readonly"])]),i("div",Gl,[l(p,{modelValue:o.form.fecha_informe_trabajo_social,"onUpdate:modelValue":e[4]||(e[4]=a=>o.form.fecha_informe_trabajo_social=a),type:"date",readonly:n.isReadOnly,dense:"",outlined:"",label:"Fecha de entrega (Trabajo social)"},null,8,["modelValue","readonly"])]),i("div",Bl,[l(p,{modelValue:o.form.fecha_derivacion_area_legal,"onUpdate:modelValue":e[5]||(e[5]=a=>o.form.fecha_derivacion_area_legal=a),type:"date",readonly:n.isReadOnly,dense:"",outlined:"",label:"Fecha de derivación (Área legal)"},null,8,["modelValue","readonly"])])])]),_:1}),l(q),l(v,null,{default:s(()=>[l(ae,{color:"primary",layout:"comfortable",side:"right"},{default:s(()=>[l(F,{title:"Apertura del caso",subtitle:n.format(o.form.fecha_apertura_caso),icon:"flag"},null,8,["subtitle"]),l(F,{title:"Derivación psicológica",subtitle:n.format(o.form.fecha_derivacion_psicologica),icon:"psychology",color:o.form.fecha_derivacion_psicologica?"primary":"grey-5"},null,8,["subtitle","color"]),l(F,{title:"Informe área psicológica",subtitle:n.format(o.form.fecha_informe_area_psicologica),icon:"assignment_turned_in",color:o.form.fecha_informe_area_psicologica?"primary":"grey-5"},null,8,["subtitle","color"]),l(F,{title:"Entrega trabajo social",subtitle:n.format(o.form.fecha_informe_trabajo_social),icon:"diversity_3",color:o.form.fecha_informe_trabajo_social?"primary":"grey-5"},null,8,["subtitle","color"]),l(F,{title:"Derivación área legal",subtitle:n.format(o.form.fecha_derivacion_area_legal),icon:"gavel",color:o.form.fecha_derivacion_area_legal?"primary":"grey-5"},null,8,["subtitle","color"])]),_:1})]),_:1})]),_:1})])}const Wl=D(Al,[["render",Hl],["__scopeId","data-v-601f57f4"]]),Yl={name:"SeguimientoSlam",props:{caso:{type:Object,required:!0}},data(){return{header:{},history:[],dialog:{show:!1,title:"",html:""}}},mounted(){this.hydrate()},watch:{caso:{handler(){this.hydrate()},deep:!0}},methods:{hydrate(){const t=this.caso?.slam?this.caso.slam:this.caso||{},e=(t.adultos||[]).map(u=>[u.nombre,u.paterno,u.materno].filter(Boolean).join(" ")).filter(Boolean).join(" · "),c=[t.den_nombres,t.den_paterno,t.den_materno].filter(Boolean).join(" "),g=[t.ref_tel_movil,t.ref_tel_fijo,t.ref_tel_movil_alt].filter(Boolean).join(" / "),o=t.am_latitud&&t.am_longitud?`${t.am_latitud}, ${t.am_longitud}`:"";this.header={area:t.area,zona:t.zona,fecha_registro:t.fecha_registro,numero_caso:t.numero_caso||t.numero_apoyo_integral,registrado_por:t.user?.name||"—",adultos:e||"—",denunciado:c||"—",contacto:g||"",latlng:o};const n=[];(t.psicologicas||[]).forEach(u=>{n.push({uid:`psy-${u.id}`,kind:"psy",icon:"psychology",side:"left",date:(u.fecha||u.created_at||"").slice(0,10)||"0000-00-00",title:`Psicológico · ${u.titulo||"Sin título"}`,subtitle:`${(u.fecha||"").slice(0,10)} · ${u.tipo||"—"} · ${u.user?.name||"—"}`,brief:u.lugar?`Lugar: ${u.lugar}`:"",html:u.contenido_html||u.contenido||null})}),(t.informes_legales||t.informesLegales||[]).forEach(u=>{n.push({uid:`legal-${u.id}`,kind:"legal",icon:"gavel",side:"right",date:(u.fecha||u.created_at||"").slice(0,10)||"0000-00-00",title:`Legal · ${u.titulo||"Informe"}`,subtitle:`${(u.fecha||"").slice(0,10)} · ${u.user?.name||"—"}`,brief:u.numero?`Informe N° ${u.numero}`:u.descripcion||"",html:u.contenido_html||u.contenido||null})}),(t.documentos||[]).forEach(u=>{n.push({uid:`doc-${u.id}`,kind:"doc",icon:"description",side:"left",date:(u.created_at||u.fecha||"").slice(0,10)||"0000-00-00",title:`Documento · ${u.titulo||u.original_name||u.filename||"Archivo"}`,subtitle:`${u.size_human||""} ${u.extension?"· "+String(u.extension).toUpperCase():""} · ${u.user?.name||"—"}`,brief:u.descripcion||"",url:this.firstUrl(u)})}),(t.fotografias||t.fotos||[]).forEach(u=>{n.push({uid:`photo-${u.id}`,kind:"photo",icon:"photo",side:"right",date:(u.created_at||u.fecha||"").slice(0,10)||"0000-00-00",title:`Fotografía · ${u.titulo||u.original_name||u.filename||"Imagen"}`,subtitle:`${u.width&&u.height?`${u.width}×${u.height}`:""} ${u.user?.name?"· "+u.user.name:""}`,brief:u.descripcion||"",url:this.firstUrl(u),thumbUrl:u.thumb_url||u.thumbPath||u.thumb||null})}),n.sort((u,T)=>{const R=u.date||"0000-00-00",A=T.date||"0000-00-00";return R===A?u.uid>T.uid?1:-1:A.localeCompare(R)}),this.history=n},firstUrl(t={}){const e=t.url||t.public_url||t.path||t.file_url||"";return this.toPublicUrl(e)},toPublicUrl(t){return t?/^https?:\/\//i.test(t)?t:`${(this.$axios?.defaults?.baseURL||"").replace(/\/api\/?$/,"")}${t.startsWith("/")?t:`/${t}`}`:""},open(t){const e=this.toPublicUrl(t);e&&window.open(e,"_blank")},openHtml(t,e){this.dialog.title=t||"Contenido",this.dialog.html=e||"<em>Sin contenido</em>",this.dialog.show=!0}}},Jl={class:"row items-start q-col-gutter-sm"},Zl={class:"col-12 col-md-8"},Xl={class:"text-caption text-grey-7"},Kl={class:"text-caption"},$l={class:"col-12 col-md-4 flex items-center justify-end"},ei={class:"row q-col-gutter-sm"},oi={class:"col-12 col-md-4"},li={class:"val"},ii={class:"col-12 col-md-4"},ti={class:"val"},ai={class:"col-12 col-md-4"},si={class:"val ellipsis"},ni={key:0,class:"text-grey-7"},ri={class:"q-mt-sm"},di={class:"row q-gutter-xs"},ci={key:0,class:"text-grey-7 text-center q-mt-lg"},ui={class:"text-subtitle1 text-weight-medium"},mi=["innerHTML"];function fi(t,e,c,g,o,n){return m(),y("div",null,[l(w,{flat:"",bordered:"",class:"q-pa-sm q-mb-md"},{default:s(()=>[i("div",Jl,[i("div",Zl,[e[6]||(e[6]=i("div",{class:"text-subtitle1 text-weight-bold"},"Seguimiento del Caso — SLAM",-1)),i("div",Xl,[e[1]||(e[1]=f(" Área ")),i("b",null,d(o.header.area||"—"),1),e[2]||(e[2]=f(" · Zona ")),i("b",null,d(o.header.zona||"—"),1)]),i("div",Kl,[e[3]||(e[3]=f(" N° Caso: ")),i("b",null,d(o.header.numero_caso||"—"),1),e[4]||(e[4]=i("span",{class:"text-grey-7"}," · Registrado:",-1)),e[5]||(e[5]=f()),i("b",null,d(o.header.fecha_registro||"—"),1)])]),i("div",$l,[l(le,{dense:"",color:"indigo-1","text-color":"indigo-9",class:"q-mr-xs"},{default:s(()=>[f(d(o.header.registrado_por||"—"),1)]),_:1})])]),l(q,{class:"q-my-sm"}),i("div",ei,[i("div",oi,[e[7]||(e[7]=i("div",{class:"lbl"},"Adulto(s) mayor(es)",-1)),i("div",li,d(o.header.adultos||"—"),1)]),i("div",ii,[e[8]||(e[8]=i("div",{class:"lbl"},"Denunciado",-1)),i("div",ti,d(o.header.denunciado||"—"),1)]),i("div",ai,[e[9]||(e[9]=i("div",{class:"lbl"},"Contacto / Ubicación",-1)),i("div",si,[f(d(o.header.contacto||"—")+" ",1),o.header.latlng?(m(),y("span",ni," · "+d(o.header.latlng),1)):V("",!0)])])])]),_:1}),l(w,{flat:"",bordered:"",class:"q-pa-md"},{default:s(()=>[e[10]||(e[10]=i("div",{class:"text-subtitle1 text-weight-medium q-mb-md"},"Historial",-1)),l(ae,{color:"primary",layout:"comfortable"},{default:s(()=>[(m(!0),y(I,null,Y(o.history,a=>(m(),_(F,{key:a.uid,title:a.title,subtitle:a.subtitle,body:a.brief,icon:a.icon,side:a.side},{default:s(()=>[i("div",ri,[i("div",di,[a.kind==="doc"&&a.url?(m(),_(b,{key:0,dense:"",flat:"",icon:"download",label:"Descargar / Abrir",onClick:r=>n.open(a.url)},null,8,["onClick"])):V("",!0),a.kind==="photo"&&a.url?(m(),_(b,{key:1,dense:"",flat:"",icon:"image",label:"Ver imagen",onClick:r=>n.open(a.url)},null,8,["onClick"])):V("",!0),(a.kind==="psy"||a.kind==="legal")&&a.html?(m(),_(b,{key:2,dense:"",flat:"",icon:"visibility",label:"Ver contenido",onClick:r=>n.openHtml(a.title,a.html)},null,8,["onClick"])):V("",!0)]),a.kind==="photo"&&a.thumbUrl?(m(),_(te,{key:0,src:n.toPublicUrl(a.thumbUrl),ratio:16/9,class:"q-mt-sm rounded-borders",style:{"max-width":"380px"},alt:a.title,"spinner-color":"primary"},null,8,["src","alt"])):V("",!0)])]),_:2},1032,["title","subtitle","body","icon","side"]))),128))]),_:1}),o.history.length?V("",!0):(m(),y("div",ci," Sin actividades registradas. "))]),_:1}),l(G,{modelValue:o.dialog.show,"onUpdate:modelValue":e[0]||(e[0]=a=>o.dialog.show=a),maximized:""},{default:s(()=>[l(w,{style:{"max-width":"1000px",width:"100%"}},{default:s(()=>[l(v,{class:"row items-center"},{default:s(()=>[i("div",ui,d(o.dialog.title),1),l(W),k(l(b,{dense:"",flat:"",icon:"close"},null,512),[[C]])]),_:1}),l(q),l(v,null,{default:s(()=>[i("div",{class:"html-content",innerHTML:o.dialog.html},null,8,mi)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const _i=D(Yl,[["render",fi],["__scopeId","data-v-cc1fd5eb"]]),pi={name:"SlamDetalle",components:{InfoGeneral:Ao,SesionesPsicologico:Xo,InformesLegal:ul,ApoyoIntegral:pl,DocumentosGeneral:kl,Fotografias:Nl,HojaRuta:Wl,Seguimiento:_i},data(){return{loading:!1,tab:"info",slam:null,defaultCountryCallingCode:"591"}},computed:{caseId(){return this.$route.params.id},role(){return this.$store.user?.role||""},hasAnyWa(){const t=this.slam||{};return!!(t?.psicologica_user?.celular||t?.legal_user?.celular||t?.trabajo_social_user?.celular)}},created(){this.fetchSlam()},methods:{normalizePhone(t){if(!t)return"";let e=String(t).replace(/\D+/g,"");return/^(\d{11,13})$/.test(e)?e:e.length===8?this.defaultCountryCallingCode+e:e.length===9&&!e.startsWith(this.defaultCountryCallingCode)?this.defaultCountryCallingCode+e:e},waUrl(t,e){const c=this.normalizePhone(t),g=encodeURIComponent(e||"");return`https://wa.me/${c}${g?`?text=${g}`:""}`},waMessage(t){const e=this.slam||{},c=e.caso_numero?e.caso_numero.replace(/\\\//g,"/"):`#${this.caseId}`,g=(this.$axios?.defaults?.baseURL||"")+`/slams/${this.caseId}`,o=t==="psico"?"Psicología":t==="legal"?"Legal":"Trabajo Social";return["*SLAM - Notificación de Caso*",`Nro: ${c}`,`Área: ${o}`,`Denunciante: ${e.denunciante_nombre_completo||"—"}`,e.caso_tipologia?`Tipología: ${e.caso_tipologia}`:null,e.caso_modalidad?`Modalidad: ${e.caso_modalidad}`:null,e.caso_fecha_hecho?`Fecha del hecho: ${e.caso_fecha_hecho}`:null,"",`Ver SLAM: ${g}`].filter(Boolean).join(`
`)},sendWhatsApp(t){const e=this.slam||{},c=t==="psico"?e.psicologica_user:t==="legal"?e.legal_user:t==="social"?e.trabajo_social_user:null;if(!c?.celular){this.$q.notify({type:"warning",message:"No hay número de celular configurado para ese responsable"});return}const g=this.waUrl(c.celular,this.waMessage(t));window.open(g,"_blank")},async fetchSlam(){this.loading=!0;try{const t=await this.$axios.get(`/slams/${this.caseId}`);this.slam=t.data.slam}catch(t){this.$alert.error(t?.response?.data?.message||"No se pudo cargar el SLAM")}finally{this.loading=!1}},printPdf(){const t=this.$axios.defaults.baseURL+`/slams/${this.caseId}/pdf`;window.open(t,"_blank")},printPdfHojaRuta(t="denunciante"){const e=this.$axios.defaults.baseURL+`/slams/${this.caseId}/pdf/hoja-ruta?tipo=${t}`;window.open(e,"_blank")}}},gi={class:"row items-center q-mb-md"},hi={class:"col"},bi={class:"text-h6 text-weight-bold"},vi={class:"col-auto row q-gutter-sm"};function yi(t,e,c,g,o,n){const a=S("InfoGeneral"),r=S("Seguimiento"),u=S("HojaRuta"),T=S("SesionesPsicologico"),R=S("InformesLegal"),A=S("ApoyoIntegral"),ee=S("DocumentosGeneral"),K=S("Fotografias");return m(),_(ue,{class:"q-pa-md bg-grey-2"},{default:s(()=>[i("div",gi,[i("div",hi,[i("div",bi,"SLAM #"+d(o.slam?.id||"..."),1),e[6]||(e[6]=i("div",{class:"text-caption text-grey-7"},"Detalle y gestión integral",-1))]),i("div",vi,[n.hasAnyWa?(m(),_(H,{key:0,flat:"",color:"positive",icon:"chat",label:"WhatsApp"},{default:s(()=>[l(oe,null,{default:s(()=>[o.slam?.psicologica_user?.celular?(m(),_(U,{key:0,clickable:"",onClick:e[0]||(e[0]=E=>n.sendWhatsApp("psico"))},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"psychology"})]),_:1}),l(h,null,{default:s(()=>[f("Psicología ("+d(o.slam.psicologica_user.name)+")",1)]),_:1}),l(h,{side:"",class:"text-caption text-grey"},{default:s(()=>[f(d(o.slam.psicologica_user.celular),1)]),_:1})]),_:1})):V("",!0),o.slam?.legal_user?.celular?(m(),_(U,{key:1,clickable:"",onClick:e[1]||(e[1]=E=>n.sendWhatsApp("legal"))},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"gavel"})]),_:1}),l(h,null,{default:s(()=>[f("Legal ("+d(o.slam.legal_user.name)+")",1)]),_:1}),l(h,{side:"",class:"text-caption text-grey"},{default:s(()=>[f(d(o.slam.legal_user.celular),1)]),_:1})]),_:1})):V("",!0),o.slam?.trabajo_social_user?.celular?(m(),_(U,{key:2,clickable:"",onClick:e[2]||(e[2]=E=>n.sendWhatsApp("social"))},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"people"})]),_:1}),l(h,null,{default:s(()=>[f("Trabajo social ("+d(o.slam.trabajo_social_user.name)+")",1)]),_:1}),l(h,{side:"",class:"text-caption text-grey"},{default:s(()=>[f(d(o.slam.trabajo_social_user.celular),1)]),_:1})]),_:1})):V("",!0)]),_:1})]),_:1})):V("",!0),l(H,{flat:"",color:"secondary",icon:"print",label:"Imprimir PDF"},{default:s(()=>[l(oe,null,{default:s(()=>[k((m(),_(U,{clickable:"",onClick:n.printPdf},{default:s(()=>[l(h,null,{default:s(()=>e[7]||(e[7]=[f("Ficha del SLAM")])),_:1})]),_:1},8,["onClick"])),[[C]]),l(q),k((m(),_(U,{clickable:"",onClick:e[3]||(e[3]=E=>n.printPdfHojaRuta("denunciante"))},{default:s(()=>[l(h,null,{default:s(()=>e[8]||(e[8]=[f("Ubicación")])),_:1})]),_:1})),[[C]])]),_:1})]),_:1}),l(b,{flat:"",color:"primary",icon:"refresh",onClick:n.fetchSlam,loading:o.loading},null,8,["onClick","loading"])])]),l(w,{flat:"",bordered:"",class:"q-mb-md"},{default:s(()=>[l(de,{modelValue:o.tab,"onUpdate:modelValue":e[4]||(e[4]=E=>o.tab=E),class:"text-primary",dense:"",align:"left","active-color":"primary","indicator-color":"primary","outside-arrows":"","mobile-arrows":""},{default:s(()=>[l(O,{name:"info",label:"1 Información General",icon:"dashboard","no-caps":""}),l(O,{name:"seguimiento",label:"2 Seguimiento",icon:"track_changes","no-caps":""}),n.role==="Administrador"||n.role==="Psicologo"?(m(),_(O,{key:0,name:"psico",label:"3 Área Psicológico",icon:"psychology","no-caps":""})):V("",!0),n.role==="Administrador"||n.role==="Abogado"?(m(),_(O,{key:1,name:"legal",label:"4 Área Legal",icon:"gavel","no-caps":""})):V("",!0),l(O,{name:"docs",label:"5 Documentos General",icon:"folder","no-caps":""}),l(O,{name:"fotos",label:"6 Fotografías",icon:"photo_library","no-caps":""})]),_:1},8,["modelValue"])]),_:1}),l(ce,{modelValue:o.tab,"onUpdate:modelValue":e[5]||(e[5]=E=>o.tab=E),animated:"","keep-alive":""},{default:s(()=>[l(N,{name:"info"},{default:s(()=>[l(a,{"case-id":n.caseId,caso:o.slam,onUpdate:n.fetchSlam},null,8,["case-id","caso","onUpdate"])]),_:1}),l(N,{name:"seguimiento"},{default:s(()=>[l(r,{"case-id":n.caseId,caso:o.slam,onRefresh:n.fetchSlam},null,8,["case-id","caso","onRefresh"])]),_:1}),l(N,{name:"hoja"},{default:s(()=>[l(u,{"case-id":n.caseId},null,8,["case-id"])]),_:1}),l(N,{name:"psico"},{default:s(()=>[l(T,{"case-id":n.caseId,caso:o.slam,onRefresh:n.fetchSlam},null,8,["case-id","caso","onRefresh"])]),_:1}),l(N,{name:"legal"},{default:s(()=>[l(R,{"case-id":n.caseId,caso:o.slam,onRefresh:n.fetchSlam},null,8,["case-id","caso","onRefresh"])]),_:1}),l(N,{name:"apoyo"},{default:s(()=>[l(A,{"case-id":n.caseId},null,8,["case-id"])]),_:1}),l(N,{name:"docs"},{default:s(()=>[l(ee,{"case-id":n.caseId,caso:o.slam,onRefresh:n.fetchSlam},null,8,["case-id","caso","onRefresh"])]),_:1}),l(N,{name:"fotos"},{default:s(()=>[l(K,{"case-id":n.caseId,caso:o.slam,onRefresh:n.fetchSlam},null,8,["case-id","caso","onRefresh"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Oi=D(pi,[["render",yi],["__scopeId","data-v-e75b8dbd"]]);export{Oi as default};
