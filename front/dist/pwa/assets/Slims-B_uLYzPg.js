import{_ as f,c as g,o as n,w as u,b as t,a as i,a6 as x,$ as _,f as h,d as b,a7 as k,a0 as a,a1 as p,a2 as S,t as l,Z as r}from"./index-DOhL7_lw.js";import{Q as P}from"./QSelect-f8tfpaqG.js";import{Q as c}from"./QBadge-BbUKtTvl.js";import{Q as V}from"./QTooltip-0IiNVeJ7.js";import{Q as w}from"./QSpinnerDots-ToQuSYhN.js";import{Q}from"./QMarkupTable-Dnm6j3b1.js";import{Q as v}from"./QPagination-Dlsz-0eK.js";import{Q as q}from"./QPage-BItIJdsn.js";import"./format-zqnYpLTY.js";const I={name:"SlimsPage",data(){return{slims:[],loading:!1,page:1,perPage:10,meta:{current_page:1,last_page:1,total:0,from:0,to:0},search:"",onlyPendientes:!1}},mounted(){this.onlyPendientes=String(this.$route.query.only_pendientes||"")==="1",this.fetchSlims()},watch:{"$route.query.only_pendientes"(d){this.onlyPendientes=String(d||"")==="1",this.goFirstPage()}},methods:{fetchSlims(){this.loading=!0,this.$axios.get("/slims",{params:{q:this.search||"",page:this.page,per_page:this.perPage,only_pendientes:this.onlyPendientes?1:0}}).then(d=>{const e=d.data||{};this.slims=e.data||[],this.meta={current_page:e.current_page||1,last_page:e.last_page||1,total:e.total||0,from:e.from||0,to:e.to||0},this.page=this.meta.current_page}).catch(d=>this.$alert.error(d.response?.data?.message||"Error cargando SLIMs")).finally(()=>{this.loading=!1})},onSearch(){this.page=1,this.fetchSlims()},clearSearch(){this.search="",this.onSearch()},goFirstPage(){this.page=1,this.fetchSlims()},rowIndex(d){return(this.meta.from||0)+d}}},C={class:"row items-center q-col-gutter-md q-mb-md"},F={class:"col-12 col-md"},U={class:"col-auto"},B={class:"col-auto"},N={class:"col-auto"},M={key:0},T=["onClick"],D={class:"text-no-wrap"},z={class:"text-no-wrap"},A={class:"text-weight-medium"},L={key:0,class:"text-caption text-grey-7"},j={class:"text-weight-medium"},E={key:0,class:"text-caption text-grey-7"},Z={key:1,class:"text-grey-6"},R={key:1},G={key:2},H={colspan:"9",class:"text-center"},J={class:"row items-center justify-between q-mt-md"},K={class:"text-caption text-grey-7"};function O(d,e,W,X,s,m){return n(),g(q,{class:"q-pa-md"},{default:u(()=>[t("div",C,[t("div",F,[i(x,{modelValue:s.search,"onUpdate:modelValue":[e[0]||(e[0]=o=>s.search=o),m.onSearch],outlined:"",dense:"",debounce:"400",placeholder:"Buscar por N° SLIM, denunciante, denunciado, tipología, zona…"},{prepend:u(()=>[i(b,{name:"search"})]),append:u(()=>[s.search?(n(),g(h,{key:0,flat:"",dense:"",round:"",icon:"close",onClick:m.clearSearch},null,8,["onClick"])):_("",!0)]),_:1},8,["modelValue","onUpdate:modelValue"])]),t("div",U,[i(k,{modelValue:s.onlyPendientes,"onUpdate:modelValue":[e[1]||(e[1]=o=>s.onlyPendientes=o),m.goFirstPage],color:"primary",label:"Solo mis pendientes"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",B,[i(P,{modelValue:s.perPage,"onUpdate:modelValue":[e[2]||(e[2]=o=>s.perPage=o),m.goFirstPage],options:[10,20,50],dense:"",outlined:"",style:{width:"120px"},label:"Por página"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",N,[i(h,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",onClick:e[3]||(e[3]=o=>m.fetchSlims()),loading:s.loading},null,8,["loading"])])]),i(Q,{flat:"",bordered:"",dense:""},{default:u(()=>[e[12]||(e[12]=t("thead",null,[t("tr",null,[t("th",{style:{width:"60px"}},"#"),t("th",null,"Nº SLIM"),t("th",null,"Fecha"),t("th",null,"Denunciante"),t("th",null,"Denunciado"),t("th",null,"Tipología"),t("th",null,"Zona"),t("th",null,"Tipo"),t("th",null,"Alerta")])],-1)),!s.loading&&s.slims.length?(n(),a("tbody",M,[(n(!0),a(p,null,S(s.slims,(o,y)=>(n(),a("tr",{key:o.id,onClick:Y=>d.$router.push("/slims/"+o.id),class:"cursor-pointer"},[t("td",null,l(m.rowIndex(y)),1),t("td",D,l(o.caso_numero||"—"),1),t("td",z,l(d.$filters.date(o.fecha_apertura_caso)),1),t("td",null,[t("div",A,l(o.denunciante_nombre_completo),1),o.denunciante_nro?(n(),a("div",L,"CI: "+l(o.denunciante_nro),1)):_("",!0)]),t("td",null,[t("div",j,l(o.denunciado_nombre_completo||"—"),1),o.denunciado_nro?(n(),a("div",E,"CI: "+l(o.denunciado_nro),1)):_("",!0)]),t("td",null,l(o.caso_tipologia||"—"),1),t("td",null,l(o.zona||"—"),1),t("td",null,[i(c,{color:o.numero_apoyo_integral?"green":"grey-5","text-color":o.numero_apoyo_integral?"white":"black",label:o.numero_apoyo_integral?"Apoyo Integral":"Regular",rounded:"",dense:""},null,8,["color","text-color","label"])]),t("td",null,[o.mi_estado?.me_asignado?(n(),a(p,{key:0},[o.mi_estado.primer_informe_hecho?(n(),g(c,{key:0,color:"green","text-color":"white",class:"q-mr-xs"},{default:u(()=>[r(l(o.mi_estado.label_listo||"Primer informe listo"),1)]),_:2},1024)):(n(),a(p,{key:1},[i(c,{color:o.mi_estado.atrasado?"red":"orange","text-color":o.mi_estado.atrasado?"white":"black",class:"q-mr-xs"},{default:u(()=>[o.mi_estado.atrasado?(n(),a(p,{key:0},[r(" Atrasado "+l(Math.abs(o.mi_estado.dias_restantes))+" d ",1)],64)):(n(),a(p,{key:1},[r(" Faltan "+l(o.mi_estado.dias_restantes)+" d ",1)],64))]),_:2},1032,["color","text-color"]),i(V,{"transition-show":"jump-down","transition-hide":"jump-up"},{default:u(()=>[e[5]||(e[5]=r(" Debes cargar tu ")),t("b",null,l(o.mi_estado.rol==="Psicologo"?"primera sesión":"primer informe"),1),e[6]||(e[6]=r(".")),e[7]||(e[7]=t("br",null,null,-1)),e[8]||(e[8]=r(" Fecha límite: ")),t("b",null,l(o.mi_estado.deadline),1),e[9]||(e[9]=r(". "))]),_:2},1024)],64))],64)):(n(),a("span",Z,"—"))])],8,T))),128))])):!s.loading&&!s.slims.length?(n(),a("tbody",R,e[10]||(e[10]=[t("tr",null,[t("td",{colspan:"9",class:"text-center text-grey"}," No hay resultados para tu búsqueda. ")],-1)]))):(n(),a("tbody",G,[t("tr",null,[t("td",H,[i(w,{size:"24px",class:"q-mr-sm"}),e[11]||(e[11]=r(" Cargando… "))])])]))]),_:1}),t("div",J,[t("div",K,[e[13]||(e[13]=r(" Mostrando ")),t("b",null,l(s.meta.from||0),1),e[14]||(e[14]=r(" – ")),t("b",null,l(s.meta.to||0),1),e[15]||(e[15]=r(" de ")),t("b",null,l(s.meta.total||0),1),e[16]||(e[16]=r(" registros "))]),i(v,{modelValue:s.page,"onUpdate:modelValue":[e[4]||(e[4]=o=>s.page=o),m.fetchSlims],max:s.meta.last_page||1,"max-pages":"10","boundary-numbers":"","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])])]),_:1})}const ie=f(I,[["render",O],["__scopeId","data-v-d574cc40"]]);export{ie as default};
