import{Q as X,b as $,c as g}from"./QMenu-fpi_DmEW.js";import{_ as I,a0 as v,o as r,b as a,$ as k,Z as m,a as l,w as i,t as n,c as p,f,a1 as q,e as w,Q as V,a3 as _,a6 as c,d as C,a2 as x,W as h,h as Q,a8 as T,Y as S}from"./index-U040-Wg_.js";import{a as z,Q as ee}from"./QBtnDropdown-D69NIteY.js";import{S as O,Q as Z,b as oe,a as le,c as te,d as P,e as ae,f as R}from"./QBar-07gNQOvK.js";import{Q as ie}from"./QPage-BkNd_a4Q.js";import{C as b}from"./ClosePopup-BWPiauoc.js";import{Q as se}from"./QBadge-DCJymwR9.js";import{Q as N}from"./QSelect-s4mbNuKp.js";import{a as L,Q as ne}from"./QTable-DGO15eQy.js";import{Q as Y}from"./QMarkupTable-Nc3c4ce6.js";import{Q as M}from"./QPagination-_lZCp6E6.js";import{Q as F}from"./QSpace-DgbIfggW.js";import{Q as de}from"./QImg-DlFRzGWc.js";import"./format-BdNKn_tk.js";import"./QBtnGroup-BuJGIrO_.js";import"./QResizeObserver-WK-gU7Lh.js";import"./touch-BjYP5sR0.js";import"./QTooltip-Bqo7M6vI.js";const re={name:"DnaInfoGeneral",props:{caseId:{type:[String,Number],required:!0}},data:()=>({loading:!1,editing:!1,form:{},backup:null,abogados:[]}),computed:{role(){return this.$store.user?.role||""},canEdit(){return this.role==="Administrador"||this.role==="Asistente"},abogadoNombre(){if(this.form.abogado?.name)return this.form.abogado.name;const e=this.abogados.find(o=>Number(o.id)===Number(this.form.abogado_user_id));return e?e.name:"Sin asignar"}},created(){this.fetch(),this.fetchAbogados()},methods:{tipoLabel(e){return{PROCESO_PENAL:"Procesos Penales",PROCESO_FAMILIAR:"Procesos Familiares",PROCESO_NNA:"Procesos Niñez y Adolescencia",APOYO_INTEGRAL:"Apoyos Integrales"}[(e||"").toUpperCase()]||e||"—"},req(e){return!!e||"Requerido"},orDash(e){return e||"—"},async fetch(){this.loading=!0;try{const{data:e}=await this.$axios.get(`/dnas/${this.caseId}`);this.form={...e},!this.form.abogado_user_id&&this.form.abogado?.id&&(this.form.abogado_user_id=this.form.abogado.id),this.backup={...this.form}}catch(e){this.$alert?.error?.(e?.response?.data?.message||"No se pudo cargar")}finally{this.loading=!1}},async fetchAbogados(){try{const{data:e}=await this.$axios.get("/usuariosRole");this.abogados=e.abogados||[]}catch{}},startEdit(){this.canEdit&&(this.editing=!0,this.backup={...this.form})},cancelEdit(){this.form={...this.backup},this.editing=!1,this.$q.notify({type:"info",message:"Cambios descartados"})},async save(){this.loading=!0;try{const e=await this.$axios.put(`/dnas/${this.caseId}`,this.form);this.form=e.data?.dna||e.data||this.form,this.backup={...this.form},this.editing=!1,this.$q.notify({type:"positive",message:"Información actualizada"})}catch(e){this.$alert?.error?.(e?.response?.data?.message||"No se pudo actualizar")}finally{this.loading=!1}}}},ue={class:"row items-center q-mb-sm"},me={class:"col"},ce={class:"text-caption text-grey-7"},fe={key:0,class:"col-auto row q-gutter-sm"},pe={class:"col-6 col-md-3"},ge={class:"col-6 col-md-3"},he={class:"col-12 col-md-6"},be={class:"col-12 col-md-6"},ve={class:"col-6 col-md-3"},ye={class:"col-6 col-md-3"},we={class:"col-12 col-md-6"},Ve={class:"col-6 col-md-3"},_e={class:"col-6 col-md-3"},ke={class:"col-6 col-md-3"},Ce={class:"col-12 col-md-6"},$e={class:"col-6 col-md-3"},De={class:"col-6 col-md-3"},qe={class:"col-12 col-md-6"},Ie={class:"col-6 col-md-3"},Ue={class:"col-6 col-md-3"},Ee={class:"col-6 col-md-3"},Se={class:"col-12 col-md-6"},Pe={class:"col-6 col-md-3"},Re={class:"col-6 col-md-3"},Ne={class:"row q-col-gutter-md"},Ae={class:"col-12 col-md-3"},Oe={class:"col-12 col-md-3"},Te={class:"col-12 col-md-6"},Le={class:"col-12 col-md-6"},Qe={class:"col-6 col-md-3"},Fe={class:"col-6 col-md-3"},xe={class:"row q-col-gutter-md"},ze={class:"col-12 col-md-6"},Me={class:"col-6 col-md-3"},je={class:"col-6 col-md-3"},Ge={class:"col-6 col-md-3"},Be={class:"col-12 col-md-6"},He={class:"col-6 col-md-3"},Ye={class:"col-6 col-md-3"},We={class:"row q-col-gutter-md"},Ze={class:"col-12 col-md-6"},Je={class:"col-6 col-md-3"},Ke={class:"col-6 col-md-3"},Xe={class:"col-6 col-md-3"},eo={class:"col-12 col-md-6"},oo={class:"col-6 col-md-3"},lo={class:"col-6 col-md-3"},to={class:"row q-col-gutter-md"},ao={class:"col-12 col-md-6"};function io(e,o,u,D,d,s){return r(),v("div",null,[a("div",ue,[a("div",me,[o[22]||(o[22]=a("div",{class:"text-subtitle1 text-weight-medium"},"Información General",-1)),a("div",ce,[o[21]||(o[21]=m("Tipo: ")),l(se,{color:"blue-2","text-color":"blue-10"},{default:i(()=>[m(n(s.tipoLabel(e.form.tipo_proceso)),1)]),_:1})])]),s.canEdit?(r(),v("div",fe,[e.editing?(r(),v(q,{key:1},[l(f,{flat:"",color:"negative",icon:"close",label:"Cancelar",onClick:s.cancelEdit,loading:e.loading},null,8,["onClick","loading"]),l(f,{color:"primary",icon:"save",label:"Guardar",onClick:s.save,loading:e.loading},null,8,["onClick","loading"])],64)):(r(),p(f,{key:0,color:"primary",icon:"edit",label:"Editar",onClick:s.startEdit,loading:e.loading},null,8,["onClick","loading"]))])):k("",!0)]),e.editing?(r(),v(q,{key:1},[l(V,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:i(()=>[l(w,null,{default:i(()=>[a("div",Ne,[a("div",Ae,[l(c,{modelValue:e.form.codigo,"onUpdate:modelValue":o[0]||(o[0]=t=>e.form.codigo=t),dense:"",outlined:"",label:"Código"},null,8,["modelValue"])]),a("div",Oe,[l(c,{modelValue:e.form.fecha_atencion,"onUpdate:modelValue":o[1]||(o[1]=t=>e.form.fecha_atencion=t),type:"date",dense:"",outlined:"",label:"Fecha"},null,8,["modelValue"])]),a("div",Te,[l(c,{modelValue:e.form.principal,"onUpdate:modelValue":o[2]||(o[2]=t=>e.form.principal=t),dense:"",outlined:"",clearable:"",label:"Principal"},null,8,["modelValue"])]),a("div",Le,[l(c,{modelValue:e.form.domicilio,"onUpdate:modelValue":o[3]||(o[3]=t=>e.form.domicilio=t),dense:"",outlined:"",clearable:"",label:"Domicilio"},null,8,["modelValue"])]),a("div",Qe,[l(c,{modelValue:e.form.telefono,"onUpdate:modelValue":o[4]||(o[4]=t=>e.form.telefono=t),dense:"",outlined:"",clearable:"",label:"Teléfono"},null,8,["modelValue"])]),a("div",Fe,[l(c,{modelValue:e.form.zona,"onUpdate:modelValue":o[5]||(o[5]=t=>e.form.zona=t),dense:"",outlined:"",clearable:"",label:"Zona"},null,8,["modelValue"])])])]),_:1})]),_:1}),l(V,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:i(()=>[l(w,{class:"text-subtitle1"},{default:i(()=>o[47]||(o[47]=[m("Denunciante")])),_:1}),l(_),l(w,null,{default:i(()=>[a("div",xe,[a("div",ze,[l(c,{modelValue:e.form.denunciante_nombre,"onUpdate:modelValue":o[6]||(o[6]=t=>e.form.denunciante_nombre=t),dense:"",outlined:"",label:"Nombre *",rules:[s.req]},null,8,["modelValue","rules"])]),a("div",Me,[l(c,{modelValue:e.form.denunciante_sexo,"onUpdate:modelValue":o[7]||(o[7]=t=>e.form.denunciante_sexo=t),dense:"",outlined:"",label:"Sexo"},null,8,["modelValue"])]),a("div",je,[l(c,{modelValue:e.form.denunciante_edad,"onUpdate:modelValue":o[8]||(o[8]=t=>e.form.denunciante_edad=t),modelModifiers:{number:!0},type:"number",dense:"",outlined:"",label:"Edad"},null,8,["modelValue"])]),a("div",Ge,[l(c,{modelValue:e.form.denunciante_ci,"onUpdate:modelValue":o[9]||(o[9]=t=>e.form.denunciante_ci=t),dense:"",outlined:"",label:"CI"},null,8,["modelValue"])]),a("div",Be,[l(c,{modelValue:e.form.denunciante_domicilio,"onUpdate:modelValue":o[10]||(o[10]=t=>e.form.denunciante_domicilio=t),dense:"",outlined:"",label:"Domicilio"},null,8,["modelValue"])]),a("div",He,[l(c,{modelValue:e.form.denunciante_telefono,"onUpdate:modelValue":o[11]||(o[11]=t=>e.form.denunciante_telefono=t),dense:"",outlined:"",label:"Teléfono"},null,8,["modelValue"])]),a("div",Ye,[l(c,{modelValue:e.form.denunciante_ocupacion,"onUpdate:modelValue":o[12]||(o[12]=t=>e.form.denunciante_ocupacion=t),dense:"",outlined:"",label:"Ocupación"},null,8,["modelValue"])])])]),_:1})]),_:1}),l(V,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:i(()=>[l(w,{class:"text-subtitle1"},{default:i(()=>o[48]||(o[48]=[m("Denunciado")])),_:1}),l(_),l(w,null,{default:i(()=>[a("div",We,[a("div",Ze,[l(c,{modelValue:e.form.denunciado_nombre,"onUpdate:modelValue":o[13]||(o[13]=t=>e.form.denunciado_nombre=t),dense:"",outlined:"",label:"Nombre"},null,8,["modelValue"])]),a("div",Je,[l(c,{modelValue:e.form.denunciado_sexo,"onUpdate:modelValue":o[14]||(o[14]=t=>e.form.denunciado_sexo=t),dense:"",outlined:"",label:"Sexo"},null,8,["modelValue"])]),a("div",Ke,[l(c,{modelValue:e.form.denunciado_edad,"onUpdate:modelValue":o[15]||(o[15]=t=>e.form.denunciado_edad=t),modelModifiers:{number:!0},type:"number",dense:"",outlined:"",label:"Edad"},null,8,["modelValue"])]),a("div",Xe,[l(c,{modelValue:e.form.denunciado_ci,"onUpdate:modelValue":o[16]||(o[16]=t=>e.form.denunciado_ci=t),dense:"",outlined:"",label:"CI"},null,8,["modelValue"])]),a("div",eo,[l(c,{modelValue:e.form.denunciado_domicilio,"onUpdate:modelValue":o[17]||(o[17]=t=>e.form.denunciado_domicilio=t),dense:"",outlined:"",label:"Domicilio"},null,8,["modelValue"])]),a("div",oo,[l(c,{modelValue:e.form.denunciado_telefono,"onUpdate:modelValue":o[18]||(o[18]=t=>e.form.denunciado_telefono=t),dense:"",outlined:"",label:"Teléfono"},null,8,["modelValue"])]),a("div",lo,[l(c,{modelValue:e.form.denunciado_ocupacion,"onUpdate:modelValue":o[19]||(o[19]=t=>e.form.denunciado_ocupacion=t),dense:"",outlined:"",label:"Ocupación"},null,8,["modelValue"])])])]),_:1})]),_:1}),l(V,{flat:"",bordered:"",class:"section-card q-mb-xl"},{default:i(()=>[l(w,{class:"text-subtitle1"},{default:i(()=>o[49]||(o[49]=[m("Asignación")])),_:1}),l(_),l(w,null,{default:i(()=>[a("div",to,[a("div",ao,[l(N,{modelValue:e.form.abogado_user_id,"onUpdate:modelValue":o[20]||(o[20]=t=>e.form.abogado_user_id=t),dense:"",outlined:"","emit-value":"","map-options":"",clearable:"",options:e.abogados.map(t=>({label:t.name,value:t.id})),label:"Abogado/a asignado"},null,8,["modelValue","options"])])])]),_:1})]),_:1})],64)):(r(),v(q,{key:0},[l(V,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:i(()=>[l(w,{class:"row q-col-gutter-md"},{default:i(()=>[a("div",pe,[o[23]||(o[23]=a("b",null,"Código:",-1)),m(" "+n(s.orDash(e.form.codigo)),1)]),a("div",ge,[o[24]||(o[24]=a("b",null,"Fecha:",-1)),m(" "+n(s.orDash(e.form.fecha_atencion)),1)]),a("div",he,[o[25]||(o[25]=a("b",null,"Principal:",-1)),m(" "+n(s.orDash(e.form.principal)),1)]),a("div",be,[o[26]||(o[26]=a("b",null,"Domicilio:",-1)),m(" "+n(s.orDash(e.form.domicilio)),1)]),a("div",ve,[o[27]||(o[27]=a("b",null,"Teléfono:",-1)),m(" "+n(s.orDash(e.form.telefono)),1)]),a("div",ye,[o[28]||(o[28]=a("b",null,"Zona:",-1)),m(" "+n(s.orDash(e.form.zona)),1)])]),_:1})]),_:1}),l(V,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:i(()=>[l(w,{class:"text-subtitle1"},{default:i(()=>o[29]||(o[29]=[m("Denunciante")])),_:1}),l(_),l(w,{class:"row q-col-gutter-md"},{default:i(()=>[a("div",we,[o[30]||(o[30]=a("b",null,"Nombre:",-1)),m(" "+n(s.orDash(e.form.denunciante_nombre)),1)]),a("div",Ve,[o[31]||(o[31]=a("b",null,"Sexo:",-1)),m(" "+n(s.orDash(e.form.denunciante_sexo)),1)]),a("div",_e,[o[32]||(o[32]=a("b",null,"Edad:",-1)),m(" "+n(s.orDash(e.form.denunciante_edad)),1)]),a("div",ke,[o[33]||(o[33]=a("b",null,"CI:",-1)),m(" "+n(s.orDash(e.form.denunciante_ci)),1)]),a("div",Ce,[o[34]||(o[34]=a("b",null,"Domicilio:",-1)),m(" "+n(s.orDash(e.form.denunciante_domicilio)),1)]),a("div",$e,[o[35]||(o[35]=a("b",null,"Teléfono:",-1)),m(" "+n(s.orDash(e.form.denunciante_telefono)),1)]),a("div",De,[o[36]||(o[36]=a("b",null,"Ocupación:",-1)),m(" "+n(s.orDash(e.form.denunciante_ocupacion)),1)])]),_:1})]),_:1}),l(V,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:i(()=>[l(w,{class:"text-subtitle1"},{default:i(()=>o[37]||(o[37]=[m("Denunciado")])),_:1}),l(_),l(w,{class:"row q-col-gutter-md"},{default:i(()=>[a("div",qe,[o[38]||(o[38]=a("b",null,"Nombre:",-1)),m(" "+n(s.orDash(e.form.denunciado_nombre)),1)]),a("div",Ie,[o[39]||(o[39]=a("b",null,"Sexo:",-1)),m(" "+n(s.orDash(e.form.denunciado_sexo)),1)]),a("div",Ue,[o[40]||(o[40]=a("b",null,"Edad:",-1)),m(" "+n(s.orDash(e.form.denunciado_edad)),1)]),a("div",Ee,[o[41]||(o[41]=a("b",null,"CI:",-1)),m(" "+n(s.orDash(e.form.denunciado_ci)),1)]),a("div",Se,[o[42]||(o[42]=a("b",null,"Domicilio:",-1)),m(" "+n(s.orDash(e.form.denunciado_domicilio)),1)]),a("div",Pe,[o[43]||(o[43]=a("b",null,"Teléfono:",-1)),m(" "+n(s.orDash(e.form.denunciado_telefono)),1)]),a("div",Re,[o[44]||(o[44]=a("b",null,"Ocupación:",-1)),m(" "+n(s.orDash(e.form.denunciado_ocupacion)),1)])]),_:1})]),_:1}),l(V,{flat:"",bordered:"",class:"section-card q-mb-xl"},{default:i(()=>[l(w,{class:"text-subtitle1"},{default:i(()=>o[45]||(o[45]=[m("Asignación")])),_:1}),l(_),l(w,null,{default:i(()=>[a("div",null,[o[46]||(o[46]=a("b",null,"Abogado(a):",-1)),m(" "+n(s.abogadoNombre),1)])]),_:1})]),_:1})],64))])}const so=I(re,[["render",io],["__scopeId","data-v-c5ce91b6"]]),no={name:"DnaSeguimiento",props:{caseId:{type:[String,Number],required:!0}},data:()=>({loading:!1,header:{},rows:[],filters:{q:"",tipo:"Todos",modulo:"Todos",desde:"",hasta:""},tipos:["Todos","Informe","Sesión","Documento","Fotografía"],modulos:["Todos","General","Psicológico","Legal","Documentos","Multimedia"],columns:[{name:"actividad",label:"Actividad",field:"actividad",align:"left"},{name:"fecha",label:"Fecha / Usuario",field:"fecha",align:"left",sortable:!0},{name:"modulo",label:"Módulo",field:"modulo",align:"left",sortable:!0},{name:"acciones",label:"",align:"right",style:"width:140px"}]}),computed:{rowsFiltered(){let e=this.rows.slice();const o=this.filters;if(o.q){const u=o.q.toLowerCase();e=e.filter(D=>(D.titulo||"").toLowerCase().includes(u)||(D.descripcion||"").toLowerCase().includes(u)||(D.usuario||"").toLowerCase().includes(u))}return o.tipo!=="Todos"&&(e=e.filter(u=>u.tipo===o.tipo)),o.modulo!=="Todos"&&(e=e.filter(u=>(u.modulo||"").toLowerCase()===o.modulo.toLowerCase())),o.desde&&(e=e.filter(u=>(u.fecha||"0000-00-00")>=o.desde)),o.hasta&&(e=e.filter(u=>(u.fecha||"9999-12-31")<=o.hasta)),e}},mounted(){this.fetch()},methods:{async fetch(){this.loading=!0;try{const{data:e}=await this.$axios.get(`/dnas/${this.caseId}/seguimiento`);this.header=e.header||{},this.rows=e.items||[]}catch(e){this.$alert?.error?.(e?.response?.data?.message||"No se pudo cargar el seguimiento")}finally{this.loading=!1}},toPublicUrl(e){return e?/^https?:\/\//i.test(e)?e:`${(this.$axios?.defaults?.baseURL||"").replace(/\/api\/?$/,"")}${e}`:""},open(e){const o=this.toPublicUrl(e);o&&window.open(o,"_blank")}}},ro={class:"row items-start q-col-gutter-sm"},uo={class:"col"},mo={class:"text-caption text-grey-7"},co={class:"col-auto"},fo={class:"row items-center q-col-gutter-sm"},po={class:"col-12 col-md-4"},go={class:"col-6 col-md-2"},ho={class:"col-6 col-md-2"},bo={class:"col-6 col-md-2"},vo={class:"col-6 col-md-2"},yo={class:"row no-wrap items-center q-gutter-xs"},wo={class:"text-weight-medium"},Vo={class:"text-caption text-grey-7 ellipsis-2-lines",style:{"max-width":"520px"}},_o={class:"text-weight-medium"},ko={class:"text-caption text-grey-7"};function Co(e,o,u,D,d,s){return r(),v("div",null,[l(V,{flat:"",bordered:"",class:"q-pa-sm q-mb-sm"},{default:i(()=>[a("div",ro,[a("div",uo,[o[5]||(o[5]=a("div",{class:"text-subtitle1 text-weight-bold"},"Seguimiento del Caso",-1)),a("div",mo,"DNA #"+n(u.caseId),1)]),a("div",co,[l(f,{flat:"",color:"primary",icon:"refresh",loading:e.loading,onClick:s.fetch},null,8,["loading","onClick"])])])]),_:1}),l(V,{flat:"",bordered:"",class:"q-pa-sm q-mb-sm"},{default:i(()=>[a("div",fo,[a("div",po,[l(c,{modelValue:e.filters.q,"onUpdate:modelValue":o[0]||(o[0]=t=>e.filters.q=t),dense:"",outlined:"",placeholder:"Buscar (título, descripción, usuario)"},{append:i(()=>[l(C,{name:"search"})]),_:1},8,["modelValue"])]),a("div",go,[l(N,{modelValue:e.filters.tipo,"onUpdate:modelValue":o[1]||(o[1]=t=>e.filters.tipo=t),options:e.tipos,dense:"",outlined:"",label:"Tipo"},null,8,["modelValue","options"])]),a("div",ho,[l(N,{modelValue:e.filters.modulo,"onUpdate:modelValue":o[2]||(o[2]=t=>e.filters.modulo=t),options:e.modulos,dense:"",outlined:"",label:"Módulo"},null,8,["modelValue","options"])]),a("div",bo,[l(c,{modelValue:e.filters.desde,"onUpdate:modelValue":o[3]||(o[3]=t=>e.filters.desde=t),type:"date",dense:"",outlined:"",label:"Desde"},null,8,["modelValue"])]),a("div",vo,[l(c,{modelValue:e.filters.hasta,"onUpdate:modelValue":o[4]||(o[4]=t=>e.filters.hasta=t),type:"date",dense:"",outlined:"",label:"Hasta"},null,8,["modelValue"])])])]),_:1}),l(ne,{flat:"",bordered:"",rows:s.rowsFiltered,columns:e.columns,"row-key":"uid",loading:e.loading,"hide-bottom":"","rows-per-page-options":[0],class:"rounded-borders"},{"body-cell-actividad":i(t=>[l(L,{props:t},{default:i(()=>[a("div",yo,[l(C,{name:t.row.icon||"feed",size:"18px",class:"text-primary"},null,8,["name"]),a("div",null,[a("div",wo,[m(n(t.row.tipo)+" ",1),o[6]||(o[6]=a("span",{class:"text-grey-7"},"·",-1)),m(" "+n(t.row.titulo||"—"),1)]),a("div",Vo,n(t.row.descripcion||"—"),1)])])]),_:2},1032,["props"])]),"body-cell-fecha":i(t=>[l(L,{props:t},{default:i(()=>[a("div",_o,n(t.row.fecha||"—"),1),a("div",ko,n(t.row.usuario||"—"),1)]),_:2},1032,["props"])]),"body-cell-modulo":i(t=>[l(L,{props:t},{default:i(()=>[l(X,{dense:"",square:""},{default:i(()=>[m(n(t.row.modulo||"—"),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-acciones":i(t=>[l(L,{props:t,class:"q-gutter-xs"},{default:i(()=>[t.row.links?.pdf?(r(),p(f,{key:0,dense:"",flat:"",icon:"picture_as_pdf",onClick:y=>s.open(t.row.links.pdf),title:"Ver PDF"},null,8,["onClick"])):k("",!0),t.row.links?.view?(r(),p(f,{key:1,dense:"",flat:"",icon:"visibility",onClick:y=>s.open(t.row.links.view),title:"Ver"},null,8,["onClick"])):k("",!0),t.row.links?.download?(r(),p(f,{key:2,dense:"",flat:"",icon:"download",onClick:y=>s.open(t.row.links.download),title:"Descargar"},null,8,["onClick"])):k("",!0),t.row.links?.open?(r(),p(f,{key:3,dense:"",flat:"",icon:"open_in_new",onClick:y=>s.open(t.row.links.open),title:"Abrir"},null,8,["onClick"])):k("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])])}const $o=I(no,[["render",Co],["__scopeId","data-v-ea6df738"]]),Do={name:"DnaPsicologiaSesiones",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:null}},data(){return{loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dialog:!1,mode:"create",form:{id:null,fecha:"",titulo:"",duracion_min:null,lugar:"",tipo:"Individual",contenido_html:""},plantilla:null,plantillasOptions:[{label:"Consentimiento informado",value:"consentimiento"},{label:"Informe Psicológico (formato DIO)",value:"informe_dio"},{label:"Acta de sesión (DIO)",value:"acta"},{label:"Informe breve (psicológico)",value:"informe"},{label:"Constancia de asistencia",value:"constancia"}]}},computed:{role(){return this.$store.user?.role||""},roleNorm(){return(this.role||"").normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toUpperCase()},canEdit(){return["ADMIN","ADMINISTRADOR","PSICOLOGO","PSICOLOGA","PSICOLOGIA","PSICOLOGÍA"].includes(this.roleNorm)}},watch:{caseId(){this.page=1,this.fetchRows()},search(){this.page=1,this.fetchRows()}},created(){this.fetchRows()},methods:{today(){const e=new Date,o=u=>String(u).padStart(2,"0");return`${e.getFullYear()}-${o(e.getMonth()+1)}-${o(e.getDate())}`},async fetchRows(){if(this.caseId){this.loading=!0;try{const e=await this.$axios.get(`/dnas/${this.caseId}/sesiones-psicologicas`,{params:{q:this.search,page:this.page,per_page:this.perPage}});this.rows=Array.isArray(e.data)?{data:e.data,last_page:1,total:e.data.length}:e.data||{data:[],last_page:1,total:0}}catch(e){this.$q.notify({type:"negative",message:e?.response?.data?.message||"Error cargando sesiones"}),this.rows={data:[],last_page:1,total:0}}finally{this.loading=!1}}},openCreate(){this.canEdit&&(this.mode="create",this.plantilla="consentimiento",this.form={id:null,fecha:this.today(),titulo:"",duracion_min:null,lugar:"",tipo:"Individual",contenido_html:""},this.dialog=!0,this.$nextTick(()=>this.applyTemplate("consentimiento")))},openView(e){this.mode="view",this.form={id:e.id||null,fecha:e.fecha||"",titulo:e.titulo||"",duracion_min:e.duracion_min??null,lugar:e.lugar||"",tipo:e.tipo||"Individual",contenido_html:e.contenido_html||e.descripcion||""},this.dialog=!0},openEdit(e){this.canEdit&&(this.mode="edit",this.form={id:e.id||null,fecha:e.fecha||"",titulo:e.titulo||"",duracion_min:e.duracion_min??null,lugar:e.lugar||"",tipo:e.tipo||"Individual",contenido_html:e.contenido_html||e.descripcion||""},this.dialog=!0)},applyTemplate(e){if(this.mode==="view")return;const o=this.caso||{},u={nombres:o.denunciante_nombre||"",apellidos:"",edad:o.denunciante_edad||"",fecha_nacimiento:"",lugar_nacimiento:"",grado:"",ocupacion:o.denunciante_ocupacion||"",domicilio:o.denunciante_domicilio||"",documento:o.denunciante_ci?"C.I.":"Documento",nro:o.denunciante_ci||"",telefono:o.denunciante_telefono||"",estado_civil:""},D=Array.isArray(o.familiares)?o.familiares.map(E=>({nombre:E.nombre||"",edad:E.edad||"",estado_civil:"",parentesco:E.parentesco||"",ocupacion:E.ocupacion||""})):[],d=(this.form.fecha||this.today()).slice(0,4),s=o.codigo&&String(o.codigo).trim()!==""?String(o.codigo):`${String(this.caseId).padStart(2,"0")}/${d}`,t=o.abogado?.name||o.abogado?.username||"",y=this.$store?.state?.user?.name||this.$store?.user?.name||"",j=o.tipo_proceso||o.principal?`Evaluación psicológica en el marco de ${[o.tipo_proceso,o.principal].filter(Boolean).join(" / ")}.`:"Evaluación psicológica para establecer indicadores clínicos relevantes.",G=(()=>{const E=o.fecha_atencion?`en fecha ${o.fecha_atencion}`:"en fecha no precisada",W=[o.zona,o.domicilio].filter(Boolean).join(", "),J=W?`, en ${W}`:"",K=o.descripcion?` ${o.descripcion}`:"";return`Según los antecedentes del caso, la atención se realizó ${E}${J}.${K}`})(),B=["Entrevista clínica y observación conductual","Aplicación de instrumentos psicométricos según pertinencia (Goldberg, IES-R, Rosenberg)"].join("; ")+".",H="Se observan indicadores emocionales compatibles con el evento referido. No se evidencian signos de psicosis. Se recomienda seguimiento clínico.",U=["Terapia focalizada en manejo de ansiedad/estrés y fortalecimiento de recursos personales.","Orientación legal para evitar revictimización y garantizar medidas de protección, si corresponde."].join(" "),A={casoId:this.caseId,fecha:this.form.fecha||this.today(),titulo:this.form.titulo||"Sesión psicológica",lugar:this.form.lugar||"",tipo:this.form.tipo||"Individual",nombre:o.denunciante_nombre||"",documento:o.denunciante_ci||"",numeroCaso:s,abogadoNombre:t,psicologoNombre:y,denunciante:u,familiares:D,motivo:j,antecedentes:G,tecnicas:B,conclusiones:H,recomendaciones:U};e==="acta"?this.form.contenido_html=O.acta(A):e==="informe"?this.form.contenido_html=O.informe(A):e==="constancia"?this.form.contenido_html=O.constancia(A):e==="consentimiento"?this.form.contenido_html=O.consentimiento(A):e==="informe_dio"&&(this.form.contenido_html=O.informe_dio(A))},async save(){if(this.canEdit){if(!this.form.titulo){this.$q.notify({type:"negative",message:"El título es obligatorio"});return}if(!this.form.contenido_html){this.$q.notify({type:"negative",message:"El contenido está vacío"});return}this.saving=!0;try{const e={fecha:this.form.fecha||null,titulo:this.form.titulo,duracion_min:this.form.duracion_min??null,lugar:this.form.lugar||"",tipo:this.form.tipo||"Individual",contenido_html:this.form.contenido_html||""};this.form.id?await this.$axios.put(`/dnas/sesiones-psicologicas/${this.form.id}`,e):await this.$axios.post(`/dnas/${this.caseId}/sesiones-psicologicas`,e),this.$q.notify({type:"positive",message:"Guardado"}),this.dialog=!1,this.fetchRows()}catch(e){this.$q.notify({type:"negative",message:e?.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}}},remove(e){if(!this.canEdit)return;const o=async()=>{try{await this.$axios.delete(`/dnas/sesiones-psicologicas/${e.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.fetchRows()}catch(u){this.$q.notify({type:"negative",message:u?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar la sesión?").onOk(o):confirm("¿Eliminar la sesión?")&&o()},printPdf(e){const o=this.$axios?.defaults?.baseURL||"";window.open(`${o}/dnas/sesiones-psicologicas/${e.id}/pdf`,"_blank")}}},qo={class:"row items-center q-mb-sm"},Io={class:"col"},Uo={class:"text-caption text-grey-7"},Eo={class:"col-auto row items-center q-gutter-sm"},So={class:"text-grey-8"},Po={key:0},Ro={class:"row justify-end q-mt-sm"},No={class:"text-subtitle1"},Ao={class:"row q-col-gutter-md"},Oo={class:"col-12 col-md-3"},To={class:"col-12 col-md-5"},Lo={class:"col-6 col-md-2"},Qo={class:"col-6 col-md-2"},Fo={class:"col-12"},xo={key:0};function zo(e,o,u,D,d,s){return r(),p(V,{flat:"",bordered:"",class:"q-pa-md"},{default:i(()=>[a("div",qo,[a("div",Io,[o[10]||(o[10]=a("div",{class:"text-subtitle1 text-weight-medium"},"Sesiones (Psicológico · DNA)",-1)),a("div",Uo,"Caso #"+n(u.caseId),1)]),a("div",Eo,[l(c,{dense:"",outlined:"",modelValue:d.search,"onUpdate:modelValue":o[0]||(o[0]=t=>d.search=t),placeholder:"Buscar...",style:{width:"260px"}},{append:i(()=>[l(C,{name:"search"})]),_:1},8,["modelValue"]),l(f,{flat:"",color:"primary",icon:"refresh",loading:d.loading,onClick:s.fetchRows},null,8,["loading","onClick"]),s.canEdit?(r(),p(f,{key:0,color:"green",icon:"add_circle_outline","no-caps":"",label:"Crear sesión",onClick:s.openCreate},null,8,["onClick"])):k("",!0)])]),l(_),l(Y,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:i(()=>[o[16]||(o[16]=a("thead",null,[a("tr",{class:"bg-primary text-white"},[a("th",{style:{width:"70px"}},"ID"),a("th",{style:{width:"140px"}},"Acciones"),a("th",null,"Título"),a("th",{style:{width:"120px"}},"Fecha"),a("th",{style:{width:"120px"}},"Tipo"),a("th",{style:{width:"180px"}},"Usuario")])],-1)),a("tbody",null,[(r(!0),v(q,null,x(d.rows.data,t=>(r(),v("tr",{key:t.id},[a("td",So,"#"+n(t.id),1),a("td",null,[l(z,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:i(()=>[h((r(),p($,{clickable:"",onClick:y=>s.openView(t)},{default:i(()=>[l(g,{avatar:""},{default:i(()=>[l(C,{name:"visibility"})]),_:1}),l(g,null,{default:i(()=>o[11]||(o[11]=[m("Ver")])),_:1})]),_:2},1032,["onClick"])),[[b]]),h((r(),p($,{clickable:"",onClick:y=>s.printPdf(t)},{default:i(()=>[l(g,{avatar:""},{default:i(()=>[l(C,{name:"print"})]),_:1}),l(g,null,{default:i(()=>o[12]||(o[12]=[m("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[b]]),s.canEdit?(r(),v(q,{key:0},[l(_),h((r(),p($,{clickable:"",onClick:y=>s.openEdit(t)},{default:i(()=>[l(g,{avatar:""},{default:i(()=>[l(C,{name:"edit"})]),_:1}),l(g,null,{default:i(()=>o[13]||(o[13]=[m("Editar")])),_:1})]),_:2},1032,["onClick"])),[[b]]),h((r(),p($,{clickable:"",onClick:y=>s.remove(t)},{default:i(()=>[l(g,{avatar:""},{default:i(()=>[l(C,{name:"delete",color:"negative"})]),_:1}),l(g,{class:"text-negative"},{default:i(()=>o[14]||(o[14]=[m("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[b]])],64)):k("",!0)]),_:2},1024)]),a("td",null,n(t.titulo||"—"),1),a("td",null,n(t.fecha||"s/f"),1),a("td",null,n(t.tipo||"—"),1),a("td",null,n(t.user?.name||t.user?.username||"—"),1)]))),128)),(!d.rows||!d.rows.data||d.rows.data.length===0)&&!d.loading?(r(),v("tr",Po,o[15]||(o[15]=[a("td",{colspan:"6",class:"text-center text-grey"},"Sin registros",-1)]))):k("",!0)])]),_:1}),a("div",Ro,[l(M,{modelValue:d.page,"onUpdate:modelValue":[o[1]||(o[1]=t=>d.page=t),s.fetchRows],max:d.rows.last_page||1,"boundary-numbers":"","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])]),l(Q,{modelValue:d.dialog,"onUpdate:modelValue":o[9]||(o[9]=t=>d.dialog=t),persistent:""},{default:i(()=>[l(V,{style:{"max-width":"900px",width:"95vw"}},{default:i(()=>[l(w,{class:"row items-center q-pb-none"},{default:i(()=>[a("div",No,n(d.mode==="view"?"Ver sesión":d.form.id?"Editar sesión":"Nueva sesión"),1),l(F),h(l(f,{flat:"",round:"",dense:"",icon:"close"},null,512),[[b]])]),_:1}),l(w,{class:"q-gutter-md"},{default:i(()=>[a("div",Ao,[a("div",Oo,[l(c,{modelValue:d.form.fecha,"onUpdate:modelValue":o[2]||(o[2]=t=>d.form.fecha=t),type:"date",dense:"",outlined:"",label:"Fecha",readonly:d.mode==="view"},null,8,["modelValue","readonly"])]),a("div",To,[l(c,{modelValue:d.form.titulo,"onUpdate:modelValue":o[3]||(o[3]=t=>d.form.titulo=t),dense:"",outlined:"",label:"Título *",readonly:d.mode==="view",rules:[t=>!!t||"Requerido"]},null,8,["modelValue","readonly","rules"])]),a("div",Lo,[l(c,{modelValue:d.form.duracion_min,"onUpdate:modelValue":o[4]||(o[4]=t=>d.form.duracion_min=t),modelModifiers:{number:!0},type:"number",dense:"",outlined:"",label:"Minutos",readonly:d.mode==="view"},null,8,["modelValue","readonly"])]),a("div",Qo,[l(c,{modelValue:d.form.tipo,"onUpdate:modelValue":o[5]||(o[5]=t=>d.form.tipo=t),dense:"",outlined:"",label:"Tipo",readonly:d.mode==="view"},null,8,["modelValue","readonly"])]),a("div",Fo,[l(c,{modelValue:d.form.lugar,"onUpdate:modelValue":o[6]||(o[6]=t=>d.form.lugar=t),dense:"",outlined:"",label:"Lugar",readonly:d.mode==="view"},null,8,["modelValue","readonly"])])]),d.mode!=="view"?(r(),v("div",xo,[l(N,{modelValue:d.plantilla,"onUpdate:modelValue":[o[7]||(o[7]=t=>d.plantilla=t),s.applyTemplate],options:d.plantillasOptions,label:"Plantilla",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])])):k("",!0),a("div",null,[o[17]||(o[17]=a("div",{class:"text-caption text-grey-7 q-mb-xs"},"Contenido (WYSIWYG / se guarda HTML)",-1)),l(Z,{modelValue:d.form.contenido_html,"onUpdate:modelValue":o[8]||(o[8]=t=>d.form.contenido_html=t),readonly:d.mode==="view","min-height":"320px",placeholder:"Escriba aquí el contenido de la sesión...",toolbar:[["left","center","right","justify"],["bold","italic","strike","underline"],["quote","unordered","ordered","outdent","indent"],["hr","link"],["undo","redo"],["removeFormat"]]},null,8,["modelValue","readonly"])])]),_:1}),l(_),l(T,{align:"right"},{default:i(()=>[h(l(f,{flat:"",label:"Cerrar"},null,512),[[b]]),d.mode!=="view"&&s.canEdit?(r(),p(f,{key:0,color:"primary",label:"Guardar",loading:d.saving,onClick:s.save},null,8,["loading","onClick"])):k("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Mo=I(Do,[["render",zo]]),jo={name:"DnaInformesLegal",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:null}},data:()=>({loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],last_page:1},dialog:!1,mode:"create",form:{id:null,fecha:"",titulo:"",numero:"",contenido_html:""},plantilla:"informe_legal",plantillasOptions:[{label:"Informe Legal (DNA)",value:"informe_legal"},{label:"Memorial (simple)",value:"memorial"},{label:"Oficio / Nota",value:"oficio"},{label:"Acta de Compromiso",value:"acta"},{label:"Denuncia penal — Ministerio Público",value:"denuncia_mp"}],toolbar:[["left","center","right","justify"],["bold","italic","strike","underline"],["quote","unordered","ordered","outdent","indent"],["hr","link"],["undo","redo"],["removeFormat"]]}),computed:{role(){return this.$store.user?.role||""},canEdit(){return this.role==="Administrador"||this.role==="Abogado"}},watch:{caseId(){this.page=1,this.fetchRows()},search(){this.page=1,this.fetchRows()}},created(){this.fetchRows()},methods:{today(){const e=new Date,o=u=>String(u).padStart(2,"0");return`${e.getFullYear()}-${o(e.getMonth()+1)}-${o(e.getDate())}`},async fetchRows(){if(this.caseId){this.loading=!0;try{const{data:e}=await this.$axios.get(`/dnas/${this.caseId}/informes-legales`,{params:{q:this.search,page:this.page,per_page:this.perPage}});this.rows=e||{data:[],last_page:1}}catch(e){this.$q.notify({type:"negative",message:e?.response?.data?.message||"Error cargando informes"})}finally{this.loading=!1}}},openCreate(){this.canEdit&&(this.mode="create",this.form={id:null,fecha:this.today(),titulo:"",numero:"",contenido_html:""},this.dialog=!0,this.$nextTick(()=>this.applyTemplate(this.plantilla)))},openView(e){this.mode="view",this.form={...e},this.dialog=!0},openEdit(e){this.canEdit&&(this.mode="edit",this.form={...e},this.dialog=!0)},applyTemplate(e){if(this.mode==="view")return;const o=this.form.fecha||this.today(),u=o.slice(0,4),d=`
        <div style="text-align:center; margin-bottom:8px;">
          <div style="font-size:16px; font-weight:bold;">DIRECCIÓN DE IGUALDAD DE OPORTUNIDADES</div>
          <div style="font-size:12px;">Gobierno Autónomo Municipal de Oruro</div>
          <div style="font-size:12px; font-weight:bold;">${this.form.numero?`N° ${this.form.numero}`:""}</div>
          <hr/>
        </div>`;if(e==="memorial"){this.form.contenido_html=d+`<p><b>Señor(a) Juez/Fiscal</b></p><p>De mi consideración:</p><p style="text-align:justify">Por medio del presente, ...</p><p>Oruro, ${o}</p>`;return}if(e==="oficio"){this.form.contenido_html=d+`<p><b>Ref.:</b> Solicitud de información</p><p>De nuestra consideración:</p><p style="text-align:justify">Solicitamos remitir la información ...</p><p>Oruro, ${o}</p>`;return}if(e==="acta"){this.form.contenido_html=d+`<p style="text-align:center"><b>ACTA DE COMPROMISO</b></p><p style="text-align:justify">En la ciudad de Oruro, a ${o}, las partes acuerdan ...</p>`;return}if(e==="denuncia_mp"){const s=this.caso||{},t=s.denunciante_nombre||s.denunciante_nombre_completo||"—";this.form.contenido_html=d+`<p style="text-align:center"><b>SEÑOR(A) REPRESENTANTE DEL MINISTERIO PÚBLICO — ORURO</b></p><p><b>DENUNCIANTE:</b> ${t}</p><p style="text-align:justify">Que, en mérito a los antecedentes ...</p><p>Oruro, ${o}</p>`;return}this.form.contenido_html=d+`<p><b>Informe Legal ${u}</b></p><p style="text-align:justify">En atención a los antecedentes, se emite el presente informe con el siguiente análisis jurídico:</p><ul><li>Ley N° 348 y reglamentación.</li><li>Constitución Política del Estado.</li><li>Normativa municipal vigente.</li></ul><p><b>Recomendaciones:</b> …</p><p>Oruro, ${o}</p>`},async save(){if(this.canEdit){if(!this.form.titulo)return this.$q.notify({type:"negative",message:"El título es obligatorio"});if(!this.form.contenido_html)return this.$q.notify({type:"negative",message:"El contenido está vacío"});this.saving=!0;try{this.form.id?await this.$axios.put(`/dnas/informes-legales/${this.form.id}`,this.form):await this.$axios.post(`/dnas/${this.caseId}/informes-legales`,this.form),this.$q.notify({type:"positive",message:"Guardado"}),this.dialog=!1,this.fetchRows()}catch(e){this.$q.notify({type:"negative",message:e?.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}}},removeIt(e){if(!this.canEdit)return;const o=async()=>{try{await this.$axios.delete(`/dnas/informes-legales/${e.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.fetchRows()}catch(u){this.$q.notify({type:"negative",message:u?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar el informe?").onOk(o):confirm("¿Eliminar el informe?")&&o()},printPdf(e){const o=this.$axios?.defaults?.baseURL||"";window.open(`${o}/dnas/informes-legales/${e.id}/pdf`,"_blank")}}},Go={class:"row items-center q-mb-sm"},Bo={class:"col"},Ho={class:"text-caption text-grey-7"},Yo={class:"col-auto row items-center q-gutter-sm"},Wo={key:0},Zo={class:"row justify-end q-mt-sm"},Jo={class:"text-subtitle1"},Ko={class:"row q-col-gutter-md"},Xo={class:"col-12 col-md-3"},el={class:"col-12 col-md-7"},ol={class:"col-12 col-md-2"},ll={key:0};function tl(e,o,u,D,d,s){return r(),p(V,{flat:"",bordered:"",class:"q-pa-md"},{default:i(()=>[a("div",Go,[a("div",Bo,[o[8]||(o[8]=a("div",{class:"text-subtitle1 text-weight-medium"},"Informes legales",-1)),a("div",Ho,"Caso #"+n(u.caseId),1)]),a("div",Yo,[l(c,{dense:"",outlined:"",modelValue:e.search,"onUpdate:modelValue":o[0]||(o[0]=t=>e.search=t),placeholder:"Buscar...",style:{width:"260px"}},{append:i(()=>[l(C,{name:"search"})]),_:1},8,["modelValue"]),l(f,{flat:"",color:"primary",icon:"refresh",loading:e.loading,onClick:s.fetchRows},null,8,["loading","onClick"]),s.canEdit?(r(),p(f,{key:0,color:"green",icon:"add_circle_outline","no-caps":"",label:"Crear informe",onClick:s.openCreate},null,8,["onClick"])):k("",!0)])]),l(_),l(Y,{dense:"",flat:"",bordered:"",class:"q-mt-sm"},{default:i(()=>[o[14]||(o[14]=a("thead",null,[a("tr",{class:"bg-primary text-white"},[a("th",{style:{width:"70px"}},"ID"),a("th",{style:{width:"140px"}},"Acciones"),a("th",null,"Título"),a("th",{style:{width:"120px"}},"Fecha"),a("th",{style:{width:"120px"}},"Nro"),a("th",{style:{width:"180px"}},"Usuario")])],-1)),a("tbody",null,[(r(!0),v(q,null,x(e.rows.data,t=>(r(),v("tr",{key:t.id},[a("td",null,"#"+n(t.id),1),a("td",null,[l(z,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:i(()=>[h((r(),p($,{clickable:"",onClick:y=>s.openView(t)},{default:i(()=>[l(g,{avatar:""},{default:i(()=>[l(C,{name:"visibility"})]),_:1}),l(g,null,{default:i(()=>o[9]||(o[9]=[m("Ver")])),_:1})]),_:2},1032,["onClick"])),[[b]]),h((r(),p($,{clickable:"",onClick:y=>s.printPdf(t)},{default:i(()=>[l(g,{avatar:""},{default:i(()=>[l(C,{name:"picture_as_pdf"})]),_:1}),l(g,null,{default:i(()=>o[10]||(o[10]=[m("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[b]]),s.canEdit?(r(),v(q,{key:0},[l(_),h((r(),p($,{clickable:"",onClick:y=>s.openEdit(t)},{default:i(()=>[l(g,{avatar:""},{default:i(()=>[l(C,{name:"edit"})]),_:1}),l(g,null,{default:i(()=>o[11]||(o[11]=[m("Editar")])),_:1})]),_:2},1032,["onClick"])),[[b]]),h((r(),p($,{clickable:"",onClick:y=>s.removeIt(t)},{default:i(()=>[l(g,{avatar:""},{default:i(()=>[l(C,{name:"delete",color:"negative"})]),_:1}),l(g,{class:"text-negative"},{default:i(()=>o[12]||(o[12]=[m("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[b]])],64)):k("",!0)]),_:2},1024)]),a("td",null,n(t.titulo),1),a("td",null,n(t.fecha||"s/f"),1),a("td",null,n(t.numero||"—"),1),a("td",null,n(t.user?.name||t.user?.username||"—"),1)]))),128)),!e.rows.data?.length&&!e.loading?(r(),v("tr",Wo,o[13]||(o[13]=[a("td",{colspan:"6",class:"text-center text-grey"},"Sin registros",-1)]))):k("",!0)])]),_:1}),a("div",Zo,[l(M,{modelValue:e.page,"onUpdate:modelValue":[o[1]||(o[1]=t=>e.page=t),s.fetchRows],max:e.rows.last_page||1,"boundary-numbers":"","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])]),l(Q,{modelValue:e.dialog,"onUpdate:modelValue":o[7]||(o[7]=t=>e.dialog=t),persistent:"",maximized:""},{default:i(()=>[l(V,null,{default:i(()=>[l(oe,{class:"bg-white text-dark"},{default:i(()=>[a("div",Jo,n(e.mode==="view"?"Ver informe":e.form.id?"Editar informe":"Nuevo informe"),1),l(F),h(l(f,{flat:"",dense:"",round:"",icon:"close"},null,512),[[b]])]),_:1}),l(_),l(w,{class:"q-gutter-md"},{default:i(()=>[a("div",Ko,[a("div",Xo,[l(c,{modelValue:e.form.fecha,"onUpdate:modelValue":o[2]||(o[2]=t=>e.form.fecha=t),type:"date",dense:"",outlined:"",label:"Fecha",readonly:e.mode==="view"},null,8,["modelValue","readonly"])]),a("div",el,[l(c,{modelValue:e.form.titulo,"onUpdate:modelValue":o[3]||(o[3]=t=>e.form.titulo=t),dense:"",outlined:"",label:"Título *",readonly:e.mode==="view",rules:[t=>!!t||"Requerido"]},null,8,["modelValue","readonly","rules"])]),a("div",ol,[l(c,{modelValue:e.form.numero,"onUpdate:modelValue":o[4]||(o[4]=t=>e.form.numero=t),dense:"",outlined:"",label:"Nro",readonly:e.mode==="view"},null,8,["modelValue","readonly"])])]),e.mode!=="view"?(r(),v("div",ll,[l(N,{modelValue:e.plantilla,"onUpdate:modelValue":[o[5]||(o[5]=t=>e.plantilla=t),s.applyTemplate],options:e.plantillasOptions,label:"Plantilla",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])])):k("",!0),a("div",null,[o[15]||(o[15]=a("div",{class:"text-caption text-grey-7 q-mb-xs"},"Contenido (HTML)",-1)),l(Z,{modelValue:e.form.contenido_html,"onUpdate:modelValue":o[6]||(o[6]=t=>e.form.contenido_html=t),readonly:e.mode==="view","min-height":"320px",placeholder:"Escriba el informe...",toolbar:e.toolbar},null,8,["modelValue","readonly","toolbar"])])]),_:1}),l(_),l(T,{align:"right"},{default:i(()=>[h(l(f,{flat:"",label:"Cerrar"},null,512),[[b]]),e.mode!=="view"&&s.canEdit?(r(),p(f,{key:0,color:"primary",label:"Guardar",loading:e.saving,onClick:s.save},null,8,["loading","onClick"])):k("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const al=I(jo,[["render",tl]]),il={name:"DnaDocumentos",props:{caseId:{type:[String,Number],required:!0}},data:()=>({loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],last_page:1},dlgUpload:!1,file:null,meta:{titulo:"",categoria:"",descripcion:""},accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.odt,.ods,.txt,.zip,.jpg,.jpeg,.png,.webp",dlgEdit:!1,edit:{},editingId:null}),watch:{caseId(){this.page=1,this.fetchRows()},search(){this.page=1,this.fetchRows()}},created(){this.fetchRows()},methods:{baseURL(){return this.$axios?.defaults?.baseURL||""},async fetchRows(){if(this.caseId){this.loading=!0;try{const{data:e}=await this.$axios.get(`/dnas/${this.caseId}/documentos`,{params:{q:this.search,page:this.page,per_page:this.perPage}});this.rows=e||{data:[],last_page:1}}catch(e){this.$q.notify({type:"negative",message:e?.response?.data?.message||"Error cargando documentos"})}finally{this.loading=!1}}},openUpload(){this.file=null,this.meta={titulo:"",categoria:"",descripcion:""},this.dlgUpload=!0},async upload(){if(!this.file)return this.$q.notify({type:"negative",message:"Seleccione un archivo"});this.saving=!0;try{const e=new FormData;e.append("file",this.file),Object.entries(this.meta).forEach(([o,u])=>u&&e.append(o,u)),await this.$axios.post(`/dnas/${this.caseId}/documentos`,e,{headers:{"Content-Type":"multipart/form-data"}}),this.$q.notify({type:"positive",message:"Archivo subido"}),this.dlgUpload=!1,this.fetchRows()}catch(e){this.$q.notify({type:"negative",message:e?.response?.data?.message||"No se pudo subir"})}finally{this.saving=!1}},viewDoc(e){window.open(`${this.baseURL()}/dnas/documentos/${e.id}/view`,"_blank")},downloadDoc(e){window.open(`${this.baseURL()}/dnas/documentos/${e.id}/download`,"_blank")},editMeta(e){this.editingId=e.id,this.edit={titulo:e.titulo||"",categoria:e.categoria||"",descripcion:e.descripcion||""},this.dlgEdit=!0},async saveMeta(){this.saving=!0;try{await this.$axios.put(`/dnas/documentos/${this.editingId}`,this.edit),this.$q.notify({type:"positive",message:"Actualizado"}),this.dlgEdit=!1,this.fetchRows()}catch(e){this.$q.notify({type:"negative",message:e?.response?.data?.message||"No se pudo actualizar"})}finally{this.saving=!1}},removeDoc(e){const o=async()=>{try{await this.$axios.delete(`/dnas/documentos/${e.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.fetchRows()}catch(u){this.$q.notify({type:"negative",message:u?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar el documento?").onOk(o):confirm("¿Eliminar el documento?")&&o()}}},sl={class:"row items-center q-mb-sm"},nl={class:"col"},dl={class:"text-caption text-grey-7"},rl={class:"col-auto row items-center q-gutter-sm"},ul={class:"text-weight-medium"},ml={key:0},cl={class:"row items-center q-mt-sm"},fl={class:"col"},pl={class:"col-auto"};function gl(e,o,u,D,d,s){return r(),p(V,{flat:"",bordered:"",class:"q-pa-md"},{default:i(()=>[a("div",sl,[a("div",nl,[o[12]||(o[12]=a("div",{class:"text-subtitle1 text-weight-medium"},"Documentos",-1)),a("div",dl,"Adjuntos del caso #"+n(u.caseId),1)]),a("div",rl,[l(c,{dense:"",outlined:"",modelValue:e.search,"onUpdate:modelValue":o[0]||(o[0]=t=>e.search=t),placeholder:"Buscar...",style:{width:"260px"}},{append:i(()=>[l(C,{name:"search"})]),_:1},8,["modelValue"]),l(f,{flat:"",color:"primary",icon:"refresh",loading:e.loading,onClick:s.fetchRows},null,8,["loading","onClick"]),l(f,{color:"green",icon:"upload","no-caps":"",label:"Subir archivo",onClick:s.openUpload},null,8,["onClick"])])]),l(_),l(Y,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:i(()=>[o[18]||(o[18]=a("thead",null,[a("tr",{class:"bg-primary text-white"},[a("th",{style:{width:"70px"}},"ID"),a("th",{style:{width:"160px"}},"Acciones"),a("th",null,"Título"),a("th",{style:{width:"130px"}},"Categoría"),a("th",{style:{width:"120px"}},"Tamaño"),a("th",{style:{width:"160px"}},"Tipo"),a("th",{style:{width:"180px"}},"Usuario")])],-1)),a("tbody",null,[(r(!0),v(q,null,x(e.rows.data,t=>(r(),v("tr",{key:t.id},[a("td",null,"#"+n(t.id),1),a("td",null,[l(z,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:i(()=>[h((r(),p($,{clickable:"",onClick:y=>s.viewDoc(t)},{default:i(()=>[l(g,{avatar:""},{default:i(()=>[l(C,{name:"visibility"})]),_:1}),l(g,null,{default:i(()=>o[13]||(o[13]=[m("Ver")])),_:1})]),_:2},1032,["onClick"])),[[b]]),h((r(),p($,{clickable:"",onClick:y=>s.downloadDoc(t)},{default:i(()=>[l(g,{avatar:""},{default:i(()=>[l(C,{name:"download"})]),_:1}),l(g,null,{default:i(()=>o[14]||(o[14]=[m("Descargar")])),_:1})]),_:2},1032,["onClick"])),[[b]]),l(_),h((r(),p($,{clickable:"",onClick:y=>s.editMeta(t)},{default:i(()=>[l(g,{avatar:""},{default:i(()=>[l(C,{name:"edit"})]),_:1}),l(g,null,{default:i(()=>o[15]||(o[15]=[m("Editar")])),_:1})]),_:2},1032,["onClick"])),[[b]]),h((r(),p($,{clickable:"",onClick:y=>s.removeDoc(t)},{default:i(()=>[l(g,{avatar:""},{default:i(()=>[l(C,{name:"delete",color:"negative"})]),_:1}),l(g,{class:"text-negative"},{default:i(()=>o[16]||(o[16]=[m("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[b]])]),_:2},1024)]),a("td",ul,n(t.titulo||t.original_name),1),a("td",null,n(t.categoria||"—"),1),a("td",null,n(t.size_human||"—"),1),a("td",null,n(t.mime||t.extension||"—"),1),a("td",null,n(t.user?.name||t.user?.username||"—"),1)]))),128)),!e.rows.data.length&&!e.loading?(r(),v("tr",ml,o[17]||(o[17]=[a("td",{colspan:"7",class:"text-center text-grey"},"Sin registros",-1)]))):k("",!0)])]),_:1}),a("div",cl,[a("div",fl,[l(N,{modelValue:e.perPage,"onUpdate:modelValue":[o[1]||(o[1]=t=>e.perPage=t),s.fetchRows],options:[5,10,15,20,50].map(t=>({label:t,value:t})),"emit-value":"","map-options":"",dense:"",outlined:"",style:{width:"110px"},label:"Por pág."},null,8,["modelValue","options","onUpdate:modelValue"])]),a("div",pl,[l(M,{modelValue:e.page,"onUpdate:modelValue":[o[2]||(o[2]=t=>e.page=t),s.fetchRows],max:e.rows.last_page||1,"boundary-numbers":"","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])])]),l(Q,{modelValue:e.dlgUpload,"onUpdate:modelValue":o[7]||(o[7]=t=>e.dlgUpload=t),persistent:""},{default:i(()=>[l(V,{style:{"max-width":"700px",width:"95vw"}},{default:i(()=>[l(w,{class:"row items-center q-pb-none"},{default:i(()=>[o[19]||(o[19]=a("div",{class:"text-subtitle1"},"Subir archivo",-1)),l(F),h(l(f,{flat:"",dense:"",round:"",icon:"close"},null,512),[[b]])]),_:1}),l(w,{class:"q-gutter-md"},{default:i(()=>[l(c,{modelValue:e.meta.titulo,"onUpdate:modelValue":o[3]||(o[3]=t=>e.meta.titulo=t),label:"Título",outlined:"",dense:""},null,8,["modelValue"]),l(c,{modelValue:e.meta.categoria,"onUpdate:modelValue":o[4]||(o[4]=t=>e.meta.categoria=t),label:"Categoría",outlined:"",dense:""},null,8,["modelValue"]),l(c,{modelValue:e.meta.descripcion,"onUpdate:modelValue":o[5]||(o[5]=t=>e.meta.descripcion=t),type:"textarea",label:"Descripción",outlined:"",dense:"",autogrow:""},null,8,["modelValue"]),l(le,{modelValue:e.file,"onUpdate:modelValue":o[6]||(o[6]=t=>e.file=t),outlined:"",dense:"","use-chips":"",clearable:!0,accept:e.accept,hint:"Hasta 50MB. PDF, Word, Excel, imágenes, etc."},null,8,["modelValue","accept"])]),_:1}),l(T,{align:"right"},{default:i(()=>[h(l(f,{flat:"",label:"Cancelar"},null,512),[[b]]),l(f,{color:"primary",label:"Subir",loading:e.saving,onClick:s.upload},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Q,{modelValue:e.dlgEdit,"onUpdate:modelValue":o[11]||(o[11]=t=>e.dlgEdit=t)},{default:i(()=>[l(V,{style:{"max-width":"600px",width:"95vw"}},{default:i(()=>[l(w,{class:"row items-center q-pb-none"},{default:i(()=>[o[20]||(o[20]=a("div",{class:"text-subtitle1"},"Editar metadatos",-1)),l(F),h(l(f,{flat:"",dense:"",round:"",icon:"close"},null,512),[[b]])]),_:1}),l(w,{class:"q-gutter-md"},{default:i(()=>[l(c,{modelValue:e.edit.titulo,"onUpdate:modelValue":o[8]||(o[8]=t=>e.edit.titulo=t),label:"Título",outlined:"",dense:""},null,8,["modelValue"]),l(c,{modelValue:e.edit.categoria,"onUpdate:modelValue":o[9]||(o[9]=t=>e.edit.categoria=t),label:"Categoría",outlined:"",dense:""},null,8,["modelValue"]),l(c,{modelValue:e.edit.descripcion,"onUpdate:modelValue":o[10]||(o[10]=t=>e.edit.descripcion=t),type:"textarea",label:"Descripción",outlined:"",dense:"",autogrow:""},null,8,["modelValue"])]),_:1}),l(T,{align:"right"},{default:i(()=>[h(l(f,{flat:"",label:"Cancelar"},null,512),[[b]]),l(f,{color:"primary",label:"Guardar",loading:e.saving,onClick:s.saveMeta},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const hl=I(il,[["render",gl]]),bl={name:"DnaFotografias",props:{caseId:{type:[String,Number],required:!0}},data:()=>({rows:{data:[],last_page:1},page:1,perPage:12,loading:!1,uploading:!1}),created(){this.fetchRows()},methods:{toPublicUrl(e){return e?/^https?:\/\//i.test(e)?e:`${(this.$axios?.defaults?.baseURL||"").replace(/\/api\/?$/,"")}${e}`:""},async fetchRows(){this.loading=!0;try{const{data:e}=await this.$axios.get(`/dnas/${this.caseId}/fotografias`,{params:{page:this.page,per_page:this.perPage}});this.rows=e||{data:[],last_page:1}}catch(e){this.$q.notify({type:"negative",message:e?.response?.data?.message||"Error cargando fotos"})}finally{this.loading=!1}},pickFile(){this.$refs.file?.click()},async upload(e){const o=e.target.files?.[0];if(o){this.uploading=!0;try{const u=new FormData;u.append("file",o),await this.$axios.post(`/dnas/${this.caseId}/fotografias`,u,{headers:{"Content-Type":"multipart/form-data"}}),this.$q.notify({type:"positive",message:"Foto subida"}),this.fetchRows()}catch(u){this.$q.notify({type:"negative",message:u?.response?.data?.message||"No se pudo subir"})}finally{this.uploading=!1,this.$refs.file&&(this.$refs.file.value="")}}},async remove(e){if(confirm("¿Eliminar foto?"))try{await this.$axios.delete(`/dnas/fotografias/${e.id}`),this.$q.notify({type:"positive",message:"Eliminada"}),this.fetchRows()}catch(o){this.$q.notify({type:"negative",message:o?.response?.data?.message||"No se pudo eliminar"})}},view(e){e&&window.open(e,"_blank")}}},vl={class:"row items-center q-mb-sm"},yl={class:"col"},wl={class:"text-caption text-grey-7"},Vl={class:"col-auto"},_l={class:"row q-col-gutter-md q-mt-sm"},kl={class:"absolute-bottom text-subtitle2 bg-black bg-opacity-40 q-pa-xs ellipsis"},Cl={class:"text-caption text-grey-7 q-ml-xs"},$l={key:0,class:"q-mt-md text-grey text-center"};function Dl(e,o,u,D,d,s){return r(),p(V,{flat:"",bordered:"",class:"q-pa-md"},{default:i(()=>[a("div",vl,[a("div",yl,[o[2]||(o[2]=a("div",{class:"text-subtitle1 text-weight-medium"},"Fotografías",-1)),a("div",wl,"Sube / ver fotos del caso #"+n(u.caseId),1)]),a("div",Vl,[l(f,{color:"primary",icon:"add_photo_alternate","no-caps":"",label:"Subir",loading:e.uploading,onClick:s.pickFile},null,8,["loading","onClick"]),a("input",{ref:"file",type:"file",accept:"image/*",class:"hidden",onChange:o[0]||(o[0]=(...t)=>s.upload&&s.upload(...t))},null,544)])]),l(_),a("div",_l,[(r(!0),v(q,null,x(e.rows.data,t=>(r(),v("div",{key:t.id,class:"col-6 col-sm-4 col-md-3"},[l(V,{flat:"",bordered:""},{default:i(()=>[l(de,{src:s.toPublicUrl(t.thumb_url||t.url),ratio:4/3,style:{cursor:"pointer"},onClick:y=>s.view(s.toPublicUrl(t.url))},{default:i(()=>[a("div",kl,n(t.titulo||t.original_name||"—"),1)]),_:2},1032,["src","onClick"]),l(T,{align:"between"},{default:i(()=>[a("div",Cl,n(t.size_human||""),1),l(f,{dense:"",flat:"",icon:"delete",color:"negative",onClick:y=>s.remove(t)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))]),!e.rows.data.length&&!e.loading?(r(),v("div",$l," No hay fotografías aún. ")):k("",!0),l(M,{modelValue:e.page,"onUpdate:modelValue":[o[1]||(o[1]=t=>e.page=t),s.fetchRows],max:e.rows.last_page||1,"boundary-numbers":"","direction-links":"",class:"q-mt-md flex justify-end"},null,8,["modelValue","max","onUpdate:modelValue"])]),_:1})}const ql=I(bl,[["render",Dl]]),Il={name:"DnaShow",components:{DnaInfoGeneral:so,DnaSeguimiento:$o,DnaPsicologia:Mo,DnaInformesLegal:al,DnaDocumentos:hl,DnaFotografias:ql},data:()=>({tab:"info",dna:null,loading:!1}),computed:{caseId(){return this.$route.params.id}},mounted(){this.load()},methods:{printPdf(){const e=this.$axios.defaults.baseURL+`/dna/${this.caseId}/pdf`;window.open(e,"_blank")},printPdfHojaRuta(e="denunciante"){const o=this.$axios.defaults.baseURL+`/dna/${this.caseId}/pdf/hoja-ruta?tipo=${e}`;window.open(o,"_blank")},async load(){this.loading=!0;try{const{data:e}=await this.$axios.get(`/dnas/${this.caseId}`);this.dna=e||{}}catch(e){this.$alert?.error?.(e?.response?.data?.message||"No se pudo cargar el caso")}finally{this.loading=!1}}}},Ul={class:"row items-center q-mb-md"},El={class:"col"},Sl={class:"text-h6 text-weight-bold"},Pl={class:"col-auto"};function Rl(e,o,u,D,d,s){const t=S("DnaInfoGeneral"),y=S("DnaSeguimiento"),j=S("DnaPsicologia"),G=S("DnaInformesLegal"),B=S("DnaDocumentos"),H=S("DnaFotografias");return r(),p(ie,{class:"q-pa-md bg-grey-2"},{default:i(()=>[a("div",Ul,[a("div",El,[a("div",Sl,"DNA #"+n(s.caseId),1),o[3]||(o[3]=a("div",{class:"text-caption text-grey-7"},"Detalle y gestión",-1))]),a("div",Pl,[l(z,{flat:"",color:"secondary",icon:"print",label:"Imprimir PDF"},{default:i(()=>[l(ee,null,{default:i(()=>[h((r(),p($,{clickable:"",onClick:s.printPdf},{default:i(()=>[l(g,null,{default:i(()=>o[4]||(o[4]=[m("Ficha del DNA")])),_:1})]),_:1},8,["onClick"])),[[b]]),l(_),h((r(),p($,{clickable:"",onClick:o[0]||(o[0]=U=>s.printPdfHojaRuta("denunciante"))},{default:i(()=>[l(g,null,{default:i(()=>o[5]||(o[5]=[m("Ubicación (Denunciante)")])),_:1})]),_:1})),[[b]])]),_:1})]),_:1}),l(f,{flat:"",color:"primary",icon:"refresh",onClick:s.load,loading:e.loading},null,8,["onClick","loading"])])]),l(V,{flat:"",bordered:"",class:"q-mb-md"},{default:i(()=>[l(te,{modelValue:e.tab,"onUpdate:modelValue":o[1]||(o[1]=U=>e.tab=U),class:"text-primary",dense:"",align:"left","active-color":"primary","indicator-color":"primary","outside-arrows":"","mobile-arrows":""},{default:i(()=>[l(P,{name:"info",label:"1 Información General",icon:"dashboard","no-caps":""}),l(P,{name:"seguimiento",label:"2 Seguimiento",icon:"track_changes","no-caps":""}),l(P,{name:"psico",label:"3 Área Psicología",icon:"psychology","no-caps":""}),l(P,{name:"legal",label:"4 Área Legal",icon:"gavel","no-caps":""}),l(P,{name:"docs",label:"5 Documentos",icon:"folder","no-caps":""}),l(P,{name:"fotos",label:"6 Fotografías",icon:"photo_library","no-caps":""})]),_:1},8,["modelValue"])]),_:1}),l(ae,{modelValue:e.tab,"onUpdate:modelValue":o[2]||(o[2]=U=>e.tab=U),animated:"","keep-alive":""},{default:i(()=>[l(R,{name:"info"},{default:i(()=>[l(t,{"case-id":s.caseId},null,8,["case-id"])]),_:1}),l(R,{name:"seguimiento"},{default:i(()=>[l(y,{"case-id":s.caseId},null,8,["case-id"])]),_:1}),l(R,{name:"psico"},{default:i(()=>[l(j,{"case-id":s.caseId},null,8,["case-id"])]),_:1}),l(R,{name:"legal"},{default:i(()=>[l(G,{"case-id":s.caseId,caso:e.dna},null,8,["case-id","caso"])]),_:1}),l(R,{name:"docs"},{default:i(()=>[l(B,{"case-id":s.caseId},null,8,["case-id"])]),_:1}),l(R,{name:"fotos"},{default:i(()=>[l(H,{"case-id":s.caseId},null,8,["case-id"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Kl=I(Il,[["render",Rl],["__scopeId","data-v-c409a3ce"]]);export{Kl as default};
