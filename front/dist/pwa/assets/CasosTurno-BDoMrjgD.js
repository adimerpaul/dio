import{_ as x,c as f,o as n,w as u,b as e,a as h,$ as c,bk as C,f as _,a0 as r,a1 as m,a2 as w,bl as S,t as o,Z as i}from"./index-tEaV_suc.js";import{Q as y}from"./QBadge-CFDHE5lk.js";import{Q as k}from"./QTooltip-C3gcl_lA.js";import{Q as P}from"./QMarkupTable-C0DQYA4_.js";import{Q as D}from"./QPage-CezfwX8s.js";import"./position-engine-BS4hZsDu.js";const v={name:"CasoTable",props:{tipo:{type:String,default:"CASO"},subtipo:{type:String,default:""},tipologia:{type:String,default:""},leerOnlyPendientesDeRuta:{type:Boolean,default:!0},placeholder:{type:String,default:""},perPageInit:{type:Number,default:10}},data(){return{dialogFormat:!1,casos:[],loading:!1,page:1,perPage:this.perPageInit,meta:{current_page:1,last_page:1,total:0,from:0,to:0},search:"",onlyPendientes:!1,showExtra:!1}},computed:{isSLIM(){return String(this.tipo).toUpperCase()==="SLIM"},placeholderComputed(){return this.placeholder?this.placeholder:`Buscar por N° ${this.tipo?.toUpperCase()||"CASO"}, denunciante, denunciado, tipología, zona…`},baseColspan(){return this.isSLIM&&this.showExtra?21:9}},mounted(){this.leerOnlyPendientesDeRuta&&(this.onlyPendientes=String(this.$route?.query?.only_pendientes||"")==="1"),this.fetchCasos()},watch:{"$route.query.only_pendientes"(s){this.leerOnlyPendientesDeRuta&&(this.onlyPendientes=String(s||"")==="1",this.goFirstPage())}},methods:{openDialogFormat(){this.dialogFormat=!0},refresh(){this.fetchCasos()},fetchCasos(){this.loading=!0,this.$axios.get("/mis-casos-de-turno").then(s=>{this.casos=s.data||[]}).catch(s=>this.$alert?.error?.(s.response?.data?.message||"Error cargando casos")||console.error(s)).finally(()=>{this.loading=!1})},onSearch(){this.page=1,this.fetchCasos()},clearSearch(){this.search="",this.onSearch()},goFirstPage(){this.page=1,this.fetchCasos()},rowIndex(s){return(this.meta.from||0)+s},goToDetalle(s){this.subtipo==="AntecedentesDna"?this.$router.push("/casos/"+s.id+"/dna"):this.$router.push("/casos/"+s.id)},nombrePersona(s,a="denunciante"){return s&&(a==="denunciante"?[s.denunciante_nombres,s.denunciante_paterno,s.denunciante_materno]:[s.denunciado_nombres,s.denunciado_paterno,s.denunciado_materno]).filter(Boolean).join(" ")||"—"},fmt(s){return(s??"")!==""?s:"—"},fmtFecha(s){if(!s)return"—";try{const a=new Date(String(s).replace(" ","T")),p=String(a.getDate()).padStart(2,"0"),g=String(a.getMonth()+1).padStart(2,"0"),l=a.getFullYear();return`${p}/${g}/${l}`}catch{return s}}}},F={class:"row items-center q-col-gutter-md q-mb-md"},I={class:"col-auto row items-center"},z={key:0},q=["onClick"],B={class:"text-no-wrap"},E={class:"text-no-wrap"},Q={class:"text-weight-medium"},T={key:0,class:"text-caption text-grey-7"},M={class:"text-weight-medium"},N={key:0,class:"text-caption text-grey-7"},V={class:"text-weight-medium"},j={key:0,class:"text-caption text-grey-7"},A={key:1,class:"text-grey-6"},O={class:"row items-center justify-between q-mt-md"},L={class:"text-caption text-grey-7"};function R(s,a,p,g,l,d){return n(),f(D,{class:"q-pa-md"},{default:u(()=>[e("div",F,[e("div",I,[h(_,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",onClick:a[0]||(a[0]=t=>d.fetchCasos()),loading:l.loading,class:"q-mr-sm",size:"10px"},null,8,["loading"]),d.isSLIM?(n(),f(_,{key:0,color:"green",icon:"visibility","no-caps":"",size:"10px",labelx:l.showExtra?"Ocultar columnas extra":"Visualizar Casos/Estado",label:"Visualizar Casos/Estado",onClick:d.openDialogFormat},null,8,["labelx","onClick"])):c("",!0),C(s.$slots,"actions",{},void 0,!0)])]),h(P,{flat:"",bordered:"",dense:""},{default:u(()=>[a[6]||(a[6]=e("thead",null,[e("tr",{class:"bg-primary text-white"},[e("th",{style:{width:"60px"}},"#"),e("th",null,"Nº"),e("th",null,"Fecha"),e("th",null,"Victima"),e("th",null,"Denunciante"),e("th",null,"Denunciado"),e("th",null,"Tipología"),e("th",null,"Zona"),e("th",{class:"col-extra"},"NUREJ"),e("th",{class:"col-extra"},"CUD"),e("th",{class:"col-extra"},"Juzgado"),e("th",null,"Estado del caso"),e("th",null,"Alerta")])],-1)),!l.loading&&l.casos.length?(n(),r("tbody",z,[(n(!0),r(m,null,w(l.casos,(t,b)=>(n(),r("tr",{key:t.id,onClick:U=>d.goToDetalle(t),class:S("cursor-pointer "+(s.$store.casoSelect.id===t.id?"bg-red-3":""))},[e("td",null,o(d.rowIndex(b)),1),e("td",B,o(t.tipo)+" "+o(t.caso_numero||"—"),1),e("td",E,o(s.$filters.date?.(t.fecha_apertura_caso)??t.fecha_apertura_caso),1),e("td",null,[e("div",Q,o(t.victimas?.[0].nombres_apellidos),1),t.victimas?.[0]?.ci?(n(),r("div",T," CI: "+o(t.victimas?.[0]?.ci),1)):c("",!0)]),e("td",null,[e("div",M,o(d.nombrePersona(t.denunciantes?.[0],"denunciante")),1),t.denunciantes?.[0]?.denunciante_nro?(n(),r("div",N," CI: "+o(t.denunciantes?.[0]?.denunciante_nro),1)):c("",!0)]),e("td",null,[e("div",V,o(d.nombrePersona(t.denunciados?.[0],"denunciado")),1),t.denunciados?.[0]?.denunciado_nro?(n(),r("div",j," CI: "+o(t.denunciados?.[0]?.denunciado_nro),1)):c("",!0)]),e("td",null,o(t.caso_tipologia||"—"),1),e("td",null,o(t.zona||"—"),1),e("td",null,o(d.fmt(t.nurej)),1),e("td",null,o(d.fmt(t.cud)),1),e("td",null,o(d.fmt(t.numero_juzgado)),1),e("td",null,o(t.estado_caso||"—"),1),e("td",null,[t.mi_estado?.me_asignado?(n(),r(m,{key:0},[t.mi_estado.primer_informe_hecho?(n(),f(y,{key:0,color:"green","text-color":"white",class:"q-mr-xs"},{default:u(()=>[i(o(t.mi_estado.label_listo||"Primer informe listo"),1)]),_:2},1024)):(n(),r(m,{key:1},[h(y,{color:t.mi_estado.atrasado?"red":"orange","text-color":t.mi_estado.atrasado?"white":"black",class:"q-mr-xs"},{default:u(()=>[t.mi_estado.atrasado?(n(),r(m,{key:0},[i(" Atrasado "+o(Math.abs(t.mi_estado.dias_restantes))+" d ",1)],64)):(n(),r(m,{key:1},[i(" Faltan "+o(t.mi_estado.dias_restantes)+" d ",1)],64))]),_:2},1032,["color","text-color"]),h(k,{"transition-show":"jump-down","transition-hide":"jump-up"},{default:u(()=>[a[1]||(a[1]=i(" Debes cargar tu ")),e("b",null,o(t.mi_estado.rol==="Psicologo"?"primera sesión":"primer informe"),1),a[2]||(a[2]=i(".")),a[3]||(a[3]=e("br",null,null,-1)),a[4]||(a[4]=i(" Fecha límite: ")),e("b",null,o(t.mi_estado.deadline),1),a[5]||(a[5]=i(". "))]),_:2},1024)],64))],64)):(n(),r("span",A,"—"))])],10,q))),128))])):c("",!0)]),_:1}),e("div",O,[e("div",L,[a[7]||(a[7]=i(" Mostrando ")),e("b",null,o(l.meta.from||0),1),a[8]||(a[8]=i(" – ")),e("b",null,o(l.meta.to||0),1),a[9]||(a[9]=i(" de ")),e("b",null,o(l.meta.total||0),1),a[10]||(a[10]=i(" registros "))])])]),_:3})}const K=x(v,[["render",R],["__scopeId","data-v-8bd84ca3"]]);export{K as default};
