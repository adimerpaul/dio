import{_ as A,Y as q,a0 as C,o as u,b as a,a as l,$ as v,a1 as L,c as p,f as _,w as s,e as D,a6 as f,Q as E,d as x,a3 as k,a7 as Ae,a9 as H,t as m,a2 as Q,Z as h,h as W,W as b,a8 as z,j as ve,n as Oe,p as ce,aa as be,k as te,x as Te,l as S,m as me,L as Re,O as Pe,g as Le,ab as Me,a5 as Fe}from"./index-DIJG5QiR.js";import{b as I,c as g,d as ue,Q as Y}from"./QMenu-C8cp1O8h.js";import{Q as fe,a as Z}from"./QBtnDropdown-CsU6qbOY.js";import{S as oe,Q as pe,a as ye,b as je,c as ze,d as F,e as Ge,f as O}from"./QFile-BJHUHxzu.js";import{Q as Qe}from"./QPage-DqtKCZU0.js";import{C as y}from"./ClosePopup-DDQZix32.js";import{Q as P}from"./QSelect-CvPrOrWf.js";import{M as $e}from"./MapPicker-CqxMIg6n.js";import{Q as he}from"./QBadge-QIByAvup.js";import{Q as Be}from"./QPagination-BtFJPwYw.js";import{Q as G}from"./QSpace-DOd3Nah8.js";import{Q as ne}from"./QMarkupTable-tDL_aQId.js";import{Q as He}from"./QImg-PTFjfDbE.js";import{a as ie,Q as Ye}from"./QTable-DnPugIXy.js";import{S as We}from"./SlimNuevo-C93IH_uK.js";import{D as Ze}from"./DnaNuevo-D81VHvia.js";import{S as Je}from"./SlamNuevo-CtNnq4yo.js";import{N as Xe}from"./UmadisNuevo-DNujyDRg.js";import{C as Ke}from"./PropremisNuevo-CdoQKv2E.js";import"./format-BOSv7eyA.js";import"./QResizeObserver-BnFWqRmw.js";import"./touch-BjYP5sR0.js";import"./QTooltip-mJdPYfcb.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./QExpansionItem-BJWGCuPI.js";import"./QForm-C65oK0Q0.js";import"./moment-C5S46NFB.js";const eo={name:"InfoGeneral",components:{MapPicker:$e},props:{caseId:{type:[String,Number],required:!0}},data(){return{documentos:[{label:"Carnet de identidad",value:"Carnet de identidad"},{label:"Pasaporte",value:"Pasaporte"},{label:"Libreta de servicio militar",value:"Libreta de servicio militar"},{label:"Libreta de conducir",value:"Libreta de conducir"}],sexos:[{label:"Masculino",value:"Masculino"},{label:"Femenino",value:"Femenino"},{label:"Otro",value:"Otro"}],estadosCiviles:[{label:"Soltero/a",value:"Soltero/a"},{label:"Casado/a",value:"Casado/a"},{label:"Divorciado/a",value:"Divorciado/a"},{label:"Viudo/a",value:"Viudo/a"},{label:"Unión libre",value:"Unión libre"}],loading:!1,editing:!1,form:{},backup:null,oruroCenter:[-17.9667,-67.1167]}},computed:{denunciantePos:{get(){return{latitud:this.form.latitud,longitud:this.form.longitud}},set(i){this.form.latitud=i.latitud,this.form.longitud=i.longitud}},denunciadoPos:{get(){return{latitud:this.form.denunciado_latitud,longitud:this.form.denunciado_longitud}},set(i){this.form.denunciado_latitud=i.latitud,this.form.denunciado_longitud=i.longitud}},role(){return this.$store.user?.role||""}},created(){this.fetch()},methods:{req(i){return!!i||"Requerido"},async fetch(){this.loading=!0;try{const i=await this.$axios.get(`/casos/${this.caseId}`);this.form={...i.data},this.backup={...this.form}}catch(i){this.$alert.error(i?.response?.data?.message||"No se pudo cargar el caso")}finally{this.loading=!1}},startEdit(){this.editing=!0,this.backup={...this.form}},cancelEdit(){this.form={...this.backup},this.editing=!1,this.$q.notify({type:"info",message:"Cambios descartados"})},async save(){this.loading=!0;try{const i=await this.$axios.put(`/casos/${this.caseId}`,this.form);this.form={...i.data.data},this.backup={...this.form},this.editing=!1,this.$alert.success("Información general actualizada")}catch(i){this.$alert.error(i?.response?.data?.message||"No se pudo actualizar")}finally{this.loading=!1}}}},oo={class:"row items-center q-mb-sm"},lo={class:"col-auto row q-gutter-sm"},io={class:"row q-col-gutter-md"},ao={class:"col-12 col-md-3"},to={class:"col-12 col-md-3"},no={class:"col-12 col-md-6"},so={class:"col-12 col-md-4"},ro={class:"col-12 col-md-4"},co={class:"col-12"},uo={class:"row q-col-gutter-md"},mo={class:"col-12 col-md-2"},fo={class:"col-12 col-md-2"},po={class:"col-12 col-md-2"},_o={class:"col-12 col-md-2"},go={class:"col-12 col-md-2"},ho={class:"col-6 col-md-3"},vo={class:"col-6 col-md-3"},bo={class:"col-6 col-md-3"},yo={class:"col-6 col-md-3"},xo={class:"col-6 col-md-3"},wo={class:"col-6 col-md-3"},Vo={class:"col-6 col-md-3"},Co={class:"col-6 col-md-3"},Io={class:"col-6 col-md-3"},ko={class:"col-6 col-md-3"},Eo={class:"col-6 col-md-3"},Do={class:"col-12 col-md-3"},qo={class:"col-12 col-md-3"},No={class:"col-12"},So={class:"col-12"},Uo={class:"row q-col-gutter-md"},Ao={class:"col-12 col-md-6"},Oo={class:"col-6 col-md-3"},To={class:"col-6 col-md-3"},Ro={class:"col-6 col-md-3"},Po={class:"col-6 col-md-3"},Lo={class:"col-6 col-md-3"},Mo={class:"col-6 col-md-3"},Fo={class:"col-6 col-md-3"},jo={class:"col-6 col-md-3"},zo={class:"col-6 col-md-3"},Go={class:"col-12"},Qo={class:"col-12"},$o={class:"row q-col-gutter-md"},Bo={class:"col-12 col-md-2"},Ho={class:"col-12 col-md-2"},Yo={class:"col-12 col-md-2"},Wo={class:"col-12 col-md-2"},Zo={class:"col-12 col-md-2"},Jo={class:"col-12 col-md-2"};function Xo(i,e,n,c,o,d){const t=q("MapPicker");return u(),C("div",null,[a("div",oo,[e[46]||(e[46]=a("div",{class:"col"},[a("div",{class:"text-subtitle1 text-weight-medium"},"Información General")],-1)),a("div",lo,[d.role==="Administrador"||d.role==="Asistente"?(u(),C(L,{key:0},[o.editing?(u(),C(L,{key:1},[l(_,{flat:"",color:"negative",icon:"close",label:"Cancelar",onClick:d.cancelEdit,loading:o.loading},null,8,["onClick","loading"]),l(_,{color:"primary",icon:"save",label:"Guardar",onClick:d.save,loading:o.loading},null,8,["onClick","loading"])],64)):(u(),p(_,{key:0,color:"primary",icon:"edit",label:"Editar",onClick:d.startEdit,loading:o.loading},null,8,["onClick","loading"]))],64)):v("",!0)])]),l(E,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:s(()=>[l(D,null,{default:s(()=>[a("div",io,[a("div",ao,[l(f,{modelValue:o.form.caso_numero,"onUpdate:modelValue":e[0]||(e[0]=r=>o.form.caso_numero=r),readonly:!0,dense:"",outlined:"",clearable:"",label:"Nro de caso"},null,8,["modelValue"])]),a("div",to,[l(f,{modelValue:o.form.caso_fecha_hecho,"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.caso_fecha_hecho=r),readonly:!o.editing,type:"date",dense:"",outlined:"",label:"Fecha del hecho"},null,8,["modelValue","readonly"])]),a("div",no,[l(f,{modelValue:o.form.caso_lugar_hecho,"onUpdate:modelValue":e[2]||(e[2]=r=>o.form.caso_lugar_hecho=r),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Lugar del hecho"},null,8,["modelValue","readonly"])]),a("div",so,[l(f,{modelValue:o.form.caso_tipologia,"onUpdate:modelValue":e[3]||(e[3]=r=>o.form.caso_tipologia=r),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Tipología"},null,8,["modelValue","readonly"])]),a("div",ro,[l(f,{modelValue:o.form.caso_modalidad,"onUpdate:modelValue":e[4]||(e[4]=r=>o.form.caso_modalidad=r),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Modalidad"},null,8,["modelValue","readonly"])]),a("div",co,[l(f,{modelValue:o.form.caso_descripcion,"onUpdate:modelValue":e[5]||(e[5]=r=>o.form.caso_descripcion=r),readonly:!o.editing,type:"textarea",autogrow:"",outlined:"",dense:"",clearable:"",label:"Descripción del hecho",counter:"",maxlength:"3000"},null,8,["modelValue","readonly"])])])]),_:1})]),_:1}),l(E,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:s(()=>[l(D,{class:"row items-center"},{default:s(()=>[l(x,{name:"assignment_ind",class:"q-mr-sm"}),e[47]||(e[47]=a("div",{class:"text-subtitle1 text-weight-medium"},"Denunciante",-1))]),_:1}),l(k),l(D,null,{default:s(()=>[a("div",uo,[a("div",mo,[l(P,{modelValue:o.form.area,"onUpdate:modelValue":e[6]||(e[6]=r=>o.form.area=r),dense:"",outlined:"",readonly:!o.editing,options:i.$areas,label:"Área *",rules:[d.req]},null,8,["modelValue","readonly","options","rules"])]),a("div",fo,[l(P,{modelValue:o.form.zona,"onUpdate:modelValue":e[7]||(e[7]=r=>o.form.zona=r),dense:"",outlined:"",readonly:!o.editing,options:i.$zonas,label:"Zona *",rules:[d.req]},null,8,["modelValue","readonly","options","rules"])]),a("div",po,[l(f,{modelValue:o.form.denunciante_nombres,"onUpdate:modelValue":e[8]||(e[8]=r=>o.form.denunciante_nombres=r),dense:"",outlined:"",clearable:"",readonly:!o.editing,label:"Nombres *",rules:[d.req]},null,8,["modelValue","readonly","rules"])]),a("div",_o,[l(f,{modelValue:o.form.denunciante_paterno,"onUpdate:modelValue":e[9]||(e[9]=r=>o.form.denunciante_paterno=r),dense:"",outlined:"",clearable:"",readonly:!o.editing,label:"Apellido paterno"},null,8,["modelValue","readonly"])]),a("div",go,[l(f,{modelValue:o.form.denunciante_materno,"onUpdate:modelValue":e[10]||(e[10]=r=>o.form.denunciante_materno=r),dense:"",outlined:"",clearable:"",readonly:!o.editing,label:"Apellido materno"},null,8,["modelValue","readonly"])]),a("div",ho,[l(f,{modelValue:o.form.denunciante_lugar_nacimiento,"onUpdate:modelValue":e[11]||(e[11]=r=>o.form.denunciante_lugar_nacimiento=r),dense:"",outlined:"",clearable:"",label:"Lugar de nacimiento",readonly:!o.editing},null,8,["modelValue","readonly"])]),a("div",vo,[l(f,{modelValue:o.form.denunciante_fecha_nacimiento,"onUpdate:modelValue":[e[12]||(e[12]=r=>o.form.denunciante_fecha_nacimiento=r),e[13]||(e[13]=r=>{if(r){const w=new Date(r),N=Date.now()-w.getTime(),T=new Date(N);this.form.denunciante_edad=Math.abs(T.getUTCFullYear()-1970)}else this.form.denunciante_edad=""})],type:"date",dense:"",outlined:"",label:"Fecha de nacimiento",readonly:!o.editing},null,8,["modelValue","readonly"])]),a("div",bo,[l(f,{modelValue:o.form.denunciante_edad,"onUpdate:modelValue":e[14]||(e[14]=r=>o.form.denunciante_edad=r),modelModifiers:{number:!0},dense:"",outlined:"",type:"number",label:"Edad",readonly:!o.editing},null,8,["modelValue","readonly"])]),a("div",yo,[l(f,{modelValue:o.form.denunciante_telefono,"onUpdate:modelValue":e[15]||(e[15]=r=>o.form.denunciante_telefono=r),dense:"",outlined:"",clearable:"",label:"Teléfono/Celular",readonly:!o.editing},null,8,["modelValue","readonly"])]),a("div",xo,[l(f,{modelValue:o.form.denunciante_grado,"onUpdate:modelValue":e[16]||(e[16]=r=>o.form.denunciante_grado=r),dense:"",outlined:"",clearable:"",label:"Grado de instrucción",readonly:!o.editing},null,8,["modelValue","readonly"])]),a("div",wo,[l(f,{modelValue:o.form.denunciante_documento,"onUpdate:modelValue":e[17]||(e[17]=r=>o.form.denunciante_documento=r),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Documento"},null,8,["modelValue","readonly"])]),a("div",Vo,[l(f,{modelValue:o.form.denunciante_nro,"onUpdate:modelValue":e[18]||(e[18]=r=>o.form.denunciante_nro=r),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Nro documento"},null,8,["modelValue","readonly"])]),a("div",Co,[l(f,{modelValue:o.form.denunciante_sexo,"onUpdate:modelValue":e[19]||(e[19]=r=>o.form.denunciante_sexo=r),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Sexo"},null,8,["modelValue","readonly"])]),a("div",Io,[l(f,{modelValue:o.form.denunciante_estado_civil,"onUpdate:modelValue":e[20]||(e[20]=r=>o.form.denunciante_estado_civil=r),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Estado civil"},null,8,["modelValue","readonly"])]),a("div",ko,[l(f,{modelValue:o.form.denunciante_residencia,"onUpdate:modelValue":e[21]||(e[21]=r=>o.form.denunciante_residencia=r),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Residencia"},null,8,["modelValue","readonly"])]),a("div",Eo,[l(f,{modelValue:o.form.denunciante_idioma,"onUpdate:modelValue":e[22]||(e[22]=r=>o.form.denunciante_idioma=r),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Idioma"},null,8,["modelValue","readonly"])]),a("div",Do,[l(Ae,{modelValue:o.form.denunciante_trabaja,"onUpdate:modelValue":e[23]||(e[23]=r=>o.form.denunciante_trabaja=r),disable:!o.editing,label:"Trabaja"},null,8,["modelValue","disable"])]),a("div",qo,[l(f,{modelValue:o.form.denunciante_ocupacion,"onUpdate:modelValue":e[24]||(e[24]=r=>o.form.denunciante_ocupacion=r),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Ocupación"},null,8,["modelValue","readonly"])]),a("div",No,[l(f,{modelValue:o.form.denunciante_domicilio_actual,"onUpdate:modelValue":e[25]||(e[25]=r=>o.form.denunciante_domicilio_actual=r),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Domicilio actual"},null,8,["modelValue","readonly"])]),a("div",So,[e[48]||(e[48]=a("div",{class:"text-caption text-grey-7 q-mb-xs"},"Ubicación (denunciante)",-1)),l(t,{modelValue:d.denunciantePos,"onUpdate:modelValue":e[26]||(e[26]=r=>d.denunciantePos=r),center:o.oruroCenter},null,8,["modelValue","center"])])])]),_:1})]),_:1}),l(E,{flat:"",bordered:"",class:"section-card q-mb-xl"},{default:s(()=>[l(D,{class:"row items-center"},{default:s(()=>[l(x,{name:"person_pin_circle",class:"q-mr-sm"}),e[49]||(e[49]=a("div",{class:"text-subtitle1 text-weight-medium"},"Denunciado",-1))]),_:1}),l(k),l(D,null,{default:s(()=>[a("div",Uo,[a("div",Ao,[l(f,{modelValue:o.form.denunciado_nombre_completo,"onUpdate:modelValue":e[27]||(e[27]=r=>o.form.denunciado_nombre_completo=r),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Nombre completo"},null,8,["modelValue","readonly"])]),a("div",Oo,[l(P,{modelValue:o.form.denunciado_documento,"onUpdate:modelValue":e[28]||(e[28]=r=>o.form.denunciado_documento=r),dense:"",outlined:"",readonly:!o.editing,"emit-value":"","map-options":"",options:o.documentos,label:"Documento"},null,8,["modelValue","readonly","options"])]),a("div",To,[l(f,{modelValue:o.form.denunciado_nro,"onUpdate:modelValue":e[29]||(e[29]=r=>o.form.denunciado_nro=r),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Nro documento"},null,8,["modelValue","readonly"])]),a("div",Ro,[l(f,{modelValue:o.form.denunciado_sexo,"onUpdate:modelValue":e[30]||(e[30]=r=>o.form.denunciado_sexo=r),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Sexo"},null,8,["modelValue","readonly"])]),a("div",Po,[l(f,{modelValue:o.form.denunciado_lugar_nacimiento,"onUpdate:modelValue":e[31]||(e[31]=r=>o.form.denunciado_lugar_nacimiento=r),dense:"",outlined:"",clearable:"",label:"Lugar de nacimiento"},null,8,["modelValue"])]),a("div",Lo,[l(f,{modelValue:o.form.denunciado_fecha_nacimiento,"onUpdate:modelValue":[e[32]||(e[32]=r=>o.form.denunciado_fecha_nacimiento=r),e[33]||(e[33]=r=>{if(r){const w=new Date(r),N=Date.now()-w.getTime(),T=new Date(N);this.form.denunciado_edad=Math.abs(T.getUTCFullYear()-1970)}else this.form.denunciado_edad=""})],type:"date",dense:"",outlined:"",label:"Fecha de nacimiento"},null,8,["modelValue"])]),a("div",Mo,[l(f,{modelValue:o.form.denunciado_edad,"onUpdate:modelValue":e[34]||(e[34]=r=>o.form.denunciado_edad=r),modelModifiers:{number:!0},dense:"",outlined:"",type:"number",label:"Edad"},null,8,["modelValue"])]),a("div",Fo,[l(f,{modelValue:o.form.denunciado_telefono,"onUpdate:modelValue":e[35]||(e[35]=r=>o.form.denunciado_telefono=r),dense:"",outlined:"",clearable:"",label:"Teléfono/Celular"},null,8,["modelValue"])]),a("div",jo,[l(f,{modelValue:o.form.denunciado_grado,"onUpdate:modelValue":e[36]||(e[36]=r=>o.form.denunciado_grado=r),dense:"",outlined:"",clearable:"",label:"Grado de instrucción"},null,8,["modelValue"])]),a("div",zo,[l(f,{modelValue:o.form.denunciado_residencia,"onUpdate:modelValue":e[37]||(e[37]=r=>o.form.denunciado_residencia=r),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Residencia"},null,8,["modelValue","readonly"])]),a("div",Go,[l(f,{modelValue:o.form.denunciado_domicilio_actual,"onUpdate:modelValue":e[38]||(e[38]=r=>o.form.denunciado_domicilio_actual=r),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Domicilio actual"},null,8,["modelValue","readonly"])]),a("div",Qo,[e[50]||(e[50]=a("div",{class:"text-caption text-grey-7 q-mb-xs"},"Ubicación (denunciado)",-1)),l(t,{modelValue:d.denunciadoPos,"onUpdate:modelValue":e[39]||(e[39]=r=>d.denunciadoPos=r),center:o.oruroCenter},null,8,["modelValue","center"])])])]),_:1}),l(D,null,{default:s(()=>[a("div",$o,[a("div",Bo,[l(H,{modelValue:o.form.documento_fotocopia_carnet_denunciante,"onUpdate:modelValue":e[40]||(e[40]=r=>o.form.documento_fotocopia_carnet_denunciante=r),label:"Fotocopia CI denunciante","false-value":"0","true-value":"1"},null,8,["modelValue"])]),a("div",Ho,[l(H,{modelValue:o.form.documento_fotocopia_carnet_denunciado,"onUpdate:modelValue":e[41]||(e[41]=r=>o.form.documento_fotocopia_carnet_denunciado=r),label:"Fotocopia CI denunciado","false-value":"0","true-value":"1"},null,8,["modelValue"])]),a("div",Yo,[l(H,{modelValue:o.form.documento_placas_fotograficas_domicilio_denunciante,"onUpdate:modelValue":e[42]||(e[42]=r=>o.form.documento_placas_fotograficas_domicilio_denunciante=r),label:"Placas fotográficas domicilio denunciante","false-value":"0","true-value":"1"},null,8,["modelValue"])]),a("div",Wo,[l(H,{modelValue:o.form.documento_croquis_direccion_denunciado,"onUpdate:modelValue":e[43]||(e[43]=r=>o.form.documento_croquis_direccion_denunciado=r),label:"Croquis dirección denunciado","false-value":"0","true-value":"1"},null,8,["modelValue"])]),a("div",Zo,[l(H,{modelValue:o.form.documento_placas_fotograficas_domicilio_denunciado,"onUpdate:modelValue":e[44]||(e[44]=r=>o.form.documento_placas_fotograficas_domicilio_denunciado=r),label:"Placas fotográficas domicilio denunciado","false-value":"0","true-value":"1"},null,8,["modelValue"])]),a("div",Jo,[l(H,{modelValue:o.form.documento_ciudadania_digital,"onUpdate:modelValue":e[45]||(e[45]=r=>o.form.documento_ciudadania_digital=r),label:"Ciudadanía digital","false-value":"0","true-value":"1"},null,8,["modelValue"])])])]),_:1})]),_:1})])}const Ko=A(eo,[["render",Xo],["__scopeId","data-v-71a690e4"]]),el={name:"Problematica",props:{caseId:{type:[String,Number],required:!0},canEdit:{type:Boolean,default:!0}},data(){return{loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dialog:!1,mode:"create",form:{id:null,fecha:"",titulo:"",detalle:"",acciones_inmediatas:"",observaciones:""}}},watch:{caseId(){this.resetAndFetch()},search(){this.page=1,this.fetchRows()}},created(){this.fetchRows()},methods:{resetAndFetch(){this.page=1,this.fetchRows()},today(){const i=new Date,e=n=>String(n).padStart(2,"0");return`${i.getFullYear()}-${e(i.getMonth()+1)}-${e(i.getDate())}`},async fetchRows(){if(this.caseId){this.loading=!0;try{const i=await this.$axios.get(`/casos/${this.caseId}/problematicas`,{params:{q:this.search,page:this.page,per_page:this.perPage}});this.rows=i.data,this.rows.data||(this.rows.data=[])}catch(i){this.$q.notify({type:"negative",message:i?.response?.data?.message||"Error cargando problemática"})}finally{this.loading=!1}}},openCreate(){this.mode="create",this.form={id:null,fecha:this.today(),titulo:"",detalle:"",acciones_inmediatas:"",observaciones:""},this.dialog=!0},openView(i){this.mode="view",this.form={...i},this.dialog=!0},openEdit(i){this.mode="edit",this.form={...i},this.dialog=!0},async save(){if(!this.form.titulo){this.$q.notify({type:"negative",message:"El título es obligatorio"});return}this.saving=!0;try{this.form.id?await this.$axios.put(`/problematicas/${this.form.id}`,this.form):await this.$axios.post(`/casos/${this.caseId}/problematicas`,this.form),this.dialog=!1,this.$q.notify({type:"positive",message:"Guardado"}),this.fetchRows(),this.$emit("changed")}catch(i){this.$q.notify({type:"negative",message:i?.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}},remove(i){const e=async()=>{try{await this.$axios.delete(`/problematicas/${i.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.fetchRows(),this.$emit("changed")}catch(n){this.$q.notify({type:"negative",message:n?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar registro?").onOk(e):confirm("¿Eliminar registro?")&&e()},print(i){const e=this.$axios.defaults.baseURL+`/problematicas/${i.id}/pdf`;window.open(e,"_blank")}}},ol={class:"row items-center q-gutter-sm q-mb-sm"},ll={class:"col"},il={class:"text-caption text-grey-7"},al={class:"col-auto row items-center q-gutter-sm"},tl={class:"row justify-end q-mt-sm"},nl={class:"text-subtitle1"},sl={class:"row q-col-gutter-md"},dl={class:"col-12 col-md-4"},rl={class:"col-12 col-md-8"},cl={class:"col-12"},ul={class:"col-12"},ml={class:"col-12"};function fl(i,e,n,c,o,d){return u(),p(E,{flat:"",bordered:"",class:"q-pa-md"},{default:s(()=>[a("div",ol,[a("div",ll,[e[8]||(e[8]=a("div",{class:"text-subtitle1 text-weight-medium"},"Problemática",-1)),a("div",il,"Registros vinculados al caso #"+m(n.caseId),1)]),a("div",al,[l(f,{dense:"",outlined:"",modelValue:o.search,"onUpdate:modelValue":e[0]||(e[0]=t=>o.search=t),placeholder:"Buscar...",style:{width:"260px"}},{append:s(()=>[l(x,{name:"search"})]),_:1},8,["modelValue"]),n.canEdit?(u(),p(_,{key:0,color:"primary",icon:"add_circle",label:"Nueva",onClick:d.openCreate},null,8,["onClick"])):v("",!0),l(_,{flat:"",color:"primary",icon:"refresh",onClick:d.fetchRows,loading:o.loading},null,8,["onClick","loading"])])]),l(k),l(fe,{bordered:"",separator:"",class:"q-mt-sm"},{default:s(()=>[(u(!0),C(L,null,Q(o.rows.data,t=>(u(),p(I,{key:t.id},{default:s(()=>[l(g,null,{default:s(()=>[l(ue,{class:"text-weight-medium"},{default:s(()=>[h(m(t.titulo),1)]),_:2},1024),l(ue,{caption:"",class:"ellipsis-2-lines"},{default:s(()=>[h(m((t.detalle||"").slice(0,220)),1)]),_:2},1024),l(ue,{caption:""},{default:s(()=>[l(he,{outline:"",color:"blue-7",class:"q-mr-xs"},{default:s(()=>[h(m(t.fecha||"s/f"),1)]),_:2},1024),l(he,{outline:"",color:"grey-7"},{default:s(()=>[h("Por: "+m(t.user?.name||t.user?.username||"—"),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),l(g,{side:"",top:""},{default:s(()=>[l(_,{dense:"",flat:"",icon:"visibility",onClick:r=>d.openView(t)},null,8,["onClick"]),n.canEdit?(u(),p(_,{key:0,dense:"",flat:"",icon:"edit",color:"primary",onClick:r=>d.openEdit(t)},null,8,["onClick"])):v("",!0),n.canEdit?(u(),p(_,{key:1,dense:"",flat:"",icon:"delete",color:"negative",onClick:r=>d.remove(t)},null,8,["onClick"])):v("",!0),l(_,{color:"red",outline:"",label:"Imprimir",onClick:r=>d.print(t)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),!o.rows.data.length&&!o.loading?(u(),p(I,{key:0},{default:s(()=>[l(g,null,{default:s(()=>e[9]||(e[9]=[h("Sin resultados")])),_:1})]),_:1})):v("",!0)]),_:1}),a("div",tl,[l(Be,{modelValue:o.page,"onUpdate:modelValue":e[1]||(e[1]=t=>o.page=t),max:o.rows.last_page||1,"boundary-numbers":"","direction-links":"",onInput:d.fetchRows},null,8,["modelValue","max","onInput"])]),l(W,{modelValue:o.dialog,"onUpdate:modelValue":e[7]||(e[7]=t=>o.dialog=t),persistent:""},{default:s(()=>[l(E,{style:{"min-width":"720px","max-width":"95vw"}},{default:s(()=>[l(D,{class:"row items-center"},{default:s(()=>[a("div",nl,m(o.mode==="view"?"Detalle de Problemática":o.form.id?"Editar Problemática":"Nueva Problemática"),1),l(G),b(l(_,{flat:"",round:"",dense:"",icon:"close"},null,512),[[y]])]),_:1}),l(k),l(D,null,{default:s(()=>[a("div",sl,[a("div",dl,[l(f,{modelValue:o.form.fecha,"onUpdate:modelValue":e[2]||(e[2]=t=>o.form.fecha=t),type:"date",dense:"",outlined:"",label:"Fecha",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),a("div",rl,[l(f,{modelValue:o.form.titulo,"onUpdate:modelValue":e[3]||(e[3]=t=>o.form.titulo=t),dense:"",outlined:"",label:"Problemática principal *",readonly:o.mode==="view",rules:[t=>!!t||"Requerido"]},null,8,["modelValue","readonly","rules"])]),a("div",cl,[l(f,{modelValue:o.form.detalle,"onUpdate:modelValue":e[4]||(e[4]=t=>o.form.detalle=t),type:"textarea",autogrow:"",outlined:"",dense:"",label:"Detalle / antecedentes",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),a("div",ul,[l(f,{modelValue:o.form.acciones_inmediatas,"onUpdate:modelValue":e[5]||(e[5]=t=>o.form.acciones_inmediatas=t),type:"textarea",autogrow:"",outlined:"",dense:"",label:"Acciones inmediatas y realizadas",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),a("div",ml,[l(f,{modelValue:o.form.observaciones,"onUpdate:modelValue":e[6]||(e[6]=t=>o.form.observaciones=t),type:"textarea",autogrow:"",outlined:"",dense:"",label:"Observaciones",readonly:o.mode==="view"},null,8,["modelValue","readonly"])])])]),_:1}),l(k),l(z,{align:"right"},{default:s(()=>[b(l(_,{flat:"",label:"Cerrar"},null,512),[[y]]),o.mode!=="view"?(u(),p(_,{key:0,color:"primary",label:"Guardar",loading:o.saving,onClick:d.save},null,8,["loading","onClick"])):v("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const pl=A(el,[["render",fl],["__scopeId","data-v-b7455962"]]),_l={name:"SesionesPsicologico",emits:["refresh"],props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:null}},data(){return{loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dialog:!1,mode:"create",form:{id:null,fecha:"",titulo:"",duracion_min:null,lugar:"",tipo:"Individual",contenido_html:""},plantilla:null,plantillasOptions:[{label:"Consentimiento informado",value:"consentimiento"},{label:"Informe Psicológico (formato DIO)",value:"informe_dio"},{label:"Acta de sesión (DIO)",value:"acta"},{label:"Informe breve (psicológico)",value:"informe"},{label:"Constancia de asistencia",value:"constancia"}]}},watch:{caseId(){this.page=1,this.fetchRows()},search(){this.page=1,this.fetchRows()}},created(){},methods:{today(){const i=new Date,e=n=>String(n).padStart(2,"0");return`${i.getFullYear()}-${e(i.getMonth()+1)}-${e(i.getDate())}`},async fetchRows(){if(this.caseId){this.loading=!0;try{const i=await this.$axios.get(`/casos/${this.caseId}/sesiones-psicologicas`,{params:{q:this.search,page:this.page,per_page:this.perPage}});this.rows=i.data||{data:[],last_page:1}}catch(i){this.$q.notify({type:"negative",message:i?.response?.data?.message||"Error cargando sesiones"})}finally{this.loading=!1}}},openCreate(){this.mode="create",this.plantilla="consentimiento",this.form={id:null,fecha:this.today(),titulo:"",duracion_min:null,lugar:"",tipo:"Individual",contenido_html:""},this.dialog=!0,this.$nextTick(()=>this.applyTemplate("consentimiento"))},openView(i){this.mode="view",this.form={...i},this.dialog=!0},openEdit(i){this.mode="edit",this.form={...i},this.dialog=!0},applyTemplate(i){if(this.mode==="view")return;const e=this.caso||{},n={nombres:e.denunciante_nombres||e.denunciante_nombre_completo||"",apellidos:[e.denunciante_paterno,e.denunciante_materno].filter(Boolean).join(" "),edad:e.denunciante_edad||"",fecha_nacimiento:e.denunciante_fecha_nacimiento||"",lugar_nacimiento:e.denunciante_lugar_nacimiento||"",grado:e.denunciante_grado||"",ocupacion:e.denunciante_ocupacion_exacto||e.denunciante_ocupacion||"",domicilio:e.denunciante_domicilio_actual||e.denunciante_residencia||"",documento:e.denunciante_documento||"Carnet de identidad",nro:e.denunciante_nro||"",telefono:e.denunciante_telefono||e.denunciante_movil||e.denunciante_fijo||"",estado_civil:e.denunciante_estado_civil||""};for(let U=1;U<=5;U++)e[`familiar${U}_nombre_completo`],e[`familiar${U}_edad`],e[`familiar${U}_parentesco`],e[`familiar${U}_celular`];const c=(this.form.fecha||this.today()).slice(0,4),o=e.caso_numero&&String(e.caso_numero).trim()!==""?String(e.caso_numero):`${String(this.caseId).padStart(2,"0")}/${c}`,d=e.legal_user?.name||e.legal_user?.username||"",t=e.psicologica_user?.name||e.psicologica_user?.username||this.$store?.state?.user?.name||"",r=e.caso_tipologia||e.caso_modalidad?`Evaluación psicológica en el marco de presunta(s) ${[e.caso_tipologia,e.caso_modalidad].filter(Boolean).join(" / ")}.`:"Evaluación psicológica para determinar los efectos emocionales y psicológicos en la evaluada.",w=(()=>{const U=e.caso_fecha_hecho?`el ${e.caso_fecha_hecho}`:"en fecha no precisada",$=[e.caso_lugar_hecho,e.caso_zona,e.caso_direccion].filter(Boolean).join(", "),K=$?`, en ${$}`:"",ee=e.caso_descripcion?` ${e.caso_descripcion}`:"";return`Según la apertura del caso, el hecho habría ocurrido ${U}${K}.${ee}`})(),N=["Entrevista clínica y observación conductual","Aplicación de instrumentos psicométricos según pertinencia (Goldberg, IES-R, Rosenberg)"].join("; ")+".",T=[e.violencia_fisica?"violencia física":null,e.violencia_psicologica?"violencia psicológica":null,e.violencia_sexual?"violencia sexual":null,e.violencia_economica?"violencia económica/patrimonial":null].filter(Boolean),J="Se evidencian reacciones emocionales congruentes con el evento referido, con impacto en el equilibrio afectivo y la autoestima."+(T.length?` Se consideran indicadores asociados a ${T.join(", ")}.`:"")+" No se evidencian signos de psicosis. Se sugiere seguimiento clínico y contención.",X=["Intervención psicológica: terapia focalizada en manejo de ansiedad/estrés y fortalecimiento de recursos personales.","Orientación/asesoramiento legal para evitar revictimización y garantizar medidas de protección, si corresponde."].join(" "),M={casoId:this.caseId,fecha:this.form.fecha||this.today(),titulo:this.form.titulo||"Sesión psicológica",lugar:this.form.lugar||"",tipo:this.form.tipo||"Individual",nombre:e.denunciantes[0]?.denunciante_nombres||n.denunciante_paterno+" "+n.denunciante_materno||"—",documento:e.denunciantes[0]?.denunciante_documento||n.documento,numeroCaso:o,abogadoNombre:d,psicologoNombre:t,denunciante:{nombres:e.denunciantes[0].denunciante_nombres||n.nombres||"—",apellidos:e.denunciantes[0].denunciante_apellidos||n.apellidos||"—",edad:e.denunciantes[0].denunciante_edad||n.edad||"—",fecha_nacimiento:e.denunciantes[0].denunciante_fecha_nacimiento||n.fecha_nacimiento||"—",lugar_nacimiento:e.denunciantes[0].denunciante_lugar_nacimiento||n.lugar_nacimiento||"—",grado:e.denunciantes[0].denunciante_grado||n.grado||"—",ocupacion:e.denunciantes[0].denunciante_ocupacion_exacto||e.denunciantes[0].denunciante_ocupacion||n.ocupacion||"—",domicilio:e.denunciantes[0].denunciante_domicilio_actual||e.denunciantes[0].denunciante_residencia||n.domicilio||"—",documento:e.denunciantes[0].denunciante_documento||n.documento},familiares:e.familiares,motivo:r,antecedentes:w,tecnicas:N,conclusiones:J,recomendaciones:X};i==="acta"?this.form.contenido_html=oe.acta(M):i==="informe"?this.form.contenido_html=oe.informe(M):i==="constancia"?this.form.contenido_html=oe.constancia(M):i==="consentimiento"?this.form.contenido_html=oe.consentimiento(M):i==="informe_dio"&&(this.form.contenido_html=oe.informe_dio(M))},async save(){if(!this.form.titulo){this.$q.notify({type:"negative",message:"El título es obligatorio"});return}if(!this.form.contenido_html){this.$q.notify({type:"negative",message:"El contenido está vacío"});return}this.saving=!0;try{this.form.id?await this.$axios.put(`/sesiones-psicologicas/${this.form.id}`,this.form):await this.$axios.post(`/casos/${this.caseId}/sesiones-psicologicas`,this.form),this.$q.notify({type:"positive",message:"Guardado"}),this.dialog=!1,this.$emit("refresh")}catch(i){this.$q.notify({type:"negative",message:i?.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}},remove(i){const e=async()=>{try{await this.$axios.delete(`/sesiones-psicologicas/${i.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.$emit("refresh")}catch(n){this.$q.notify({type:"negative",message:n?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar la sesión?").onOk(e):confirm("¿Eliminar la sesión?")&&e()},printPdf(i){const e=this.$url||"";window.open(`${e}/sesiones-psicologicas/${i.id}/pdf`,"_blank")}}},gl={class:"row items-center q-mb-sm"},hl={class:"col"},vl={class:"text-caption text-grey-7"},bl={class:"col-auto row items-center q-gutter-sm"},yl={class:"text-grey-8"},xl={key:0},wl={class:"text-subtitle1"},Vl={class:"row"},Cl={class:"col-12 col-md-3"},Il={class:"col-12 col-md-5"},kl={class:"col-6 col-md-2"},El={class:"col-6 col-md-2"},Dl={class:"col-12"},ql={key:0};function Nl(i,e,n,c,o,d){return u(),p(E,{flat:"",bordered:"",class:"q-pa-md"},{default:s(()=>[a("div",gl,[a("div",hl,[e[9]||(e[9]=a("div",{class:"text-subtitle1 text-weight-medium"},"Sesiones (Psicológico)",-1)),a("div",vl,"Vinculadas al caso #"+m(n.caseId),1)]),a("div",bl,[l(_,{flat:"",color:"primary",icon:"refresh",loading:o.loading,onClick:e[0]||(e[0]=t=>i.$emit("refresh"))},null,8,["loading"]),l(_,{color:"green",icon:"add_circle_outline","no-caps":"",label:"Crear sesión",onClick:d.openCreate},null,8,["onClick"])])]),l(k),l(ne,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:s(()=>[e[15]||(e[15]=a("thead",null,[a("tr",{class:"bg-primary text-white"},[a("th",{style:{width:"70px"}},"ID"),a("th",{style:{width:"140px"}},"Acciones"),a("th",null,"Título"),a("th",{style:{width:"120px"}},"Fecha"),a("th",{style:{width:"120px"}},"Tipo"),a("th",{style:{width:"180px"}},"Usuario")])],-1)),a("tbody",null,[(u(!0),C(L,null,Q(n.caso.psicologicas,t=>(u(),C("tr",{key:t.id},[a("td",yl,"#"+m(t.id),1),a("td",null,[l(Z,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:s(()=>[b((u(),p(I,{clickable:"",onClick:r=>d.openView(t)},{default:s(()=>[l(g,{avatar:""},{default:s(()=>[l(x,{name:"visibility"})]),_:1}),l(g,null,{default:s(()=>e[10]||(e[10]=[h("Ver")])),_:1})]),_:2},1032,["onClick"])),[[y]]),b((u(),p(I,{clickable:"",onClick:r=>d.printPdf(t)},{default:s(()=>[l(g,{avatar:""},{default:s(()=>[l(x,{name:"print"})]),_:1}),l(g,null,{default:s(()=>e[11]||(e[11]=[h("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[y]]),l(k),b((u(),p(I,{clickable:"",onClick:r=>d.openEdit(t)},{default:s(()=>[l(g,{avatar:""},{default:s(()=>[l(x,{name:"edit"})]),_:1}),l(g,null,{default:s(()=>e[12]||(e[12]=[h("Editar")])),_:1})]),_:2},1032,["onClick"])),[[y]]),b((u(),p(I,{clickable:"",onClick:r=>d.remove(t)},{default:s(()=>[l(g,{avatar:""},{default:s(()=>[l(x,{name:"delete",color:"negative"})]),_:1}),l(g,{class:"text-negative"},{default:s(()=>e[13]||(e[13]=[h("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[y]])]),_:2},1024)]),a("td",null,m(t.titulo),1),a("td",null,m(t.fecha||"s/f"),1),a("td",null,m(t.tipo||"—"),1),a("td",null,m(t.user?.name||t.user?.username||"—"),1)]))),128)),!n.caso.psicologicas||n.caso.psicologicas.length===0?(u(),C("tr",xl,e[14]||(e[14]=[a("td",{colspan:"6",class:"text-center text-grey"},"Sin registros",-1)]))):v("",!0)])]),_:1}),l(W,{modelValue:o.dialog,"onUpdate:modelValue":e[8]||(e[8]=t=>o.dialog=t),persistent:""},{default:s(()=>[l(E,{style:{"max-width":"900px",width:"95vw"}},{default:s(()=>[l(D,{class:"row items-center q-pb-none"},{default:s(()=>[a("div",wl,m(o.mode==="view"?"Ver sesión":o.form.id?"Editar sesión":"Nueva sesión"),1),l(G),b(l(_,{flat:"",round:"",dense:"",icon:"close"},null,512),[[y]])]),_:1}),l(D,{class:"q-gutter-md"},{default:s(()=>[a("div",Vl,[a("div",Cl,[l(f,{modelValue:o.form.fecha,"onUpdate:modelValue":e[1]||(e[1]=t=>o.form.fecha=t),type:"date",dense:"",outlined:"",label:"Fecha",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),a("div",Il,[l(f,{modelValue:o.form.titulo,"onUpdate:modelValue":e[2]||(e[2]=t=>o.form.titulo=t),dense:"",outlined:"",label:"Título *",readonly:o.mode==="view",rules:[t=>!!t||"Requerido"]},null,8,["modelValue","readonly","rules"])]),a("div",kl,[l(f,{modelValue:o.form.duracion_min,"onUpdate:modelValue":e[3]||(e[3]=t=>o.form.duracion_min=t),modelModifiers:{number:!0},type:"number",dense:"",outlined:"",label:"Minutos",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),a("div",El,[l(f,{modelValue:o.form.tipo,"onUpdate:modelValue":e[4]||(e[4]=t=>o.form.tipo=t),dense:"",outlined:"",label:"Tipo",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),a("div",Dl,[l(f,{modelValue:o.form.lugar,"onUpdate:modelValue":e[5]||(e[5]=t=>o.form.lugar=t),dense:"",outlined:"",label:"Lugar",readonly:o.mode==="view"},null,8,["modelValue","readonly"])])]),o.mode!=="view"?(u(),C("div",ql,[l(P,{modelValue:o.plantilla,"onUpdate:modelValue":[e[6]||(e[6]=t=>o.plantilla=t),d.applyTemplate],options:o.plantillasOptions,label:"Plantilla",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])])):v("",!0),a("div",null,[e[16]||(e[16]=a("div",{class:"text-caption text-grey-7 q-mb-xs"},"Contenido (WYSIWYG / se guarda HTML)",-1)),l(pe,{modelValue:o.form.contenido_html,"onUpdate:modelValue":e[7]||(e[7]=t=>o.form.contenido_html=t),readonly:o.mode==="view","min-height":"320px",placeholder:"Escriba aquí el contenido de la sesión...",toolbar:[["left","center","right","justify"],["bold","italic","strike","underline"],["quote","unordered","ordered","outdent","indent"],["hr","link"],["undo","redo"],["removeFormat"]]},null,8,["modelValue","readonly"])])]),_:1}),l(k),l(z,{align:"right"},{default:s(()=>[b(l(_,{flat:"",label:"Cerrar"},null,512),[[y]]),o.mode!=="view"?(u(),p(_,{key:0,color:"primary",label:"Guardar",loading:o.saving,onClick:d.save},null,8,["loading","onClick"])):v("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Sl=A(_l,[["render",Nl]]),j={psicologico({casoId:i,fecha:e,titulo:n,numero:c}){return`
<div style="border:1px solid #333;border-radius:6px;padding:12px;margin-bottom:12px;font-size:12px">
  <div style="display:flex;justify-content:space-between">
    <div>
      <div style="font-weight:700">DIRECCIÓN DE IGUALDAD DE OPORTUNIDADES (D.I.O.)</div>
      <div style="font-size:11px;color:#555">SERVICIO LEGAL INTEGRAL MUNICIPAL</div>
    </div>
    <div style="text-align:right;font-size:11px;color:#555">
      <div><b>Caso:</b> ${i}</div>
      <div><b>Fecha:</b> ${e}</div>
      <div><b>Nro. Informe:</b> ${c||"—"}</div>
    </div>
  </div>
</div>

<h4 style="margin:8px 0 4px 0;">${n||"INFORME PSICOLÓGICO"}</h4>

<h5 style="margin:10px 0 4px 0;">1. Datos personales</h5>
<p>...</p>

<h5 style="margin:10px 0 4px 0;">2. Motivo de consulta</h5>
<p>...</p>

<h5 style="margin:10px 0 4px 0;">3. Antecedentes</h5>
<p>...</p>

<h5 style="margin:10px 0 4px 0;">4. Técnicas e instrumentos empleados</h5>
<ul>
  <li>...</li>
</ul>

<h5 style="margin:10px 0 4px 0;">5. Resultados</h5>
<p>...</p>

<h5 style="margin:10px 0 4px 0;">6. Conclusiones</h5>
<p>...</p>

<h5 style="margin:10px 0 4px 0;">7. Recomendaciones</h5>
<ol>
  <li>...</li>
</ol>

<div style="margin-top:40px;display:flex;justify-content:space-between;font-size:12px;">
  <div style="text-align:center;width:45%;">
    <div>__________________________</div>
    <div>Profesional responsable</div>
  </div>
  <div style="text-align:center;width:45%;">
    <div>__________________________</div>
    <div>Vo.Bo.</div>
  </div>
</div>
    `},legal(i){const e=V=>V==null||V===""?"—":String(V),n=V=>V===!0||V===1||V==="1"?"Sí":V===!1||V===0||V==="0"?"No":"—",c=V=>{if(!V)return"—";const B=new Date(V);if(isNaN(B.getTime()))return e(V);const re=B.getFullYear(),ge=String(B.getMonth()+1).padStart(2,"0"),Ue=String(B.getDate()).padStart(2,"0");return`${re}-${ge}-${Ue}`},o=()=>{const V=new Date,B=V.getFullYear(),re=String(V.getMonth()+1).padStart(2,"0");return`${String(V.getDate()).padStart(2,"0")}/${re}/${B}`},d=(V={})=>[V.denunciante_nombres,V.denunciante_paterno,V.denunciante_materno].filter(Boolean).join(" ")||"—",t=(V={})=>[V.denunciado_nombres,V.denunciado_paterno,V.denunciado_materno].filter(Boolean).join(" ")||"—",r=i?.denunciantes&&i.denunciantes[0]?i.denunciantes[0]:{},w=i?.denunciados&&i.denunciados[0]?i.denunciados[0]:{},N=e(i?.principal||i?.caso_tipologia),T=n(i?.documento_ciudadania_digital),le=d(r),J=c(r?.denunciante_fecha_nacimiento),X=e(r?.denunciante_lugar_nacimiento),M=e(r?.denunciante_edad),U=e(r?.denunciante_nro),$=e(r?.denunciante_estado_civil),K=e(r?.denunciante_grado),ee=e(r?.denunciante_residencia||r?.denunciante_domicilio_actual||i?.caso_direccion),se=e(r?.denunciante_ocupacion),de=e(r?.denunciante_telefono),R="—",xe=t(w),we=c(w?.denunciado_fecha_nacimiento),Ve=e(w?.denunciado_lugar_nacimiento),Ce=e(w?.denunciado_edad),Ie=e(w?.denunciado_nro),ke=e(w?.denunciado_estado_civil),Ee=e(w?.denunciado_grado),De=e(w?.denunciado_residencia||w?.denunciado_domicilio_actual),qe=e(w?.denunciado_ocupacion),Ne=e(w?.denunciado_telefono),Se="—",_e=e(i?.legal_user?.name?`ABG. ${i.legal_user.name}`:"ABG.");return`
<div style="border:1px solid #333;border-radius:6px;padding:14px;margin-bottom:12px;font-size:13px; line-height:1.35">
  <div style="text-align:center; font-weight:700; font-size:16px; margin-bottom:10px">INFORME LEGAL</div>

  <div style="margin-bottom:10px">
    <div><b>A :</b> SEÑOR REPRESENTANTE DEL MINISTERIO PUBLICO</div>
    <div><b>DE :</b> ${_e}</div>
  </div>

  <div style="margin:14px 0; font-weight:700">I. FORMULACION DE DENUNCIA</div>
  <div style="margin:14px 0; font-weight:700">II. FUNDAMENTO DEL HECHO</div>
  <div style="margin:14px 0; font-weight:700">III. FUNDAMENTO DE DERECHO</div>
  <div style="margin:14px 0; font-weight:700">IV. PETITORIO</div>
  <div style="margin:14px 0; font-weight:700">V. OTROSIS</div>

  <div style="margin:18px 0; font-weight:700">I. FORMULA DENUNCIA POR EL MOTIVO DE :</div>
  <div style="margin:6px 0 14px 0">${N}</div>

  <div style="margin:10px 0; font-weight:700">DATOS GENERALES DEL DENUNCIANTE :</div>
  <div><b>Nombres y Apellidos:</b> ${le}</div>
  <div><b>Fecha de Nacimiento:</b> ${J}</div>
  <div><b>Lugar de Nacimiento:</b> ${X}</div>
  <div><b>Edad:</b> ${M}</div>
  <div><b>C.I.:</b> ${U}</div>
  <div><b>Estado Civil:</b> ${$}</div>
  <div><b>Grado de Instrucción:</b> ${K}</div>
  <div><b>Dirección:</b> ${ee}</div>
  <div><b>Ocupación:</b> ${se}</div>
  <div><b>Teléfono Celular:</b> ${de}</div>
  <div><b>Correo electrónico:</b> ${R}</div>
  <div><b>Ciudadanía Digital:</b> ${T}</div>

  <div style="margin:16px 0; font-weight:700">DATOS DEL DEMANDADO</div>
  <div><b>Nombres y Apellidos:</b> ${xe}</div>
  <div><b>Fecha de Nacimiento:</b> ${we}</div>
  <div><b>Lugar de Nacimiento:</b> ${Ve}</div>
  <div><b>Edad:</b> ${Ce}</div>
  <div><b>C.I.:</b> ${Ie}</div>
  <div><b>Estado Civil:</b> ${ke}</div>
  <div><b>Grado de Instrucción:</b> ${Ee}</div>
  <div><b>Dirección:</b> ${De}</div>
  <div><b>Ocupación:</b> ${qe}</div>
  <div><b>Teléfono Celular:</b> ${Ne}</div>
  <div><b>Correo electrónico:</b> ${Se}</div>

  <div style="margin:18px 0; font-weight:700">II. FUNDAMENTO DEL HECHO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">III. FUNDAMENTO DE DERECHO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">IV. PETITORIO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">V. OTROSIS</div>
  <p style="margin:6px 0">Por un derecho y protección a la Mujer…</p>

  <div style="margin-top:24px;">Oruro, ${o()}</div>

  <div style="margin-top:36px;text-align:center">
    __________________________<br>
    ${_e}
  </div>
</div>
  `},social({casoId:i,fecha:e,titulo:n,numero:c}){return`
<div style="border:1px solid #333;border-radius:6px;padding:12px;margin-bottom:12px;font-size:12px">
  <div style="display:flex;justify-content:space-between">
    <div><div style="font-weight:700">D.I.O. — ÁREA SOCIAL</div></div>
    <div style="text-align:right;font-size:11px;color:#555">
      <div><b>Caso:</b> ${i}</div>
      <div><b>Fecha:</b> ${e}</div>
      <div><b>Nro. Informe:</b> ${c||"—"}</div>
    </div>
  </div>
</div>

<h4>${n||"INFORME SOCIAL"}</h4>

<h5>1. Datos de la familia</h5>
<p>...</p>

<h5>2. Visita domiciliaria / Observaciones del entorno</h5>
<p>...</p>

<h5>3. Situación socioeconómica</h5>
<p>...</p>

<h5>4. Conclusiones y recomendaciones</h5>
<p>...</p>

<div style="margin-top:36px;text-align:center">
  __________________________<br>
  Trabajadora Social
</div>
    `},denuncia_mp(i={}){const e=(w,N="—")=>w==null||w===""?N:w,n=i.denunciante||{},c=i.denunciado||{},o=i.anexos&&i.anexos.length?i.anexos:["Formulario de Registro domiciliario de la denunciante.","Formulario de Registro domiciliario del denunciado.","Croquis denunciante.","Croquis del denunciado.","Fotocopia simple de la Cédula de Identidad de la denunciante.","Fotocopia simple de la Cédula de Identidad del denunciado.","Informe Psicológico emitido por profesional de la D.I.O."],d=e(i.ciudad,"ORURO"),t=e(i.fecha);return e(i.numero),`
<div style="font-size:12px; line-height:1.35">
  <!-- Encabezado simple DomPDF-friendly -->
  <div style="border:1px solid #333;border-radius:6px;padding:10px;margin-bottom:10px;">
    <div style="font-weight:700">DIRECCIÓN DE IGUALDAD DE OPORTUNIDADES — DEFENSORÍA DE LA NIÑEZ Y ADOLESCENCIA</div>
    <div style="font-size:11px;color:#555">SERVICIO LEGAL INTEGRAL MUNICIPAL</div>
  </div>

  <div style="text-align:center; font-weight:700; text-transform:uppercase; margin-top:4px;">
    ${e(i.fiscaliaTitulo,"SEÑOR REPRESENTANTE DEL MINISTERIO PÚBLICO DE LA CIUDAD DE ORURO")}
  </div>

  <div style="margin:10px 0 6px 0;">
    <b>I.</b>&nbsp; <b>FORMULA DENUNCIA POR EL DELITO DE ABUSO SEXUAL</b>, SOLICITANDO EL LEVANTAMIENTO DE DILIGENCIAS PRELIMINARES Y SE PROCEDA CONFORME A LEY.
  </div>

  <div style="margin:6px 0;">
    <b>II.</b>&nbsp; <b>FUNDAMENTO DE HECHO</b>
  </div>

  <div style="margin:6px 0;">
    <b>III.</b>&nbsp; <b>FUNDAMENTO DE DERECHO</b>
  </div>

  <div style="margin:6px 0;">
    <b>IV.</b>&nbsp; <b>PETITORIO</b>
  </div>

  <div style="margin:6px 0;">
    <b>V.</b>&nbsp; <b>OTROSÍES</b>
  </div>

  <hr style="margin:10px 0;">

  <!-- Datos Generales de Denunciante -->
  <h5 style="margin:6px 0 4px 0;">DATOS GENERALES DE DENUNCIANTE</h5>
  <table style="width:100%; border-collapse:collapse; font-size:12px">
    <tr><td style="width:35%"><b>Nombres y apellidos:</b></td><td>${e(n.nombre)}</td></tr>
    <tr><td><b>Fecha de nacimiento:</b></td><td>${e(n.fecha_nac)}</td></tr>
    <tr><td><b>Lugar de nacimiento:</b></td><td>${e(n.lugar_nac)}</td></tr>
    <tr><td><b>Cédula de identidad:</b></td><td>${e(n.ci)}</td></tr>
    <tr><td><b>Edad:</b></td><td>${e(n.edad)}</td></tr>
    <tr><td><b>Ocupación:</b></td><td>${e(n.ocupacion)}</td></tr>
    <tr><td><b>Estado Civil:</b></td><td>${e(n.estado_civil)}</td></tr>
    <tr><td><b>Domicilio:</b></td><td>${e(n.domicilio)}</td></tr>
    <tr><td><b>Teléfono Celular:</b></td><td>${e(n.celular)}</td></tr>
    <tr><td><b>Correo electrónico:</b></td><td>${e(n.correo)}</td></tr>
    <tr><td><b>Ciudadanía Digital:</b></td><td>${e(i.ciudadania_digital_denunciante)}</td></tr>
  </table>

  <h5 style="margin:12px 0 4px 0;">DATOS GENERALES DEL DENUNCIADO</h5>
  <table style="width:100%; border-collapse:collapse; font-size:12px">
    <tr><td style="width:35%"><b>Nombres y apellidos:</b></td><td>${e(c.nombre)}</td></tr>
    <tr><td><b>Fecha de nacimiento:</b></td><td>${e(c.fecha_nac)}</td></tr>
    <tr><td><b>Nacionalidad:</b></td><td>${e(c.nacionalidad,"Boliviana")}</td></tr>
    <tr><td><b>Cédula de identidad:</b></td><td>${e(c.ci)}</td></tr>
    <tr><td><b>Ocupación:</b></td><td>${e(c.ocupacion)}</td></tr>
    <tr><td><b>Estado Civil:</b></td><td>${e(c.estado_civil)}</td></tr>
    <tr><td><b>Domicilio:</b></td><td>${e(c.domicilio)}</td></tr>
    <tr><td><b>Teléfono Celular:</b></td><td>${e(c.celular)}</td></tr>
    <tr><td><b>Correo electrónico:</b></td><td>${e(c.correo,"Se desconoce")}</td></tr>
  </table>

  <h5 style="margin:12px 0 4px 0;">II. FUNDAMENTO DE HECHO — RELACIÓN CIRCUNSTANCIADA</h5>
  <p style="text-align:justify;">
    ${e(i.relato,"La denunciante refiere los hechos ocurridos, consignando fechas, lugares, personas involucradas y las acciones desplegadas.")}
  </p>

  <h5 style="margin:12px 0 4px 0;">III. FUNDAMENTO DE DERECHO</h5>
  <div style="margin-left:6px">
    <div style="margin:4px 0;"><b>a) DE LA CONSTITUCIÓN POLÍTICA DEL ESTADO — Artículo 15</b></div>
    <ul style="margin:0 0 0 16px;">
      <li>Toda persona tiene derecho a la vida y a la integridad física, psicológica y sexual. Nadie será torturado ni sufrirá tratos crueles, inhumanos, degradantes u humillantes.</li>
      <li>Las personas, en particular las mujeres, tienen derecho a no sufrir violencia física, sexual o psicológica.</li>
      <li>El Estado adoptará medidas para prevenir, eliminar y sancionar la violencia de género.</li>
    </ul>

    <div style="margin:8px 0 4px 0;"><b>b) DE LA LEY 348 — Artículo 83 (modifica el Código Penal)</b></div>
    <div style="margin:0 0 6px 0;">Se adecúan tipos penales y se agravan penas cuando la víctima es niña, niño o adolescente.</div>

    <div style="margin:4px 0;"><b>c) CÓDIGO PENAL — Artículo 312 (Abuso Sexual)</b></div>
    <div>Cuando, en las circunstancias previstas por ley, se realicen actos sexuales no constitutivos de penetración o acceso carnal, la pena será de seis (6) a diez (10) años de privación de libertad.</div>

    ${i.fundamentos_derecho_extra?`<div style="margin-top:8px;">${i.fundamentos_derecho_extra}</div>`:""}
  </div>

  <h5 style="margin:12px 0 4px 0;">IV. PETITORIO</h5>
  <p style="text-align:justify;">
    Por lo expuesto y al amparo de las normas citadas, solicito se admita la presente DENUNCIA por el delito de ABUSO SEXUAL, se disponga el levantamiento de diligencias preliminares y se remitan las actuaciones que correspondan, a efectos de que el hecho no quede impune, determinando responsabilidades conforme a derecho.
    ${i.petitorio_extra?` ${i.petitorio_extra}`:""}
  </p>

  <h5 style="margin:12px 0 4px 0;">V. OTROSÍ 1º — Prueba literal</h5>
  <ul style="margin:0 0 0 16px;">
    ${o.map(w=>`<li>${w}</li>`).join("")}
  </ul>

  <h5 style="margin:10px 0 4px 0;">OTROSÍ 2º — Medidas de protección</h5>
  <p>Al amparo de la Ley 348, solicito se evalúen medidas de protección a favor de la víctima y su entorno familiar para precautelar el normal desenvolvimiento de sus actividades.</p>

  <h5 style="margin:10px 0 4px 0;">OTROSÍ 3º — Domicilio procesal y contactos</h5>
  <table style="width:100%; border-collapse:collapse; font-size:12px">
    <tr><td style="width:30%"><b>Ciudadanía digital (víctima):</b></td><td>${e(i.ciudadania_digital_denunciante)}</td></tr>
    <tr><td><b>WhatsApp (víctima):</b></td><td>${e(n.celular)}</td></tr>
    <tr><td><b>Correo electrónico (víctima):</b></td><td>${e(n.correo)}</td></tr>
    <tr><td><b>Ciudadanía digital (abogado/a):</b></td><td>${e(i.abogado?.ciudadania)}</td></tr>
    <tr><td><b>Correo electrónico (abogado/a):</b></td><td>${e(i.abogado?.correo)}</td></tr>
    <tr><td><b>Celular / WhatsApp (abogado/a):</b></td><td>${e(i.abogado?.whatsapp)}</td></tr>
  </table>

  <div style="margin-top:18px;">
    ${e(d)}, ${t||"___ de __________ de _____"}
  </div>

  <div style="margin-top:26px; display:flex; justify-content:space-between;">
    <div style="text-align:center; width:45%;">
      __________________________<br/>
      Firma Denunciante
    </div>
    <div style="text-align:center; width:45%;">
      __________________________<br/>
      Abg. ${e(i.abogado?.nombre,"Responsable")}
    </div>
  </div>
</div>
`}},Ul={name:"Informes",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:null}},data(){return{loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dialog:!1,mode:"create",form:{id:null,fecha:"",titulo:"",area:"psicologico",numero:"",contenido_html:""},plantilla:"informe_psico",plantillasOptions:[{label:"Informe Psicológico (formato SLIM)",value:"informe_psico"},{label:"Informe Legal (fundamentos)",value:"informe_legal"},{label:"Informe Social (visita / entorno)",value:"informe_social"},{label:"Denuncia penal — Ministerio Público (Abuso sexual)",value:"denuncia_mp"}],areas:[{label:"Psicológico",value:"psicologico"},{label:"Legal",value:"legal"},{label:"Social",value:"social"}]}},methods:{today(){const i=new Date,e=n=>String(n).padStart(2,"0");return`${i.getFullYear()}-${e(i.getMonth()+1)}-${e(i.getDate())}`},openCreate(){this.mode="create",this.form={id:null,fecha:this.today(),titulo:"",area:"psicologico",numero:"",contenido_html:""},this.dialog=!0,this.$nextTick(()=>this.applyTemplate(this.plantilla))},openView(i){this.mode="view",this.form={...i},this.dialog=!0},openEdit(i){this.mode="edit",this.form={...i},this.dialog=!0},applyTemplate(i){if(this.mode==="view")return;const e={casoId:this.caseId,fecha:this.form.fecha||this.today(),titulo:this.form.titulo||"Informe",area:this.form.area||"psicologico",numero:this.form.numero||""};if(i==="informe_psico"&&(this.form.contenido_html=j.psicologico(e)),i==="informe_legal"&&(this.form.contenido_html=j.legal(this.caso)),i==="informe_social"&&(this.form.contenido_html=j.social(e)),i==="denuncia_mp"){const n=this.caso||{},c={nombre:n.denunciante_nombre_completo,ci:n.denunciante_nro,fecha_nac:n.denunciante_fecha_nacimiento,lugar_nac:n.denunciante_lugar_nacimiento,edad:n.denunciante_edad,ocupacion:n.denunciante_ocupacion_exacto||n.denunciante_ocupacion,estado_civil:n.denunciante_estado_civil,domicilio:n.denunciante_domicilio_actual||n.denunciante_residencia,celular:n.denunciante_telefono||n.denunciante_movil,correo:n.denunciante_correo},o={nombre:n.denunciado_nombre_completo,ci:n.denunciado_nro,fecha_nac:n.denunciado_fecha_nacimiento,nacionalidad:"Boliviana",ocupacion:n.denunciado_ocupacion_exacto||n.denunciado_ocupacion,estado_civil:n.denunciado_estado_civil,domicilio:n.denunciado_domicilio_actual||n.denunciado_residencia,celular:n.denunciado_telefono||n.denunciado_movil,correo:n.denunciado_correo},d={...e,ciudad:"ORURO",fiscaliaTitulo:"SEÑOR REPRESENTANTE DEL MINISTERIO PÚBLICO DE LA CIUDAD DE ORURO",titulo:"Denuncia penal por Abuso Sexual",denunciante:c,denunciado:o,ciudadania_digital_denunciante:n.documento_ciudadania_digital?n.denunciante_nro:"",relato:n.caso_descripcion||"",abogado:{nombre:n.legal_user?.name||"",correo:n.legal_user?.correo||"",whatsapp:n.legal_user?.celular||""}};this.form.contenido_html=j.denuncia_mp(d)}},async save(){if(!this.form.titulo)return this.$q.notify({type:"negative",message:"El título es obligatorio"});if(!this.form.contenido_html)return this.$q.notify({type:"negative",message:"El contenido está vacío"});this.saving=!0;try{this.form.id?await this.$axios.put(`/informes-legales/${this.form.id}`,this.form):await this.$axios.post(`/casos/${this.caseId}/informes-legales`,this.form),this.$q.notify({type:"positive",message:"Guardado"}),this.$emit("refresh"),this.dialog=!1}catch(i){this.$q.notify({type:"negative",message:i?.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}},removeIt(i){const e=async()=>{try{await this.$axios.delete(`/informes-legales/${i.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.$emit("refresh")}catch(n){this.$q.notify({type:"negative",message:n?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar el informe?").onOk(e):confirm("¿Eliminar el informe?")&&e()},printPdf(i){const e=this.$url||"";window.open(`${e}/informes/${i.id}/pdf`,"_blank")}}},Al={class:"row items-center q-mb-sm"},Ol={class:"col"},Tl={class:"text-caption text-grey-7"},Rl={class:"col-auto row items-center q-gutter-sm"},Pl={key:0},Ll={class:"text-subtitle1"},Ml={class:"row"},Fl={class:"col-12 col-md-3"},jl={class:"col-12 col-md-5"},zl={class:"col-6 col-md-2"},Gl={class:"col-6 col-md-2"},Ql={key:0};function $l(i,e,n,c,o,d){return u(),p(E,{flat:"",bordered:"",class:"q-pa-md"},{default:s(()=>[a("div",Al,[a("div",Ol,[e[9]||(e[9]=a("div",{class:"text-subtitle1 text-weight-medium"},"Informes",-1)),a("div",Tl,"Vinculados al caso #"+m(n.caseId),1)]),a("div",Rl,[l(f,{dense:"",outlined:"",modelValue:o.search,"onUpdate:modelValue":e[0]||(e[0]=t=>o.search=t),placeholder:"Buscar...",style:{width:"260px"}},{append:s(()=>[l(x,{name:"search"})]),_:1},8,["modelValue"]),l(_,{flat:"",color:"primary",icon:"refresh",loading:o.loading,onClick:e[1]||(e[1]=t=>i.$emit("refresh"))},null,8,["loading"]),l(_,{color:"green",icon:"add_circle_outline","no-caps":"",label:"Crear informe",onClick:d.openCreate},null,8,["onClick"])])]),l(k),l(ne,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:s(()=>[e[15]||(e[15]=a("thead",null,[a("tr",{class:"bg-primary text-white"},[a("th",{style:{width:"70px"}},"ID"),a("th",{style:{width:"140px"}},"Acciones"),a("th",null,"Título"),a("th",{style:{width:"120px"}},"Fecha"),a("th",{style:{width:"130px"}},"Área"),a("th",{style:{width:"120px"}},"Nro"),a("th",{style:{width:"180px"}},"Usuario")])],-1)),a("tbody",null,[(u(!0),C(L,null,Q(n.caso.informes_legales,t=>(u(),C("tr",{key:t.id},[a("td",null,"#"+m(t.id),1),a("td",null,[l(Z,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:s(()=>[b((u(),p(I,{clickable:"",onClick:r=>d.openView(t)},{default:s(()=>[l(g,{avatar:""},{default:s(()=>[l(x,{name:"visibility"})]),_:1}),l(g,null,{default:s(()=>e[10]||(e[10]=[h("Ver")])),_:1})]),_:2},1032,["onClick"])),[[y]]),b((u(),p(I,{clickable:"",onClick:r=>d.printPdf(t)},{default:s(()=>[l(g,{avatar:""},{default:s(()=>[l(x,{name:"picture_as_pdf"})]),_:1}),l(g,null,{default:s(()=>e[11]||(e[11]=[h("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[y]]),l(k),b((u(),p(I,{clickable:"",onClick:r=>d.openEdit(t)},{default:s(()=>[l(g,{avatar:""},{default:s(()=>[l(x,{name:"edit"})]),_:1}),l(g,null,{default:s(()=>e[12]||(e[12]=[h("Editar")])),_:1})]),_:2},1032,["onClick"])),[[y]]),b((u(),p(I,{clickable:"",onClick:r=>d.removeIt(t)},{default:s(()=>[l(g,{avatar:""},{default:s(()=>[l(x,{name:"delete",color:"negative"})]),_:1}),l(g,{class:"text-negative"},{default:s(()=>e[13]||(e[13]=[h("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[y]])]),_:2},1024)]),a("td",null,m(t.titulo),1),a("td",null,m(t.fecha||"s/f"),1),a("td",null,m(t.area||"—"),1),a("td",null,m(t.numero||"—"),1),a("td",null,m(t.user?.name||t.user?.username||"—"),1)]))),128)),n.caso.informes_legales.length?v("",!0):(u(),C("tr",Pl,e[14]||(e[14]=[a("td",{colspan:"7",class:"text-center text-grey"},"Sin registros",-1)])))])]),_:1}),l(W,{modelValue:o.dialog,"onUpdate:modelValue":e[8]||(e[8]=t=>o.dialog=t),persistent:"",maximized:""},{default:s(()=>[l(E,null,{default:s(()=>[l(ye,{class:"bg-white text-dark"},{default:s(()=>[a("div",Ll,m(o.mode==="view"?"Ver informe":o.form.id?"Editar informe":"Nuevo informe"),1),l(G),b(l(_,{flat:"",dense:"",round:"",icon:"close"},null,512),[[y]])]),_:1}),l(k),l(D,{class:"q-gutter-md"},{default:s(()=>[a("div",Ml,[a("div",Fl,[l(f,{modelValue:o.form.fecha,"onUpdate:modelValue":e[2]||(e[2]=t=>o.form.fecha=t),type:"date",dense:"",outlined:"",label:"Fecha",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),a("div",jl,[l(f,{modelValue:o.form.titulo,"onUpdate:modelValue":e[3]||(e[3]=t=>o.form.titulo=t),dense:"",outlined:"",label:"Título *",readonly:o.mode==="view",rules:[t=>!!t||"Requerido"]},null,8,["modelValue","readonly","rules"])]),a("div",zl,[l(P,{modelValue:o.form.area,"onUpdate:modelValue":e[4]||(e[4]=t=>o.form.area=t),options:o.areas,dense:"",outlined:"",label:"Área",readonly:o.mode==="view","emit-value":"","map-options":""},null,8,["modelValue","options","readonly"])]),a("div",Gl,[l(f,{modelValue:o.form.numero,"onUpdate:modelValue":e[5]||(e[5]=t=>o.form.numero=t),dense:"",outlined:"",label:"Nro",readonly:o.mode==="view"},null,8,["modelValue","readonly"])])]),o.mode!=="view"?(u(),C("div",Ql,[l(P,{modelValue:o.plantilla,"onUpdate:modelValue":[e[6]||(e[6]=t=>o.plantilla=t),d.applyTemplate],options:o.plantillasOptions,label:"Plantilla",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])])):v("",!0),a("div",null,[e[16]||(e[16]=a("div",{class:"text-caption text-grey-7 q-mb-xs"},"Contenido (WYSIWYG / guarda HTML)",-1)),l(pe,{modelValue:o.form.contenido_html,"onUpdate:modelValue":e[7]||(e[7]=t=>o.form.contenido_html=t),readonly:o.mode==="view","min-height":"320px",placeholder:"Escriba el informe...",toolbar:[["left","center","right","justify"],["bold","italic","strike","underline"],["quote","unordered","ordered","outdent","indent"],["hr","link"],["undo","redo"],["removeFormat"]]},null,8,["modelValue","readonly"])])]),_:1}),l(k),l(z,{align:"right"},{default:s(()=>[b(l(_,{flat:"",label:"Cerrar"},null,512),[[y]]),o.mode!=="view"?(u(),p(_,{key:0,color:"primary",label:"Guardar",loading:o.saving,onClick:d.save},null,8,["loading","onClick"])):v("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Bl=A(Ul,[["render",$l]]),Hl={name:"ApoyoIntegral",props:{caseId:{type:[String,Number],required:!0}}},Yl={class:"text-grey-7"};function Wl(i,e,n,c,o,d){return u(),p(E,{flat:"",bordered:"",class:"q-pa-md"},{default:s(()=>[e[0]||(e[0]=a("div",{class:"text-subtitle1 text-weight-medium q-mb-sm"},"Apoyo integral",-1)),a("div",Yl,"DIO personal, descripción, impresión (ID: "+m(n.caseId)+")",1)]),_:1})}const Zl=A(Hl,[["render",Wl]]),Jl={name:"DocumentosGeneral",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:()=>({})}},data(){return{loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dlgUpload:!1,file:null,meta:{titulo:"",categoria:"",descripcion:""},accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.odt,.ods,.txt,.zip,.jpg,.jpeg,.png,.webp",dlgEdit:!1,edit:{},editingId:null}},methods:{openUpload(){this.file=null,this.meta={titulo:"",categoria:"",descripcion:""},this.dlgUpload=!0},async upload(){if(!this.file){this.$q.notify({type:"negative",message:"Seleccione un archivo"});return}this.saving=!0;try{const i=new FormData;i.append("file",this.file),this.meta.titulo&&i.append("titulo",this.meta.titulo),this.meta.categoria&&i.append("categoria",this.meta.categoria),this.meta.descripcion&&i.append("descripcion",this.meta.descripcion),await this.$axios.post(`/casos/${this.caseId}/documentos`,i,{headers:{"Content-Type":"multipart/form-data"}}),this.$q.notify({type:"positive",message:"Archivo subido"}),this.dlgUpload=!1,this.$emit("refresh")}catch(i){this.$q.notify({type:"negative",message:i?.response?.data?.message||"No se pudo subir"})}finally{this.saving=!1}},viewDoc(i){const e=this.$url||"";window.open(`${e}/documentos/${i.id}/view`,"_blank")},downloadDoc(i){const e=this.$url||"";window.open(`${e}/documentos/${i.id}/download`,"_blank")},editMeta(i){this.editingId=i.id,this.edit={titulo:i.titulo,categoria:i.categoria,descripcion:i.descripcion},this.dlgEdit=!0},async saveMeta(){this.saving=!0;try{await this.$axios.put(`/documentos/${this.editingId}`,this.edit),this.$q.notify({type:"positive",message:"Actualizado"}),this.dlgEdit=!1,this.$emit("refresh")}catch(i){this.$q.notify({type:"negative",message:i?.response?.data?.message||"No se pudo actualizar"})}finally{this.saving=!1}},removeDoc(i){const e=async()=>{try{await this.$axios.delete(`/documentos/${i.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.$emit("refresh")}catch(n){this.$q.notify({type:"negative",message:n?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar el documento?").onOk(e):confirm("¿Eliminar el documento?")&&e()}}},Xl={class:"row items-center q-mb-sm"},Kl={class:"col"},ei={class:"text-caption text-grey-7"},oi={class:"col-auto row items-center q-gutter-sm"},li={class:"text-weight-medium"},ii={key:0};function ai(i,e,n,c,o,d){return u(),p(E,{flat:"",bordered:"",class:"q-pa-md"},{default:s(()=>[a("div",Xl,[a("div",Kl,[e[10]||(e[10]=a("div",{class:"text-subtitle1 text-weight-medium"},"Documentos (General)",-1)),a("div",ei,"Gestión de adjuntos del caso #"+m(n.caseId),1)]),a("div",oi,[l(_,{flat:"",color:"primary",icon:"refresh",loading:o.loading,onClick:e[0]||(e[0]=t=>i.$emit("refresh"))},null,8,["loading"]),l(_,{color:"green",icon:"upload","no-caps":"",label:"Subir archivo",onClick:d.openUpload},null,8,["onClick"])])]),l(k),l(ne,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:s(()=>[e[16]||(e[16]=a("thead",null,[a("tr",{class:"bg-primary text-white"},[a("th",{style:{width:"70px"}},"ID"),a("th",{style:{width:"160px"}},"Acciones"),a("th",null,"Título"),a("th",{style:{width:"130px"}},"Categoría"),a("th",{style:{width:"120px"}},"Tamaño"),a("th",{style:{width:"160px"}},"Tipo"),a("th",{style:{width:"180px"}},"Usuario")])],-1)),a("tbody",null,[(u(!0),C(L,null,Q(n.caso.documentos,t=>(u(),C("tr",{key:t.id},[a("td",null,"#"+m(t.id),1),a("td",null,[l(Z,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:s(()=>[b((u(),p(I,{clickable:"",onClick:r=>d.viewDoc(t)},{default:s(()=>[l(g,{avatar:""},{default:s(()=>[l(x,{name:"visibility"})]),_:1}),l(g,null,{default:s(()=>e[11]||(e[11]=[h("Ver")])),_:1})]),_:2},1032,["onClick"])),[[y]]),b((u(),p(I,{clickable:"",onClick:r=>d.downloadDoc(t)},{default:s(()=>[l(g,{avatar:""},{default:s(()=>[l(x,{name:"download"})]),_:1}),l(g,null,{default:s(()=>e[12]||(e[12]=[h("Descargar")])),_:1})]),_:2},1032,["onClick"])),[[y]]),l(k),b((u(),p(I,{clickable:"",onClick:r=>d.editMeta(t)},{default:s(()=>[l(g,{avatar:""},{default:s(()=>[l(x,{name:"edit"})]),_:1}),l(g,null,{default:s(()=>e[13]||(e[13]=[h("Editar")])),_:1})]),_:2},1032,["onClick"])),[[y]]),b((u(),p(I,{clickable:"",onClick:r=>d.removeDoc(t)},{default:s(()=>[l(g,{avatar:""},{default:s(()=>[l(x,{name:"delete",color:"negative"})]),_:1}),l(g,{class:"text-negative"},{default:s(()=>e[14]||(e[14]=[h("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[y]])]),_:2},1024)]),a("td",li,m(t.titulo),1),a("td",null,m(t.categoria||"—"),1),a("td",null,m(t.size_human),1),a("td",null,m(t.mime||t.extension),1),a("td",null,m(t.user?.name||t.user?.username||"—"),1)]))),128)),!n.caso.documentos.length&&!o.loading?(u(),C("tr",ii,e[15]||(e[15]=[a("td",{colspan:"7",class:"text-center text-grey"},"Sin registros",-1)]))):v("",!0)])]),_:1}),l(W,{modelValue:o.dlgUpload,"onUpdate:modelValue":e[5]||(e[5]=t=>o.dlgUpload=t),persistent:""},{default:s(()=>[l(E,{style:{"max-width":"700px",width:"95vw"}},{default:s(()=>[l(D,{class:"row items-center q-pb-none"},{default:s(()=>[e[17]||(e[17]=a("div",{class:"text-subtitle1"},"Subir archivo",-1)),l(G),b(l(_,{flat:"",dense:"",round:"",icon:"close"},null,512),[[y]])]),_:1}),l(D,{class:"q-gutter-md"},{default:s(()=>[l(f,{modelValue:o.meta.titulo,"onUpdate:modelValue":e[1]||(e[1]=t=>o.meta.titulo=t),label:"Título",outlined:"",dense:""},null,8,["modelValue"]),l(f,{modelValue:o.meta.categoria,"onUpdate:modelValue":e[2]||(e[2]=t=>o.meta.categoria=t),label:"Categoría",outlined:"",dense:""},null,8,["modelValue"]),l(f,{modelValue:o.meta.descripcion,"onUpdate:modelValue":e[3]||(e[3]=t=>o.meta.descripcion=t),type:"textarea",label:"Descripción",outlined:"",dense:"",autogrow:""},null,8,["modelValue"]),l(je,{modelValue:o.file,"onUpdate:modelValue":e[4]||(e[4]=t=>o.file=t),outlined:"",dense:"","use-chips":"",clearable:!0,accept:o.accept,hint:"Hasta 20MB. PDF, Word, Excel, imágenes, etc."},null,8,["modelValue","accept"])]),_:1}),l(z,{align:"right"},{default:s(()=>[b(l(_,{flat:"",label:"Cancelar"},null,512),[[y]]),l(_,{color:"primary",label:"Subir",loading:o.saving,onClick:d.upload},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(W,{modelValue:o.dlgEdit,"onUpdate:modelValue":e[9]||(e[9]=t=>o.dlgEdit=t)},{default:s(()=>[l(E,{style:{"max-width":"600px",width:"95vw"}},{default:s(()=>[l(D,{class:"row items-center q-pb-none"},{default:s(()=>[e[18]||(e[18]=a("div",{class:"text-subtitle1"},"Editar metadatos",-1)),l(G),b(l(_,{flat:"",dense:"",round:"",icon:"close"},null,512),[[y]])]),_:1}),l(D,{class:"q-gutter-md"},{default:s(()=>[l(f,{modelValue:o.edit.titulo,"onUpdate:modelValue":e[6]||(e[6]=t=>o.edit.titulo=t),label:"Título",outlined:"",dense:""},null,8,["modelValue"]),l(f,{modelValue:o.edit.categoria,"onUpdate:modelValue":e[7]||(e[7]=t=>o.edit.categoria=t),label:"Categoría",outlined:"",dense:""},null,8,["modelValue"]),l(f,{modelValue:o.edit.descripcion,"onUpdate:modelValue":e[8]||(e[8]=t=>o.edit.descripcion=t),type:"textarea",label:"Descripción",outlined:"",dense:"",autogrow:""},null,8,["modelValue"])]),_:1}),l(z,{align:"right"},{default:s(()=>[b(l(_,{flat:"",label:"Cancelar"},null,512),[[y]]),l(_,{color:"primary",label:"Guardar",loading:o.saving,onClick:d.saveMeta},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ti=A(Jl,[["render",ai]]),ni={name:"Fotografias",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,required:!1}},data(){return{rows:{data:[],last_page:1},page:1,perPage:12,loading:!1,uploading:!1}},methods:{toPublicUrl(i){return i?/^https?:\/\//i.test(i)?i:`${(this.$url||"").replace(/\/api\/?$/,"")}${i}`:""},pickFile(){this.$refs.file.click()},async upload(i){const e=i.target.files?.[0];if(e){this.uploading=!0;try{const n=new FormData;n.append("file",e),await this.$axios.post(`/casos/${this.caseId}/fotografias`,n,{headers:{"Content-Type":"multipart/form-data"}}),this.$q.notify({type:"positive",message:"Foto subida"}),this.$emit("refresh")}catch(n){this.$q.notify({type:"negative",message:n?.response?.data?.message||"No se pudo subir"})}finally{this.uploading=!1,this.$refs.file&&(this.$refs.file.value="")}}},async remove(i){if(confirm("¿Eliminar foto?"))try{await this.$axios.delete(`/fotografias/${i.id}`),this.$q.notify({type:"positive",message:"Eliminada"}),this.$emit("refresh")}catch(e){this.$q.notify({type:"negative",message:e?.response?.data?.message||"No se pudo eliminar"})}},view(i){i&&window.open(i,"_blank")}}},si={class:"row items-center q-mb-sm"},di={class:"col"},ri={class:"text-caption text-grey-7"},ci={class:"col-auto"},ui={class:"row q-col-gutter-md q-mt-sm"},mi={class:"absolute-bottom text-subtitle2 bg-black bg-opacity-40 q-pa-xs ellipsis"};function fi(i,e,n,c,o,d){return u(),p(E,{flat:"",bordered:"",class:"q-pa-md"},{default:s(()=>[a("div",si,[a("div",di,[e[1]||(e[1]=a("div",{class:"text-subtitle1 text-weight-medium"},"Fotografías",-1)),a("div",ri,"Sube/ver fotos del caso #"+m(n.caseId),1)]),a("div",ci,[l(_,{color:"primary",icon:"add_photo_alternate","no-caps":"",label:"Subir",onClick:d.pickFile,loading:o.uploading},null,8,["onClick","loading"]),a("input",{type:"file",ref:"file",accept:"image/*",class:"hidden",onChange:e[0]||(e[0]=(...t)=>d.upload&&d.upload(...t))},null,544)])]),l(k),a("div",ui,[(u(!0),C(L,null,Q(n.caso.fotografias,t=>(u(),C("div",{key:t.id,class:"col-6 col-sm-4 col-md-3"},[l(E,{flat:"",bordered:""},{default:s(()=>[l(He,{src:d.toPublicUrl(t.thumb_url||t.url),ratio:4/3,onClick:r=>d.view(d.toPublicUrl(t.url)),style:{cursor:"pointer"}},{default:s(()=>[a("div",mi,m(t.titulo),1)]),_:2},1032,["src","onClick"]),l(z,{align:"between"},{default:s(()=>[l(_,{dense:"",flat:"",icon:"delete",color:"negative",onClick:r=>d.remove(t)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))])]),_:1})}const pi=A(ni,[["render",fi]]),ae=ve({name:"QTimelineEntry",props:{heading:Boolean,tag:{type:String,default:"h3"},side:{type:String,default:"right",validator:i=>["left","right"].includes(i)},icon:String,avatar:String,color:String,title:String,subtitle:String,body:String},setup(i,{slots:e}){const n=Oe(be,ce);if(n===ce)return console.error("QTimelineEntry needs to be child of QTimeline"),ce;const c=te(()=>`q-timeline__entry q-timeline__entry--${i.side}`+(i.icon!==void 0||i.avatar!==void 0?" q-timeline__entry--icon":"")),o=te(()=>`q-timeline__dot text-${i.color||n.color}`),d=te(()=>n.layout==="comfortable"&&n.side==="left");return()=>{const t=Te(e.default,[]);if(i.body!==void 0&&t.unshift(i.body),i.heading===!0){const N=[S("div"),S("div"),S(i.tag,{class:"q-timeline__heading-title"},t)];return S("div",{class:"q-timeline__heading"},d.value===!0?N.reverse():N)}let r;i.icon!==void 0?r=[S(x,{class:"row items-center justify-center",name:i.icon})]:i.avatar!==void 0&&(r=[S("img",{class:"q-timeline__dot-img",src:i.avatar})]);const w=[S("div",{class:"q-timeline__subtitle"},[S("span",{},me(e.subtitle,[i.subtitle]))]),S("div",{class:o.value},r),S("div",{class:"q-timeline__content"},[S("h6",{class:"q-timeline__title"},me(e.title,[i.title]))].concat(t))];return S("li",{class:c.value},d.value===!0?w.reverse():w)}}}),_i=ve({name:"QTimeline",props:{...Re,color:{type:String,default:"primary"},side:{type:String,default:"right",validator:i=>["left","right"].includes(i)},layout:{type:String,default:"dense",validator:i=>["dense","comfortable","loose"].includes(i)}},setup(i,{slots:e}){const n=Le(),c=Pe(i,n.proxy.$q);Me(be,i);const o=te(()=>`q-timeline q-timeline--${i.layout} q-timeline--${i.layout}--${i.side}`+(c.value===!0?" q-timeline--dark":""));return()=>S("ul",{class:o.value},me(e.default))}}),gi={name:"HojaRuta",props:{caseId:{type:[String,Number],required:!0}},data(){return{loading:!1,editing:!1,backup:null,form:{caso_numero:"",fecha_apertura_caso:"",fecha_derivacion_psicologica:"",fecha_informe_area_psicologica:"",fecha_informe_trabajo_social:"",fecha_derivacion_area_legal:""}}},computed:{today(){const i=new Date,e=String(i.getMonth()+1).padStart(2,"0"),n=String(i.getDate()).padStart(2,"0");return`${i.getFullYear()}-${e}-${n}`},total(){return 5},done(){return["fecha_apertura_caso","fecha_derivacion_psicologica","fecha_informe_area_psicologica","fecha_informe_trabajo_social","fecha_derivacion_area_legal"].filter(e=>!!this.form[e]).length}},created(){this.fetch()},methods:{format(i){return i||"—"},async fetch(){this.loading=!0;try{const{data:i}=await this.$axios.get(`/casos/${this.caseId}`);this.form={caso_numero:i.caso_numero||"",fecha_apertura_caso:i.fecha_apertura_caso||"",fecha_derivacion_psicologica:i.fecha_derivacion_psicologica||"",fecha_informe_area_psicologica:i.fecha_informe_area_psicologica||"",fecha_informe_trabajo_social:i.fecha_informe_trabajo_social||"",fecha_derivacion_area_legal:i.fecha_derivacion_area_legal||""},this.backup={...this.form}}catch(i){this.$alert?.error(i?.response?.data?.message||"No se pudo cargar la hoja de ruta")}finally{this.loading=!1}},startEdit(){this.editing=!0,this.backup={...this.form}},cancelEdit(){this.form={...this.backup},this.editing=!1,this.$q.notify({type:"info",message:"Cambios descartados"})},async save(){const i={fecha_derivacion_psicologica:this.form.fecha_derivacion_psicologica||null,fecha_informe_area_psicologica:this.form.fecha_informe_area_psicologica||null,fecha_informe_trabajo_social:this.form.fecha_informe_trabajo_social||null,fecha_derivacion_area_legal:this.form.fecha_derivacion_area_legal||null};this.loading=!0;try{const{data:e}=await this.$axios.put(`/casos/${this.caseId}`,i);this.form={...this.form,fecha_derivacion_psicologica:e.data?.fecha_derivacion_psicologica||this.form.fecha_derivacion_psicologica,fecha_informe_area_psicologica:e.data?.fecha_informe_area_psicologica||this.form.fecha_informe_area_psicologica,fecha_informe_trabajo_social:e.data?.fecha_informe_trabajo_social||this.form.fecha_informe_trabajo_social,fecha_derivacion_area_legal:e.data?.fecha_derivacion_area_legal||this.form.fecha_derivacion_area_legal},this.backup={...this.form},this.editing=!1,this.$alert?.success("Hoja de ruta actualizada")}catch(e){this.$alert?.error(e?.response?.data?.message||"No se pudo actualizar")}finally{this.loading=!1}}}},hi={class:"row items-center q-mb-sm"},vi={class:"col"},bi={class:"text-caption text-grey-7"},yi={class:"col-auto row q-gutter-sm"},xi={class:"row q-col-gutter-md"},wi={class:"col-12 col-md-3"},Vi={class:"col-12 col-md-3"},Ci={class:"col-12 col-md-3"},Ii={class:"col-12 col-md-3"},ki={class:"col-12 col-md-3"},Ei={class:"col-12 col-md-3"};function Di(i,e,n,c,o,d){return u(),C("div",null,[a("div",hi,[a("div",vi,[e[6]||(e[6]=a("div",{class:"text-subtitle1 text-weight-medium"},"Hoja de ruta",-1)),a("div",bi," Completa las fechas clave del caso ("+m(d.done)+"/"+m(d.total)+" completadas) ",1)]),a("div",yi,[l(_,{flat:"",color:"secondary",icon:"refresh",loading:o.loading,onClick:d.fetch},null,8,["loading","onClick"]),o.editing?(u(),C(L,{key:1},[l(_,{flat:"",color:"negative",icon:"close",label:"Cancelar",onClick:d.cancelEdit,loading:o.loading},null,8,["onClick","loading"]),l(_,{color:"primary",icon:"save",label:"Guardar",onClick:d.save,loading:o.loading},null,8,["onClick","loading"])],64)):(u(),p(_,{key:0,color:"primary",icon:"edit",label:"Editar",onClick:d.startEdit,loading:o.loading},null,8,["onClick","loading"]))])]),l(E,{flat:"",bordered:"",class:"section-card"},{default:s(()=>[l(D,null,{default:s(()=>[a("div",xi,[a("div",wi,[l(f,{modelValue:o.form.caso_numero,"onUpdate:modelValue":e[0]||(e[0]=t=>o.form.caso_numero=t),label:"Código de caso",dense:"",outlined:"",readonly:""},null,8,["modelValue"])]),a("div",Vi,[l(f,{modelValue:o.form.fecha_apertura_caso,"onUpdate:modelValue":e[1]||(e[1]=t=>o.form.fecha_apertura_caso=t),type:"date",label:"Fecha de apertura del caso",dense:"",outlined:"",readonly:""},null,8,["modelValue"])]),a("div",Ci,[l(f,{modelValue:o.form.fecha_derivacion_psicologica,"onUpdate:modelValue":e[2]||(e[2]=t=>o.form.fecha_derivacion_psicologica=t),type:"date",readonly:!o.editing,dense:"",outlined:"",label:"Fecha de derivación psicológica"},null,8,["modelValue","readonly"])]),a("div",Ii,[l(f,{modelValue:o.form.fecha_informe_area_psicologica,"onUpdate:modelValue":e[3]||(e[3]=t=>o.form.fecha_informe_area_psicologica=t),type:"date",readonly:!o.editing,dense:"",outlined:"",label:"Fecha de entrega informe (Área psicológica)"},null,8,["modelValue","readonly"])]),a("div",ki,[l(f,{modelValue:o.form.fecha_informe_trabajo_social,"onUpdate:modelValue":e[4]||(e[4]=t=>o.form.fecha_informe_trabajo_social=t),type:"date",readonly:!o.editing,dense:"",outlined:"",label:"Fecha de entrega (Trabajo social)"},null,8,["modelValue","readonly"])]),a("div",Ei,[l(f,{modelValue:o.form.fecha_derivacion_area_legal,"onUpdate:modelValue":e[5]||(e[5]=t=>o.form.fecha_derivacion_area_legal=t),type:"date",readonly:!o.editing,dense:"",outlined:"",label:"Fecha de derivación (Área legal)"},null,8,["modelValue","readonly"])])])]),_:1}),l(k),l(D,null,{default:s(()=>[l(_i,{color:"primary",layout:"comfortable",side:"right"},{default:s(()=>[l(ae,{title:"Apertura del caso",subtitle:d.format(o.form.fecha_apertura_caso),icon:"flag"},null,8,["subtitle"]),l(ae,{title:"Derivación psicológica",subtitle:d.format(o.form.fecha_derivacion_psicologica),icon:"psychology",color:o.form.fecha_derivacion_psicologica?"primary":"grey-5"},null,8,["subtitle","color"]),l(ae,{title:"Entrega trabajo social",subtitle:d.format(o.form.fecha_informe_trabajo_social),icon:"diversity_3",color:o.form.fecha_informe_trabajo_social?"primary":"grey-5"},null,8,["subtitle","color"]),l(ae,{title:"Derivación área legal",subtitle:d.format(o.form.fecha_derivacion_area_legal),icon:"gavel",color:o.form.fecha_derivacion_area_legal?"primary":"grey-5"},null,8,["subtitle","color"])]),_:1})]),_:1})]),_:1})])}const qi=A(gi,[["render",Di],["__scopeId","data-v-c6cf3a23"]]),Ni={name:"SeguimientoCaso",props:{caso:{type:Object,required:!0}},data(){return{loading:!1,filters:{q:"",tipo:"Todos",modulo:"Todos",desde:"",hasta:""},tipos:["Todos","Informe","Sesión","Documento","Fotografía","Hito"],modulos:["Todos","General","Psicológico","Legal","Social","Documentos","Multimedia"],columns:[{name:"actividad",label:"Actividad",field:"actividad",align:"left",sortable:!1},{name:"fecha",label:"Fecha / Usuario",field:"fecha",align:"left",sortable:!0},{name:"modulo",label:"Módulo",field:"modulo",align:"left",sortable:!0},{name:"acciones",label:"",field:"acciones",align:"right",sortable:!1,style:"width: 150px"}]}},computed:{header(){const i=this.caso||{},e=Array.isArray(i.denunciantes)&&i.denunciantes.length?i.denunciantes[0]:null,n=Array.isArray(i.denunciados)&&i.denunciados.length?i.denunciados[0]:null;return{caso_id:i.id||"—",caso_numero:i.caso_numero||"—",tipologia:i.caso_tipologia||i.caso_tipologia===""?i.caso_tipologia:i.caso_tipologia||i.caso_tipologia,modalidad:(i.caso_modalidad||i.caso_modalidad==="",i.caso_modalidad),zona:i.caso_zona||i.zona||"—",direccion:i.caso_direccion||"—",fecha_hecho:i.caso_fecha_hecho||"—",fecha_registro:i.fecha_apertura_caso||"—",registrado_por:i.user?.name||"—",denunciante:e?this.fullName(e,"denunciante"):"—",denunciado:n?this.fullName(n,"denunciado"):"—"}},violenciaChips(){const i=this.caso||{};return[{key:"violencia_fisica",label:"Física",color:"red-7"},{key:"violencia_psicologica",label:"Psicológica",color:"deep-purple-7"},{key:"violencia_sexual",label:"Sexual",color:"purple-7"},{key:"violencia_economica",label:"Económica",color:"orange-7"},{key:"violencia_patrimonial",label:"Patrimonial",color:"brown-7"},{key:"violencia_simbolica",label:"Simbólica",color:"indigo-7"},{key:"violencia_institucional",label:"Institucional",color:"teal-7"}].map(n=>({...n,on:!!i[n.key]}))},rows(){const i=[],e=this.caso||{};return[{fecha:e.fecha_apertura_caso,titulo:"Apertura del caso"},{fecha:e.fecha_derivacion_psicologica,titulo:"Derivación a Psicología"},{fecha:e.fecha_derivacion_area_legal,titulo:"Derivación a Área Legal"},{fecha:e.fecha_informe_area_social,titulo:"Informe Área Social"},{fecha:e.fecha_informe_area_psicologica,titulo:"Informe Área Psicológica"},{fecha:e.fecha_informe_trabajo_social,titulo:"Informe Trabajo Social"}].forEach((c,o)=>{c.fecha&&i.push({uid:`hito-${o}-${c.fecha}`,tipo:"Hito",modulo:"General",titulo:c.titulo,descripcion:`Fecha: ${c.fecha}`,usuario:e.user?.name||"",fecha:c.fecha,icon:"flag",links:{}})}),Array.isArray(e.informes_sociales)&&e.informes_sociales.forEach(c=>{i.push({uid:`soc-${c.id}`,tipo:"Informe",modulo:"Social",titulo:c.titulo||"Informe Social",descripcion:this.stripHtml(c.contenido_html||""),usuario:c.user?.name||"",fecha:c.fecha||"",icon:"description",links:{}})}),Array.isArray(e.psicologicas)&&e.psicologicas.forEach(c=>{i.push({uid:`psi-${c.id}`,tipo:"Sesión",modulo:"Psicológico",titulo:`${c.tipo||"Sesión"}${c.titulo?` — ${c.titulo}`:""}`,descripcion:this.stripHtml(c.contenido_html||""),usuario:c.user?.name||"",fecha:c.fecha||"",icon:"psychology",links:{}})}),Array.isArray(e.informes_legales)&&e.informes_legales.forEach(c=>{i.push({uid:`leg-${c.id}`,tipo:"Informe",modulo:"Legal",titulo:c.titulo||"Informe Legal",descripcion:this.stripHtml(c.contenido_html||""),usuario:c.user?.name||"",fecha:c.fecha||"",icon:"gavel",links:{}})}),Array.isArray(e.documentos)&&e.documentos.forEach(c=>{i.push({uid:`doc-${c.id}`,tipo:"Documento",modulo:"Documentos",titulo:c.titulo||c.original_name||"Documento",descripcion:[c.categoria,c.descripcion,c.size_human].filter(Boolean).join(" · "),usuario:c.user?.name||"",fecha:(c.created_at||"").slice(0,10),icon:c.extension==="pdf"?"picture_as_pdf":"attach_file",links:{view:c.url,download:c.url,open:c.url}})}),Array.isArray(e.fotografias)&&e.fotografias.forEach(c=>{i.push({uid:`foto-${c.id}`,tipo:"Fotografía",modulo:"Multimedia",titulo:c.titulo||"Fotografía",descripcion:c.descripcion||"",usuario:c.user?.name||"",fecha:(c.created_at||"").slice(0,10),icon:"image",links:{view:c.url,open:c.url,download:c.url}})}),i.sort((c,o)=>(o.fecha||"").localeCompare(c.fecha||"")),i},rowsFiltered(){let i=this.rows.slice();if(this.filters.q){const e=this.filters.q.toLowerCase();i=i.filter(n=>(n.titulo||"").toLowerCase().includes(e)||(n.descripcion||"").toLowerCase().includes(e)||(n.usuario||"").toLowerCase().includes(e))}return this.filters.tipo&&this.filters.tipo!=="Todos"&&(i=i.filter(e=>e.tipo===this.filters.tipo)),this.filters.modulo&&this.filters.modulo!=="Todos"&&(i=i.filter(e=>(e.modulo||"").toLowerCase()===this.filters.modulo.toLowerCase())),this.filters.desde&&(i=i.filter(e=>(e.fecha||"0000-00-00")>=this.filters.desde)),this.filters.hasta&&(i=i.filter(e=>(e.fecha||"9999-12-31")<=this.filters.hasta)),i}},methods:{stripHtml(i){const e=document.createElement("div");e.innerHTML=i||"";const n=(e.textContent||e.innerText||"").trim().replace(/\s+/g," ");return n.length>280?n.slice(0,277)+"…":n},fullName(i,e){return[i[`${e}_nombres`],i[`${e}_paterno`],i[`${e}_materno`]].filter(Boolean).join(" ").trim()||i[`${e}_nombre_completo`]||i[`${e}_nombres`]||"—"},open(i){i&&window.open(i,"_blank")},async forceRefresh(){this.loading=!0;try{await new Promise(i=>setTimeout(i,500))}finally{this.loading=!1}}}},Si={class:"row items-start q-col-gutter-sm"},Ui={class:"col-12 col-md-8"},Ai={class:"text-caption text-grey-7"},Oi={class:"col-12 col-md-4 flex items-center justify-end"},Ti={class:"row q-col-gutter-sm"},Ri={class:"col-12 col-md-3"},Pi={class:"val"},Li={class:"col-12 col-md-3"},Mi={class:"val"},Fi={class:"col-12 col-md-3"},ji={class:"val"},zi={class:"col-12 col-md-3"},Gi={class:"val ellipsis"},Qi={class:"col-12 col-md-3"},$i={class:"val"},Bi={class:"col-12 col-md-3"},Hi={class:"val"},Yi={class:"col-12 col-md-3"},Wi={class:"val"},Zi={class:"col-12 col-md-3"},Ji={class:"val"},Xi={class:"row q-col-gutter-xs q-mt-sm items-center"},Ki={class:"col-12 col-md-8"},ea={class:"row q-gutter-xs"},oa={class:"col-12 col-md-4"},la={class:"row q-gutter-xs justify-end"},ia={class:"row items-center q-col-gutter-sm"},aa={class:"col-12 col-md-4"},ta={class:"col-6 col-md-2"},na={class:"col-6 col-md-2"},sa={class:"col-6 col-md-2"},da={class:"col-6 col-md-2"},ra={class:"row no-wrap items-start q-gutter-sm"},ca={class:"text-weight-medium"},ua={class:"text-caption text-grey-7 ellipsis-2-lines",style:{"max-width":"560px"}},ma={class:"text-weight-medium"},fa={class:"text-caption text-grey-7"};function pa(i,e,n,c,o,d){return u(),C("div",null,[l(E,{flat:"",bordered:"",class:"q-pa-sm q-mb-md rounded-borders"},{default:s(()=>[a("div",Si,[a("div",Ui,[e[6]||(e[6]=a("div",{class:"text-subtitle1 text-weight-bold"},"Seguimiento del Caso",-1)),a("div",Ai,[h(m(n.caso?.tipo||"SLIM")+" · Caso ",1),a("b",null,"#"+m(d.header.caso_id),1),e[5]||(e[5]=h(" · N° ")),a("b",null,m(d.header.caso_numero||"—"),1)])]),a("div",Oi,[l(Y,{dense:"",color:"indigo-1","text-color":"indigo-9",class:"q-mr-xs"},{default:s(()=>[h(m(d.header.fecha_registro||"—"),1)]),_:1}),l(_,{flat:"",color:"primary",icon:"refresh",onClick:d.forceRefresh,loading:o.loading,title:"Actualizar",label:o.loading?"":"Actualizar","no-caps":"",dense:""},null,8,["onClick","loading","label"])])]),l(k,{class:"q-my-sm"}),a("div",Ti,[a("div",Ri,[e[7]||(e[7]=a("div",{class:"lbl"},"Tipología",-1)),a("div",Pi,m(d.header.tipologia||"—"),1)]),a("div",Li,[e[8]||(e[8]=a("div",{class:"lbl"},"Modalidad",-1)),a("div",Mi,m(d.header.modalidad||"—"),1)]),a("div",Fi,[e[9]||(e[9]=a("div",{class:"lbl"},"Zona",-1)),a("div",ji,m(d.header.zona||"—"),1)]),a("div",zi,[e[10]||(e[10]=a("div",{class:"lbl"},"Dirección",-1)),a("div",Gi,m(d.header.direccion||"—"),1)]),a("div",Qi,[e[11]||(e[11]=a("div",{class:"lbl"},"Denunciante",-1)),a("div",$i,m(d.header.denunciante||"—"),1)]),a("div",Bi,[e[12]||(e[12]=a("div",{class:"lbl"},"Denunciado",-1)),a("div",Hi,m(d.header.denunciado||"—"),1)]),a("div",Yi,[e[13]||(e[13]=a("div",{class:"lbl"},"Fecha del hecho",-1)),a("div",Wi,m(d.header.fecha_hecho||"—"),1)]),a("div",Zi,[e[14]||(e[14]=a("div",{class:"lbl"},"Registrado por",-1)),a("div",Ji,m(d.header.registrado_por||"—"),1)])]),a("div",Xi,[a("div",Ki,[e[15]||(e[15]=a("div",{class:"lbl q-mb-xs"},"Tipos de violencia",-1)),a("div",ea,[(u(!0),C(L,null,Q(d.violenciaChips,t=>(u(),p(Y,{key:t.label,dense:"",color:t.on?t.color:"grey-3","text-color":t.on?"white":"grey-8",square:""},{default:s(()=>[h(m(t.label),1)]),_:2},1032,["color","text-color"]))),128))])]),a("div",oa,[e[16]||(e[16]=a("div",{class:"lbl q-mb-xs"},"Responsables",-1)),a("div",la,[n.caso?.psicologica_user?(u(),p(Y,{key:0,dense:"",color:"pink-2","text-color":"pink-10",square:""},{default:s(()=>[h(" Psic.: "+m(n.caso.psicologica_user.name),1)]),_:1})):v("",!0),n.caso?.trabajo_social_user?(u(),p(Y,{key:1,dense:"",color:"teal-2","text-color":"teal-10",square:""},{default:s(()=>[h(" TS: "+m(n.caso.trabajo_social_user.name),1)]),_:1})):v("",!0),n.caso?.legal_user?(u(),p(Y,{key:2,dense:"",color:"amber-2","text-color":"amber-10",square:""},{default:s(()=>[h(" Legal: "+m(n.caso.legal_user.name),1)]),_:1})):v("",!0)])])])]),_:1}),l(E,{flat:"",bordered:"",class:"q-pa-sm q-mb-sm rounded-borders"},{default:s(()=>[a("div",ia,[a("div",aa,[l(f,{modelValue:o.filters.q,"onUpdate:modelValue":e[0]||(e[0]=t=>o.filters.q=t),dense:"",outlined:"",placeholder:"Buscar (título, descripción, usuario)"},{append:s(()=>[l(x,{name:"search"})]),_:1},8,["modelValue"])]),a("div",ta,[l(P,{modelValue:o.filters.tipo,"onUpdate:modelValue":e[1]||(e[1]=t=>o.filters.tipo=t),options:o.tipos,dense:"",outlined:"",label:"Tipo"},null,8,["modelValue","options"])]),a("div",na,[l(P,{modelValue:o.filters.modulo,"onUpdate:modelValue":e[2]||(e[2]=t=>o.filters.modulo=t),options:o.modulos,dense:"",outlined:"",label:"Módulo"},null,8,["modelValue","options"])]),a("div",sa,[l(f,{modelValue:o.filters.desde,"onUpdate:modelValue":e[3]||(e[3]=t=>o.filters.desde=t),type:"date",dense:"",outlined:"",label:"Desde"},null,8,["modelValue"])]),a("div",da,[l(f,{modelValue:o.filters.hasta,"onUpdate:modelValue":e[4]||(e[4]=t=>o.filters.hasta=t),type:"date",dense:"",outlined:"",label:"Hasta"},null,8,["modelValue"])])])]),_:1}),l(Ye,{flat:"",bordered:"",rows:d.rowsFiltered,columns:o.columns,"row-key":"uid",loading:o.loading,"hide-bottom":"","rows-per-page-options":[0],class:"rounded-borders"},{"body-cell-actividad":s(t=>[l(ie,{props:t},{default:s(()=>[a("div",ra,[l(x,{name:t.row.icon||"feed",size:"18px",class:"text-primary q-mt-xs"},null,8,["name"]),a("div",null,[a("div",ca,[h(m(t.row.tipo)+" ",1),e[17]||(e[17]=a("span",{class:"text-grey-7"},"·",-1)),h(" "+m(t.row.titulo||"—"),1)]),a("div",ua,m(t.row.descripcion||"—"),1)])])]),_:2},1032,["props"])]),"body-cell-fecha":s(t=>[l(ie,{props:t},{default:s(()=>[a("div",ma,m(t.row.fecha||"—"),1),a("div",fa,m(t.row.usuario||"—"),1)]),_:2},1032,["props"])]),"body-cell-modulo":s(t=>[l(ie,{props:t},{default:s(()=>[l(Y,{dense:"",square:""},{default:s(()=>[h(m(t.row.modulo||"—"),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-acciones":s(t=>[l(ie,{props:t,class:"q-gutter-xs"},{default:s(()=>[t.row.links?.pdf?(u(),p(_,{key:0,dense:"",flat:"",icon:"picture_as_pdf",onClick:r=>d.open(t.row.links.pdf),title:"Ver PDF"},null,8,["onClick"])):v("",!0),t.row.links?.view?(u(),p(_,{key:1,dense:"",flat:"",icon:"visibility",onClick:r=>d.open(t.row.links.view),title:"Ver"},null,8,["onClick"])):v("",!0),t.row.links?.download?(u(),p(_,{key:2,dense:"",flat:"",icon:"download",onClick:r=>d.open(t.row.links.download),title:"Descargar"},null,8,["onClick"])):v("",!0),t.row.links?.open?(u(),p(_,{key:3,dense:"",flat:"",icon:"open_in_new",onClick:r=>d.open(t.row.links.open),title:"Abrir"},null,8,["onClick"])):v("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])])}const _a=A(Ni,[["render",pa],["__scopeId","data-v-7f7d9f4f"]]),ga={name:"SocialInformes",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:null}},data(){return{loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dialog:!1,mode:"create",form:{id:null,fecha:"",titulo:"",area:"psicologico",numero:"",contenido_html:""},plantilla:"informe_psico",plantillasOptions:[{label:"Informe Psicológico (formato SLIM)",value:"informe_psico"},{label:"Informe Legal (fundamentos)",value:"informe_legal"},{label:"Informe Social (visita / entorno)",value:"informe_social"},{label:"Denuncia penal — Ministerio Público (Abuso sexual)",value:"denuncia_mp"}],areas:[{label:"Psicológico",value:"psicologico"},{label:"Legal",value:"legal"},{label:"Social",value:"social"}]}},methods:{today(){const i=new Date,e=n=>String(n).padStart(2,"0");return`${i.getFullYear()}-${e(i.getMonth()+1)}-${e(i.getDate())}`},openCreate(){this.mode="create",this.form={id:null,fecha:this.today(),titulo:"",area:"psicologico",numero:"",contenido_html:""},this.dialog=!0,this.$nextTick(()=>this.applyTemplate(this.plantilla))},openView(i){this.mode="view",this.form={...i},this.dialog=!0},openEdit(i){this.mode="edit",this.form={...i},this.dialog=!0},applyTemplate(i){if(this.mode==="view")return;const e={casoId:this.caseId,fecha:this.form.fecha||this.today(),titulo:this.form.titulo||"Informe",area:this.form.area||"psicologico",numero:this.form.numero||""};if(i==="informe_psico"&&(this.form.contenido_html=j.psicologico(e)),i==="informe_legal"&&(this.form.contenido_html=j.legal(e)),i==="informe_social"&&(this.form.contenido_html=j.social(e)),i==="denuncia_mp"){const n=this.caso||{},c={nombre:n.denunciante_nombre_completo,ci:n.denunciante_nro,fecha_nac:n.denunciante_fecha_nacimiento,lugar_nac:n.denunciante_lugar_nacimiento,edad:n.denunciante_edad,ocupacion:n.denunciante_ocupacion_exacto||n.denunciante_ocupacion,estado_civil:n.denunciante_estado_civil,domicilio:n.denunciante_domicilio_actual||n.denunciante_residencia,celular:n.denunciante_telefono||n.denunciante_movil,correo:n.denunciante_correo},o={nombre:n.denunciado_nombre_completo,ci:n.denunciado_nro,fecha_nac:n.denunciado_fecha_nacimiento,nacionalidad:"Boliviana",ocupacion:n.denunciado_ocupacion_exacto||n.denunciado_ocupacion,estado_civil:n.denunciado_estado_civil,domicilio:n.denunciado_domicilio_actual||n.denunciado_residencia,celular:n.denunciado_telefono||n.denunciado_movil,correo:n.denunciado_correo},d={...e,ciudad:"ORURO",fiscaliaTitulo:"SEÑOR REPRESENTANTE DEL MINISTERIO PÚBLICO DE LA CIUDAD DE ORURO",titulo:"Denuncia penal por Abuso Sexual",denunciante:c,denunciado:o,ciudadania_digital_denunciante:n.documento_ciudadania_digital?n.denunciante_nro:"",relato:n.caso_descripcion||"",abogado:{nombre:n.legal_user?.name||"",correo:n.legal_user?.correo||"",whatsapp:n.legal_user?.celular||""}};this.form.contenido_html=j.denuncia_mp(d)}},async save(){if(!this.form.titulo)return this.$q.notify({type:"negative",message:"El título es obligatorio"});if(!this.form.contenido_html)return this.$q.notify({type:"negative",message:"El contenido está vacío"});this.saving=!0;try{this.form.id?await this.$axios.put(`/informes-sociales/${this.form.id}`,this.form):await this.$axios.post(`/casos/${this.caseId}/informes-sociales`,this.form),this.$q.notify({type:"positive",message:"Guardado"}),this.$emit("refresh"),this.dialog=!1}catch(i){this.$q.notify({type:"negative",message:i?.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}},removeIt(i){const e=async()=>{try{await this.$axios.delete(`/informes-sociales/${i.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.$emit("refresh")}catch(n){this.$q.notify({type:"negative",message:n?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar el informe?").onOk(e):confirm("¿Eliminar el informe?")&&e()},printPdf(i){const e=this.$url||"";window.open(`${e}/informes/${i.id}/pdf`,"_blank")}}},ha={class:"row items-center q-mb-sm"},va={class:"col"},ba={class:"text-caption text-grey-7"},ya={class:"col-auto row items-center q-gutter-sm"},xa={key:0},wa={class:"text-subtitle1"},Va={class:"row"},Ca={class:"col-12 col-md-3"},Ia={class:"col-12 col-md-5"},ka={class:"col-6 col-md-2"},Ea={class:"col-6 col-md-2"},Da={key:0};function qa(i,e,n,c,o,d){return u(),p(E,{flat:"",bordered:"",class:"q-pa-md"},{default:s(()=>[a("div",ha,[a("div",va,[e[9]||(e[9]=a("div",{class:"text-subtitle1 text-weight-medium"},"Informes",-1)),a("div",ba,"Vinculados al caso #"+m(n.caseId),1)]),a("div",ya,[l(f,{dense:"",outlined:"",modelValue:o.search,"onUpdate:modelValue":e[0]||(e[0]=t=>o.search=t),placeholder:"Buscar...",style:{width:"260px"}},{append:s(()=>[l(x,{name:"search"})]),_:1},8,["modelValue"]),l(_,{flat:"",color:"primary",icon:"refresh",loading:o.loading,onClick:e[1]||(e[1]=t=>i.$emit("refresh"))},null,8,["loading"]),l(_,{color:"green",icon:"add_circle_outline","no-caps":"",label:"Crear informe",onClick:d.openCreate},null,8,["onClick"])])]),l(k),l(ne,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:s(()=>[e[15]||(e[15]=a("thead",null,[a("tr",{class:"bg-primary text-white"},[a("th",{style:{width:"70px"}},"ID"),a("th",{style:{width:"140px"}},"Acciones"),a("th",null,"Título"),a("th",{style:{width:"120px"}},"Fecha"),a("th",{style:{width:"130px"}},"Área"),a("th",{style:{width:"120px"}},"Nro"),a("th",{style:{width:"180px"}},"Usuario")])],-1)),a("tbody",null,[(u(!0),C(L,null,Q(n.caso.informes_sociales,t=>(u(),C("tr",{key:t.id},[a("td",null,"#"+m(t.id),1),a("td",null,[l(Z,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:s(()=>[b((u(),p(I,{clickable:"",onClick:r=>d.openView(t)},{default:s(()=>[l(g,{avatar:""},{default:s(()=>[l(x,{name:"visibility"})]),_:1}),l(g,null,{default:s(()=>e[10]||(e[10]=[h("Ver")])),_:1})]),_:2},1032,["onClick"])),[[y]]),b((u(),p(I,{clickable:"",onClick:r=>d.printPdf(t)},{default:s(()=>[l(g,{avatar:""},{default:s(()=>[l(x,{name:"picture_as_pdf"})]),_:1}),l(g,null,{default:s(()=>e[11]||(e[11]=[h("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[y]]),l(k),b((u(),p(I,{clickable:"",onClick:r=>d.openEdit(t)},{default:s(()=>[l(g,{avatar:""},{default:s(()=>[l(x,{name:"edit"})]),_:1}),l(g,null,{default:s(()=>e[12]||(e[12]=[h("Editar")])),_:1})]),_:2},1032,["onClick"])),[[y]]),b((u(),p(I,{clickable:"",onClick:r=>d.removeIt(t)},{default:s(()=>[l(g,{avatar:""},{default:s(()=>[l(x,{name:"delete",color:"negative"})]),_:1}),l(g,{class:"text-negative"},{default:s(()=>e[13]||(e[13]=[h("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[y]])]),_:2},1024)]),a("td",null,m(t.titulo),1),a("td",null,m(t.fecha||"s/f"),1),a("td",null,m(t.area||"—"),1),a("td",null,m(t.numero||"—"),1),a("td",null,m(t.user?.name||t.user?.username||"—"),1)]))),128)),n.caso.informes_sociales.length?v("",!0):(u(),C("tr",xa,e[14]||(e[14]=[a("td",{colspan:"7",class:"text-center text-grey"},"Sin registros",-1)])))])]),_:1}),l(W,{modelValue:o.dialog,"onUpdate:modelValue":e[8]||(e[8]=t=>o.dialog=t),persistent:"",maximized:""},{default:s(()=>[l(E,null,{default:s(()=>[l(ye,{class:"bg-white text-dark"},{default:s(()=>[a("div",wa,m(o.mode==="view"?"Ver informe":o.form.id?"Editar informe":"Nuevo informe"),1),l(G),b(l(_,{flat:"",dense:"",round:"",icon:"close"},null,512),[[y]])]),_:1}),l(k),l(D,{class:"q-gutter-md"},{default:s(()=>[a("div",Va,[a("div",Ca,[l(f,{modelValue:o.form.fecha,"onUpdate:modelValue":e[2]||(e[2]=t=>o.form.fecha=t),type:"date",dense:"",outlined:"",label:"Fecha",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),a("div",Ia,[l(f,{modelValue:o.form.titulo,"onUpdate:modelValue":e[3]||(e[3]=t=>o.form.titulo=t),dense:"",outlined:"",label:"Título *",readonly:o.mode==="view",rules:[t=>!!t||"Requerido"]},null,8,["modelValue","readonly","rules"])]),a("div",ka,[l(P,{modelValue:o.form.area,"onUpdate:modelValue":e[4]||(e[4]=t=>o.form.area=t),options:o.areas,dense:"",outlined:"",label:"Área",readonly:o.mode==="view","emit-value":"","map-options":""},null,8,["modelValue","options","readonly"])]),a("div",Ea,[l(f,{modelValue:o.form.numero,"onUpdate:modelValue":e[5]||(e[5]=t=>o.form.numero=t),dense:"",outlined:"",label:"Nro",readonly:o.mode==="view"},null,8,["modelValue","readonly"])])]),o.mode!=="view"?(u(),C("div",Da,[l(P,{modelValue:o.plantilla,"onUpdate:modelValue":[e[6]||(e[6]=t=>o.plantilla=t),d.applyTemplate],options:o.plantillasOptions,label:"Plantilla",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])])):v("",!0),a("div",null,[e[16]||(e[16]=a("div",{class:"text-caption text-grey-7 q-mb-xs"},"Contenido (WYSIWYG / guarda HTML)",-1)),l(pe,{modelValue:o.form.contenido_html,"onUpdate:modelValue":e[7]||(e[7]=t=>o.form.contenido_html=t),readonly:o.mode==="view","min-height":"320px",placeholder:"Escriba el informe...",toolbar:[["left","center","right","justify"],["bold","italic","strike","underline"],["quote","unordered","ordered","outdent","indent"],["hr","link"],["undo","redo"],["removeFormat"]]},null,8,["modelValue","readonly"])])]),_:1}),l(k),l(z,{align:"right"},{default:s(()=>[b(l(_,{flat:"",label:"Cerrar"},null,512),[[y]]),o.mode!=="view"?(u(),p(_,{key:0,color:"primary",label:"Guardar",loading:o.saving,onClick:d.save},null,8,["loading","onClick"])):v("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Na=A(ga,[["render",qa]]),Sa={name:"CodigoCaso",props:{caso:{type:Object,required:!0}},data(){return{editMode:!1,loading:!1,form:{nurej:null,cud:null}}},watch:{caso:{immediate:!0,deep:!0,handler(i){this.form.nurej=i?.nurej??null,this.form.cud=i?.cud??null}}},methods:{toggleEdit(){this.editMode&&(this.form.nurej=this.caso?.nurej??null,this.form.cud=this.caso?.cud??null),this.editMode=!this.editMode},async guardar(){this.loading=!0;try{const i={nurej:this.form.nurej,cud:this.form.cud};await this.$axios.put(`casos/${this.caso.id}/codigos`,i),this.$emit("actualizado"),this.editMode=!1,this.$q.notify({type:"positive",message:"Códigos actualizados correctamente."})}catch(i){console.error(i),this.$q.notify({type:"negative",message:"Error al actualizar los códigos."})}finally{this.loading=!1}}}},Ua={class:"row items-center q-gutter-sm q-mb-md"},Aa={class:"row q-col-gutter-md"},Oa={class:"col-12 col-md-6"},Ta={class:"col-12 col-md-6"};function Ra(i,e,n,c,o,d){return u(),p(E,{flat:"",bordered:"",class:"q-pa-md"},{default:s(()=>[a("div",Ua,[l(Fe,{icon:"qr_code_2",color:"primary","text-color":"white"}),e[2]||(e[2]=a("div",null,[a("div",{class:"text-h6 text-weight-bold"},"Códigos del Caso"),a("div",{class:"text-caption text-grey-7"},"NUREJ y CUD")],-1)),l(G),l(_,{label:o.editMode?"Cancelar":"Editar",icon:o.editMode?"close":"edit",flat:"",color:"primary",onClick:d.toggleEdit},null,8,["label","icon","onClick"]),o.editMode?(u(),p(_,{key:0,color:"primary",icon:"save",label:"Guardar",loading:o.loading,onClick:d.guardar},null,8,["loading","onClick"])):v("",!0)]),l(k,{spaced:""}),a("div",Aa,[a("div",Oa,[l(f,{modelValue:o.form.nurej,"onUpdate:modelValue":e[0]||(e[0]=t=>o.form.nurej=t),readonly:!o.editMode,filled:"",label:"NUREJ",dense:i.$q.screen.lt.md},{prepend:s(()=>[l(x,{name:"tag"})]),_:1},8,["modelValue","readonly","dense"])]),a("div",Ta,[l(f,{modelValue:o.form.cud,"onUpdate:modelValue":e[1]||(e[1]=t=>o.form.cud=t),readonly:!o.editMode,filled:"",label:"CUD",dense:i.$q.screen.lt.md},{prepend:s(()=>[l(x,{name:"confirmation_number"})]),_:1},8,["modelValue","readonly","dense"])])])]),_:1})}const Pa=A(Sa,[["render",Ra],["__scopeId","data-v-9cc36eb8"]]),La={name:"CasoDetalle",components:{Codigo:Pa,CasoNuevoPROPREMI:Ke,CasoNuevoUMADIS:Xe,CasoNuevoSLAM:Je,CasoNuevoDNA:Ze,SocialInformes:Na,SlimNuevo:We,Seguimiento:_a,HojaRuta:qi,InfoGeneral:Ko,Problematica:pl,SesionesPsicologico:Sl,InformesLegal:Bl,ApoyoIntegral:Zl,DocumentosGeneral:ti,Fotografias:pi},data(){return{loading:!1,tab:"info",caso:null,defaultCountryCallingCode:"591"}},computed:{caseId(){return this.$route.params.id},role(){return this.$store.user?.role||""},hasAnyWa(){const i=this.caso||{};return!!(i?.psicologica_user?.celular||i?.legal_user?.celular||i?.trabajo_social_user?.celular)}},created(){this.fetchCaso()},methods:{normalizePhone(i){if(!i)return"";let e=String(i).replace(/\D+/g,"");return/^(\d{11,13})$/.test(e)?e:e.length===8?this.defaultCountryCallingCode+e:e.length===9&&!e.startsWith(this.defaultCountryCallingCode)?this.defaultCountryCallingCode+e:e},waUrl(i,e){const n=this.normalizePhone(i),c=encodeURIComponent(e||"");return`https://wa.me/${n}${c?`?text=${c}`:""}`},waMessage(i){const e=this.caso||{},n=e.caso_numero?e.caso_numero.replace(/\\\//g,"/"):`#${this.caseId}`,c=(this.$axios?.defaults?.baseURL||"")+`/casos/${this.caseId}`,o=i==="psico"?"Psicología":i==="legal"?"Legal":"Trabajo Social";return["*SLIM - Notificación de Caso*",`Nro: ${n}`,`Área: ${o}`,`Denunciante: ${e.denunciante_nombre_completo||"—"}`,e.caso_tipologia?`Tipología: ${e.caso_tipologia}`:null,e.caso_modalidad?`Modalidad: ${e.caso_modalidad}`:null,e.caso_fecha_hecho?`Fecha del hecho: ${e.caso_fecha_hecho}`:null,"",`Ver caso: ${c}`].filter(Boolean).join(`
`)},sendWhatsApp(i){const e=this.caso||{},n=i==="psico"?e.psicologica_user:i==="legal"?e.legal_user:i==="social"?e.trabajo_social_user:null;if(!n?.celular){this.$q.notify({type:"warning",message:"No hay número de celular configurado para ese responsable"});return}const c=this.waUrl(n.celular,this.waMessage(i));window.open(c,"_blank")},async fetchCaso(){this.loading=!0;try{const i=await this.$axios.get(`/casos/${this.caseId}`);this.caso=i.data}catch(i){this.$alert.error(i?.response?.data?.message||"No se pudo cargar el caso")}finally{this.loading=!1}},printPdf(){const i=this.$axios.defaults.baseURL+`/casos/${this.caseId}/pdf`;window.open(i,"_blank")},printPdfHojaRuta(i="denunciante"){const e=this.$axios.defaults.baseURL+`/casos/${this.caseId}/pdf/hoja-ruta?tipo=${i}`;window.open(e,"_blank")}}},Ma={class:"row items-center q-mb-md"},Fa={class:"col"},ja={class:"text-h6 text-weight-bold"},za={class:"col-auto row q-gutter-sm"};function Ga(i,e,n,c,o,d){const t=q("SlimNuevo"),r=q("CasoNuevoDNA"),w=q("CasoNuevoSLAM"),N=q("CasoNuevoUMADIS"),T=q("CasoNuevoPROPREMI"),le=q("Seguimiento"),J=q("Problematica"),X=q("HojaRuta"),M=q("SesionesPsicologico"),U=q("InformesLegal"),$=q("SocialInformes"),K=q("ApoyoIntegral"),ee=q("DocumentosGeneral"),se=q("Fotografias"),de=q("Codigo");return u(),p(Qe,{class:"q-pa-md bg-grey-2"},{default:s(()=>[a("div",Ma,[a("div",Fa,[a("div",ja,m(o.caso?.tipo)+" "+m(o.caso?.caso_numero||"..."),1),e[7]||(e[7]=a("div",{class:"text-caption text-grey-7"},"Detalle y gestión integral",-1))]),a("div",za,[d.hasAnyWa?(u(),p(Z,{key:0,flat:"",color:"positive",icon:"chat",label:"WhatsApp"},{default:s(()=>[l(fe,null,{default:s(()=>[o.caso?.psicologica_user?.celular?(u(),p(I,{key:0,clickable:"",onClick:e[0]||(e[0]=R=>d.sendWhatsApp("psico"))},{default:s(()=>[l(g,{avatar:""},{default:s(()=>[l(x,{name:"psychology"})]),_:1}),l(g,null,{default:s(()=>[h("Psicología ("+m(o.caso.psicologica_user.name)+")",1)]),_:1}),l(g,{side:"",class:"text-caption text-grey"},{default:s(()=>[h(m(o.caso.psicologica_user.celular),1)]),_:1})]),_:1})):v("",!0),o.caso?.legal_user?.celular?(u(),p(I,{key:1,clickable:"",onClick:e[1]||(e[1]=R=>d.sendWhatsApp("legal"))},{default:s(()=>[l(g,{avatar:""},{default:s(()=>[l(x,{name:"gavel"})]),_:1}),l(g,null,{default:s(()=>[h("Legal ("+m(o.caso.legal_user.name)+")",1)]),_:1}),l(g,{side:"",class:"text-caption text-grey"},{default:s(()=>[h(m(o.caso.legal_user.celular),1)]),_:1})]),_:1})):v("",!0),o.caso?.trabajo_social_user?.celular?(u(),p(I,{key:2,clickable:"",onClick:e[2]||(e[2]=R=>d.sendWhatsApp("social"))},{default:s(()=>[l(g,{avatar:""},{default:s(()=>[l(x,{name:"people"})]),_:1}),l(g,null,{default:s(()=>[h("Trabajo social ("+m(o.caso.trabajo_social_user.name)+")",1)]),_:1}),l(g,{side:"",class:"text-caption text-grey"},{default:s(()=>[h(m(o.caso.trabajo_social_user.celular),1)]),_:1})]),_:1})):v("",!0)]),_:1})]),_:1})):v("",!0),l(Z,{flat:"",color:"secondary",icon:"print",label:"Imprimir PDF"},{default:s(()=>[l(fe,null,{default:s(()=>[b((u(),p(I,{clickable:"",onClick:d.printPdf},{default:s(()=>[l(g,null,{default:s(()=>e[8]||(e[8]=[h("Ficha del Caso")])),_:1})]),_:1},8,["onClick"])),[[y]]),l(k),b((u(),p(I,{clickable:"",onClick:e[3]||(e[3]=R=>d.printPdfHojaRuta("denunciante"))},{default:s(()=>[l(g,null,{default:s(()=>e[9]||(e[9]=[h("Ubicacion (Denunciante)")])),_:1})]),_:1})),[[y]]),b((u(),p(I,{clickable:"",onClick:e[4]||(e[4]=R=>d.printPdfHojaRuta("denunciado"))},{default:s(()=>[l(g,null,{default:s(()=>e[10]||(e[10]=[h("Ubicacion (Denunciado)")])),_:1})]),_:1})),[[y]])]),_:1})]),_:1}),l(_,{flat:"",color:"primary",icon:"refresh",onClick:d.fetchCaso,loading:o.loading},null,8,["onClick","loading"])])]),l(E,{flat:"",bordered:"",class:"q-mb-md"},{default:s(()=>[l(ze,{modelValue:o.tab,"onUpdate:modelValue":e[5]||(e[5]=R=>o.tab=R),class:"text-primary",dense:"",align:"left","active-color":"primary","indicator-color":"primary","outside-arrows":"","mobile-arrows":""},{default:s(()=>[l(F,{name:"info",label:"1 Información General",icon:"dashboard","no-caps":""}),l(F,{name:"seguimiento",label:"2 Seguimiento",icon:"track_changes","no-caps":""}),d.role==="Administrador"||d.role==="Asistente"?(u(),p(F,{key:0,name:"hoja",label:"3 Hoja de Ruta",icon:"report_problem","no-caps":""})):v("",!0),d.role==="Administrador"||d.role==="Psicologo"?(u(),p(F,{key:1,name:"psico",label:"4 Área Psicológico",icon:"psychology","no-caps":""})):v("",!0),d.role==="Administrador"||d.role==="Abogado"?(u(),p(F,{key:2,name:"legal",label:"5 Área Legal",icon:"gavel","no-caps":""})):v("",!0),d.role==="Administrador"||d.role==="Social"?(u(),p(F,{key:3,name:"social",label:"6 Área Social",icon:"people","no-caps":""})):v("",!0),l(F,{name:"docs",label:"7 Documentos General",icon:"folder","no-caps":""}),l(F,{name:"fotos",label:"8 Fotografías",icon:"photo_library","no-caps":""}),l(F,{name:"codigo",label:"9 Codigos",icon:"code","no-caps":""})]),_:1},8,["modelValue"])]),_:1}),l(Ge,{modelValue:o.tab,"onUpdate:modelValue":e[6]||(e[6]=R=>o.tab=R),animated:"","keep-alive":""},{default:s(()=>[l(O,{name:"info"},{default:s(()=>[o.caso?.tipo==="SLIM"?(u(),p(t,{key:0,casoId:o.caso.id,showNumeroApoyoIntegral:o.caso?.numero_apoyo_integral,editable:!0},null,8,["casoId","showNumeroApoyoIntegral"])):o.caso?.tipo==="DNA"?(u(),p(r,{key:1,casoId:o.caso.id,showNumeroApoyoIntegral:o.caso?.numero_apoyo_integral,editable:!0},null,8,["casoId","showNumeroApoyoIntegral"])):o.caso?.tipo==="SLAM"?(u(),p(w,{key:2,casoId:o.caso.id,showNumeroApoyoIntegral:o.caso?.numero_apoyo_integral,editable:!0},null,8,["casoId","showNumeroApoyoIntegral"])):o.caso?.tipo==="UMADIS"?(u(),p(N,{key:3,casoId:o.caso.id,showNumeroApoyoIntegral:o.caso?.numero_apoyo_integral,editable:!0},null,8,["casoId","showNumeroApoyoIntegral"])):o.caso?.tipo==="PROPREMI"?(u(),p(T,{key:4,casoId:o.caso.id,showNumeroApoyoIntegral:o.caso?.numero_apoyo_integral,editable:!0},null,8,["casoId","showNumeroApoyoIntegral"])):v("",!0)]),_:1}),l(O,{name:"seguimiento"},{default:s(()=>[l(le,{caso:o.caso},null,8,["caso"])]),_:1}),l(O,{name:"problematica"},{default:s(()=>[l(J,{"case-id":d.caseId},null,8,["case-id"])]),_:1}),l(O,{name:"hoja"},{default:s(()=>[l(X,{"case-id":d.caseId},null,8,["case-id"])]),_:1}),l(O,{name:"psico"},{default:s(()=>[l(M,{"case-id":d.caseId,caso:o.caso,onRefresh:d.fetchCaso},null,8,["case-id","caso","onRefresh"])]),_:1}),l(O,{name:"legal"},{default:s(()=>[l(U,{"case-id":d.caseId,caso:o.caso,onRefresh:d.fetchCaso},null,8,["case-id","caso","onRefresh"])]),_:1}),l(O,{name:"social"},{default:s(()=>[l($,{caso:o.caso,onRefresh:d.fetchCaso,"case-id":d.caseId},null,8,["caso","onRefresh","case-id"])]),_:1}),l(O,{name:"apoyo"},{default:s(()=>[l(K,{"case-id":d.caseId},null,8,["case-id"])]),_:1}),l(O,{name:"docs"},{default:s(()=>[l(ee,{"case-id":d.caseId,caso:o.caso,onRefresh:d.fetchCaso},null,8,["case-id","caso","onRefresh"])]),_:1}),l(O,{name:"fotos"},{default:s(()=>[l(se,{"case-id":d.caseId,caso:o.caso,onRefresh:d.fetchCaso},null,8,["case-id","caso","onRefresh"])]),_:1}),l(O,{name:"codigo"},{default:s(()=>[l(de,{"case-id":d.caseId,caso:o.caso,onRefresh:d.fetchCaso},null,8,["case-id","caso","onRefresh"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ht=A(La,[["render",Ga],["__scopeId","data-v-91b90863"]]);export{ht as default};
