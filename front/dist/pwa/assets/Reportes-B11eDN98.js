import{j as k,L as q,g as S,O as C,k as x,l as b,m as _,_ as R,Y as D,c as m,o as r,w as a,b as o,a as l,f as v,Q as h,e as u,a6 as w,a3 as L,Z as p,t as g,a0 as f,$ as M}from"./index-D3xeA4YS.js";import{Q as A}from"./QSelect-nw7LQKU7.js";import{Q as V}from"./QPage-DSObx1WP.js";import{m as B}from"./vue3-apexcharts-Cq8m7nZD.js";import"./QMenu-C-LBE08B.js";import"./format-C4BH9IsS.js";const Q=k({name:"QBanner",props:{...q,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(e,{slots:t}){const{proxy:{$q:i}}=S(),y=C(e,i),s=x(()=>"q-banner row items-center"+(e.dense===!0?" q-banner--dense":"")+(y.value===!0?" q-banner--dark q-dark":"")+(e.rounded===!0?" rounded-borders":"")),d=x(()=>`q-banner__actions row items-center justify-end col-${e.inlineActions===!0?"auto":"all"}`);return()=>{const c=[b("div",{class:"q-banner__avatar col-auto row items-center self-start"},_(t.avatar)),b("div",{class:"q-banner__content col text-body2"},_(t.default))],n=_(t.action);return n!==void 0&&c.push(b("div",{class:d.value},n)),b("div",{class:s.value+(e.inlineActions===!1&&n!==void 0?" q-banner--top-padding":""),role:"alert"},c)}}}),P={name:"ReportesCasos",components:{apexchart:B},data(){return{loading:!1,total:null,modulos:[{label:"SLIM",value:"SLIM"},{label:"DNA",value:"DNA"},{label:"SLAM",value:"SLAM"},{label:"UMADIS",value:"UMADIS"},{label:"PROPREMI",value:"PROPREMI"}],filters:{start:"",end:"",tipo:null},chart:{tipologia:{options:{labels:[],legend:{position:"bottom"},dataLabels:{enabled:!0},tooltip:{y:{formatter:e=>`${e} casos`}}},series:[]},modalidad:{options:{labels:[],legend:{position:"bottom"},dataLabels:{enabled:!0},tooltip:{y:{formatter:e=>`${e} casos`}}},series:[]},tipo:{options:{labels:[],legend:{position:"bottom"},dataLabels:{enabled:!0},tooltip:{y:{formatter:e=>`${e} casos`}}},series:[]},zona:{options:{xaxis:{categories:[]},plotOptions:{bar:{borderRadius:6}},legend:{show:!1},dataLabels:{enabled:!1},tooltip:{y:{formatter:e=>`${e} casos`}}},series:[]}}}},mounted(){this.fetchReporte()},watch:{"filters.tipo"(){this.fetchReporte()}},methods:{show(e){return e==null||e===""?"—":String(e)},clearFilters(){this.filters.start="",this.filters.end="",this.filters.tipo=null,this.fetchReporte()},toDonut(e){const t=e||{labels:[],series:[]};return{options:{labels:(t.labels||[]).map(i=>i||"—"),legend:{position:"bottom"},dataLabels:{enabled:!0},tooltip:{y:{formatter:i=>`${i} casos`}}},series:t.series||[]}},toBar(e,t){return{options:{xaxis:{categories:(e||[]).map(i=>i||"—")},plotOptions:{bar:{borderRadius:6}},dataLabels:{enabled:!1},legend:{show:!1},tooltip:{y:{formatter:i=>`${i} casos`}}},series:[{name:"Casos",data:t||[]}]}},async fetchReporte(){this.loading=!0;try{const e={};this.filters.start&&(e.start=this.filters.start),this.filters.end&&(e.end=this.filters.end),this.filters.tipo&&(e.tipo=this.filters.tipo);const{data:t}=await this.$axios.get("/reportes/casos-resumen",{params:e});this.total=t?.total??0,this.chart.tipologia=this.toDonut(t?.tipologia),this.chart.modalidad=this.toDonut(t?.modalidad),this.chart.tipo=this.toDonut(t?.tipo),this.chart.zona=this.toBar(t?.zona_top10?.labels,t?.zona_top10?.series)}catch{this.$alert?.error?.("No se pudo cargar el reporte")}finally{this.loading=!1}}}},I={class:"toolbar q-pa-sm bg-white row items-center q-gutter-sm shadow-1"},z={class:"col-auto row q-gutter-sm"},N={class:"q-mt-md"},T={class:"row items-center q-col-gutter-md"},O={class:"col-12 col-sm-3"},U={class:"col-12 col-sm-3"},E={class:"col-12 col-sm-3"},F={class:"col-12 col-sm-3"},j={class:"text-subtitle1"},Z={class:"text-caption"},H={key:0},Y={class:"row q-col-gutter-md q-mt-md"},G={class:"col-12 col-md-4"},J={key:1,class:"q-pa-md text-grey"},K={class:"col-12 col-md-4"},W={key:1,class:"q-pa-md text-grey"},X={class:"col-12 col-md-4"},$={key:1,class:"q-pa-md text-grey"},tt={class:"row q-col-gutter-md q-mt-md"},et={class:"col-12"},st={key:1,class:"q-pa-md text-grey"};function ot(e,t,i,y,s,d){const c=D("apexchart");return r(),m(V,{class:"q-pa-md bg-grey-2"},{default:a(()=>[o("div",I,[t[3]||(t[3]=o("div",{class:"col"},[o("div",{class:"text-h6 text-weight-bold"},"Reportes de Casos"),o("div",{class:"text-caption text-grey-7"},"Tortas por Tipología, Proceso y Módulo · Filtro por fechas")],-1)),o("div",z,[l(v,{flat:"",color:"primary",icon:"history",label:"Limpiar",onClick:d.clearFilters},null,8,["onClick"]),l(v,{color:"primary",icon:"refresh",label:"Actualizar",loading:s.loading,onClick:d.fetchReporte},null,8,["loading","onClick"])])]),o("div",N,[l(h,{flat:"",bordered:"",class:"section-card"},{default:a(()=>[l(u,null,{default:a(()=>[o("div",T,[o("div",O,[l(w,{modelValue:s.filters.start,"onUpdate:modelValue":t[0]||(t[0]=n=>s.filters.start=n),type:"date",dense:"",outlined:"",label:"Desde"},null,8,["modelValue"])]),o("div",U,[l(w,{modelValue:s.filters.end,"onUpdate:modelValue":t[1]||(t[1]=n=>s.filters.end=n),type:"date",dense:"",outlined:"",label:"Hasta"},null,8,["modelValue"])]),o("div",E,[l(A,{modelValue:s.filters.tipo,"onUpdate:modelValue":t[2]||(t[2]=n=>s.filters.tipo=n),options:s.modulos,dense:"",outlined:"",clearable:"","emit-value":"","map-options":"",label:"Módulo (SLIM, DNA, SLAM, …)"},null,8,["modelValue","options"])]),o("div",F,[l(v,{color:"primary",icon:"refresh",label:"Aplicar filtros",loading:s.loading,class:"full-width",onClick:d.fetchReporte},null,8,["loading","onClick"])])])]),_:1}),l(L),l(u,null,{default:a(()=>[l(Q,{class:"bg-indigo-1 text-indigo-10",rounded:""},{default:a(()=>[o("div",j,[t[4]||(t[4]=o("b",null,"Total de casos:",-1)),p(" "+g(s.total??"—"),1)]),o("div",Z,[p(" Rango: "+g(d.show(s.filters.start))+" → "+g(d.show(s.filters.end))+" ",1),s.filters.tipo?(r(),f("span",H,[t[5]||(t[5]=p(" · Módulo: ")),o("b",null,g(s.filters.tipo),1)])):M("",!0)])]),_:1})]),_:1})]),_:1})]),o("div",Y,[o("div",G,[l(h,{flat:"",bordered:"",class:"section-card"},{default:a(()=>[l(u,{class:"text-subtitle2 text-weight-bold"},{default:a(()=>t[6]||(t[6]=[p("Por Tipología")])),_:1}),s.chart.tipologia.series.length?(r(),m(c,{key:0,type:"donut",height:"300",options:s.chart.tipologia.options,series:s.chart.tipologia.series},null,8,["options","series"])):(r(),f("div",J,"Sin datos"))]),_:1})]),o("div",K,[l(h,{flat:"",bordered:"",class:"section-card"},{default:a(()=>[l(u,{class:"text-subtitle2 text-weight-bold"},{default:a(()=>t[7]||(t[7]=[p("Por Tipo de Proceso")])),_:1}),s.chart.modalidad.series.length?(r(),m(c,{key:0,type:"donut",height:"300",options:s.chart.modalidad.options,series:s.chart.modalidad.series},null,8,["options","series"])):(r(),f("div",W,"Sin datos"))]),_:1})]),o("div",X,[l(h,{flat:"",bordered:"",class:"section-card"},{default:a(()=>[l(u,{class:"text-subtitle2 text-weight-bold"},{default:a(()=>t[8]||(t[8]=[p("Por Módulo")])),_:1}),s.chart.tipo.series.length?(r(),m(c,{key:0,type:"donut",height:"300",options:s.chart.tipo.options,series:s.chart.tipo.series},null,8,["options","series"])):(r(),f("div",$,"Sin datos"))]),_:1})])]),o("div",tt,[o("div",et,[l(h,{flat:"",bordered:"",class:"section-card"},{default:a(()=>[l(u,{class:"text-subtitle2 text-weight-bold"},{default:a(()=>t[9]||(t[9]=[p("Top 10 Zonas")])),_:1}),s.chart.zona.series.length?(r(),m(c,{key:0,type:"bar",height:"320",options:s.chart.zona.options,series:s.chart.zona.series},null,8,["options","series"])):(r(),f("div",st,"Sin datos"))]),_:1})])])]),_:1})}const ct=R(P,[["render",ot],["__scopeId","data-v-0b49a1af"]]);export{ct as default};
