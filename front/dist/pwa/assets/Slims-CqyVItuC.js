import{_ as b,c,o as s,w as h,b as n,a as u,a6 as E,$ as l,f as y,d as f,a7 as S,W as P,Z as m,a4 as Q,a0 as r,a1 as p,a2 as V,t as i}from"./index-D_cefSM8.js";import{Q as v}from"./QSelect-Be43hUbp.js";import{b as C,c as x}from"./QMenu-CYWZacx5.js";import{a as F,Q as I}from"./QBtnDropdown-Z2YnYe5Z.js";import{Q as w}from"./QBadge-B2UBVuyr.js";import{Q as U}from"./QTooltip-D5D2BeRv.js";import{Q as z}from"./QSpinnerDots-BG1nATjk.js";import{Q as q}from"./QMarkupTable-CW74thjj.js";import{Q as L}from"./QPagination-CdhOHYnj.js";import{Q as j}from"./QPage-B2ndozRg.js";import{C as B}from"./ClosePopup-CR_8lpfC.js";import"./format-CjUnP1ns.js";import"./QBtnGroup-CE-Al57M.js";const D={name:"SlimsPage",data(){return{showExtra:!1,slims:[],loading:!1,page:1,perPage:10,meta:{current_page:1,last_page:1,total:0,from:0,to:0},search:"",onlyPendientes:!1}},mounted(){this.onlyPendientes=String(this.$route.query.only_pendientes||"")==="1",this.fetchSlims()},watch:{"$route.query.only_pendientes"(a){this.onlyPendientes=String(a||"")==="1",this.goFirstPage()}},methods:{visibleShow(){this.showExtra=!this.showExtra},nombrePersona(a){return a&&[a.denunciante_nombres??a.denunciado_nombres??a.nombres,a.denunciante_paterno??a.paterno,a.denunciante_materno??a.materno].filter(Boolean).join(" ")||"—"},fmt(a){return(a??"")!==""?a:"—"},fmtFecha(a){if(!a)return"—";try{const e=new Date(String(a).replace(" ","T")),_=String(e.getDate()).padStart(2,"0"),g=String(e.getMonth()+1).padStart(2,"0"),o=e.getFullYear();return`${_}/${g}/${o}`}catch{return a}},imprimir(){this.$axios.get("/slimsImprimir").then(a=>{const e=new Blob([a.data],{type:"application/pdf"}),_=document.createElement("a");_.href=window.URL.createObjectURL(e),_.download="slims.pdf",_.click(),window.URL.revokeObjectURL(_.href)}).catch(a=>this.$alert.error(a.response?.data?.message||"Error imprimiendo SLIMs"))},fetchSlims(){this.loading=!0,this.$axios.get("/casos",{params:{q:this.search||"",tipo:"SLIM",page:this.page,per_page:this.perPage,only_pendientes:this.onlyPendientes?1:0}}).then(a=>{const e=a.data||{};this.slims=e.data||[],this.meta={current_page:e.current_page||1,last_page:e.last_page||1,total:e.total||0,from:e.from||0,to:e.to||0},this.page=this.meta.current_page}).catch(a=>this.$alert.error(a.response?.data?.message||"Error cargando SLIMs")).finally(()=>{this.loading=!1})},onSearch(){this.page=1,this.fetchSlims()},clearSearch(){this.search="",this.onSearch()},goFirstPage(){this.page=1,this.fetchSlims()},rowIndex(a){return(this.meta.from||0)+a}}},N={class:"row items-center q-col-gutter-md q-mb-md"},R={class:"col-12 col-md"},M={class:"col-auto"},T={class:"col-auto"},A={class:"col-auto"},J={key:0},O={key:1},Z={key:2},W={key:3},Y={key:4},G={key:5},H={key:6},K={key:7},X={key:8},$={key:9},ee={key:10},te={key:11},oe={key:0},se=["onClick"],ne={class:"text-no-wrap"},re={class:"text-no-wrap"},ae={class:"text-weight-medium"},ie={key:0,class:"text-caption text-grey-7"},le={class:"text-weight-medium"},de={key:0,class:"text-caption text-grey-7"},ue={key:1,class:"text-grey-6"},me={key:0},he={key:1},_e={key:2},pe={key:3},ce={key:4},ge={key:5},ye={key:6},fe={key:7},xe={key:8},we={key:9},ke={key:10,class:"ellipsis-2-lines"},be={key:11},Ee={key:1},Se={key:2},Pe={colspan:"9",class:"text-center"},Qe={class:"row items-center justify-between q-mt-md"},Ve={class:"text-caption text-grey-7"};function ve(a,e,_,g,o,d){return s(),c(j,{class:"q-pa-md"},{default:h(()=>[n("div",N,[n("div",R,[u(E,{modelValue:o.search,"onUpdate:modelValue":[e[0]||(e[0]=t=>o.search=t),d.onSearch],outlined:"",dense:"",debounce:"400",placeholder:"Buscar por N° SLIM, denunciante, denunciado, tipología, zona…"},{prepend:h(()=>[u(f,{name:"search"})]),append:h(()=>[o.search?(s(),c(y,{key:0,flat:"",dense:"",round:"",icon:"close",onClick:d.clearSearch},null,8,["onClick"])):l("",!0)]),_:1},8,["modelValue","onUpdate:modelValue"])]),n("div",M,[u(S,{modelValue:o.onlyPendientes,"onUpdate:modelValue":[e[1]||(e[1]=t=>o.onlyPendientes=t),d.goFirstPage],color:"primary",label:"Solo mis pendientes"},null,8,["modelValue","onUpdate:modelValue"])]),n("div",T,[u(v,{modelValue:o.perPage,"onUpdate:modelValue":[e[2]||(e[2]=t=>o.perPage=t),d.goFirstPage],options:[10,20,50],dense:"",outlined:"",style:{width:"120px"},label:"Por página"},null,8,["modelValue","onUpdate:modelValue"])]),n("div",A,[u(y,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",onClick:e[3]||(e[3]=t=>d.fetchSlims()),loading:o.loading,size:"10px"},null,8,["loading"]),u(F,{label:"Visualizar Casos",color:"green",icon:"visibility","no-caps":"",size:"10px"},{default:h(()=>[u(I,null,{default:h(()=>[P((s(),c(C,{clickable:"",onClick:d.visibleShow},{default:h(()=>[u(x,{avatar:""},{default:h(()=>[u(f,{name:"visibility"})]),_:1}),u(x,null,{default:h(()=>e[5]||(e[5]=[m("Vizualizar Casos")])),_:1})]),_:1},8,["onClick"])),[[Q],[B]])]),_:1})]),_:1})])]),u(q,{flat:"",bordered:"",dense:""},{default:h(()=>[n("thead",null,[n("tr",null,[e[6]||(e[6]=n("th",{style:{width:"60px"}},"#",-1)),e[7]||(e[7]=n("th",null,"Nº ",-1)),e[8]||(e[8]=n("th",null,"Fecha",-1)),e[9]||(e[9]=n("th",null,"Denunciante",-1)),e[10]||(e[10]=n("th",null,"Denunciado",-1)),e[11]||(e[11]=n("th",null,"Tipología",-1)),e[12]||(e[12]=n("th",null,"Zona",-1)),e[13]||(e[13]=n("th",null,"Estado",-1)),e[14]||(e[14]=n("th",null,"Alerta",-1)),o.showExtra?(s(),r("th",J,"Víctima (NNA)")):l("",!0),o.showExtra?(s(),r("th",O,"Resp. Legal")):l("",!0),o.showExtra?(s(),r("th",Z,"Resp. Psicológico")):l("",!0),o.showExtra?(s(),r("th",W,"Resp. T. Social")):l("",!0),o.showExtra?(s(),r("th",Y,"CUD")):l("",!0),o.showExtra?(s(),r("th",G,"NUREJ")):l("",!0),o.showExtra?(s(),r("th",H,"Juzgado")):l("",!0),o.showExtra?(s(),r("th",K,"Fiscalía a Resp.")):l("",!0),o.showExtra?(s(),r("th",X,"Estado actual del proceso")):l("",!0),o.showExtra?(s(),r("th",$,"Fecha Sentencia")):l("",!0),o.showExtra?(s(),r("th",ee,"Observación")):l("",!0),o.showExtra?(s(),r("th",te,"F. Entrega al Juzgado")):l("",!0)])]),!o.loading&&o.slims.length?(s(),r("tbody",oe,[(s(!0),r(p,null,V(o.slims,(t,k)=>(s(),r("tr",{key:t.id,onClick:Ce=>a.$router.push("/casos/"+t.id),class:"cursor-pointer"},[n("td",null,i(d.rowIndex(k)),1),n("td",ne,i(t.tipo)+" "+i(t.caso_numero||"—"),1),n("td",re,i(a.$filters.date(t.fecha_apertura_caso)),1),n("td",null,[n("div",ae,i(t.denunciantes[0].denunciante_nombres==null?"—":t.denunciantes[0].denunciante_nombres+" "+(t.denunciantes[0].denunciante_paterno||"")+" "+(t.denunciantes[0].denunciante_materno||"")),1),t.denunciantes[0].denunciante_nro?(s(),r("div",ie,"CI: "+i(t.denunciantes[0].denunciante_nro),1)):l("",!0)]),n("td",null,[n("div",le,i(t.denunciados[0]?.denunciado_nombres==null?"—":t.denunciados[0]?.denunciado_nombres+" "+(t.denunciados[0]?.denunciado_paterno||"")+" "+(t.denunciados[0]?.denunciado_materno||"")),1),t.denunciados[0]?.denunciado_nro?(s(),r("div",de,"CI: "+i(t.denunciados[0]?.denunciado_nro),1)):l("",!0)]),n("td",null,i(t.caso_tipologia||"—"),1),n("td",null,i(t.zona||"—"),1),n("td",null,i(t.estado_caso||"—"),1),n("td",null,[t.mi_estado?.me_asignado?(s(),r(p,{key:0},[t.mi_estado.primer_informe_hecho?(s(),c(w,{key:0,color:"green","text-color":"white",class:"q-mr-xs"},{default:h(()=>[m(i(t.mi_estado.label_listo||"Primer informe listo"),1)]),_:2},1024)):(s(),r(p,{key:1},[u(w,{color:t.mi_estado.atrasado?"red":"orange","text-color":t.mi_estado.atrasado?"white":"black",class:"q-mr-xs"},{default:h(()=>[t.mi_estado.atrasado?(s(),r(p,{key:0},[m(" Atrasado "+i(Math.abs(t.mi_estado.dias_restantes))+" d ",1)],64)):(s(),r(p,{key:1},[m(" Faltan "+i(t.mi_estado.dias_restantes)+" d ",1)],64))]),_:2},1032,["color","text-color"]),u(U,{"transition-show":"jump-down","transition-hide":"jump-up"},{default:h(()=>[e[15]||(e[15]=m(" Debes cargar tu ")),n("b",null,i(t.mi_estado.rol==="Psicologo"?"primera sesión":"primer informe"),1),e[16]||(e[16]=m(".")),e[17]||(e[17]=n("br",null,null,-1)),e[18]||(e[18]=m(" Fecha límite: ")),n("b",null,i(t.mi_estado.deadline),1),e[19]||(e[19]=m(". "))]),_:2},1024)],64))],64)):(s(),r("span",ue,"—"))]),o.showExtra?(s(),r("td",me,"—")):l("",!0),o.showExtra?(s(),r("td",he,i(t.legal_user?.name??"—"),1)):l("",!0),o.showExtra?(s(),r("td",_e,i(t.psicologica_user?.name??"—"),1)):l("",!0),o.showExtra?(s(),r("td",pe,i(t.trabajo_social_user?.name??"—"),1)):l("",!0),o.showExtra?(s(),r("td",ce,i(d.fmt(t.cud)),1)):l("",!0),o.showExtra?(s(),r("td",ge,i(d.fmt(t.nurej)),1)):l("",!0),o.showExtra?(s(),r("td",ye,i(d.fmt(t.numero_juzgado)),1)):l("",!0),o.showExtra?(s(),r("td",fe,i(d.fmt(t.responsable_fiscalia)),1)):l("",!0),o.showExtra?(s(),r("td",xe,i(d.fmt(t.estado_caso||t.estado_caso_otro)),1)):l("",!0),o.showExtra?(s(),r("td",we,i(d.fmtFecha(t.fecha_sentencia)),1)):l("",!0),o.showExtra?(s(),r("td",ke,i(d.fmt(t.observaciones)),1)):l("",!0),o.showExtra?(s(),r("td",be,i(t.numero_apoyo_integral?d.fmtFecha(t.fecha_entrega_juzgado||t.fecha_derivacion_area_legal):"—"),1)):l("",!0)],8,se))),128))])):!o.loading&&!o.slims.length?(s(),r("tbody",Ee,e[20]||(e[20]=[n("tr",null,[n("td",{colspan:"9",class:"text-center text-grey"}," No hay resultados para tu búsqueda. ")],-1)]))):(s(),r("tbody",Se,[n("tr",null,[n("td",Pe,[u(z,{size:"24px",class:"q-mr-sm"}),e[21]||(e[21]=m(" Cargando… "))])])]))]),_:1}),n("div",Qe,[n("div",Ve,[e[22]||(e[22]=m(" Mostrando ")),n("b",null,i(o.meta.from||0),1),e[23]||(e[23]=m(" – ")),n("b",null,i(o.meta.to||0),1),e[24]||(e[24]=m(" de ")),n("b",null,i(o.meta.total||0),1),e[25]||(e[25]=m(" registros "))]),u(L,{modelValue:o.page,"onUpdate:modelValue":[e[4]||(e[4]=t=>o.page=t),d.fetchSlims],max:o.meta.last_page||1,"max-pages":"10","boundary-numbers":"","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])])]),_:1})}const Ae=b(D,[["render",ve],["__scopeId","data-v-25ac6776"]]);export{Ae as default};
