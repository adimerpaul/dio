import{_ as P,a0 as i,o as n,a as d,w as c,b as e,a6 as S,c as p,$ as h,f as g,d as V,a7 as v,ag as F,a1 as m,a2 as b,t as o,Z as u,Q as D,e as Q,a8 as I,W as q,h as z}from"./index-dOWFJ4BU.js";import{Q as E}from"./QSelect-Ctp9WErU.js";import{Q as f}from"./QBadge-Bobcq-YY.js";import{Q as C}from"./QTooltip-DUZe-q__.js";import{Q as k}from"./QMarkupTable-DbO2vvWm.js";import{Q as T}from"./QPagination-DsBGn5kX.js";import{Q as U}from"./QPage-bdGzpsIs.js";import{C as j}from"./ClosePopup-B5cthfrm.js";const B={name:"CasoTable",props:{tipo:{type:String,required:!0},leerOnlyPendientesDeRuta:{type:Boolean,default:!0},placeholder:{type:String,default:""},perPageInit:{type:Number,default:10}},data(){return{dialogFormat:!1,casos:[],loading:!1,page:1,perPage:this.perPageInit,meta:{current_page:1,last_page:1,total:0,from:0,to:0},search:"",onlyPendientes:!1,showExtra:!1}},computed:{isSLIM(){return String(this.tipo).toUpperCase()==="SLIM"},placeholderComputed(){return this.placeholder?this.placeholder:`Buscar por N° ${this.tipo?.toUpperCase()||"CASO"}, denunciante, denunciado, tipología, zona…`},baseColspan(){return this.isSLIM&&this.showExtra?21:9}},mounted(){this.leerOnlyPendientesDeRuta&&(this.onlyPendientes=String(this.$route?.query?.only_pendientes||"")==="1"),this.fetchCasos()},watch:{"$route.query.only_pendientes"(s){this.leerOnlyPendientesDeRuta&&(this.onlyPendientes=String(s||"")==="1",this.goFirstPage())}},methods:{openDialogFormat(){this.dialogFormat=!0},refresh(){this.fetchCasos()},fetchCasos(){this.loading=!0,this.$axios.get("/casos",{params:{q:this.search||"",tipo:this.tipo,page:this.page,per_page:this.perPage,only_pendientes:this.onlyPendientes?1:0}}).then(s=>{const a=s.data||{};this.casos=a.data||[],this.meta={current_page:a.current_page||1,last_page:a.last_page||1,total:a.total||0,from:a.from||0,to:a.to||0},this.page=this.meta.current_page}).catch(s=>this.$alert?.error?.(s.response?.data?.message||"Error cargando casos")||console.error(s)).finally(()=>{this.loading=!1})},onSearch(){this.page=1,this.fetchCasos()},clearSearch(){this.search="",this.onSearch()},goFirstPage(){this.page=1,this.fetchCasos()},rowIndex(s){return(this.meta.from||0)+s},goToDetalle(s){this.$router.push("/casos/"+s.id)},nombrePersona(s,a="denunciante"){return s&&(a==="denunciante"?[s.denunciante_nombres,s.denunciante_paterno,s.denunciante_materno]:[s.denunciado_nombres,s.denunciado_paterno,s.denunciado_materno]).filter(Boolean).join(" ")||"—"},fmt(s){return(s??"")!==""?s:"—"},fmtFecha(s){if(!s)return"—";try{const a=new Date(String(s).replace(" ","T")),_=String(a.getDate()).padStart(2,"0"),x=String(a.getMonth()+1).padStart(2,"0"),r=a.getFullYear();return`${_}/${x}/${r}`}catch{return s}}}},M={class:"row items-center q-col-gutter-md q-mb-md"},N={class:"col-12 col-md"},A={class:"col-auto"},L={class:"col-auto"},O={class:"col-auto row items-center"},R={key:0},Z=["onClick"],J={class:"text-no-wrap"},W={class:"text-no-wrap"},Y={class:"text-weight-medium"},G={key:0,class:"text-caption text-grey-7"},H={class:"text-weight-medium"},K={key:0,class:"text-caption text-grey-7"},X={key:1,class:"text-grey-6"},$={class:"row items-center justify-between q-mt-md"},ee={class:"text-caption text-grey-7"},te=["onClick"],ae={class:"text-no-wrap"},oe={class:"text-no-wrap"},se={class:"text-weight-medium"},le={key:0,class:"text-caption text-grey-7"},ne={class:"text-weight-medium"},re={key:0,class:"text-caption text-grey-7"},ie={key:1,class:"text-grey-6"},de={class:"col-extra"},ue={class:"col-extra"},ce={class:"col-extra"},me={class:"col-extra"},he={class:"col-extra"},_e={class:"col-extra"},pe={class:"col-extra"},ge={class:"col-extra"},fe={class:"col-extra"},xe={class:"col-extra ellipsis-2-lines"},ye={class:"col-extra"};function be(s,a,_,x,r,l){return n(),i(m,null,[d(U,{class:"q-pa-md"},{default:c(()=>[e("div",M,[e("div",N,[d(S,{modelValue:r.search,"onUpdate:modelValue":[a[0]||(a[0]=t=>r.search=t),l.onSearch],outlined:"",dense:"",debounce:"400",placeholder:l.placeholderComputed},{prepend:c(()=>[d(V,{name:"search"})]),append:c(()=>[r.search?(n(),p(g,{key:0,flat:"",dense:"",round:"",icon:"close",onClick:l.clearSearch},null,8,["onClick"])):h("",!0)]),_:1},8,["modelValue","placeholder","onUpdate:modelValue"])]),e("div",A,[d(v,{modelValue:r.onlyPendientes,"onUpdate:modelValue":[a[1]||(a[1]=t=>r.onlyPendientes=t),l.goFirstPage],color:"primary",label:"Solo mis pendientes"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",L,[d(E,{modelValue:r.perPage,"onUpdate:modelValue":[a[2]||(a[2]=t=>r.perPage=t),l.goFirstPage],options:[10,20,50],dense:"",outlined:"",style:{width:"120px"},label:"Por página"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",O,[d(g,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",onClick:a[3]||(a[3]=t=>l.fetchCasos()),loading:r.loading,class:"q-mr-sm",size:"10px"},null,8,["loading"]),l.isSLIM?(n(),p(g,{key:0,color:"green",icon:"visibility","no-caps":"",size:"10px",labelx:r.showExtra?"Ocultar columnas extra":"Visualizar Casos/Estado",label:"Visualizar Casos/Estado",onClick:l.openDialogFormat},null,8,["labelx","onClick"])):h("",!0),F(s.$slots,"actions",{},void 0,!0)])]),d(k,{flat:"",bordered:"",dense:""},{default:c(()=>[a[11]||(a[11]=e("thead",null,[e("tr",null,[e("th",{style:{width:"60px"}},"#"),e("th",null,"Nº"),e("th",null,"Fecha"),e("th",null,"Denunciante"),e("th",null,"Denunciado"),e("th",null,"Tipología"),e("th",null,"Zona"),e("th",null,"Estado"),e("th",null,"Alerta")])],-1)),!r.loading&&r.casos.length?(n(),i("tbody",R,[(n(!0),i(m,null,b(r.casos,(t,y)=>(n(),i("tr",{key:t.id,onClick:w=>l.goToDetalle(t),class:"cursor-pointer"},[e("td",null,o(l.rowIndex(y)),1),e("td",J,o(_.tipo)+" "+o(t.caso_numero||"—"),1),e("td",W,o(s.$filters.date?.(t.fecha_apertura_caso)??t.fecha_apertura_caso),1),e("td",null,[e("div",Y,o(l.nombrePersona(t.denunciantes?.[0],"denunciante")),1),t.denunciantes?.[0]?.denunciante_nro?(n(),i("div",G," CI: "+o(t.denunciantes?.[0]?.denunciante_nro),1)):h("",!0)]),e("td",null,[e("div",H,o(l.nombrePersona(t.denunciados?.[0],"denunciado")),1),t.denunciados?.[0]?.denunciado_nro?(n(),i("div",K," CI: "+o(t.denunciados?.[0]?.denunciado_nro),1)):h("",!0)]),e("td",null,o(t.caso_tipologia||"—"),1),e("td",null,o(t.zona||"—"),1),e("td",null,o(t.estado_caso||"—"),1),e("td",null,[t.mi_estado?.me_asignado?(n(),i(m,{key:0},[t.mi_estado.primer_informe_hecho?(n(),p(f,{key:0,color:"green","text-color":"white",class:"q-mr-xs"},{default:c(()=>[u(o(t.mi_estado.label_listo||"Primer informe listo"),1)]),_:2},1024)):(n(),i(m,{key:1},[d(f,{color:t.mi_estado.atrasado?"red":"orange","text-color":t.mi_estado.atrasado?"white":"black",class:"q-mr-xs"},{default:c(()=>[t.mi_estado.atrasado?(n(),i(m,{key:0},[u(" Atrasado "+o(Math.abs(t.mi_estado.dias_restantes))+" d ",1)],64)):(n(),i(m,{key:1},[u(" Faltan "+o(t.mi_estado.dias_restantes)+" d ",1)],64))]),_:2},1032,["color","text-color"]),d(C,{"transition-show":"jump-down","transition-hide":"jump-up"},{default:c(()=>[a[6]||(a[6]=u(" Debes cargar tu ")),e("b",null,o(t.mi_estado.rol==="Psicologo"?"primera sesión":"primer informe"),1),a[7]||(a[7]=u(".")),a[8]||(a[8]=e("br",null,null,-1)),a[9]||(a[9]=u(" Fecha límite: ")),e("b",null,o(t.mi_estado.deadline),1),a[10]||(a[10]=u(". "))]),_:2},1024)],64))],64)):(n(),i("span",X,"—"))])],8,Z))),128))])):h("",!0)]),_:1}),e("div",$,[e("div",ee,[a[12]||(a[12]=u(" Mostrando ")),e("b",null,o(r.meta.from||0),1),a[13]||(a[13]=u(" – ")),e("b",null,o(r.meta.to||0),1),a[14]||(a[14]=u(" de ")),e("b",null,o(r.meta.total||0),1),a[15]||(a[15]=u(" registros "))]),d(T,{modelValue:r.page,"onUpdate:modelValue":[a[4]||(a[4]=t=>r.page=t),l.fetchCasos],max:r.meta.last_page||1,"max-pages":"10","boundary-numbers":"","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])])]),_:3}),d(z,{modelValue:r.dialogFormat,"onUpdate:modelValue":a[5]||(a[5]=t=>r.dialogFormat=t),persistent:"",maximized:""},{default:c(()=>[d(D,null,{default:c(()=>[d(Q,null,{default:c(()=>a[16]||(a[16]=[e("div",{class:"text-h6"},"Visualizar Casos/Estado",-1)])),_:1}),d(k,{flat:"",bordered:"",dense:""},{default:c(()=>[a[23]||(a[23]=e("thead",null,[e("tr",null,[e("th",{style:{width:"60px"}},"#"),e("th",null,"Nº"),e("th",null,"Fecha"),e("th",null,"Denunciante"),e("th",null,"Denunciado"),e("th",null,"Tipología"),e("th",null,"Zona"),e("th",null,"Estado"),e("th",null,"Alerta"),e("th",{class:"col-extra"},"—"),e("th",{class:"col-extra"},"Legal"),e("th",{class:"col-extra"},"Psicológica"),e("th",{class:"col-extra"},"Trabajo Social"),e("th",{class:"col-extra"},"CUD"),e("th",{class:"col-extra"},"NUREJ"),e("th",{class:"col-extra"},"Juzgado"),e("th",{class:"col-extra"},"Fiscal"),e("th",{class:"col-extra"},"Estado (Legal)"),e("th",{class:"col-extra"},"Fecha Sentencia"),e("th",{class:"col-extra"},"Observaciones"),e("th",{class:"col-extra"},"Entrega/Derivación")])],-1)),e("tbody",null,[(n(!0),i(m,null,b(r.casos,(t,y)=>(n(),i("tr",{key:t.id,onClick:w=>l.goToDetalle(t),class:"cursor-pointer"},[e("td",null,o(l.rowIndex(y)),1),e("td",ae,o(_.tipo)+" "+o(t.caso_numero||"—"),1),e("td",oe,o(s.$filters.date?.(t.fecha_apertura_caso)??t.fecha_apertura_caso),1),e("td",null,[e("div",se,o(l.nombrePersona(t.denunciantes?.[0],"denunciante")),1),t.denunciantes?.[0]?.denunciante_nro?(n(),i("div",le," CI: "+o(t.denunciantes?.[0]?.denunciante_nro),1)):h("",!0)]),e("td",null,[e("div",ne,o(l.nombrePersona(t.denunciados?.[0],"denunciado")),1),t.denunciados?.[0]?.denunciado_nro?(n(),i("div",re," CI: "+o(t.denunciados?.[0]?.denunciado_nro),1)):h("",!0)]),e("td",null,o(t.caso_tipologia||"—"),1),e("td",null,o(t.zona||"—"),1),e("td",null,o(t.estado_caso||"—"),1),e("td",null,[t.mi_estado?.me_asignado?(n(),i(m,{key:0},[t.mi_estado.primer_informe_hecho?(n(),p(f,{key:0,color:"green","text-color":"white",class:"q-mr-xs"},{default:c(()=>[u(o(t.mi_estado.label_listo||"Primer informe listo"),1)]),_:2},1024)):(n(),i(m,{key:1},[d(f,{color:t.mi_estado.atrasado?"red":"orange","text-color":t.mi_estado.atrasado?"white":"black",class:"q-mr-xs"},{default:c(()=>[t.mi_estado.atrasado?(n(),i(m,{key:0},[u(" Atrasado "+o(Math.abs(t.mi_estado.dias_restantes))+" d ",1)],64)):(n(),i(m,{key:1},[u(" Faltan "+o(t.mi_estado.dias_restantes)+" d ",1)],64))]),_:2},1032,["color","text-color"]),d(C,{"transition-show":"jump-down","transition-hide":"jump-up"},{default:c(()=>[a[17]||(a[17]=u(" Debes cargar tu ")),e("b",null,o(t.mi_estado.rol==="Psicologo"?"primera sesión":"primer informe"),1),a[18]||(a[18]=u(".")),a[19]||(a[19]=e("br",null,null,-1)),a[20]||(a[20]=u(" Fecha límite: ")),e("b",null,o(t.mi_estado.deadline),1),a[21]||(a[21]=u(". "))]),_:2},1024)],64))],64)):(n(),i("span",ie,"—"))]),a[22]||(a[22]=e("td",{class:"col-extra"},"—",-1)),e("td",de,o(t.legal_user?.name??"—"),1),e("td",ue,o(t.psicologica_user?.name??"—"),1),e("td",ce,o(t.trabajo_social_user?.name??"—"),1),e("td",me,o(l.fmt(t.cud)),1),e("td",he,o(l.fmt(t.nurej)),1),e("td",_e,o(l.fmt(t.numero_juzgado)),1),e("td",pe,o(l.fmt(t.responsable_fiscalia)),1),e("td",ge,o(l.fmt(t.estado_caso||t.estado_caso_otro)),1),e("td",fe,o(l.fmtFecha(t.fecha_sentencia)),1),e("td",xe,o(l.fmt(t.observaciones)),1),e("td",ye,o(t.numero_apoyo_integral?l.fmtFecha(t.fecha_entrega_juzgado||t.fecha_derivacion_area_legal):"—"),1)],8,te))),128))])]),_:1}),d(I,{align:"right"},{default:c(()=>[q(d(g,{flat:"",label:"Cerrar",color:"primary"},null,512),[[j]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const De=P(B,[["render",be],["__scopeId","data-v-bf4b5adc"]]);export{De as C};
