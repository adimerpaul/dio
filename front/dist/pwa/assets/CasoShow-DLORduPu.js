import{_ as B,Y as M,a0 as N,o as u,b as l,a as t,$ as C,a1 as oe,c as g,f as v,w as n,e as O,a6 as p,Q as A,d as D,a3 as V,a7 as qe,a9 as _e,t as f,a2 as fe,Z as y,h as ie,W as x,a8 as J,j as Oe,n as Re,p as we,aa as ke,k as xe,x as Le,l as G,m as Ve,L as Me,O as Pe,g as $e,ab as Fe,a5 as je}from"./index-C0cTRvy_.js";import{b as S,c as h,d as Ee,Q as ge}from"./QMenu-C13egf3R.js";import{Q as Ne,a as ve}from"./QBtnDropdown-r2DlWouY.js";import{S as be,Q as Ae,a as Ie,b as Ue,c as Ge,d as ee,e as ze,f as Y}from"./QBar-CjyJfF9l.js";import{Q as Be}from"./QPage-Dyl3MRJG.js";import{C as I}from"./ClosePopup-DK-43CQL.js";import{Q as Z}from"./QSelect-B_m3uMCm.js";import{M as He}from"./MapPicker-CHj4nC_c.js";import{Q as Se}from"./QBadge-Bu1W1g6s.js";import{Q as Qe}from"./QPagination-Cp-m5TuC.js";import{Q as X}from"./QSpace-BId3ySqY.js";import{Q as Ce}from"./QMarkupTable-CSSgmBXi.js";import{Q as Ye}from"./QImg-BOZFLvBA.js";import{a as ye,Q as We}from"./QTable-NMeVwdlW.js";import{S as Ze}from"./SlimNuevo-DbM2DGjZ.js";import{D as Je}from"./DnaNuevo-CmfNuqPx.js";import{S as Xe}from"./SlamNuevo-C6mbW-ZH.js";import{N as Ke}from"./UmadisNuevo-BUdngh08.js";import{C as eo}from"./PropremisNuevo-DdFnRkCE.js";import"./format-D7agTbas.js";import"./QResizeObserver-BztSLgav.js";import"./touch-BjYP5sR0.js";import"./QTooltip-D285bqBO.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./QExpansionItem-mYm6iA7L.js";import"./QForm-BCg0LP1K.js";import"./moment-C5S46NFB.js";const oo={name:"InfoGeneral",components:{MapPicker:He},props:{caseId:{type:[String,Number],required:!0}},data(){return{documentos:[{label:"Carnet de identidad",value:"Carnet de identidad"},{label:"Pasaporte",value:"Pasaporte"},{label:"Libreta de servicio militar",value:"Libreta de servicio militar"},{label:"Libreta de conducir",value:"Libreta de conducir"}],sexos:[{label:"Masculino",value:"Masculino"},{label:"Femenino",value:"Femenino"},{label:"Otro",value:"Otro"}],estadosCiviles:[{label:"Soltero/a",value:"Soltero/a"},{label:"Casado/a",value:"Casado/a"},{label:"Divorciado/a",value:"Divorciado/a"},{label:"Viudo/a",value:"Viudo/a"},{label:"Unión libre",value:"Unión libre"}],loading:!1,editing:!1,form:{},backup:null,oruroCenter:[-17.9667,-67.1167]}},computed:{denunciantePos:{get(){return{latitud:this.form.latitud,longitud:this.form.longitud}},set(i){this.form.latitud=i.latitud,this.form.longitud=i.longitud}},denunciadoPos:{get(){return{latitud:this.form.denunciado_latitud,longitud:this.form.denunciado_longitud}},set(i){this.form.denunciado_latitud=i.latitud,this.form.denunciado_longitud=i.longitud}},role(){return this.$store.user?.role||""}},created(){this.fetch()},methods:{req(i){return!!i||"Requerido"},async fetch(){this.loading=!0;try{const i=await this.$axios.get(`/casos/${this.caseId}`);this.form={...i.data},this.backup={...this.form}}catch(i){this.$alert.error(i?.response?.data?.message||"No se pudo cargar el caso")}finally{this.loading=!1}},startEdit(){this.editing=!0,this.backup={...this.form}},cancelEdit(){this.form={...this.backup},this.editing=!1,this.$q.notify({type:"info",message:"Cambios descartados"})},async save(){this.loading=!0;try{const i=await this.$axios.put(`/casos/${this.caseId}`,this.form);this.form={...i.data.data},this.backup={...this.form},this.editing=!1,this.$alert.success("Información general actualizada")}catch(i){this.$alert.error(i?.response?.data?.message||"No se pudo actualizar")}finally{this.loading=!1}}}},io={class:"row items-center q-mb-sm"},to={class:"col-auto row q-gutter-sm"},lo={class:"row q-col-gutter-md"},ao={class:"col-12 col-md-3"},no={class:"col-12 col-md-3"},so={class:"col-12 col-md-6"},ro={class:"col-12 col-md-4"},co={class:"col-12 col-md-4"},uo={class:"col-12"},mo={class:"row q-col-gutter-md"},fo={class:"col-12 col-md-2"},po={class:"col-12 col-md-2"},_o={class:"col-12 col-md-2"},go={class:"col-12 col-md-2"},vo={class:"col-12 col-md-2"},ho={class:"col-6 col-md-3"},bo={class:"col-6 col-md-3"},yo={class:"col-6 col-md-3"},xo={class:"col-6 col-md-3"},Io={class:"col-6 col-md-3"},Co={class:"col-6 col-md-3"},wo={class:"col-6 col-md-3"},Eo={class:"col-6 col-md-3"},Do={class:"col-6 col-md-3"},Vo={class:"col-6 col-md-3"},No={class:"col-6 col-md-3"},Ao={class:"col-12 col-md-3"},So={class:"col-12 col-md-3"},Oo={class:"col-12"},ko={class:"col-12"},Uo={class:"row q-col-gutter-md"},To={class:"col-12 col-md-6"},qo={class:"col-6 col-md-3"},Ro={class:"col-6 col-md-3"},Lo={class:"col-6 col-md-3"},Mo={class:"col-6 col-md-3"},Po={class:"col-6 col-md-3"},$o={class:"col-6 col-md-3"},Fo={class:"col-6 col-md-3"},jo={class:"col-6 col-md-3"},Go={class:"col-6 col-md-3"},zo={class:"col-12"},Bo={class:"col-12"},Ho={class:"row q-col-gutter-md"},Qo={class:"col-12 col-md-2"},Yo={class:"col-12 col-md-2"},Wo={class:"col-12 col-md-2"},Zo={class:"col-12 col-md-2"},Jo={class:"col-12 col-md-2"},Xo={class:"col-12 col-md-2"};function Ko(i,e,r,c,o,d){const a=M("MapPicker");return u(),N("div",null,[l("div",io,[e[46]||(e[46]=l("div",{class:"col"},[l("div",{class:"text-subtitle1 text-weight-medium"},"Información General")],-1)),l("div",to,[d.role==="Administrador"||d.role==="Asistente"?(u(),N(oe,{key:0},[o.editing?(u(),N(oe,{key:1},[t(v,{flat:"",color:"negative",icon:"close",label:"Cancelar",onClick:d.cancelEdit,loading:o.loading},null,8,["onClick","loading"]),t(v,{color:"primary",icon:"save",label:"Guardar",onClick:d.save,loading:o.loading},null,8,["onClick","loading"])],64)):(u(),g(v,{key:0,color:"primary",icon:"edit",label:"Editar",onClick:d.startEdit,loading:o.loading},null,8,["onClick","loading"]))],64)):C("",!0)])]),t(A,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:n(()=>[t(O,null,{default:n(()=>[l("div",lo,[l("div",ao,[t(p,{modelValue:o.form.caso_numero,"onUpdate:modelValue":e[0]||(e[0]=s=>o.form.caso_numero=s),readonly:!0,dense:"",outlined:"",clearable:"",label:"Nro de caso"},null,8,["modelValue"])]),l("div",no,[t(p,{modelValue:o.form.caso_fecha_hecho,"onUpdate:modelValue":e[1]||(e[1]=s=>o.form.caso_fecha_hecho=s),readonly:!o.editing,type:"date",dense:"",outlined:"",label:"Fecha del hecho"},null,8,["modelValue","readonly"])]),l("div",so,[t(p,{modelValue:o.form.caso_lugar_hecho,"onUpdate:modelValue":e[2]||(e[2]=s=>o.form.caso_lugar_hecho=s),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Lugar del hecho"},null,8,["modelValue","readonly"])]),l("div",ro,[t(p,{modelValue:o.form.caso_tipologia,"onUpdate:modelValue":e[3]||(e[3]=s=>o.form.caso_tipologia=s),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Tipología"},null,8,["modelValue","readonly"])]),l("div",co,[t(p,{modelValue:o.form.caso_modalidad,"onUpdate:modelValue":e[4]||(e[4]=s=>o.form.caso_modalidad=s),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Modalidad"},null,8,["modelValue","readonly"])]),l("div",uo,[t(p,{modelValue:o.form.caso_descripcion,"onUpdate:modelValue":e[5]||(e[5]=s=>o.form.caso_descripcion=s),readonly:!o.editing,type:"textarea",autogrow:"",outlined:"",dense:"",clearable:"",label:"Descripción del hecho",counter:"",maxlength:"3000"},null,8,["modelValue","readonly"])])])]),_:1})]),_:1}),t(A,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:n(()=>[t(O,{class:"row items-center"},{default:n(()=>[t(D,{name:"assignment_ind",class:"q-mr-sm"}),e[47]||(e[47]=l("div",{class:"text-subtitle1 text-weight-medium"},"Denunciante",-1))]),_:1}),t(V),t(O,null,{default:n(()=>[l("div",mo,[l("div",fo,[t(Z,{modelValue:o.form.area,"onUpdate:modelValue":e[6]||(e[6]=s=>o.form.area=s),dense:"",outlined:"",readonly:!o.editing,options:i.$areas,label:"Área *",rules:[d.req]},null,8,["modelValue","readonly","options","rules"])]),l("div",po,[t(Z,{modelValue:o.form.zona,"onUpdate:modelValue":e[7]||(e[7]=s=>o.form.zona=s),dense:"",outlined:"",readonly:!o.editing,options:i.$zonas,label:"Zona *",rules:[d.req]},null,8,["modelValue","readonly","options","rules"])]),l("div",_o,[t(p,{modelValue:o.form.denunciante_nombres,"onUpdate:modelValue":e[8]||(e[8]=s=>o.form.denunciante_nombres=s),dense:"",outlined:"",clearable:"",readonly:!o.editing,label:"Nombres *",rules:[d.req]},null,8,["modelValue","readonly","rules"])]),l("div",go,[t(p,{modelValue:o.form.denunciante_paterno,"onUpdate:modelValue":e[9]||(e[9]=s=>o.form.denunciante_paterno=s),dense:"",outlined:"",clearable:"",readonly:!o.editing,label:"Apellido paterno"},null,8,["modelValue","readonly"])]),l("div",vo,[t(p,{modelValue:o.form.denunciante_materno,"onUpdate:modelValue":e[10]||(e[10]=s=>o.form.denunciante_materno=s),dense:"",outlined:"",clearable:"",readonly:!o.editing,label:"Apellido materno"},null,8,["modelValue","readonly"])]),l("div",ho,[t(p,{modelValue:o.form.denunciante_lugar_nacimiento,"onUpdate:modelValue":e[11]||(e[11]=s=>o.form.denunciante_lugar_nacimiento=s),dense:"",outlined:"",clearable:"",label:"Lugar de nacimiento",readonly:!o.editing},null,8,["modelValue","readonly"])]),l("div",bo,[t(p,{modelValue:o.form.denunciante_fecha_nacimiento,"onUpdate:modelValue":[e[12]||(e[12]=s=>o.form.denunciante_fecha_nacimiento=s),e[13]||(e[13]=s=>{if(s){const m=new Date(s),k=Date.now()-m.getTime(),U=new Date(k);this.form.denunciante_edad=Math.abs(U.getUTCFullYear()-1970)}else this.form.denunciante_edad=""})],type:"date",dense:"",outlined:"",label:"Fecha de nacimiento",readonly:!o.editing},null,8,["modelValue","readonly"])]),l("div",yo,[t(p,{modelValue:o.form.denunciante_edad,"onUpdate:modelValue":e[14]||(e[14]=s=>o.form.denunciante_edad=s),modelModifiers:{number:!0},dense:"",outlined:"",type:"number",label:"Edad",readonly:!o.editing},null,8,["modelValue","readonly"])]),l("div",xo,[t(p,{modelValue:o.form.denunciante_telefono,"onUpdate:modelValue":e[15]||(e[15]=s=>o.form.denunciante_telefono=s),dense:"",outlined:"",clearable:"",label:"Teléfono/Celular",readonly:!o.editing},null,8,["modelValue","readonly"])]),l("div",Io,[t(p,{modelValue:o.form.denunciante_grado,"onUpdate:modelValue":e[16]||(e[16]=s=>o.form.denunciante_grado=s),dense:"",outlined:"",clearable:"",label:"Grado de instrucción",readonly:!o.editing},null,8,["modelValue","readonly"])]),l("div",Co,[t(p,{modelValue:o.form.denunciante_documento,"onUpdate:modelValue":e[17]||(e[17]=s=>o.form.denunciante_documento=s),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Documento"},null,8,["modelValue","readonly"])]),l("div",wo,[t(p,{modelValue:o.form.denunciante_nro,"onUpdate:modelValue":e[18]||(e[18]=s=>o.form.denunciante_nro=s),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Nro documento"},null,8,["modelValue","readonly"])]),l("div",Eo,[t(p,{modelValue:o.form.denunciante_sexo,"onUpdate:modelValue":e[19]||(e[19]=s=>o.form.denunciante_sexo=s),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Sexo"},null,8,["modelValue","readonly"])]),l("div",Do,[t(p,{modelValue:o.form.denunciante_estado_civil,"onUpdate:modelValue":e[20]||(e[20]=s=>o.form.denunciante_estado_civil=s),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Estado civil"},null,8,["modelValue","readonly"])]),l("div",Vo,[t(p,{modelValue:o.form.denunciante_residencia,"onUpdate:modelValue":e[21]||(e[21]=s=>o.form.denunciante_residencia=s),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Residencia"},null,8,["modelValue","readonly"])]),l("div",No,[t(p,{modelValue:o.form.denunciante_idioma,"onUpdate:modelValue":e[22]||(e[22]=s=>o.form.denunciante_idioma=s),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Idioma"},null,8,["modelValue","readonly"])]),l("div",Ao,[t(qe,{modelValue:o.form.denunciante_trabaja,"onUpdate:modelValue":e[23]||(e[23]=s=>o.form.denunciante_trabaja=s),disable:!o.editing,label:"Trabaja"},null,8,["modelValue","disable"])]),l("div",So,[t(p,{modelValue:o.form.denunciante_ocupacion,"onUpdate:modelValue":e[24]||(e[24]=s=>o.form.denunciante_ocupacion=s),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Ocupación"},null,8,["modelValue","readonly"])]),l("div",Oo,[t(p,{modelValue:o.form.denunciante_domicilio_actual,"onUpdate:modelValue":e[25]||(e[25]=s=>o.form.denunciante_domicilio_actual=s),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Domicilio actual"},null,8,["modelValue","readonly"])]),l("div",ko,[e[48]||(e[48]=l("div",{class:"text-caption text-grey-7 q-mb-xs"},"Ubicación (denunciante)",-1)),t(a,{modelValue:d.denunciantePos,"onUpdate:modelValue":e[26]||(e[26]=s=>d.denunciantePos=s),center:o.oruroCenter},null,8,["modelValue","center"])])])]),_:1})]),_:1}),t(A,{flat:"",bordered:"",class:"section-card q-mb-xl"},{default:n(()=>[t(O,{class:"row items-center"},{default:n(()=>[t(D,{name:"person_pin_circle",class:"q-mr-sm"}),e[49]||(e[49]=l("div",{class:"text-subtitle1 text-weight-medium"},"Denunciado",-1))]),_:1}),t(V),t(O,null,{default:n(()=>[l("div",Uo,[l("div",To,[t(p,{modelValue:o.form.denunciado_nombre_completo,"onUpdate:modelValue":e[27]||(e[27]=s=>o.form.denunciado_nombre_completo=s),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Nombre completo"},null,8,["modelValue","readonly"])]),l("div",qo,[t(Z,{modelValue:o.form.denunciado_documento,"onUpdate:modelValue":e[28]||(e[28]=s=>o.form.denunciado_documento=s),dense:"",outlined:"",readonly:!o.editing,"emit-value":"","map-options":"",options:o.documentos,label:"Documento"},null,8,["modelValue","readonly","options"])]),l("div",Ro,[t(p,{modelValue:o.form.denunciado_nro,"onUpdate:modelValue":e[29]||(e[29]=s=>o.form.denunciado_nro=s),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Nro documento"},null,8,["modelValue","readonly"])]),l("div",Lo,[t(p,{modelValue:o.form.denunciado_sexo,"onUpdate:modelValue":e[30]||(e[30]=s=>o.form.denunciado_sexo=s),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Sexo"},null,8,["modelValue","readonly"])]),l("div",Mo,[t(p,{modelValue:o.form.denunciado_lugar_nacimiento,"onUpdate:modelValue":e[31]||(e[31]=s=>o.form.denunciado_lugar_nacimiento=s),dense:"",outlined:"",clearable:"",label:"Lugar de nacimiento"},null,8,["modelValue"])]),l("div",Po,[t(p,{modelValue:o.form.denunciado_fecha_nacimiento,"onUpdate:modelValue":[e[32]||(e[32]=s=>o.form.denunciado_fecha_nacimiento=s),e[33]||(e[33]=s=>{if(s){const m=new Date(s),k=Date.now()-m.getTime(),U=new Date(k);this.form.denunciado_edad=Math.abs(U.getUTCFullYear()-1970)}else this.form.denunciado_edad=""})],type:"date",dense:"",outlined:"",label:"Fecha de nacimiento"},null,8,["modelValue"])]),l("div",$o,[t(p,{modelValue:o.form.denunciado_edad,"onUpdate:modelValue":e[34]||(e[34]=s=>o.form.denunciado_edad=s),modelModifiers:{number:!0},dense:"",outlined:"",type:"number",label:"Edad"},null,8,["modelValue"])]),l("div",Fo,[t(p,{modelValue:o.form.denunciado_telefono,"onUpdate:modelValue":e[35]||(e[35]=s=>o.form.denunciado_telefono=s),dense:"",outlined:"",clearable:"",label:"Teléfono/Celular"},null,8,["modelValue"])]),l("div",jo,[t(p,{modelValue:o.form.denunciado_grado,"onUpdate:modelValue":e[36]||(e[36]=s=>o.form.denunciado_grado=s),dense:"",outlined:"",clearable:"",label:"Grado de instrucción"},null,8,["modelValue"])]),l("div",Go,[t(p,{modelValue:o.form.denunciado_residencia,"onUpdate:modelValue":e[37]||(e[37]=s=>o.form.denunciado_residencia=s),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Residencia"},null,8,["modelValue","readonly"])]),l("div",zo,[t(p,{modelValue:o.form.denunciado_domicilio_actual,"onUpdate:modelValue":e[38]||(e[38]=s=>o.form.denunciado_domicilio_actual=s),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Domicilio actual"},null,8,["modelValue","readonly"])]),l("div",Bo,[e[50]||(e[50]=l("div",{class:"text-caption text-grey-7 q-mb-xs"},"Ubicación (denunciado)",-1)),t(a,{modelValue:d.denunciadoPos,"onUpdate:modelValue":e[39]||(e[39]=s=>d.denunciadoPos=s),center:o.oruroCenter},null,8,["modelValue","center"])])])]),_:1}),t(O,null,{default:n(()=>[l("div",Ho,[l("div",Qo,[t(_e,{modelValue:o.form.documento_fotocopia_carnet_denunciante,"onUpdate:modelValue":e[40]||(e[40]=s=>o.form.documento_fotocopia_carnet_denunciante=s),label:"Fotocopia CI denunciante","false-value":"0","true-value":"1"},null,8,["modelValue"])]),l("div",Yo,[t(_e,{modelValue:o.form.documento_fotocopia_carnet_denunciado,"onUpdate:modelValue":e[41]||(e[41]=s=>o.form.documento_fotocopia_carnet_denunciado=s),label:"Fotocopia CI denunciado","false-value":"0","true-value":"1"},null,8,["modelValue"])]),l("div",Wo,[t(_e,{modelValue:o.form.documento_placas_fotograficas_domicilio_denunciante,"onUpdate:modelValue":e[42]||(e[42]=s=>o.form.documento_placas_fotograficas_domicilio_denunciante=s),label:"Placas fotográficas domicilio denunciante","false-value":"0","true-value":"1"},null,8,["modelValue"])]),l("div",Zo,[t(_e,{modelValue:o.form.documento_croquis_direccion_denunciado,"onUpdate:modelValue":e[43]||(e[43]=s=>o.form.documento_croquis_direccion_denunciado=s),label:"Croquis dirección denunciado","false-value":"0","true-value":"1"},null,8,["modelValue"])]),l("div",Jo,[t(_e,{modelValue:o.form.documento_placas_fotograficas_domicilio_denunciado,"onUpdate:modelValue":e[44]||(e[44]=s=>o.form.documento_placas_fotograficas_domicilio_denunciado=s),label:"Placas fotográficas domicilio denunciado","false-value":"0","true-value":"1"},null,8,["modelValue"])]),l("div",Xo,[t(_e,{modelValue:o.form.documento_ciudadania_digital,"onUpdate:modelValue":e[45]||(e[45]=s=>o.form.documento_ciudadania_digital=s),label:"Ciudadanía digital","false-value":"0","true-value":"1"},null,8,["modelValue"])])])]),_:1})]),_:1})])}const ei=B(oo,[["render",Ko],["__scopeId","data-v-71a690e4"]]),oi={name:"Problematica",props:{caseId:{type:[String,Number],required:!0},canEdit:{type:Boolean,default:!0}},data(){return{loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dialog:!1,mode:"create",form:{id:null,fecha:"",titulo:"",detalle:"",acciones_inmediatas:"",observaciones:""}}},watch:{caseId(){this.resetAndFetch()},search(){this.page=1,this.fetchRows()}},created(){this.fetchRows()},methods:{resetAndFetch(){this.page=1,this.fetchRows()},today(){const i=new Date,e=r=>String(r).padStart(2,"0");return`${i.getFullYear()}-${e(i.getMonth()+1)}-${e(i.getDate())}`},async fetchRows(){if(this.caseId){this.loading=!0;try{const i=await this.$axios.get(`/casos/${this.caseId}/problematicas`,{params:{q:this.search,page:this.page,per_page:this.perPage}});this.rows=i.data,this.rows.data||(this.rows.data=[])}catch(i){this.$q.notify({type:"negative",message:i?.response?.data?.message||"Error cargando problemática"})}finally{this.loading=!1}}},openCreate(){this.mode="create",this.form={id:null,fecha:this.today(),titulo:"",detalle:"",acciones_inmediatas:"",observaciones:""},this.dialog=!0},openView(i){this.mode="view",this.form={...i},this.dialog=!0},openEdit(i){this.mode="edit",this.form={...i},this.dialog=!0},async save(){if(!this.form.titulo){this.$q.notify({type:"negative",message:"El título es obligatorio"});return}this.saving=!0;try{this.form.id?await this.$axios.put(`/problematicas/${this.form.id}`,this.form):await this.$axios.post(`/casos/${this.caseId}/problematicas`,this.form),this.dialog=!1,this.$q.notify({type:"positive",message:"Guardado"}),this.fetchRows(),this.$emit("changed")}catch(i){this.$q.notify({type:"negative",message:i?.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}},remove(i){const e=async()=>{try{await this.$axios.delete(`/problematicas/${i.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.fetchRows(),this.$emit("changed")}catch(r){this.$q.notify({type:"negative",message:r?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar registro?").onOk(e):confirm("¿Eliminar registro?")&&e()},print(i){const e=this.$axios.defaults.baseURL+`/problematicas/${i.id}/pdf`;window.open(e,"_blank")}}},ii={class:"row items-center q-gutter-sm q-mb-sm"},ti={class:"col"},li={class:"text-caption text-grey-7"},ai={class:"col-auto row items-center q-gutter-sm"},ni={class:"row justify-end q-mt-sm"},si={class:"text-subtitle1"},di={class:"row q-col-gutter-md"},ri={class:"col-12 col-md-4"},ci={class:"col-12 col-md-8"},ui={class:"col-12"},mi={class:"col-12"},fi={class:"col-12"};function pi(i,e,r,c,o,d){return u(),g(A,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[l("div",ii,[l("div",ti,[e[8]||(e[8]=l("div",{class:"text-subtitle1 text-weight-medium"},"Problemática",-1)),l("div",li,"Registros vinculados al caso #"+f(r.caseId),1)]),l("div",ai,[t(p,{dense:"",outlined:"",modelValue:o.search,"onUpdate:modelValue":e[0]||(e[0]=a=>o.search=a),placeholder:"Buscar...",style:{width:"260px"}},{append:n(()=>[t(D,{name:"search"})]),_:1},8,["modelValue"]),r.canEdit?(u(),g(v,{key:0,color:"primary",icon:"add_circle",label:"Nueva",onClick:d.openCreate},null,8,["onClick"])):C("",!0),t(v,{flat:"",color:"primary",icon:"refresh",onClick:d.fetchRows,loading:o.loading},null,8,["onClick","loading"])])]),t(V),t(Ne,{bordered:"",separator:"",class:"q-mt-sm"},{default:n(()=>[(u(!0),N(oe,null,fe(o.rows.data,a=>(u(),g(S,{key:a.id},{default:n(()=>[t(h,null,{default:n(()=>[t(Ee,{class:"text-weight-medium"},{default:n(()=>[y(f(a.titulo),1)]),_:2},1024),t(Ee,{caption:"",class:"ellipsis-2-lines"},{default:n(()=>[y(f((a.detalle||"").slice(0,220)),1)]),_:2},1024),t(Ee,{caption:""},{default:n(()=>[t(Se,{outline:"",color:"blue-7",class:"q-mr-xs"},{default:n(()=>[y(f(a.fecha||"s/f"),1)]),_:2},1024),t(Se,{outline:"",color:"grey-7"},{default:n(()=>[y("Por: "+f(a.user?.name||a.user?.username||"—"),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(h,{side:"",top:""},{default:n(()=>[t(v,{dense:"",flat:"",icon:"visibility",onClick:s=>d.openView(a)},null,8,["onClick"]),r.canEdit?(u(),g(v,{key:0,dense:"",flat:"",icon:"edit",color:"primary",onClick:s=>d.openEdit(a)},null,8,["onClick"])):C("",!0),r.canEdit?(u(),g(v,{key:1,dense:"",flat:"",icon:"delete",color:"negative",onClick:s=>d.remove(a)},null,8,["onClick"])):C("",!0),t(v,{color:"red",outline:"",label:"Imprimir",onClick:s=>d.print(a)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),!o.rows.data.length&&!o.loading?(u(),g(S,{key:0},{default:n(()=>[t(h,null,{default:n(()=>e[9]||(e[9]=[y("Sin resultados")])),_:1})]),_:1})):C("",!0)]),_:1}),l("div",ni,[t(Qe,{modelValue:o.page,"onUpdate:modelValue":e[1]||(e[1]=a=>o.page=a),max:o.rows.last_page||1,"boundary-numbers":"","direction-links":"",onInput:d.fetchRows},null,8,["modelValue","max","onInput"])]),t(ie,{modelValue:o.dialog,"onUpdate:modelValue":e[7]||(e[7]=a=>o.dialog=a),persistent:""},{default:n(()=>[t(A,{style:{"min-width":"720px","max-width":"95vw"}},{default:n(()=>[t(O,{class:"row items-center"},{default:n(()=>[l("div",si,f(o.mode==="view"?"Detalle de Problemática":o.form.id?"Editar Problemática":"Nueva Problemática"),1),t(X),x(t(v,{flat:"",round:"",dense:"",icon:"close"},null,512),[[I]])]),_:1}),t(V),t(O,null,{default:n(()=>[l("div",di,[l("div",ri,[t(p,{modelValue:o.form.fecha,"onUpdate:modelValue":e[2]||(e[2]=a=>o.form.fecha=a),type:"date",dense:"",outlined:"",label:"Fecha",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),l("div",ci,[t(p,{modelValue:o.form.titulo,"onUpdate:modelValue":e[3]||(e[3]=a=>o.form.titulo=a),dense:"",outlined:"",label:"Problemática principal *",readonly:o.mode==="view",rules:[a=>!!a||"Requerido"]},null,8,["modelValue","readonly","rules"])]),l("div",ui,[t(p,{modelValue:o.form.detalle,"onUpdate:modelValue":e[4]||(e[4]=a=>o.form.detalle=a),type:"textarea",autogrow:"",outlined:"",dense:"",label:"Detalle / antecedentes",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),l("div",mi,[t(p,{modelValue:o.form.acciones_inmediatas,"onUpdate:modelValue":e[5]||(e[5]=a=>o.form.acciones_inmediatas=a),type:"textarea",autogrow:"",outlined:"",dense:"",label:"Acciones inmediatas y realizadas",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),l("div",fi,[t(p,{modelValue:o.form.observaciones,"onUpdate:modelValue":e[6]||(e[6]=a=>o.form.observaciones=a),type:"textarea",autogrow:"",outlined:"",dense:"",label:"Observaciones",readonly:o.mode==="view"},null,8,["modelValue","readonly"])])])]),_:1}),t(V),t(J,{align:"right"},{default:n(()=>[x(t(v,{flat:"",label:"Cerrar"},null,512),[[I]]),o.mode!=="view"?(u(),g(v,{key:0,color:"primary",label:"Guardar",loading:o.saving,onClick:d.save},null,8,["loading","onClick"])):C("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const _i=B(oi,[["render",pi],["__scopeId","data-v-b7455962"]]),gi={name:"SesionesPsicologico",emits:["refresh"],props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:null}},data(){return{openSubirArchivo:!1,file:null,loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dialog:!1,mode:"create",form:{id:null,fecha:"",titulo:"",duracion_min:null,lugar:"",tipo:"Individual",contenido_html:""},plantilla:null,plantillasOptions:[{label:"Consentimiento informado",value:"consentimiento"},{label:"Informe Psicológico (formato DIO)",value:"informe_dio"},{label:"Acta de sesión (DIO)",value:"acta"}]}},watch:{caseId(){this.page=1,this.fetchRows()},search(){this.page=1,this.fetchRows()}},created(){},methods:{guardarInforme(){if(!this.file){this.$q.notify({type:"negative",message:"Seleccione un archivo"});return}if(!this.form.titulo){this.$q.notify({type:"negative",message:"El título es obligatorio"});return}const i=new FormData;i.append("titulo",this.form.titulo),i.append("file",this.file),this.saving=!0,this.$axios.post(`/casos/${this.caseId}/sesiones-psicologicas/upload`,i,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{this.$q.notify({type:"positive",message:"Informe subido"}),this.openSubirArchivo=!1,this.file=null,this.form.titulo="",this.$emit("refresh")}).catch(e=>{this.$q.notify({type:"negative",message:e?.response?.data?.message||"No se pudo subir el informe"})}).finally(()=>{this.saving=!1})},onFileChange(i){this.file=i},today(){const i=new Date,e=r=>String(r).padStart(2,"0");return`${i.getFullYear()}-${e(i.getMonth()+1)}-${e(i.getDate())}`},async fetchRows(){if(this.caseId){this.loading=!0;try{const i=await this.$axios.get(`/casos/${this.caseId}/sesiones-psicologicas`,{params:{q:this.search,page:this.page,per_page:this.perPage}});this.rows=i.data||{data:[],last_page:1}}catch(i){this.$q.notify({type:"negative",message:i?.response?.data?.message||"Error cargando sesiones"})}finally{this.loading=!1}}},openSubirInforme(){this.openSubirArchivo=!0},openCreate(){this.mode="create",this.plantilla="consentimiento",this.form={id:null,fecha:this.today(),titulo:"",duracion_min:null,lugar:"",tipo:"Individual",contenido_html:""},this.dialog=!0,this.$nextTick(()=>this.applyTemplate("consentimiento"))},openView(i){this.mode="view",this.form={...i},this.dialog=!0},openEdit(i){this.mode="edit",this.form={...i},this.dialog=!0},applyTemplate(i){if(this.mode==="view")return;const e=this.caso||{},r={nombres:e.denunciante_nombres||e.denunciante_nombre_completo||"",apellidos:[e.denunciante_paterno,e.denunciante_materno].filter(Boolean).join(" "),edad:e.denunciante_edad||"",fecha_nacimiento:e.denunciante_fecha_nacimiento||"",lugar_nacimiento:e.denunciante_lugar_nacimiento||"",grado:e.denunciante_grado||"",ocupacion:e.denunciante_ocupacion_exacto||e.denunciante_ocupacion||"",domicilio:e.denunciante_domicilio_actual||e.denunciante_residencia||"",documento:e.denunciante_documento||"Carnet de identidad",nro:e.denunciante_nro||"",telefono:e.denunciante_telefono||e.denunciante_movil||e.denunciante_fijo||"",estado_civil:e.denunciante_estado_civil||""};for(let E=1;E<=5;E++)e[`familiar${E}_nombre_completo`],e[`familiar${E}_edad`],e[`familiar${E}_parentesco`],e[`familiar${E}_celular`];const c=(this.form.fecha||this.today()).slice(0,4),o=e.caso_numero&&String(e.caso_numero).trim()!==""?String(e.caso_numero):`${String(this.caseId).padStart(2,"0")}/${c}`,d=e.legal_user?.name||e.legal_user?.username||"",a=e.psicologica_user?.name||e.psicologica_user?.username||this.$store?.state?.user?.name||"",s=e.caso_tipologia||e.caso_modalidad?`Evaluación psicológica en el marco de presunta(s) ${[e.caso_tipologia,e.caso_modalidad].filter(Boolean).join(" / ")}.`:"Evaluación psicológica para determinar los efectos emocionales y psicológicos en la evaluada.",m=(()=>{const E=e.caso_fecha_hecho?`el ${e.caso_fecha_hecho}`:"en fecha no precisada",q=[e.caso_lugar_hecho,e.caso_zona,e.caso_direccion].filter(Boolean).join(", "),F=q?`, en ${q}`:"",j=e.caso_descripcion?` ${e.caso_descripcion}`:"";return`Según la apertura del caso, el hecho habría ocurrido ${E}${F}.${j}`})(),k=["Entrevista clínica y observación conductual","Aplicación de instrumentos psicométricos según pertinencia (Goldberg, IES-R, Rosenberg)"].join("; ")+".",U=[e.violencia_fisica?"violencia física":null,e.violencia_psicologica?"violencia psicológica":null,e.violencia_sexual?"violencia sexual":null,e.violencia_economica?"violencia económica/patrimonial":null].filter(Boolean),P="Se evidencian reacciones emocionales congruentes con el evento referido, con impacto en el equilibrio afectivo y la autoestima."+(U.length?` Se consideran indicadores asociados a ${U.join(", ")}.`:"")+" No se evidencian signos de psicosis. Se sugiere seguimiento clínico y contención.",$=["Intervención psicológica: terapia focalizada en manejo de ansiedad/estrés y fortalecimiento de recursos personales.","Orientación/asesoramiento legal para evitar revictimización y garantizar medidas de protección, si corresponde."].join(" "),T={casoId:this.caseId,fecha:this.form.fecha||this.today(),titulo:this.form.titulo||"Sesión psicológica",lugar:this.form.lugar||"",tipo:this.form.tipo||"Individual",nombre:e.denunciantes[0]?.denunciante_nombres||r.denunciante_paterno+" "+r.denunciante_materno||"—",documento:e.denunciantes[0]?.denunciante_documento||r.documento,numeroCaso:o,abogadoNombre:d,psicologoNombre:a,denunciante:{nombres:e.denunciantes[0].denunciante_nombres||r.nombres||"—",apellidos:e.denunciantes[0].denunciante_apellidos||r.apellidos||"—",edad:e.denunciantes[0].denunciante_edad||r.edad||"—",fecha_nacimiento:e.denunciantes[0].denunciante_fecha_nacimiento||r.fecha_nacimiento||"—",lugar_nacimiento:e.denunciantes[0].denunciante_lugar_nacimiento||r.lugar_nacimiento||"—",grado:e.denunciantes[0].denunciante_grado||r.grado||"—",ocupacion:e.denunciantes[0].denunciante_ocupacion_exacto||e.denunciantes[0].denunciante_ocupacion||r.ocupacion||"—",domicilio:e.denunciantes[0].denunciante_domicilio_actual||e.denunciantes[0].denunciante_residencia||r.domicilio||"—",documento:e.denunciantes[0].denunciante_documento||r.documento},familiares:e.familiares,motivo:s,antecedentes:m,tecnicas:k,conclusiones:P,recomendaciones:$};i==="acta"?this.form.contenido_html=be.acta(T):i==="informe"?this.form.contenido_html=be.informe(T):i==="constancia"?this.form.contenido_html=be.constancia(T):i==="consentimiento"?this.form.contenido_html=be.consentimiento(T):i==="informe_dio"&&(this.form.contenido_html=be.informe_dio(T))},async save(){if(!this.form.titulo){this.$q.notify({type:"negative",message:"El título es obligatorio"});return}if(!this.form.contenido_html){this.$q.notify({type:"negative",message:"El contenido está vacío"});return}this.saving=!0;try{this.form.id?await this.$axios.put(`/sesiones-psicologicas/${this.form.id}`,this.form):await this.$axios.post(`/casos/${this.caseId}/sesiones-psicologicas`,this.form),this.$q.notify({type:"positive",message:"Guardado"}),this.dialog=!1,this.$emit("refresh")}catch(i){this.$q.notify({type:"negative",message:i?.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}},remove(i){const e=async()=>{try{await this.$axios.delete(`/sesiones-psicologicas/${i.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.$emit("refresh")}catch(r){this.$q.notify({type:"negative",message:r?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar la sesión?").onOk(e):confirm("¿Eliminar la sesión?")&&e()},printPdf(i){const e=this.$url||"";window.open(`${e}/sesiones-psicologicas/${i.id}/pdf`,"_blank")}}},vi={class:"row items-center q-mb-sm"},hi={class:"col"},bi={class:"text-caption text-grey-7"},yi={class:"col-auto row items-center q-gutter-sm"},xi={class:"text-grey-8"},Ii={key:0},Ci={class:"text-subtitle1"},wi={class:"row"},Ei={class:"col-12 col-md-3"},Di={class:"col-12 col-md-5"},Vi={class:"col-6 col-md-2"},Ni={class:"col-6 col-md-2"},Ai={class:"col-12"},Si={key:0};function Oi(i,e,r,c,o,d){return u(),g(A,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[l("div",vi,[l("div",hi,[e[12]||(e[12]=l("div",{class:"text-subtitle1 text-weight-medium"},"Sesiones (Psicológico)",-1)),l("div",bi,"Vinculadas al caso #"+f(r.caseId),1)]),l("div",yi,[t(v,{flat:"",color:"primary",icon:"refresh",loading:o.loading,onClick:e[0]||(e[0]=a=>i.$emit("refresh"))},null,8,["loading"]),t(v,{color:"green",icon:"add_circle_outline","no-caps":"",label:"Crear Informe",onClick:d.openCreate},null,8,["onClick"]),t(v,{color:"primary",icon:"upload","no-caps":"",label:"Subir informe",onClick:d.openSubirInforme},null,8,["onClick"])])]),t(V),t(Ce,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:n(()=>[e[18]||(e[18]=l("thead",null,[l("tr",{class:"bg-primary text-white"},[l("th",{style:{width:"70px"}},"ID"),l("th",{style:{width:"140px"}},"Acciones"),l("th",null,"Título"),l("th",{style:{width:"120px"}},"Fecha"),l("th",{style:{width:"120px"}},"Tipo"),l("th",{style:{width:"180px"}},"Usuario")])],-1)),l("tbody",null,[(u(!0),N(oe,null,fe(r.caso.psicologicas,a=>(u(),N("tr",{key:a.id},[l("td",xi,"#"+f(a.id),1),l("td",null,[t(ve,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:n(()=>[x((u(),g(S,{clickable:"",onClick:s=>d.openView(a)},{default:n(()=>[t(h,{avatar:""},{default:n(()=>[t(D,{name:"visibility"})]),_:1}),t(h,null,{default:n(()=>e[13]||(e[13]=[y("Ver")])),_:1})]),_:2},1032,["onClick"])),[[I]]),x((u(),g(S,{clickable:"",onClick:s=>d.printPdf(a)},{default:n(()=>[t(h,{avatar:""},{default:n(()=>[t(D,{name:"print"})]),_:1}),t(h,null,{default:n(()=>e[14]||(e[14]=[y("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[I]]),t(V),x((u(),g(S,{clickable:"",onClick:s=>d.openEdit(a)},{default:n(()=>[t(h,{avatar:""},{default:n(()=>[t(D,{name:"edit"})]),_:1}),t(h,null,{default:n(()=>e[15]||(e[15]=[y("Editar")])),_:1})]),_:2},1032,["onClick"])),[[I]]),x((u(),g(S,{clickable:"",onClick:s=>d.remove(a)},{default:n(()=>[t(h,{avatar:""},{default:n(()=>[t(D,{name:"delete",color:"negative"})]),_:1}),t(h,{class:"text-negative"},{default:n(()=>e[16]||(e[16]=[y("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[I]])]),_:2},1024)]),l("td",null,f(a.titulo),1),l("td",null,f(a.fecha||"s/f"),1),l("td",null,f(a.tipo||"—"),1),l("td",null,f(a.user?.name||a.user?.username||"—"),1)]))),128)),!r.caso.psicologicas||r.caso.psicologicas.length===0?(u(),N("tr",Ii,e[17]||(e[17]=[l("td",{colspan:"6",class:"text-center text-grey"},"Sin registros",-1)]))):C("",!0)])]),_:1}),t(ie,{modelValue:o.dialog,"onUpdate:modelValue":e[8]||(e[8]=a=>o.dialog=a),persistent:""},{default:n(()=>[t(A,{style:{"max-width":"900px",width:"95vw"}},{default:n(()=>[t(O,{class:"row items-center q-pb-none"},{default:n(()=>[l("div",Ci,f(o.mode==="view"?"Ver sesión":o.form.id?"Editar sesión":"Nueva sesión"),1),t(X),x(t(v,{flat:"",round:"",dense:"",icon:"close"},null,512),[[I]])]),_:1}),t(O,{class:"q-gutter-md"},{default:n(()=>[l("div",wi,[l("div",Ei,[t(p,{modelValue:o.form.fecha,"onUpdate:modelValue":e[1]||(e[1]=a=>o.form.fecha=a),type:"date",dense:"",outlined:"",label:"Fecha",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),l("div",Di,[t(p,{modelValue:o.form.titulo,"onUpdate:modelValue":e[2]||(e[2]=a=>o.form.titulo=a),dense:"",outlined:"",label:"Título *",readonly:o.mode==="view",rules:[a=>!!a||"Requerido"]},null,8,["modelValue","readonly","rules"])]),l("div",Vi,[t(p,{modelValue:o.form.duracion_min,"onUpdate:modelValue":e[3]||(e[3]=a=>o.form.duracion_min=a),modelModifiers:{number:!0},type:"number",dense:"",outlined:"",label:"Minutos",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),l("div",Ni,[t(p,{modelValue:o.form.tipo,"onUpdate:modelValue":e[4]||(e[4]=a=>o.form.tipo=a),dense:"",outlined:"",label:"Tipo",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),l("div",Ai,[t(p,{modelValue:o.form.lugar,"onUpdate:modelValue":e[5]||(e[5]=a=>o.form.lugar=a),dense:"",outlined:"",label:"Lugar",readonly:o.mode==="view"},null,8,["modelValue","readonly"])])]),o.mode!=="view"?(u(),N("div",Si,[t(Z,{modelValue:o.plantilla,"onUpdate:modelValue":[e[6]||(e[6]=a=>o.plantilla=a),d.applyTemplate],options:o.plantillasOptions,label:"Plantilla",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])])):C("",!0),l("div",null,[e[19]||(e[19]=l("div",{class:"text-caption text-grey-7 q-mb-xs"},"Contenido (WYSIWYG / se guarda HTML)",-1)),t(Ae,{modelValue:o.form.contenido_html,"onUpdate:modelValue":e[7]||(e[7]=a=>o.form.contenido_html=a),readonly:o.mode==="view","min-height":"320px",placeholder:"Escriba aquí el contenido de la sesión...",toolbar:[["left","center","right","justify"],["bold","italic","strike","underline"],["quote","unordered","ordered","outdent","indent"],["hr","link"],["undo","redo"],["removeFormat"]]},null,8,["modelValue","readonly"])])]),_:1}),t(V),t(J,{align:"right"},{default:n(()=>[x(t(v,{flat:"",label:"Cerrar"},null,512),[[I]]),o.mode!=="view"?(u(),g(v,{key:0,color:"primary",label:"Guardar",loading:o.saving,onClick:d.save},null,8,["loading","onClick"])):C("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ie,{modelValue:o.openSubirArchivo,"onUpdate:modelValue":e[11]||(e[11]=a=>o.openSubirArchivo=a),persistent:""},{default:n(()=>[t(A,{style:{"max-width":"500px",width:"90vw"}},{default:n(()=>[t(O,{class:"row items-center q-pb-none"},{default:n(()=>[e[20]||(e[20]=l("div",{class:"text-subtitle1"},"Subir informe",-1)),t(X),x(t(v,{flat:"",round:"",dense:"",icon:"close"},null,512),[[I]])]),_:1}),t(O,{class:"q-gutter-md"},{default:n(()=>[e[21]||(e[21]=l("div",{class:"text-body2 q-mb-sm"}," Aquí puede subir un informe psicológico ya elaborado (PDF, Word, etc.) y vincularlo al caso. ",-1)),t(p,{modelValue:o.form.titulo,"onUpdate:modelValue":e[9]||(e[9]=a=>o.form.titulo=a),dense:"",outlined:"",label:"Título del informe *",rules:[a=>!!a||"Requerido"]},null,8,["modelValue","rules"]),t(Ie,{modelValue:o.file,"onUpdate:modelValue":[e[10]||(e[10]=a=>o.file=a),d.onFileChange],label:"Seleccionar archivo",outlined:"",dense:"",accept:".pdf,.doc,.docx,.odt,.png,.jpg,.jpeg"},null,8,["modelValue","onUpdate:modelValue"]),t(v,{color:"primary",label:"Guardar",disabled:!o.file||!o.form.titulo,onClick:d.guardarInforme},null,8,["disabled","onClick"])]),_:1}),t(V),t(J,{align:"right"},{default:n(()=>[x(t(v,{flat:"",label:"Cerrar"},null,512),[[I]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ki=B(gi,[["render",Oi]]),De={psicologico({casoId:i,fecha:e,titulo:r,numero:c}){return`
<div style="border:1px solid #333;border-radius:6px;padding:12px;margin-bottom:12px;font-size:12px">
  <div style="display:flex;justify-content:space-between">
    <div>
      <div style="font-weight:700">DIRECCIÓN DE IGUALDAD DE OPORTUNIDADES (D.I.O.)</div>
      <div style="font-size:11px;color:#555">SERVICIO LEGAL INTEGRAL MUNICIPAL</div>
    </div>
    <div style="text-align:right;font-size:11px;color:#555">
      <div><b>Caso:</b> ${i}</div>
      <div><b>Fecha:</b> ${e}</div>
      <div><b>Nro. Informe:</b> ${c||"—"}</div>
    </div>
  </div>
</div>

<h4 style="margin:8px 0 4px 0;">${r||"INFORME PSICOLÓGICO"}</h4>

<h5 style="margin:10px 0 4px 0;">1. Datos personales</h5>
<p>...</p>

<h5 style="margin:10px 0 4px 0;">2. Motivo de consulta</h5>
<p>...</p>

<h5 style="margin:10px 0 4px 0;">3. Antecedentes</h5>
<p>...</p>

<h5 style="margin:10px 0 4px 0;">4. Técnicas e instrumentos empleados</h5>
<ul>
  <li>...</li>
</ul>

<h5 style="margin:10px 0 4px 0;">5. Resultados</h5>
<p>...</p>

<h5 style="margin:10px 0 4px 0;">6. Conclusiones</h5>
<p>...</p>

<h5 style="margin:10px 0 4px 0;">7. Recomendaciones</h5>
<ol>
  <li>...</li>
</ol>

<div style="margin-top:40px;display:flex;justify-content:space-between;font-size:12px;">
  <div style="text-align:center;width:45%;">
    <div>__________________________</div>
    <div>Profesional responsable</div>
  </div>
  <div style="text-align:center;width:45%;">
    <div>__________________________</div>
    <div>Vo.Bo.</div>
  </div>
</div>
    `},legal(i){const e=_=>_==null||_===""?"—":String(_),r=_=>_===!0||_===1||_==="1"?"Sí":_===!1||_===0||_==="0"?"No":"—",c=_=>{if(!_)return"—";const b=new Date(_);if(isNaN(b.getTime()))return e(_);const L=b.getFullYear(),Q=String(b.getMonth()+1).padStart(2,"0"),pe=String(b.getDate()).padStart(2,"0");return`${L}-${Q}-${pe}`},o=()=>{const _=new Date,b=_.getFullYear(),L=String(_.getMonth()+1).padStart(2,"0");return`${String(_.getDate()).padStart(2,"0")}/${L}/${b}`},d=(_={})=>[_.denunciante_nombres,_.denunciante_paterno,_.denunciante_materno].filter(Boolean).join(" ")||"—",a=(_={})=>[_.denunciado_nombres,_.denunciado_paterno,_.denunciado_materno].filter(Boolean).join(" ")||"—",s=i?.denunciantes&&i.denunciantes[0]?i.denunciantes[0]:{},m=i?.denunciados&&i.denunciados[0]?i.denunciados[0]:{},k=e(i?.principal||i?.caso_tipologia),U=r(i?.documento_ciudadania_digital),z=d(s),P=c(s?.denunciante_fecha_nacimiento),$=e(s?.denunciante_lugar_nacimiento),T=e(s?.denunciante_edad),E=e(s?.denunciante_nro),q=e(s?.denunciante_estado_civil),F=e(s?.denunciante_grado),j=e(s?.denunciante_residencia||s?.denunciante_domicilio_actual||i?.caso_direccion),H=e(s?.denunciante_ocupacion),K=e(s?.denunciante_telefono),R="—",te=a(m),le=c(m?.denunciado_fecha_nacimiento),ae=e(m?.denunciado_lugar_nacimiento),ne=e(m?.denunciado_edad),se=e(m?.denunciado_nro),de=e(m?.denunciado_estado_civil),re=e(m?.denunciado_grado),ce=e(m?.denunciado_residencia||m?.denunciado_domicilio_actual),ue=e(m?.denunciado_ocupacion),me=e(m?.denunciado_telefono),he="—",w=e(i?.legal_user?.name?`ABG. ${i.legal_user.name}`:"ABG.");return`
<div style="border:1px solid #333;border-radius:6px;padding:14px;margin-bottom:12px;font-size:13px; line-height:1.35">
  <div style="text-align:center; font-weight:700; font-size:16px; margin-bottom:10px">INFORME LEGAL</div>

  <div style="margin-bottom:10px">
    <div><b>A :</b> SEÑOR REPRESENTANTE DEL MINISTERIO PUBLICO</div>
    <div><b>DE :</b> ${w}</div>
  </div>

  <div style="margin:14px 0; font-weight:700">I. FORMULACION DE DENUNCIA</div>
  <div style="margin:14px 0; font-weight:700">II. FUNDAMENTO DEL HECHO</div>
  <div style="margin:14px 0; font-weight:700">III. FUNDAMENTO DE DERECHO</div>
  <div style="margin:14px 0; font-weight:700">IV. PETITORIO</div>
  <div style="margin:14px 0; font-weight:700">V. OTROSIS</div>

  <div style="margin:18px 0; font-weight:700">I. FORMULA DENUNCIA POR EL MOTIVO DE :</div>
  <div style="margin:6px 0 14px 0">${k}</div>

  <div style="margin:10px 0; font-weight:700">DATOS GENERALES DEL DENUNCIANTE :</div>
  <div><b>Nombres y Apellidos:</b> ${z}</div>
  <div><b>Fecha de Nacimiento:</b> ${P}</div>
  <div><b>Lugar de Nacimiento:</b> ${$}</div>
  <div><b>Edad:</b> ${T}</div>
  <div><b>C.I.:</b> ${E}</div>
  <div><b>Estado Civil:</b> ${q}</div>
  <div><b>Grado de Instrucción:</b> ${F}</div>
  <div><b>Dirección:</b> ${j}</div>
  <div><b>Ocupación:</b> ${H}</div>
  <div><b>Teléfono Celular:</b> ${K}</div>
  <div><b>Correo electrónico:</b> ${R}</div>
  <div><b>Ciudadanía Digital:</b> ${U}</div>

  <div style="margin:16px 0; font-weight:700">DATOS DEL DEMANDADO</div>
  <div><b>Nombres y Apellidos:</b> ${te}</div>
  <div><b>Fecha de Nacimiento:</b> ${le}</div>
  <div><b>Lugar de Nacimiento:</b> ${ae}</div>
  <div><b>Edad:</b> ${ne}</div>
  <div><b>C.I.:</b> ${se}</div>
  <div><b>Estado Civil:</b> ${de}</div>
  <div><b>Grado de Instrucción:</b> ${re}</div>
  <div><b>Dirección:</b> ${ce}</div>
  <div><b>Ocupación:</b> ${ue}</div>
  <div><b>Teléfono Celular:</b> ${me}</div>
  <div><b>Correo electrónico:</b> ${he}</div>

  <div style="margin:18px 0; font-weight:700">II. FUNDAMENTO DEL HECHO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">III. FUNDAMENTO DE DERECHO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">IV. PETITORIO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">V. OTROSIS</div>
  <p style="margin:6px 0">Por un derecho y protección a la Mujer…</p>

  <div style="margin-top:24px;">Oruro, ${o()}</div>

  <div style="margin-top:36px;text-align:center">
    __________________________<br>
    ${w}
  </div>
</div>
  `},social({casoId:i,fecha:e,titulo:r,numero:c}){return`
<div style="border:1px solid #333;border-radius:6px;padding:12px;margin-bottom:12px;font-size:12px">
  <div style="display:flex;justify-content:space-between">
    <div><div style="font-weight:700">D.I.O. — ÁREA SOCIAL</div></div>
    <div style="text-align:right;font-size:11px;color:#555">
      <div><b>Caso:</b> ${i}</div>
      <div><b>Fecha:</b> ${e}</div>
      <div><b>Nro. Informe:</b> ${c||"—"}</div>
    </div>
  </div>
</div>

<h4>${r||"INFORME SOCIAL"}</h4>

<h5>1. Datos de la familia</h5>
<p>...</p>

<h5>2. Visita domiciliaria / Observaciones del entorno</h5>
<p>...</p>

<h5>3. Situación socioeconómica</h5>
<p>...</p>

<h5>4. Conclusiones y recomendaciones</h5>
<p>...</p>

<div style="margin-top:36px;text-align:center">
  __________________________<br>
  Trabajadora Social
</div>
    `},dirigido_otros(i){const e=w=>w==null||w===""?"—":String(w),r=w=>w===!0||w===1||w==="1"?"Sí":w===!1||w===0||w==="0"?"No":"—",c=w=>{if(!w)return"—";const _=new Date(w);if(isNaN(_.getTime()))return e(w);const b=_.getFullYear(),L=String(_.getMonth()+1).padStart(2,"0"),Q=String(_.getDate()).padStart(2,"0");return`${b}-${L}-${Q}`},o=()=>{const w=new Date,_=w.getFullYear(),b=String(w.getMonth()+1).padStart(2,"0");return`${String(w.getDate()).padStart(2,"0")}/${b}/${_}`},d=(w={})=>[w.denunciante_nombres,w.denunciante_paterno,w.denunciante_materno].filter(Boolean).join(" ")||"—",a=(w={})=>[w.denunciado_nombres,w.denunciado_paterno,w.denunciado_materno].filter(Boolean).join(" ")||"—",s=i?.denunciantes&&i.denunciantes[0]?i.denunciantes[0]:{},m=i?.denunciados&&i.denunciados[0]?i.denunciados[0]:{},k=e(i?.principal||i?.caso_tipologia),U=r(i?.documento_ciudadania_digital),z=d(s),P=c(s?.denunciante_fecha_nacimiento),$=e(s?.denunciante_lugar_nacimiento||"ORURO"),T=e(s?.denunciante_edad),E=e(s?.denunciante_nro),q=e(s?.denunciante_estado_civil),F=e(s?.denunciante_grado),j=e(s?.denunciante_residencia||s?.denunciante_domicilio_actual||i?.caso_direccion||"ORURO"),H=e(s?.denunciante_ocupacion),K=e(s?.denunciante_telefono),R="—",te=a(m),le=c(m?.denunciado_fecha_nacimiento),ae=e(m?.denunciado_lugar_nacimiento||"ORURO"),ne=e(m?.denunciado_edad),se=e(m?.denunciado_nro),de=e(m?.denunciado_estado_civil),re=e(m?.denunciado_grado||"—"),ce=e(m?.denunciado_residencia||m?.denunciado_domicilio_actual||"ORURO"),ue=e(m?.denunciado_ocupacion||m?.denunciado_ocupacion_exacto||"—"),me=e(m?.denunciado_telefono||m?.denunciado_movil||m?.denunciado_fijo),he="—";return(i?.legal_user?.name||i?.user?.name||"Responsable").toString(),`
<div style="border:1px solid #333;border-radius:6px;padding:14px;margin-bottom:12px;font-size:13px;line-height:1.35">

  <div style="margin-bottom:10px">
    <div><b>A :</b> __________________________</div>
    <div><b>DE :</b> __________________________</div>
  </div>

  <div style="margin:14px 0; font-weight:700">I. FORMULACION DE DENUNCIA</div>
  <div style="margin:14px 0; font-weight:700">II. FUNDAMENTO DEL HECHO</div>
  <div style="margin:14px 0; font-weight:700">III. FUNDAMENTO DE DERECHO</div>
  <div style="margin:14px 0; font-weight:700">IV. PETITORIO</div>
  <div style="margin:14px 0; font-weight:700">V. OTROSIS</div>

  <div style="margin:18px 0; font-weight:700">I. FORMULA DENUNCIA POR EL MOTIVO DE :</div>
  <div style="margin:6px 0 14px 0">${k}</div>

  <div style="margin:10px 0; font-weight:700">DATOS GENERALES DEL DENUNCIANTE :</div>
  <div><b>Nombres y Apellidos:</b> ${z}</div>
  <div><b>Fecha de Nacimiento:</b> ${P}</div>
  <div><b>Lugar de Nacimiento:</b> ${$}</div>
  <div><b>Edad:</b> ${T}</div>
  <div><b>C.I.:</b> ${E}</div>
  <div><b>Estado Civil:</b> ${q}</div>
  <div><b>Grado de Instrucción:</b> ${F}</div>
  <div><b>Dirección:</b> ${j}</div>
  <div><b>Ocupación:</b> ${H}</div>
  <div><b>Teléfono Celular:</b> ${K}</div>
  <div><b>Correo electrónico:</b> ${R}</div>
  <div><b>Ciudadanía Digital:</b> ${U}</div>

  <div style="margin:16px 0; font-weight:700">DATOS DEL DEMANDADO</div>
  <div><b>Nombres y Apellidos:</b> ${te}</div>
  <div><b>Fecha de Nacimiento:</b> ${le}</div>
  <div><b>Lugar de Nacimiento:</b> ${ae}</div>
  <div><b>Edad:</b> ${ne}</div>
  <div><b>C.I.:</b> ${se}</div>
  <div><b>Estado Civil:</b> ${de}</div>
  <div><b>Grado de Instrucción:</b> ${re}</div>
  <div><b>Dirección:</b> ${ce}</div>
  <div><b>Ocupación:</b> ${ue}</div>
  <div><b>Teléfono Celular:</b> ${me}</div>
  <div><b>Correo electrónico:</b> ${he}</div>

  <div style="margin:18px 0; font-weight:700">II. FUNDAMENTO DEL HECHO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">III. FUNDAMENTO DE DERECHO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">IV. PETITORIO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">V. OTROSIS</div>
  <p style="margin:6px 0">...</p>

  <div style="margin-top:24px;">Oruro, ${o()}</div>

  <div style="margin-top:36px;display:flex;justify-content:space-between;">
    <div style="text-align:center;width:45%;">
      __________________________<br>
      NOMBRE Y FIRMA DEL DENUNCIANTE
    </div>
    <div style="text-align:center;width:45%;">
      __________________________<br>
      NOMBRE Y FIRMA DEL ABOGADO
    </div>
  </div>
</div>
  `},dirigido_juzgado(i){const e=_=>_==null||_===""?"—":String(_),r=_=>_===!0||_===1||_==="1"?"Sí":_===!1||_===0||_==="0"?"No":"—",c=_=>{if(!_)return"—";const b=new Date(_);if(isNaN(b.getTime()))return e(_);const L=b.getFullYear(),Q=String(b.getMonth()+1).padStart(2,"0"),pe=String(b.getDate()).padStart(2,"0");return`${L}-${Q}-${pe}`},o=()=>{const _=new Date,b=_.getFullYear(),L=String(_.getMonth()+1).padStart(2,"0");return`${String(_.getDate()).padStart(2,"0")}/${L}/${b}`},d=(_={})=>[_.denunciante_nombres,_.denunciante_paterno,_.denunciante_materno].filter(Boolean).join(" ")||"—",a=(_={})=>[_.denunciado_nombres,_.denunciado_paterno,_.denunciado_materno].filter(Boolean).join(" ")||"—",s=i?.denunciantes&&i.denunciantes[0]?i.denunciantes[0]:{},m=i?.denunciados&&i.denunciados[0]?i.denunciados[0]:{},k=e(i?.principal||i?.caso_tipologia),U=r(i?.documento_ciudadania_digital),z=d(s),P=c(s?.denunciante_fecha_nacimiento),$=e(s?.denunciante_lugar_nacimiento),T=e(s?.denunciante_edad),E=e(s?.denunciante_nro),q=e(s?.denunciante_estado_civil),F=e(s?.denunciante_grado),j=e(s?.denunciante_residencia||s?.denunciante_domicilio_actual||i?.caso_direccion||i?.caso_zona||"ORURO"),H=e(s?.denunciante_ocupacion),K=e(s?.denunciante_telefono),R="—",te=a(m),le=c(m?.denunciado_fecha_nacimiento),ae=e(m?.denunciado_lugar_nacimiento||"ORURO"),ne=e(m?.denunciado_edad),se=e(m?.denunciado_nro),de=e(m?.denunciado_estado_civil),re=e(m?.denunciado_grado||"BACHILLER"),ce=e(m?.denunciado_residencia||m?.denunciado_domicilio_actual||"ORURO"),ue=e(m?.denunciado_ocupacion||m?.denunciado_ocupacion_exacto||"—"),me=e(m?.denunciado_telefono||m?.denunciado_movil||m?.denunciado_fijo);return`
<div style="border:1px solid #333;border-radius:6px;padding:14px;margin-bottom:12px;font-size:13px;line-height:1.35">
  <div style="text-align:center; font-weight:700; font-size:15px; margin-bottom:8px;">
    DIRECCION DE IGUALDAD DE OPORTUNIDADES
  </div>

  <div style="margin-bottom:10px">
    <div><b>A :</b> SEÑOR REPRESENTANTE DEL JUZGADO PUBLICO DE FAMILIA LA CIUDAD DE ORURO</div>
    <div><b>DE :</b> ABG. ${(i?.legal_user?.name||i?.user?.name||"Responsable").toString()}</div>
  </div>

  <div style="margin:14px 0; font-weight:700">I. FORMULACION DE DENUNCIA</div>
  <div style="margin:14px 0; font-weight:700">II. FUNDAMENTO DEL HECHO</div>
  <div style="margin:14px 0; font-weight:700">III. FUNDAMENTO DE DERECHO</div>
  <div style="margin:14px 0; font-weight:700">IV. PETITORIO</div>
  <div style="margin:14px 0; font-weight:700">V. OTROSIS</div>

  <div style="margin:18px 0; font-weight:700">I. FORMULA DENUNCIA POR EL MOTIVO DE :</div>
  <div style="margin:6px 0 14px 0">${k}</div>

  <div style="margin:10px 0; font-weight:700">DATOS GENERALES DEL DENUNCIANTE :</div>
  <div><b>Nombres y Apellidos:</b> ${z}</div>
  <div><b>Fecha de Nacimiento:</b> ${P}</div>
  <div><b>Lugar de Nacimiento:</b> ${$}</div>
  <div><b>Edad:</b> ${T}</div>
  <div><b>C.I.:</b> ${E}</div>
  <div><b>Estado Civil:</b> ${q}</div>
  <div><b>Grado de Instrucción:</b> ${F}</div>
  <div><b>Dirección:</b> ${j}</div>
  <div><b>Ocupación:</b> ${H}</div>
  <div><b>Teléfono Celular:</b> ${K}</div>
  <div><b>Correo electrónico:</b> ${R}</div>
  <div><b>Ciudadanía Digital:</b> ${U}</div>

  <div style="margin:16px 0; font-weight:700">DATOS DEL DEMANDADO</div>
  <div><b>Nombres y Apellidos:</b> ${te}</div>
  <div><b>Fecha de Nacimiento:</b> ${le}</div>
  <div><b>Lugar de Nacimiento:</b> ${ae}</div>
  <div><b>Edad:</b> ${ne}</div>
  <div><b>C.I.:</b> ${se}</div>
  <div><b>Estado Civil:</b> ${de}</div>
  <div><b>Grado de Instrucción:</b> ${re}</div>
  <div><b>Dirección:</b> ${ce}</div>
  <div><b>Ocupación:</b> ${ue}</div>
  <div><b>Teléfono Celular:</b> ${me}</div>
  <div><b>Correo electrónico:</b> —</div>

  <div style="margin:18px 0; font-weight:700">II. FUNDAMENTO DE HECHO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">III. FUNDAMENTO DE DERECHO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">IV. PETITORIO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">V. OTROSIS</div>
  <p style="margin:6px 0">Por un derecho y protección a la Mujer…</p>

  <div style="margin-top:24px;">Oruro, ${o()}</div>

  <div style="margin-top:36px;text-align:center">
    __________________________<br>
    NOMBRE Y FIRMA DEL ABOGADO
  </div>
</div>
  `},dirigido_mp(i){const e=b=>b==null||b===""?"—":String(b),r=b=>b===!0||b===1||b==="1"?"Sí":b===!1||b===0||b==="0"?"No":"—",c=b=>{if(!b)return"—";const L=new Date(b);if(isNaN(L.getTime()))return e(b);const Q=L.getFullYear(),pe=String(L.getMonth()+1).padStart(2,"0"),Te=String(L.getDate()).padStart(2,"0");return`${Q}-${pe}-${Te}`},o=()=>{const b=new Date,L=b.getFullYear(),Q=String(b.getMonth()+1).padStart(2,"0");return`${String(b.getDate()).padStart(2,"0")}/${Q}/${L}`},d=(b={})=>[b.denunciante_nombres,b.denunciante_paterno,b.denunciante_materno].filter(Boolean).join(" ")||"—",a=(b={})=>[b.denunciado_nombres,b.denunciado_paterno,b.denunciado_materno].filter(Boolean).join(" ")||"—",s=i?.denunciantes&&i.denunciantes[0]?i.denunciantes[0]:{},m=i?.denunciados&&i.denunciados[0]?i.denunciados[0]:{},k=e(i?.principal||i?.caso_tipologia),U=r(i?.documento_ciudadania_digital),z=d(s),P=c(s?.denunciante_fecha_nacimiento),$=e(s?.denunciante_lugar_nacimiento),T=e(s?.denunciante_edad),E=e(s?.denunciante_nro),q=e(s?.denunciante_estado_civil),F=e(s?.denunciante_grado),j=e(s?.denunciante_residencia||i?.caso_direccion),H=e(s?.denunciante_ocupacion),K=e(s?.denunciante_telefono),R="—",te=a(m),le=c(m?.denunciado_fecha_nacimiento),ae=e(m?.denunciado_lugar_nacimiento),ne=e(m?.denunciado_edad),se=e(m?.denunciado_nro),de=e(m?.denunciado_estado_civil),re=e(m?.denunciado_grado),ce=e(m?.denunciado_residencia||m?.denunciado_domicilio_actual),ue=e(m?.denunciado_ocupacion||m?.denunciado_ocupacion_exacto),me=e(m?.denunciado_telefono||m?.denunciado_movil||m?.denunciado_fijo);return`
<div style="border:1px solid #333;border-radius:6px;padding:14px;margin-bottom:12px;font-size:13px;line-height:1.35">

  <div style="margin-bottom:10px">
    <div><b>A :</b> SEÑOR REPRESENTANTE DEL JUZGADO PUBLICO DE FAMILIA LA CIUDAD DE ORURO</div>
    <div><b>DE :</b> ${`ABG. ${(i?.legal_user?.name||i?.user?.name||"Responsable").toString()}`}</div>
  </div>

  <div style="margin:14px 0; font-weight:700">I. FORMULACION DE DENUNCIA</div>
  <div style="margin:14px 0; font-weight:700">II. FUNDAMENTO DEL HECHO</div>
  <div style="margin:14px 0; font-weight:700">III. FUNDAMENTO DE DERECHO</div>
  <div style="margin:14px 0; font-weight:700">IV. PETITORIO</div>
  <div style="margin:14px 0; font-weight:700">V. OTROSIS</div>

  <div style="margin:18px 0; font-weight:700">I. FORMULA DENUNCIA POR EL MOTIVO DE :</div>
  <div style="margin:6px 0 14px 0">${k}</div>

  <div style="margin:10px 0; font-weight:700">DATOS GENERALES DEL DENUNCIANTE :</div>
  <div><b>Nombres y Apellidos:</b> ${z}</div>
  <div><b>Fecha de Nacimiento:</b> ${P}</div>
  <div><b>Lugar de Nacimiento:</b> ${$}</div>
  <div><b>Edad:</b> ${T}</div>
  <div><b>C.I.:</b> ${E}</div>
  <div><b>Estado Civil:</b> ${q}</div>
  <div><b>Grado de Instrucción:</b> ${F}</div>
  <div><b>Dirección:</b> ${j}</div>
  <div><b>Ocupación:</b> ${H}</div>
  <div><b>Teléfono Celular:</b> ${K}</div>
  <div><b>Correo electrónico:</b> ${R}</div>
  <div><b>Ciudadanía Digital:</b> ${U}</div>

  <div style="margin:16px 0; font-weight:700">DATOS DEL DEMANDADO</div>
  <div><b>Nombres y Apellidos:</b> ${te}</div>
  <div><b>Fecha de Nacimiento:</b> ${le}</div>
  <div><b>Lugar de Nacimiento:</b> ${ae}</div>
  <div><b>Edad:</b> ${ne}</div>
  <div><b>C.I.:</b> ${se}</div>
  <div><b>Estado Civil:</b> ${de}</div>
  <div><b>Grado de Instrucción:</b> ${re}</div>
  <div><b>Dirección:</b> ${ce}</div>
  <div><b>Ocupación:</b> ${ue}</div>
  <div><b>Teléfono Celular:</b> ${me}</div>
  <div><b>Correo electrónico:</b> —</div>

  <div style="margin:18px 0; font-weight:700">II. FUNDAMENTO DE HECHO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">III. FUNDAMENTO DE DERECHO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">IV. PETITORIO</div>
  <p style="margin:6px 0">...</p>

  <div style="margin:18px 0; font-weight:700">V. OTROSIS</div>
  <p style="margin:6px 0">Por un derecho y protección a la Mujer…</p>

  <div style="margin-top:24px;">Oruro, ${o()}</div>

  <div style="margin-top:36px;text-align:center">
    __________________________<br>
    NOMBRE Y FIRMA DEL ABOGADO
  </div>
</div>
  `},denuncia_mp(i={}){const e=(m,k="—")=>m==null||m===""?k:m,r=i.denunciante||{},c=i.denunciado||{},o=i.anexos&&i.anexos.length?i.anexos:["Formulario de Registro domiciliario de la denunciante.","Formulario de Registro domiciliario del denunciado.","Croquis denunciante.","Croquis del denunciado.","Fotocopia simple de la Cédula de Identidad de la denunciante.","Fotocopia simple de la Cédula de Identidad del denunciado.","Informe Psicológico emitido por profesional de la D.I.O."],d=e(i.ciudad,"ORURO"),a=e(i.fecha);return e(i.numero),`
<div style="font-size:12px; line-height:1.35">
  <!-- Encabezado simple DomPDF-friendly -->
  <div style="border:1px solid #333;border-radius:6px;padding:10px;margin-bottom:10px;">
    <div style="font-weight:700">DIRECCIÓN DE IGUALDAD DE OPORTUNIDADES — DEFENSORÍA DE LA NIÑEZ Y ADOLESCENCIA</div>
    <div style="font-size:11px;color:#555">SERVICIO LEGAL INTEGRAL MUNICIPAL</div>
  </div>

  <div style="text-align:center; font-weight:700; text-transform:uppercase; margin-top:4px;">
    ${e(i.fiscaliaTitulo,"SEÑOR REPRESENTANTE DEL MINISTERIO PÚBLICO DE LA CIUDAD DE ORURO")}
  </div>

  <div style="margin:10px 0 6px 0;">
    <b>I.</b>&nbsp; <b>FORMULA DENUNCIA POR EL DELITO DE ABUSO SEXUAL</b>, SOLICITANDO EL LEVANTAMIENTO DE DILIGENCIAS PRELIMINARES Y SE PROCEDA CONFORME A LEY.
  </div>

  <div style="margin:6px 0;">
    <b>II.</b>&nbsp; <b>FUNDAMENTO DE HECHO</b>
  </div>

  <div style="margin:6px 0;">
    <b>III.</b>&nbsp; <b>FUNDAMENTO DE DERECHO</b>
  </div>

  <div style="margin:6px 0;">
    <b>IV.</b>&nbsp; <b>PETITORIO</b>
  </div>

  <div style="margin:6px 0;">
    <b>V.</b>&nbsp; <b>OTROSÍES</b>
  </div>

  <hr style="margin:10px 0;">

  <!-- Datos Generales de Denunciante -->
  <h5 style="margin:6px 0 4px 0;">DATOS GENERALES DE DENUNCIANTE</h5>
  <table style="width:100%; border-collapse:collapse; font-size:12px">
    <tr><td style="width:35%"><b>Nombres y apellidos:</b></td><td>${e(r.nombre)}</td></tr>
    <tr><td><b>Fecha de nacimiento:</b></td><td>${e(r.fecha_nac)}</td></tr>
    <tr><td><b>Lugar de nacimiento:</b></td><td>${e(r.lugar_nac)}</td></tr>
    <tr><td><b>Cédula de identidad:</b></td><td>${e(r.ci)}</td></tr>
    <tr><td><b>Edad:</b></td><td>${e(r.edad)}</td></tr>
    <tr><td><b>Ocupación:</b></td><td>${e(r.ocupacion)}</td></tr>
    <tr><td><b>Estado Civil:</b></td><td>${e(r.estado_civil)}</td></tr>
    <tr><td><b>Domicilio:</b></td><td>${e(r.domicilio)}</td></tr>
    <tr><td><b>Teléfono Celular:</b></td><td>${e(r.celular)}</td></tr>
    <tr><td><b>Correo electrónico:</b></td><td>${e(r.correo)}</td></tr>
    <tr><td><b>Ciudadanía Digital:</b></td><td>${e(i.ciudadania_digital_denunciante)}</td></tr>
  </table>

  <h5 style="margin:12px 0 4px 0;">DATOS GENERALES DEL DENUNCIADO</h5>
  <table style="width:100%; border-collapse:collapse; font-size:12px">
    <tr><td style="width:35%"><b>Nombres y apellidos:</b></td><td>${e(c.nombre)}</td></tr>
    <tr><td><b>Fecha de nacimiento:</b></td><td>${e(c.fecha_nac)}</td></tr>
    <tr><td><b>Nacionalidad:</b></td><td>${e(c.nacionalidad,"Boliviana")}</td></tr>
    <tr><td><b>Cédula de identidad:</b></td><td>${e(c.ci)}</td></tr>
    <tr><td><b>Ocupación:</b></td><td>${e(c.ocupacion)}</td></tr>
    <tr><td><b>Estado Civil:</b></td><td>${e(c.estado_civil)}</td></tr>
    <tr><td><b>Domicilio:</b></td><td>${e(c.domicilio)}</td></tr>
    <tr><td><b>Teléfono Celular:</b></td><td>${e(c.celular)}</td></tr>
    <tr><td><b>Correo electrónico:</b></td><td>${e(c.correo,"Se desconoce")}</td></tr>
  </table>

  <h5 style="margin:12px 0 4px 0;">II. FUNDAMENTO DE HECHO — RELACIÓN CIRCUNSTANCIADA</h5>
  <p style="text-align:justify;">
    ${e(i.relato,"La denunciante refiere los hechos ocurridos, consignando fechas, lugares, personas involucradas y las acciones desplegadas.")}
  </p>

  <h5 style="margin:12px 0 4px 0;">III. FUNDAMENTO DE DERECHO</h5>
  <div style="margin-left:6px">
    <div style="margin:4px 0;"><b>a) DE LA CONSTITUCIÓN POLÍTICA DEL ESTADO — Artículo 15</b></div>
    <ul style="margin:0 0 0 16px;">
      <li>Toda persona tiene derecho a la vida y a la integridad física, psicológica y sexual. Nadie será torturado ni sufrirá tratos crueles, inhumanos, degradantes u humillantes.</li>
      <li>Las personas, en particular las mujeres, tienen derecho a no sufrir violencia física, sexual o psicológica.</li>
      <li>El Estado adoptará medidas para prevenir, eliminar y sancionar la violencia de género.</li>
    </ul>

    <div style="margin:8px 0 4px 0;"><b>b) DE LA LEY 348 — Artículo 83 (modifica el Código Penal)</b></div>
    <div style="margin:0 0 6px 0;">Se adecúan tipos penales y se agravan penas cuando la víctima es niña, niño o adolescente.</div>

    <div style="margin:4px 0;"><b>c) CÓDIGO PENAL — Artículo 312 (Abuso Sexual)</b></div>
    <div>Cuando, en las circunstancias previstas por ley, se realicen actos sexuales no constitutivos de penetración o acceso carnal, la pena será de seis (6) a diez (10) años de privación de libertad.</div>

    ${i.fundamentos_derecho_extra?`<div style="margin-top:8px;">${i.fundamentos_derecho_extra}</div>`:""}
  </div>

  <h5 style="margin:12px 0 4px 0;">IV. PETITORIO</h5>
  <p style="text-align:justify;">
    Por lo expuesto y al amparo de las normas citadas, solicito se admita la presente DENUNCIA por el delito de ABUSO SEXUAL, se disponga el levantamiento de diligencias preliminares y se remitan las actuaciones que correspondan, a efectos de que el hecho no quede impune, determinando responsabilidades conforme a derecho.
    ${i.petitorio_extra?` ${i.petitorio_extra}`:""}
  </p>

  <h5 style="margin:12px 0 4px 0;">V. OTROSÍ 1º — Prueba literal</h5>
  <ul style="margin:0 0 0 16px;">
    ${o.map(m=>`<li>${m}</li>`).join("")}
  </ul>

  <h5 style="margin:10px 0 4px 0;">OTROSÍ 2º — Medidas de protección</h5>
  <p>Al amparo de la Ley 348, solicito se evalúen medidas de protección a favor de la víctima y su entorno familiar para precautelar el normal desenvolvimiento de sus actividades.</p>

  <h5 style="margin:10px 0 4px 0;">OTROSÍ 3º — Domicilio procesal y contactos</h5>
  <table style="width:100%; border-collapse:collapse; font-size:12px">
    <tr><td style="width:30%"><b>Ciudadanía digital (víctima):</b></td><td>${e(i.ciudadania_digital_denunciante)}</td></tr>
    <tr><td><b>WhatsApp (víctima):</b></td><td>${e(r.celular)}</td></tr>
    <tr><td><b>Correo electrónico (víctima):</b></td><td>${e(r.correo)}</td></tr>
    <tr><td><b>Ciudadanía digital (abogado/a):</b></td><td>${e(i.abogado?.ciudadania)}</td></tr>
    <tr><td><b>Correo electrónico (abogado/a):</b></td><td>${e(i.abogado?.correo)}</td></tr>
    <tr><td><b>Celular / WhatsApp (abogado/a):</b></td><td>${e(i.abogado?.whatsapp)}</td></tr>
  </table>

  <div style="margin-top:18px;">
    ${e(d)}, ${a||"___ de __________ de _____"}
  </div>

  <div style="margin-top:26px; display:flex; justify-content:space-between;">
    <div style="text-align:center; width:45%;">
      __________________________<br/>
      Firma Denunciante
    </div>
    <div style="text-align:center; width:45%;">
      __________________________<br/>
      Abg. ${e(i.abogado?.nombre,"Responsable")}
    </div>
  </div>
</div>
`}},Ui={name:"Informes",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:null}},data(){return{openSubirArchivo:!1,file:null,loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dialog:!1,mode:"create",form:{id:null,fecha:"",titulo:"",area:"psicologico",numero:"",contenido_html:""},plantilla:"dirigido_mp",plantillasOptions:[{label:"Dirigido a Ministerio Público",value:"dirigido_mp",disabled:!0},{label:"Dirigido a Juzgado",value:"dirigido_juzgado",disabled:!0},{label:"Dirigido a Otros",value:"dirigido_otros",disabled:!0}],areas:[{label:"Psicológico",value:"psicologico"},{label:"Legal",value:"legal"},{label:"Social",value:"social"}]}},methods:{today(){const i=new Date,e=r=>String(r).padStart(2,"0");return`${i.getFullYear()}-${e(i.getMonth()+1)}-${e(i.getDate())}`},guardarInforme(){if(!this.file){this.$q.notify({type:"negative",message:"Seleccione un archivo"});return}if(!this.form.titulo){this.$q.notify({type:"negative",message:"El título es obligatorio"});return}const i=new FormData;i.append("titulo",this.form.titulo),i.append("file",this.file),this.saving=!0,this.$axios.post(`/casos/${this.caseId}/sesiones-psicologicas/upload`,i,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{this.$q.notify({type:"positive",message:"Informe subido"}),this.openSubirArchivo=!1,this.file=null,this.form.titulo="",this.$emit("refresh")}).catch(e=>{this.$q.notify({type:"negative",message:e?.response?.data?.message||"No se pudo subir el informe"})}).finally(()=>{this.saving=!1})},onFileChange(i){this.file=i},openSubirInforme(){this.openSubirArchivo=!0},openCreate(){this.mode="create",this.form={id:null,fecha:this.today(),titulo:"",area:"psicologico",numero:"",contenido_html:""},this.dialog=!0,this.$nextTick(()=>this.applyTemplate(this.plantilla))},openView(i){this.mode="view",this.form={...i},this.dialog=!0},openEdit(i){this.mode="edit",this.form={...i},this.dialog=!0},applyTemplate(i){this.mode!=="view"&&(this.form.contenido_html="",i==="dirigido_mp"&&(this.form.contenido_html=De.dirigido_mp(this.caso)),i==="dirigido_juzgado"&&(this.form.contenido_html=De.dirigido_juzgado(this.caso)),i==="dirigido_otros"&&(this.form.contenido_html=De.dirigido_otros(this.caso)))},async save(){if(!this.form.titulo)return this.$q.notify({type:"negative",message:"El título es obligatorio"});if(!this.form.contenido_html)return this.$q.notify({type:"negative",message:"El contenido está vacío"});this.saving=!0;try{this.form.id?await this.$axios.put(`/informes-legales/${this.form.id}`,this.form):await this.$axios.post(`/casos/${this.caseId}/informes-legales`,this.form),this.$q.notify({type:"positive",message:"Guardado"}),this.$emit("refresh"),this.dialog=!1}catch(i){this.$q.notify({type:"negative",message:i?.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}},removeIt(i){const e=async()=>{try{await this.$axios.delete(`/informes-legales/${i.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.$emit("refresh")}catch(r){this.$q.notify({type:"negative",message:r?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar el informe?").onOk(e):confirm("¿Eliminar el informe?")&&e()},printPdf(i){const e=this.$url||"";window.open(`${e}/informes/${i.id}/pdf`,"_blank")}}},Ti={class:"row items-center q-mb-sm"},qi={class:"col"},Ri={class:"text-caption text-grey-7"},Li={class:"col-auto row items-center q-gutter-sm"},Mi={key:0},Pi={class:"text-subtitle1"},$i={class:"row"},Fi={class:"col-12 col-md-3"},ji={class:"col-12 col-md-5"},Gi={class:"col-6 col-md-2"},zi={class:"col-6 col-md-2"},Bi={key:0};function Hi(i,e,r,c,o,d){return u(),g(A,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[l("div",Ti,[l("div",qi,[e[12]||(e[12]=l("div",{class:"text-subtitle1 text-weight-medium"},"Informes",-1)),l("div",Ri,"Vinculados al caso #"+f(r.caseId),1)]),l("div",Li,[t(p,{dense:"",outlined:"",modelValue:o.search,"onUpdate:modelValue":e[0]||(e[0]=a=>o.search=a),placeholder:"Buscar...",style:{width:"260px"}},{append:n(()=>[t(D,{name:"search"})]),_:1},8,["modelValue"]),t(v,{flat:"",color:"primary",icon:"refresh",loading:o.loading,onClick:e[1]||(e[1]=a=>i.$emit("refresh"))},null,8,["loading"]),t(v,{color:"green",icon:"add_circle_outline","no-caps":"",label:"Crear Memorial",onClick:d.openCreate},null,8,["onClick"]),t(v,{color:"primary",icon:"upload","no-caps":"",label:"Subir Memorial",onClick:d.openSubirInforme},null,8,["onClick"])])]),t(V),t(Ce,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:n(()=>[e[18]||(e[18]=l("thead",null,[l("tr",{class:"bg-primary text-white"},[l("th",{style:{width:"70px"}},"ID"),l("th",{style:{width:"140px"}},"Acciones"),l("th",null,"Título"),l("th",{style:{width:"120px"}},"Fecha"),l("th",{style:{width:"130px"}},"Área"),l("th",{style:{width:"120px"}},"Nro"),l("th",{style:{width:"180px"}},"Usuario")])],-1)),l("tbody",null,[(u(!0),N(oe,null,fe(r.caso.informes_legales,a=>(u(),N("tr",{key:a.id},[l("td",null,"#"+f(a.id),1),l("td",null,[t(ve,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:n(()=>[x((u(),g(S,{clickable:"",onClick:s=>d.openView(a)},{default:n(()=>[t(h,{avatar:""},{default:n(()=>[t(D,{name:"visibility"})]),_:1}),t(h,null,{default:n(()=>e[13]||(e[13]=[y("Ver")])),_:1})]),_:2},1032,["onClick"])),[[I]]),x((u(),g(S,{clickable:"",onClick:s=>d.printPdf(a)},{default:n(()=>[t(h,{avatar:""},{default:n(()=>[t(D,{name:"picture_as_pdf"})]),_:1}),t(h,null,{default:n(()=>e[14]||(e[14]=[y("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[I]]),t(V),x((u(),g(S,{clickable:"",onClick:s=>d.openEdit(a)},{default:n(()=>[t(h,{avatar:""},{default:n(()=>[t(D,{name:"edit"})]),_:1}),t(h,null,{default:n(()=>e[15]||(e[15]=[y("Editar")])),_:1})]),_:2},1032,["onClick"])),[[I]]),x((u(),g(S,{clickable:"",onClick:s=>d.removeIt(a)},{default:n(()=>[t(h,{avatar:""},{default:n(()=>[t(D,{name:"delete",color:"negative"})]),_:1}),t(h,{class:"text-negative"},{default:n(()=>e[16]||(e[16]=[y("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[I]])]),_:2},1024)]),l("td",null,f(a.titulo),1),l("td",null,f(a.fecha||"s/f"),1),l("td",null,f(a.area||"—"),1),l("td",null,f(a.numero||"—"),1),l("td",null,f(a.user?.name||a.user?.username||"—"),1)]))),128)),r.caso.informes_legales.length?C("",!0):(u(),N("tr",Mi,e[17]||(e[17]=[l("td",{colspan:"7",class:"text-center text-grey"},"Sin registros",-1)])))])]),_:1}),t(ie,{modelValue:o.dialog,"onUpdate:modelValue":e[8]||(e[8]=a=>o.dialog=a),persistent:"",maximized:""},{default:n(()=>[t(A,null,{default:n(()=>[t(Ue,{class:"bg-white text-dark"},{default:n(()=>[l("div",Pi,f(o.mode==="view"?"Ver informe":o.form.id?"Editar informe":"Nuevo informe"),1),t(X),x(t(v,{flat:"",dense:"",round:"",icon:"close"},null,512),[[I]])]),_:1}),t(V),t(O,{class:"q-gutter-md"},{default:n(()=>[l("div",$i,[l("div",Fi,[t(p,{modelValue:o.form.fecha,"onUpdate:modelValue":e[2]||(e[2]=a=>o.form.fecha=a),type:"date",dense:"",outlined:"",label:"Fecha",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),l("div",ji,[t(p,{modelValue:o.form.titulo,"onUpdate:modelValue":e[3]||(e[3]=a=>o.form.titulo=a),dense:"",outlined:"",label:"Título *",readonly:o.mode==="view",rules:[a=>!!a||"Requerido"]},null,8,["modelValue","readonly","rules"])]),l("div",Gi,[t(Z,{modelValue:o.form.area,"onUpdate:modelValue":e[4]||(e[4]=a=>o.form.area=a),options:o.areas,dense:"",outlined:"",label:"Área",readonly:o.mode==="view","emit-value":"","map-options":""},null,8,["modelValue","options","readonly"])]),l("div",zi,[t(p,{modelValue:o.form.numero,"onUpdate:modelValue":e[5]||(e[5]=a=>o.form.numero=a),dense:"",outlined:"",label:"Nro",readonly:o.mode==="view"},null,8,["modelValue","readonly"])])]),o.mode!=="view"?(u(),N("div",Bi,[t(Z,{modelValue:o.plantilla,"onUpdate:modelValue":[e[6]||(e[6]=a=>o.plantilla=a),d.applyTemplate],options:o.plantillasOptions,label:"Plantilla",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])])):C("",!0),l("div",null,[e[19]||(e[19]=l("div",{class:"text-caption text-grey-7 q-mb-xs"},"Contenido (WYSIWYG / guarda HTML)",-1)),t(Ae,{modelValue:o.form.contenido_html,"onUpdate:modelValue":e[7]||(e[7]=a=>o.form.contenido_html=a),readonly:o.mode==="view","min-height":"320px",placeholder:"Escriba el informe...",toolbar:[["left","center","right","justify"],["bold","italic","strike","underline"],["quote","unordered","ordered","outdent","indent"],["hr","link"],["undo","redo"],["removeFormat"]]},null,8,["modelValue","readonly"])])]),_:1}),t(V),t(J,{align:"right"},{default:n(()=>[x(t(v,{flat:"",label:"Cerrar"},null,512),[[I]]),o.mode!=="view"?(u(),g(v,{key:0,color:"primary",label:"Guardar",loading:o.saving,onClick:d.save},null,8,["loading","onClick"])):C("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ie,{modelValue:o.openSubirArchivo,"onUpdate:modelValue":e[11]||(e[11]=a=>o.openSubirArchivo=a),persistent:""},{default:n(()=>[t(A,{style:{"max-width":"500px",width:"90vw"}},{default:n(()=>[t(O,{class:"row items-center q-pb-none"},{default:n(()=>[e[20]||(e[20]=l("div",{class:"text-subtitle1"},"Subir informe",-1)),t(X),x(t(v,{flat:"",round:"",dense:"",icon:"close"},null,512),[[I]])]),_:1}),t(O,{class:"q-gutter-md"},{default:n(()=>[e[21]||(e[21]=l("div",{class:"text-body2 q-mb-sm"}," Aquí puede subir un informe ya elaborado en formato PDF, Word, OpenDocument o imagen. ",-1)),t(p,{modelValue:o.form.titulo,"onUpdate:modelValue":e[9]||(e[9]=a=>o.form.titulo=a),dense:"",outlined:"",label:"Titulo de Memorial *",rules:[a=>!!a||"Requerido"]},null,8,["modelValue","rules"]),t(Ie,{modelValue:o.file,"onUpdate:modelValue":[e[10]||(e[10]=a=>o.file=a),d.onFileChange],label:"Seleccionar archivo",outlined:"",dense:"",accept:".pdf,.doc,.docx,.odt,.png,.jpg,.jpeg"},null,8,["modelValue","onUpdate:modelValue"]),t(v,{color:"primary",label:"Guardar",disabled:!o.file||!o.form.titulo,onClick:d.guardarInforme},null,8,["disabled","onClick"])]),_:1}),t(V),t(J,{align:"right"},{default:n(()=>[x(t(v,{flat:"",label:"Cerrar"},null,512),[[I]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Qi=B(Ui,[["render",Hi]]),Yi={name:"ApoyoIntegral",props:{caseId:{type:[String,Number],required:!0}}},Wi={class:"text-grey-7"};function Zi(i,e,r,c,o,d){return u(),g(A,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[e[0]||(e[0]=l("div",{class:"text-subtitle1 text-weight-medium q-mb-sm"},"Apoyo integral",-1)),l("div",Wi,"DIO personal, descripción, impresión (ID: "+f(r.caseId)+")",1)]),_:1})}const Ji=B(Yi,[["render",Zi]]),Xi={name:"DocumentosGeneral",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:()=>({})}},data(){return{loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dlgUpload:!1,file:null,meta:{titulo:"",categoria:"",descripcion:""},accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.odt,.ods,.txt,.zip,.jpg,.jpeg,.png,.webp",dlgEdit:!1,edit:{},editingId:null}},methods:{openUpload(){this.file=null,this.meta={titulo:"",categoria:"",descripcion:""},this.dlgUpload=!0},async upload(){if(!this.file){this.$q.notify({type:"negative",message:"Seleccione un archivo"});return}this.saving=!0;try{const i=new FormData;i.append("file",this.file),this.meta.titulo&&i.append("titulo",this.meta.titulo),this.meta.categoria&&i.append("categoria",this.meta.categoria),this.meta.descripcion&&i.append("descripcion",this.meta.descripcion),await this.$axios.post(`/casos/${this.caseId}/documentos`,i,{headers:{"Content-Type":"multipart/form-data"}}),this.$q.notify({type:"positive",message:"Archivo subido"}),this.dlgUpload=!1,this.$emit("refresh")}catch(i){this.$q.notify({type:"negative",message:i?.response?.data?.message||"No se pudo subir"})}finally{this.saving=!1}},viewDoc(i){const e=this.$url||"";window.open(`${e}/documentos/${i.id}/view`,"_blank")},downloadDoc(i){const e=this.$url||"";window.open(`${e}/documentos/${i.id}/download`,"_blank")},editMeta(i){this.editingId=i.id,this.edit={titulo:i.titulo,categoria:i.categoria,descripcion:i.descripcion},this.dlgEdit=!0},async saveMeta(){this.saving=!0;try{await this.$axios.put(`/documentos/${this.editingId}`,this.edit),this.$q.notify({type:"positive",message:"Actualizado"}),this.dlgEdit=!1,this.$emit("refresh")}catch(i){this.$q.notify({type:"negative",message:i?.response?.data?.message||"No se pudo actualizar"})}finally{this.saving=!1}},removeDoc(i){const e=async()=>{try{await this.$axios.delete(`/documentos/${i.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.$emit("refresh")}catch(r){this.$q.notify({type:"negative",message:r?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar el documento?").onOk(e):confirm("¿Eliminar el documento?")&&e()}}},Ki={class:"row items-center q-mb-sm"},et={class:"col"},ot={class:"text-caption text-grey-7"},it={class:"col-auto row items-center q-gutter-sm"},tt={class:"text-weight-medium"},lt={key:0};function at(i,e,r,c,o,d){return u(),g(A,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[l("div",Ki,[l("div",et,[e[10]||(e[10]=l("div",{class:"text-subtitle1 text-weight-medium"},"Documentos (General)",-1)),l("div",ot,"Gestión de adjuntos del caso #"+f(r.caseId),1)]),l("div",it,[t(v,{flat:"",color:"primary",icon:"refresh",loading:o.loading,onClick:e[0]||(e[0]=a=>i.$emit("refresh"))},null,8,["loading"]),t(v,{color:"green",icon:"upload","no-caps":"",label:"Subir archivo",onClick:d.openUpload},null,8,["onClick"])])]),t(V),t(Ce,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:n(()=>[e[16]||(e[16]=l("thead",null,[l("tr",{class:"bg-primary text-white"},[l("th",{style:{width:"70px"}},"ID"),l("th",{style:{width:"160px"}},"Acciones"),l("th",null,"Título"),l("th",{style:{width:"130px"}},"Categoría"),l("th",{style:{width:"120px"}},"Tamaño"),l("th",{style:{width:"160px"}},"Tipo"),l("th",{style:{width:"180px"}},"Usuario")])],-1)),l("tbody",null,[(u(!0),N(oe,null,fe(r.caso.documentos,a=>(u(),N("tr",{key:a.id},[l("td",null,"#"+f(a.id),1),l("td",null,[t(ve,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:n(()=>[x((u(),g(S,{clickable:"",onClick:s=>d.viewDoc(a)},{default:n(()=>[t(h,{avatar:""},{default:n(()=>[t(D,{name:"visibility"})]),_:1}),t(h,null,{default:n(()=>e[11]||(e[11]=[y("Ver")])),_:1})]),_:2},1032,["onClick"])),[[I]]),x((u(),g(S,{clickable:"",onClick:s=>d.downloadDoc(a)},{default:n(()=>[t(h,{avatar:""},{default:n(()=>[t(D,{name:"download"})]),_:1}),t(h,null,{default:n(()=>e[12]||(e[12]=[y("Descargar")])),_:1})]),_:2},1032,["onClick"])),[[I]]),t(V),x((u(),g(S,{clickable:"",onClick:s=>d.editMeta(a)},{default:n(()=>[t(h,{avatar:""},{default:n(()=>[t(D,{name:"edit"})]),_:1}),t(h,null,{default:n(()=>e[13]||(e[13]=[y("Editar")])),_:1})]),_:2},1032,["onClick"])),[[I]]),x((u(),g(S,{clickable:"",onClick:s=>d.removeDoc(a)},{default:n(()=>[t(h,{avatar:""},{default:n(()=>[t(D,{name:"delete",color:"negative"})]),_:1}),t(h,{class:"text-negative"},{default:n(()=>e[14]||(e[14]=[y("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[I]])]),_:2},1024)]),l("td",tt,f(a.titulo),1),l("td",null,f(a.categoria||"—"),1),l("td",null,f(a.size_human),1),l("td",null,f(a.mime||a.extension),1),l("td",null,f(a.user?.name||a.user?.username||"—"),1)]))),128)),!r.caso.documentos.length&&!o.loading?(u(),N("tr",lt,e[15]||(e[15]=[l("td",{colspan:"7",class:"text-center text-grey"},"Sin registros",-1)]))):C("",!0)])]),_:1}),t(ie,{modelValue:o.dlgUpload,"onUpdate:modelValue":e[5]||(e[5]=a=>o.dlgUpload=a),persistent:""},{default:n(()=>[t(A,{style:{"max-width":"700px",width:"95vw"}},{default:n(()=>[t(O,{class:"row items-center q-pb-none"},{default:n(()=>[e[17]||(e[17]=l("div",{class:"text-subtitle1"},"Subir archivo",-1)),t(X),x(t(v,{flat:"",dense:"",round:"",icon:"close"},null,512),[[I]])]),_:1}),t(O,{class:"q-gutter-md"},{default:n(()=>[t(p,{modelValue:o.meta.titulo,"onUpdate:modelValue":e[1]||(e[1]=a=>o.meta.titulo=a),label:"Título",outlined:"",dense:""},null,8,["modelValue"]),t(p,{modelValue:o.meta.categoria,"onUpdate:modelValue":e[2]||(e[2]=a=>o.meta.categoria=a),label:"Categoría",outlined:"",dense:""},null,8,["modelValue"]),t(p,{modelValue:o.meta.descripcion,"onUpdate:modelValue":e[3]||(e[3]=a=>o.meta.descripcion=a),type:"textarea",label:"Descripción",outlined:"",dense:"",autogrow:""},null,8,["modelValue"]),t(Ie,{modelValue:o.file,"onUpdate:modelValue":e[4]||(e[4]=a=>o.file=a),outlined:"",dense:"","use-chips":"",clearable:!0,accept:o.accept,hint:"Hasta 20MB. PDF, Word, Excel, imágenes, etc."},null,8,["modelValue","accept"])]),_:1}),t(J,{align:"right"},{default:n(()=>[x(t(v,{flat:"",label:"Cancelar"},null,512),[[I]]),t(v,{color:"primary",label:"Subir",loading:o.saving,onClick:d.upload},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ie,{modelValue:o.dlgEdit,"onUpdate:modelValue":e[9]||(e[9]=a=>o.dlgEdit=a)},{default:n(()=>[t(A,{style:{"max-width":"600px",width:"95vw"}},{default:n(()=>[t(O,{class:"row items-center q-pb-none"},{default:n(()=>[e[18]||(e[18]=l("div",{class:"text-subtitle1"},"Editar metadatos",-1)),t(X),x(t(v,{flat:"",dense:"",round:"",icon:"close"},null,512),[[I]])]),_:1}),t(O,{class:"q-gutter-md"},{default:n(()=>[t(p,{modelValue:o.edit.titulo,"onUpdate:modelValue":e[6]||(e[6]=a=>o.edit.titulo=a),label:"Título",outlined:"",dense:""},null,8,["modelValue"]),t(p,{modelValue:o.edit.categoria,"onUpdate:modelValue":e[7]||(e[7]=a=>o.edit.categoria=a),label:"Categoría",outlined:"",dense:""},null,8,["modelValue"]),t(p,{modelValue:o.edit.descripcion,"onUpdate:modelValue":e[8]||(e[8]=a=>o.edit.descripcion=a),type:"textarea",label:"Descripción",outlined:"",dense:"",autogrow:""},null,8,["modelValue"])]),_:1}),t(J,{align:"right"},{default:n(()=>[x(t(v,{flat:"",label:"Cancelar"},null,512),[[I]]),t(v,{color:"primary",label:"Guardar",loading:o.saving,onClick:d.saveMeta},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const nt=B(Xi,[["render",at]]),st={name:"Fotografias",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,required:!1}},data(){return{rows:{data:[],last_page:1},page:1,perPage:12,loading:!1,uploading:!1}},methods:{toPublicUrl(i){return i?/^https?:\/\//i.test(i)?i:`${(this.$url||"").replace(/\/api\/?$/,"")}${i}`:""},pickFile(){this.$refs.file.click()},async upload(i){const e=i.target.files?.[0];if(e){this.uploading=!0;try{const r=new FormData;r.append("file",e),await this.$axios.post(`/casos/${this.caseId}/fotografias`,r,{headers:{"Content-Type":"multipart/form-data"}}),this.$q.notify({type:"positive",message:"Foto subida"}),this.$emit("refresh")}catch(r){this.$q.notify({type:"negative",message:r?.response?.data?.message||"No se pudo subir"})}finally{this.uploading=!1,this.$refs.file&&(this.$refs.file.value="")}}},async remove(i){if(confirm("¿Eliminar foto?"))try{await this.$axios.delete(`/fotografias/${i.id}`),this.$q.notify({type:"positive",message:"Eliminada"}),this.$emit("refresh")}catch(e){this.$q.notify({type:"negative",message:e?.response?.data?.message||"No se pudo eliminar"})}},view(i){i&&window.open(i,"_blank")}}},dt={class:"row items-center q-mb-sm"},rt={class:"col"},ct={class:"text-caption text-grey-7"},ut={class:"col-auto"},mt={class:"row q-col-gutter-md q-mt-sm"},ft={class:"absolute-bottom text-subtitle2 bg-black bg-opacity-40 q-pa-xs ellipsis"};function pt(i,e,r,c,o,d){return u(),g(A,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[l("div",dt,[l("div",rt,[e[1]||(e[1]=l("div",{class:"text-subtitle1 text-weight-medium"},"Fotografías",-1)),l("div",ct,"Sube/ver fotos del caso #"+f(r.caseId),1)]),l("div",ut,[t(v,{color:"primary",icon:"add_photo_alternate","no-caps":"",label:"Subir",onClick:d.pickFile,loading:o.uploading},null,8,["onClick","loading"]),l("input",{type:"file",ref:"file",accept:"image/*",class:"hidden",onChange:e[0]||(e[0]=(...a)=>d.upload&&d.upload(...a))},null,544)])]),t(V),l("div",mt,[(u(!0),N(oe,null,fe(r.caso.fotografias,a=>(u(),N("div",{key:a.id,class:"col-6 col-sm-4 col-md-3"},[t(A,{flat:"",bordered:""},{default:n(()=>[t(Ye,{src:d.toPublicUrl(a.thumb_url||a.url),ratio:4/3,onClick:s=>d.view(d.toPublicUrl(a.url)),style:{cursor:"pointer"}},{default:n(()=>[l("div",ft,f(a.titulo),1)]),_:2},1032,["src","onClick"]),t(J,{align:"between"},{default:n(()=>[t(v,{dense:"",flat:"",icon:"delete",color:"negative",onClick:s=>d.remove(a)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))])]),_:1})}const _t=B(st,[["render",pt]]),W=Oe({name:"QTimelineEntry",props:{heading:Boolean,tag:{type:String,default:"h3"},side:{type:String,default:"right",validator:i=>["left","right"].includes(i)},icon:String,avatar:String,color:String,title:String,subtitle:String,body:String},setup(i,{slots:e}){const r=Re(ke,we);if(r===we)return console.error("QTimelineEntry needs to be child of QTimeline"),we;const c=xe(()=>`q-timeline__entry q-timeline__entry--${i.side}`+(i.icon!==void 0||i.avatar!==void 0?" q-timeline__entry--icon":"")),o=xe(()=>`q-timeline__dot text-${i.color||r.color}`),d=xe(()=>r.layout==="comfortable"&&r.side==="left");return()=>{const a=Le(e.default,[]);if(i.body!==void 0&&a.unshift(i.body),i.heading===!0){const k=[G("div"),G("div"),G(i.tag,{class:"q-timeline__heading-title"},a)];return G("div",{class:"q-timeline__heading"},d.value===!0?k.reverse():k)}let s;i.icon!==void 0?s=[G(D,{class:"row items-center justify-center",name:i.icon})]:i.avatar!==void 0&&(s=[G("img",{class:"q-timeline__dot-img",src:i.avatar})]);const m=[G("div",{class:"q-timeline__subtitle"},[G("span",{},Ve(e.subtitle,[i.subtitle]))]),G("div",{class:o.value},s),G("div",{class:"q-timeline__content"},[G("h6",{class:"q-timeline__title"},Ve(e.title,[i.title]))].concat(a))];return G("li",{class:c.value},d.value===!0?m.reverse():m)}}}),gt=Oe({name:"QTimeline",props:{...Me,color:{type:String,default:"primary"},side:{type:String,default:"right",validator:i=>["left","right"].includes(i)},layout:{type:String,default:"dense",validator:i=>["dense","comfortable","loose"].includes(i)}},setup(i,{slots:e}){const r=$e(),c=Pe(i,r.proxy.$q);Fe(ke,i);const o=xe(()=>`q-timeline q-timeline--${i.layout} q-timeline--${i.layout}--${i.side}`+(c.value===!0?" q-timeline--dark":""));return()=>G("ul",{class:o.value},Ve(e.default))}}),vt={name:"HojaRuta",props:{caseId:{type:[String,Number],required:!0}},data(){return{loading:!1,editing:!1,backup:null,form:{caso_numero:"",fecha_apertura_caso:"",fecha_derivacion_psicologica:"",fecha_informe_area_psicologica:"",fecha_informe_trabajo_social:"",fecha_derivacion_area_legal:""}}},computed:{today(){const i=new Date,e=String(i.getMonth()+1).padStart(2,"0"),r=String(i.getDate()).padStart(2,"0");return`${i.getFullYear()}-${e}-${r}`},total(){return 5},done(){return["fecha_apertura_caso","fecha_derivacion_psicologica","fecha_informe_area_psicologica","fecha_informe_trabajo_social","fecha_derivacion_area_legal"].filter(e=>!!this.form[e]).length}},created(){this.fetch()},methods:{format(i){return i||"—"},async fetch(){this.loading=!0;try{const{data:i}=await this.$axios.get(`/casos/${this.caseId}`);this.form={caso_numero:i.caso_numero||"",fecha_apertura_caso:i.fecha_apertura_caso||"",fecha_derivacion_psicologica:i.fecha_derivacion_psicologica||"",fecha_informe_area_psicologica:i.fecha_informe_area_psicologica||"",fecha_informe_trabajo_social:i.fecha_informe_trabajo_social||"",fecha_derivacion_area_legal:i.fecha_derivacion_area_legal||""},this.backup={...this.form}}catch(i){this.$alert?.error(i?.response?.data?.message||"No se pudo cargar la hoja de ruta")}finally{this.loading=!1}},startEdit(){this.editing=!0,this.backup={...this.form}},cancelEdit(){this.form={...this.backup},this.editing=!1,this.$q.notify({type:"info",message:"Cambios descartados"})},async save(){const i={fecha_derivacion_psicologica:this.form.fecha_derivacion_psicologica||null,fecha_informe_area_psicologica:this.form.fecha_informe_area_psicologica||null,fecha_informe_trabajo_social:this.form.fecha_informe_trabajo_social||null,fecha_derivacion_area_legal:this.form.fecha_derivacion_area_legal||null};this.loading=!0;try{const{data:e}=await this.$axios.put(`/casos/${this.caseId}`,i);this.form={...this.form,fecha_derivacion_psicologica:e.data?.fecha_derivacion_psicologica||this.form.fecha_derivacion_psicologica,fecha_informe_area_psicologica:e.data?.fecha_informe_area_psicologica||this.form.fecha_informe_area_psicologica,fecha_informe_trabajo_social:e.data?.fecha_informe_trabajo_social||this.form.fecha_informe_trabajo_social,fecha_derivacion_area_legal:e.data?.fecha_derivacion_area_legal||this.form.fecha_derivacion_area_legal},this.backup={...this.form},this.editing=!1,this.$alert?.success("Hoja de ruta actualizada")}catch(e){this.$alert?.error(e?.response?.data?.message||"No se pudo actualizar")}finally{this.loading=!1}}}},ht={class:"row items-center q-mb-sm"},bt={class:"col"},yt={class:"text-caption text-grey-7"};function xt(i,e,r,c,o,d){return u(),N("div",null,[l("div",ht,[l("div",bt,[e[0]||(e[0]=l("div",{class:"text-subtitle1 text-weight-medium"},"Hoja de ruta",-1)),l("div",yt," Completa las fechas clave del caso ("+f(d.done)+"/"+f(d.total)+" completadas) ",1)])]),t(A,{flat:"",bordered:"",class:"section-card"},{default:n(()=>[t(V),t(O,null,{default:n(()=>[t(gt,{color:"primary",layout:"comfortable",side:"right"},{default:n(()=>[t(W,{title:"Apertura del caso",subtitle:d.format(o.form.fecha_apertura_caso),icon:"flag"},null,8,["subtitle"]),t(W,{title:"Derivación área legal",subtitle:d.format(o.form.fecha_derivacion_area_legal),icon:"gavel",color:o.form.fecha_derivacion_area_legal?"primary":"grey-5"},null,8,["subtitle","color"]),t(W,{title:"Aceptación área legal",subtitle:d.format(o.form.fecha_derivacion_area_legal),icon:"gavel",color:o.form.fecha_derivacion_area_legal?"primary":"grey-5"},null,8,["subtitle","color"]),t(W,{title:"Devolución área legal",subtitle:d.format(o.form.fecha_derivacion_area_legal),icon:"gavel",color:o.form.fecha_derivacion_area_legal?"primary":"grey-5"},null,8,["subtitle","color"]),t(W,{title:"Derivación área Psicologica",subtitle:d.format(o.form.fecha_derivacion_area_legal),icon:"gavel",color:o.form.fecha_derivacion_area_legal?"primary":"grey-5"},null,8,["subtitle","color"]),t(W,{title:"Aceptación área Psicologica",subtitle:d.format(o.form.fecha_derivacion_area_legal),icon:"gavel",color:o.form.fecha_derivacion_area_legal?"primary":"grey-5"},null,8,["subtitle","color"]),t(W,{title:"Devolución área Psicologica",subtitle:d.format(o.form.fecha_derivacion_area_legal),icon:"gavel",color:o.form.fecha_derivacion_area_legal?"primary":"grey-5"},null,8,["subtitle","color"]),t(W,{title:"Derivación área Social",subtitle:d.format(o.form.fecha_derivacion_area_legal),icon:"gavel",color:o.form.fecha_derivacion_area_legal?"primary":"grey-5"},null,8,["subtitle","color"]),t(W,{title:"Aceptación área Social",subtitle:d.format(o.form.fecha_derivacion_area_legal),icon:"gavel",color:o.form.fecha_derivacion_area_legal?"primary":"grey-5"},null,8,["subtitle","color"]),t(W,{title:"Devolución área Social",subtitle:d.format(o.form.fecha_derivacion_area_legal),icon:"gavel",color:o.form.fecha_derivacion_area_legal?"primary":"grey-5"},null,8,["subtitle","color"])]),_:1})]),_:1})]),_:1})])}const It=B(vt,[["render",xt],["__scopeId","data-v-f88212b0"]]),Ct={name:"SeguimientoCaso",props:{caso:{type:Object,required:!0}},data(){return{loading:!1,filters:{q:"",tipo:"Todos",modulo:"Todos",desde:"",hasta:""},tipos:["Todos","Informe","Sesión","Documento","Fotografía","Hito"],modulos:["Todos","General","Psicológico","Legal","Social","Documentos","Multimedia"],columns:[{name:"actividad",label:"Actividad",field:"actividad",align:"left",sortable:!1},{name:"fecha",label:"Fecha / Usuario",field:"fecha",align:"left",sortable:!0},{name:"modulo",label:"Módulo",field:"modulo",align:"left",sortable:!0},{name:"acciones",label:"",field:"acciones",align:"right",sortable:!1,style:"width: 150px"}]}},computed:{header(){const i=this.caso||{},e=Array.isArray(i.denunciantes)&&i.denunciantes.length?i.denunciantes[0]:null,r=Array.isArray(i.denunciados)&&i.denunciados.length?i.denunciados[0]:null;return{caso_id:i.id||"—",caso_numero:i.caso_numero||"—",tipologia:i.caso_tipologia||i.caso_tipologia===""?i.caso_tipologia:i.caso_tipologia||i.caso_tipologia,modalidad:(i.caso_modalidad||i.caso_modalidad==="",i.caso_modalidad),zona:i.caso_zona||i.zona||"—",direccion:i.caso_direccion||"—",fecha_hecho:i.caso_fecha_hecho||"—",fecha_registro:i.fecha_apertura_caso||"—",registrado_por:i.user?.name||"—",denunciante:e?this.fullName(e,"denunciante"):"—",denunciado:r?this.fullName(r,"denunciado"):"—"}},violenciaChips(){const i=this.caso||{};return[{key:"violencia_fisica",label:"Física",color:"red-7"},{key:"violencia_psicologica",label:"Psicológica",color:"deep-purple-7"},{key:"violencia_sexual",label:"Sexual",color:"purple-7"},{key:"violencia_economica",label:"Económica",color:"orange-7"},{key:"violencia_patrimonial",label:"Patrimonial",color:"brown-7"},{key:"violencia_simbolica",label:"Simbólica",color:"indigo-7"},{key:"violencia_institucional",label:"Institucional",color:"teal-7"}].map(r=>({...r,on:!!i[r.key]}))},rows(){const i=[],e=this.caso||{};return[{fecha:e.fecha_apertura_caso,titulo:"Apertura del caso"},{fecha:e.fecha_derivacion_psicologica,titulo:"Derivación a Psicología"},{fecha:e.fecha_derivacion_area_legal,titulo:"Derivación a Área Legal"},{fecha:e.fecha_informe_area_social,titulo:"Informe Área Social"},{fecha:e.fecha_informe_area_psicologica,titulo:"Informe Área Psicológica"},{fecha:e.fecha_informe_trabajo_social,titulo:"Informe Trabajo Social"}].forEach((c,o)=>{c.fecha}),Array.isArray(e.informes_sociales)&&e.informes_sociales.forEach(c=>{i.push({uid:`soc-${c.id}`,tipo:"Informe",modulo:"Social",titulo:c.titulo||"Informe Social",descripcion:this.stripHtml(c.contenido_html||""),usuario:c.user?.name||"",fecha:c.fecha||"",icon:"description",links:{}})}),Array.isArray(e.psicologicas)&&e.psicologicas.forEach(c=>{i.push({uid:`psi-${c.id}`,tipo:"Sesión",modulo:"Psicológico",titulo:`${c.tipo||"Sesión"}${c.titulo?` — ${c.titulo}`:""}`,descripcion:this.stripHtml(c.contenido_html||""),usuario:c.user?.name||"",fecha:c.fecha||"",icon:"psychology",links:{}})}),Array.isArray(e.informes_legales)&&e.informes_legales.forEach(c=>{i.push({uid:`leg-${c.id}`,tipo:"Informe",modulo:"Legal",titulo:c.titulo||"Informe Legal",descripcion:this.stripHtml(c.contenido_html||""),usuario:c.user?.name||"",fecha:c.fecha||"",icon:"gavel",links:{}})}),Array.isArray(e.documentos)&&e.documentos.forEach(c=>{i.push({uid:`doc-${c.id}`,tipo:"Documento",modulo:"Documentos",titulo:c.titulo||c.original_name||"Documento",descripcion:[c.categoria,c.descripcion,c.size_human].filter(Boolean).join(" · "),usuario:c.user?.name||"",fecha:(c.created_at||"").slice(0,10),icon:c.extension==="pdf"?"picture_as_pdf":"attach_file",links:{view:c.url,download:c.url,open:c.url}})}),Array.isArray(e.fotografias)&&e.fotografias.forEach(c=>{i.push({uid:`foto-${c.id}`,tipo:"Fotografía",modulo:"Multimedia",titulo:c.titulo||"Fotografía",descripcion:c.descripcion||"",usuario:c.user?.name||"",fecha:(c.created_at||"").slice(0,10),icon:"image",links:{view:c.url,open:c.url,download:c.url}})}),i.sort((c,o)=>(o.fecha||"").localeCompare(c.fecha||"")),i},rowsFiltered(){let i=this.rows.slice();if(this.filters.q){const e=this.filters.q.toLowerCase();i=i.filter(r=>(r.titulo||"").toLowerCase().includes(e)||(r.descripcion||"").toLowerCase().includes(e)||(r.usuario||"").toLowerCase().includes(e))}return this.filters.tipo&&this.filters.tipo!=="Todos"&&(i=i.filter(e=>e.tipo===this.filters.tipo)),this.filters.modulo&&this.filters.modulo!=="Todos"&&(i=i.filter(e=>(e.modulo||"").toLowerCase()===this.filters.modulo.toLowerCase())),this.filters.desde&&(i=i.filter(e=>(e.fecha||"0000-00-00")>=this.filters.desde)),this.filters.hasta&&(i=i.filter(e=>(e.fecha||"9999-12-31")<=this.filters.hasta)),i}},methods:{clickSeguimiento(i,e){if(e.tipo==="Informe"&&e.modulo==="Social"&&e.uid.startsWith("soc-")){const r=e.uid.split("-")[1],c=this.$axios.defaults.baseURL+`/informesSocial/${r}/pdf`;this.open(c)}if(e.tipo==="Documento"&&e.uid.startsWith("doc-")){const r=e.uid.split("-")[1],c=this.$axios.defaults.baseURL+`/documentos/${r}/view`;this.open(c)}if(e.tipo==="Sesión"&&e.modulo==="Psicológico"&&e.uid.startsWith("psi-")){const r=e.uid.split("-")[1],c=this.$axios.defaults.baseURL+`/sesiones-psicologicas/${r}/pdf`;this.open(c)}if(e.tipo==="Informe"&&e.modulo==="Legal"&&e.uid.startsWith("leg-")){const r=e.uid.split("-")[1],c=this.$axios.defaults.baseURL+`/informes/${r}/pdf`;this.open(c)}},stripHtml(i){const e=document.createElement("div");e.innerHTML=i||"";const r=(e.textContent||e.innerText||"").trim().replace(/\s+/g," ");return r.length>280?r.slice(0,277)+"…":r},fullName(i,e){return[i[`${e}_nombres`],i[`${e}_paterno`],i[`${e}_materno`]].filter(Boolean).join(" ").trim()||i[`${e}_nombre_completo`]||i[`${e}_nombres`]||"—"},open(i){i&&window.open(i,"_blank")},async forceRefresh(){this.loading=!0;try{await new Promise(i=>setTimeout(i,500))}finally{this.loading=!1}}}},wt={class:"row items-start q-col-gutter-sm"},Et={class:"col-12 col-md-8"},Dt={class:"text-caption text-grey-7"},Vt={class:"col-12 col-md-4 flex items-center justify-end"},Nt={class:"row q-col-gutter-sm"},At={class:"col-12 col-md-3"},St={class:"val"},Ot={class:"col-12 col-md-3"},kt={class:"val"},Ut={class:"col-12 col-md-3"},Tt={class:"val"},qt={class:"col-12 col-md-3"},Rt={class:"val ellipsis"},Lt={class:"col-12 col-md-3"},Mt={class:"val"},Pt={class:"col-12 col-md-3"},$t={class:"val"},Ft={class:"col-12 col-md-3"},jt={class:"val"},Gt={class:"col-12 col-md-3"},zt={class:"val"},Bt={class:"row q-col-gutter-xs q-mt-sm items-center"},Ht={class:"col-12 col-md-8"},Qt={class:"row q-gutter-xs"},Yt={class:"col-12 col-md-4"},Wt={class:"row q-gutter-xs justify-end"},Zt={class:"row items-center q-col-gutter-sm"},Jt={class:"col-12 col-md-4"},Xt={class:"col-6 col-md-2"},Kt={class:"col-6 col-md-2"},el={class:"col-6 col-md-2"},ol={class:"col-6 col-md-2"},il={class:"row no-wrap items-start q-gutter-sm"},tl={class:"text-weight-medium"},ll={class:"text-caption text-grey-7 ellipsis-2-lines",style:{"max-width":"560px"}},al={class:"text-weight-medium"},nl={class:"text-caption text-grey-7"};function sl(i,e,r,c,o,d){return u(),N("div",null,[t(A,{flat:"",bordered:"",class:"q-pa-sm q-mb-md rounded-borders"},{default:n(()=>[l("div",wt,[l("div",Et,[e[6]||(e[6]=l("div",{class:"text-subtitle1 text-weight-bold"},"Seguimiento del Caso",-1)),l("div",Dt,[y(f(r.caso?.tipo||"SLIM")+" · Caso ",1),l("b",null,"#"+f(d.header.caso_id),1),e[5]||(e[5]=y(" · N° ")),l("b",null,f(d.header.caso_numero||"—"),1)])]),l("div",Vt,[t(ge,{dense:"",color:"indigo-1","text-color":"indigo-9",class:"q-mr-xs"},{default:n(()=>[y(f(d.header.fecha_registro||"—"),1)]),_:1}),t(v,{flat:"",color:"primary",icon:"refresh",onClick:d.forceRefresh,loading:o.loading,title:"Actualizar",label:o.loading?"":"Actualizar","no-caps":"",dense:""},null,8,["onClick","loading","label"])])]),t(V,{class:"q-my-sm"}),l("div",Nt,[l("div",At,[e[7]||(e[7]=l("div",{class:"lbl"},"Tipología",-1)),l("div",St,f(d.header.tipologia||"—"),1)]),l("div",Ot,[e[8]||(e[8]=l("div",{class:"lbl"},"Modalidad",-1)),l("div",kt,f(d.header.modalidad||"—"),1)]),l("div",Ut,[e[9]||(e[9]=l("div",{class:"lbl"},"Zona",-1)),l("div",Tt,f(d.header.zona||"—"),1)]),l("div",qt,[e[10]||(e[10]=l("div",{class:"lbl"},"Dirección",-1)),l("div",Rt,f(d.header.direccion||"—"),1)]),l("div",Lt,[e[11]||(e[11]=l("div",{class:"lbl"},"Denunciante",-1)),l("div",Mt,f(d.header.denunciante||"—"),1)]),l("div",Pt,[e[12]||(e[12]=l("div",{class:"lbl"},"Denunciado",-1)),l("div",$t,f(d.header.denunciado||"—"),1)]),l("div",Ft,[e[13]||(e[13]=l("div",{class:"lbl"},"Fecha del hecho",-1)),l("div",jt,f(d.header.fecha_hecho||"—"),1)]),l("div",Gt,[e[14]||(e[14]=l("div",{class:"lbl"},"Registrado por",-1)),l("div",zt,f(d.header.registrado_por||"—"),1)])]),l("div",Bt,[l("div",Ht,[e[15]||(e[15]=l("div",{class:"lbl q-mb-xs"},"Tipos de violencia",-1)),l("div",Qt,[(u(!0),N(oe,null,fe(d.violenciaChips,a=>(u(),g(ge,{key:a.label,dense:"",color:a.on?a.color:"grey-3","text-color":a.on?"white":"grey-8",square:""},{default:n(()=>[y(f(a.label),1)]),_:2},1032,["color","text-color"]))),128))])]),l("div",Yt,[e[16]||(e[16]=l("div",{class:"lbl q-mb-xs"},"Responsables",-1)),l("div",Wt,[r.caso?.psicologica_user?(u(),g(ge,{key:0,dense:"",color:"pink-2","text-color":"pink-10",square:""},{default:n(()=>[y(" Psic.: "+f(r.caso.psicologica_user.name),1)]),_:1})):C("",!0),r.caso?.trabajo_social_user?(u(),g(ge,{key:1,dense:"",color:"teal-2","text-color":"teal-10",square:""},{default:n(()=>[y(" TS: "+f(r.caso.trabajo_social_user.name),1)]),_:1})):C("",!0),r.caso?.legal_user?(u(),g(ge,{key:2,dense:"",color:"amber-2","text-color":"amber-10",square:""},{default:n(()=>[y(" Legal: "+f(r.caso.legal_user.name),1)]),_:1})):C("",!0)])])])]),_:1}),t(A,{flat:"",bordered:"",class:"q-pa-sm q-mb-sm rounded-borders"},{default:n(()=>[l("div",Zt,[l("div",Jt,[t(p,{modelValue:o.filters.q,"onUpdate:modelValue":e[0]||(e[0]=a=>o.filters.q=a),dense:"",outlined:"",placeholder:"Buscar (título, descripción, usuario)"},{append:n(()=>[t(D,{name:"search"})]),_:1},8,["modelValue"])]),l("div",Xt,[t(Z,{modelValue:o.filters.tipo,"onUpdate:modelValue":e[1]||(e[1]=a=>o.filters.tipo=a),options:o.tipos,dense:"",outlined:"",label:"Tipo"},null,8,["modelValue","options"])]),l("div",Kt,[t(Z,{modelValue:o.filters.modulo,"onUpdate:modelValue":e[2]||(e[2]=a=>o.filters.modulo=a),options:o.modulos,dense:"",outlined:"",label:"Módulo"},null,8,["modelValue","options"])]),l("div",el,[t(p,{modelValue:o.filters.desde,"onUpdate:modelValue":e[3]||(e[3]=a=>o.filters.desde=a),type:"date",dense:"",outlined:"",label:"Desde"},null,8,["modelValue"])]),l("div",ol,[t(p,{modelValue:o.filters.hasta,"onUpdate:modelValue":e[4]||(e[4]=a=>o.filters.hasta=a),type:"date",dense:"",outlined:"",label:"Hasta"},null,8,["modelValue"])])])]),_:1}),t(We,{flat:"",bordered:"",rows:d.rowsFiltered,columns:o.columns,"row-key":"uid",loading:o.loading,"hide-bottom":"","rows-per-page-options":[0],class:"rounded-borders",onRowClick:d.clickSeguimiento},{"body-cell-actividad":n(a=>[t(ye,{props:a},{default:n(()=>[l("div",il,[t(D,{name:a.row.icon||"feed",size:"18px",class:"text-primary q-mt-xs"},null,8,["name"]),l("div",null,[l("div",tl,[y(f(a.row.tipo)+" ",1),e[17]||(e[17]=l("span",{class:"text-grey-7"},"·",-1)),y(" "+f(a.row.titulo||"—"),1)]),l("div",ll,f(a.row.descripcion||"—"),1)])])]),_:2},1032,["props"])]),"body-cell-fecha":n(a=>[t(ye,{props:a},{default:n(()=>[l("div",al,f(a.row.fecha||"—"),1),l("div",nl,f(a.row.usuario||"—"),1)]),_:2},1032,["props"])]),"body-cell-modulo":n(a=>[t(ye,{props:a},{default:n(()=>[t(ge,{dense:"",square:""},{default:n(()=>[y(f(a.row.modulo||"—"),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-acciones":n(a=>[t(ye,{props:a,class:"q-gutter-xs"},{default:n(()=>[a.row.links?.pdf?(u(),g(v,{key:0,dense:"",flat:"",icon:"picture_as_pdf",onClick:s=>d.open(a.row.links.pdf),title:"Ver PDF"},null,8,["onClick"])):C("",!0),a.row.links?.view?(u(),g(v,{key:1,dense:"",flat:"",icon:"visibility",onClick:s=>d.open(a.row.links.view),title:"Ver"},null,8,["onClick"])):C("",!0),a.row.links?.download?(u(),g(v,{key:2,dense:"",flat:"",icon:"download",onClick:s=>d.open(a.row.links.download),title:"Descargar"},null,8,["onClick"])):C("",!0),a.row.links?.open?(u(),g(v,{key:3,dense:"",flat:"",icon:"open_in_new",onClick:s=>d.open(a.row.links.open),title:"Abrir"},null,8,["onClick"])):C("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading","onRowClick"])])}const dl=B(Ct,[["render",sl],["__scopeId","data-v-ca4c39da"]]),rl={informeSocial(i){const e=E=>E==null||E===""?"—":String(E),r=E=>{if(!E)return"—";const q=new Date(E);if(isNaN(q.getTime()))return e(E);const F=q.getFullYear(),j=String(q.getMonth()+1).padStart(2,"0"),H=String(q.getDate()).padStart(2,"0");return`${F}-${j}-${H}`},c=(E={})=>[E.denunciante_nombres,E.denunciante_paterno,E.denunciante_materno].filter(Boolean).join(" ")||"—",o=i?.denunciantes&&i.denunciantes[0]?i.denunciantes[0]:{},d=c(o),a=e(o?.denunciante_edad),s=r(o?.denunciante_fecha_nacimiento),m=e(o?.denunciante_lugar_nacimiento||"—"),k=e(o?.denunciante_grado),U=e(o?.denunciante_estado_civil),z=e(o?.denunciante_ocupacion),P=e(o?.denunciante_relacion),$=e(i?.caso_tipologia||i?.principal||"—"),T=e(i?.caso_numero);return`
<div style="border:1px solid #333;border-radius:6px;padding:14px;margin-bottom:12px;font-size:13px;line-height:1.4">

  <div style="text-align:center; font-weight:700; font-size:16px; margin-bottom:12px;">
    INFORME SOCIAL
  </div>

  <div style="margin-bottom:8px"><b>A :</b> __________________________</div>
  <div style="margin-bottom:8px">
    <b>DE :</b> <br/>
    TRABAJADORA SOCIAL - DIRECCION DE IGUALDAD DE OPORTUNIDADES
  </div>

  <div style="margin-top:10px;">
    <b>TIPOLOGIA:</b> ${$}<br/>
    <b>CASO:</b> ${T}
  </div>

  <div style="margin:18px 0; font-weight:700">I. REFERENCIA DEL CASO</div>
  <p>...</p>

  <div style="margin:18px 0; font-weight:700">II. DATOS PERSONALES</div>
  <div><b>NOMBRE Y APELLIDO:</b> ${d}</div>
  <div><b>EDAD:</b> ${a}</div>
  <div><b>FECHA DE NACIMIENTO:</b> ${s}</div>
  <div><b>LUGAR DE NACIMIENTO:</b> ${m}</div>
  <div><b>GRADO DE INSTRUCCIÓN:</b> ${k}</div>
  <div><b>ESTADO CIVIL:</b> ${U}</div>
  <div><b>OCUPACION:</b> ${z}</div>
  <div><b>NOMBRE DE CONTACTO:</b> ${P}</div>

  <div style="margin:18px 0; font-weight:700">III. GRUPO FAMILIAR NUCLEAR</div>
  <p>...</p>

  <div style="margin:18px 0; font-weight:700">IV. INTERVENCION TECNICOS Y/O INSTRUMENTOS UTILIZADOS</div>
  <p>...</p>

  <div style="margin:18px 0; font-weight:700">V. HISTORIA SOCIAL</div>
  <p>...</p>

  <div style="margin:18px 0; font-weight:700">VI. SITUACION ACTUAL</div>
  <p>...</p>

  <div style="margin:18px 0; font-weight:700">VII. DIAGNOSTICO SOCIAL</div>
  <p>...</p>

  <div style="margin:18px 0; font-weight:700">VIII. RECOMENDACIONES</div>
  <p>...</p>

  <div style="margin-top:36px;text-align:center">
    __________________________<br/>
    <br/>
    Trabajadora Social
  </div>
</div>
  `}},cl={name:"SocialInformes",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:null}},data(){return{openSubirArchivo:!1,file:null,loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dialog:!1,mode:"create",form:{id:null,fecha:"",titulo:"",area:"psicologico",numero:"",contenido_html:""},plantilla:"informe_social",plantillasOptions:[{label:"Informe Social",value:"informe_social"},{label:"Acto Social",value:"acto_social"}],areas:[{label:"Psicológico",value:"psicologico"},{label:"Legal",value:"legal"},{label:"Social",value:"social"}]}},methods:{today(){const i=new Date,e=r=>String(r).padStart(2,"0");return`${i.getFullYear()}-${e(i.getMonth()+1)}-${e(i.getDate())}`},guardarInforme(){if(!this.file){this.$q.notify({type:"negative",message:"Seleccione un archivo"});return}if(!this.form.titulo){this.$q.notify({type:"negative",message:"El título es obligatorio"});return}const i=new FormData;i.append("titulo",this.form.titulo),i.append("file",this.file),this.saving=!0,this.$axios.post(`/casos/${this.caseId}/sesiones-psicologicas/upload`,i,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{this.$q.notify({type:"positive",message:"Informe subido"}),this.openSubirArchivo=!1,this.file=null,this.form.titulo="",this.$emit("refresh")}).catch(e=>{this.$q.notify({type:"negative",message:e?.response?.data?.message||"No se pudo subir el informe"})}).finally(()=>{this.saving=!1})},onFileChange(i){this.file=i},openSubirInforme(){this.openSubirArchivo=!0},openCreate(){this.mode="create",this.form={id:null,fecha:this.today(),titulo:"",area:"psicologico",numero:"",contenido_html:""},this.dialog=!0,this.$nextTick(()=>this.applyTemplate(this.plantilla))},openView(i){this.mode="view",this.form={...i},this.dialog=!0},openEdit(i){this.mode="edit",this.form={...i},this.dialog=!0},applyTemplate(i){this.mode!=="view"&&(this.form.contenido_html="",i==="informe_social"&&(this.form.contenido_html=rl.informeSocial(this.caso)))},async save(){if(!this.form.titulo)return this.$q.notify({type:"negative",message:"El título es obligatorio"});if(!this.form.contenido_html)return this.$q.notify({type:"negative",message:"El contenido está vacío"});this.saving=!0;try{this.form.id?await this.$axios.put(`/informes-sociales/${this.form.id}`,this.form):await this.$axios.post(`/casos/${this.caseId}/informes-sociales`,this.form),this.$q.notify({type:"positive",message:"Guardado"}),this.$emit("refresh"),this.dialog=!1}catch(i){this.$q.notify({type:"negative",message:i?.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}},removeIt(i){const e=async()=>{try{await this.$axios.delete(`/informes-sociales/${i.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.$emit("refresh")}catch(r){this.$q.notify({type:"negative",message:r?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar el informe?").onOk(e):confirm("¿Eliminar el informe?")&&e()},printPdf(i){const e=this.$url||"";window.open(`${e}/informesSocial/${i.id}/pdf`,"_blank")}}},ul={class:"row items-center q-mb-sm"},ml={class:"col"},fl={class:"text-caption text-grey-7"},pl={class:"col-auto row items-center q-gutter-sm"},_l={key:0},gl={class:"text-subtitle1"},vl={class:"row"},hl={class:"col-12 col-md-3"},bl={class:"col-12 col-md-5"},yl={class:"col-6 col-md-2"},xl={class:"col-6 col-md-2"},Il={key:0};function Cl(i,e,r,c,o,d){return u(),g(A,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[l("div",ul,[l("div",ml,[e[12]||(e[12]=l("div",{class:"text-subtitle1 text-weight-medium"},"Informes",-1)),l("div",fl,"Vinculados al caso #"+f(r.caseId),1)]),l("div",pl,[t(p,{dense:"",outlined:"",modelValue:o.search,"onUpdate:modelValue":e[0]||(e[0]=a=>o.search=a),placeholder:"Buscar...",style:{width:"260px"}},{append:n(()=>[t(D,{name:"search"})]),_:1},8,["modelValue"]),t(v,{flat:"",color:"primary",icon:"refresh",loading:o.loading,onClick:e[1]||(e[1]=a=>i.$emit("refresh"))},null,8,["loading"]),t(v,{color:"green",icon:"add_circle_outline","no-caps":"",label:"Crear informe",onClick:d.openCreate},null,8,["onClick"]),t(v,{color:"primary",icon:"upload","no-caps":"",label:"Subir Informe",onClick:d.openSubirInforme},null,8,["onClick"])])]),t(V),t(Ce,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:n(()=>[e[18]||(e[18]=l("thead",null,[l("tr",{class:"bg-primary text-white"},[l("th",{style:{width:"70px"}},"ID"),l("th",{style:{width:"140px"}},"Acciones"),l("th",null,"Título"),l("th",{style:{width:"120px"}},"Fecha"),l("th",{style:{width:"130px"}},"Área"),l("th",{style:{width:"120px"}},"Nro"),l("th",{style:{width:"180px"}},"Usuario")])],-1)),l("tbody",null,[(u(!0),N(oe,null,fe(r.caso.informes_sociales,a=>(u(),N("tr",{key:a.id},[l("td",null,"#"+f(a.id),1),l("td",null,[t(ve,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:n(()=>[x((u(),g(S,{clickable:"",onClick:s=>d.openView(a)},{default:n(()=>[t(h,{avatar:""},{default:n(()=>[t(D,{name:"visibility"})]),_:1}),t(h,null,{default:n(()=>e[13]||(e[13]=[y("Ver")])),_:1})]),_:2},1032,["onClick"])),[[I]]),x((u(),g(S,{clickable:"",onClick:s=>d.printPdf(a)},{default:n(()=>[t(h,{avatar:""},{default:n(()=>[t(D,{name:"picture_as_pdf"})]),_:1}),t(h,null,{default:n(()=>e[14]||(e[14]=[y("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[I]]),t(V),x((u(),g(S,{clickable:"",onClick:s=>d.openEdit(a)},{default:n(()=>[t(h,{avatar:""},{default:n(()=>[t(D,{name:"edit"})]),_:1}),t(h,null,{default:n(()=>e[15]||(e[15]=[y("Editar")])),_:1})]),_:2},1032,["onClick"])),[[I]]),x((u(),g(S,{clickable:"",onClick:s=>d.removeIt(a)},{default:n(()=>[t(h,{avatar:""},{default:n(()=>[t(D,{name:"delete",color:"negative"})]),_:1}),t(h,{class:"text-negative"},{default:n(()=>e[16]||(e[16]=[y("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[I]])]),_:2},1024)]),l("td",null,f(a.titulo),1),l("td",null,f(a.fecha||"s/f"),1),l("td",null,f(a.area||"—"),1),l("td",null,f(a.numero||"—"),1),l("td",null,f(a.user?.name||a.user?.username||"—"),1)]))),128)),r.caso.informes_sociales.length?C("",!0):(u(),N("tr",_l,e[17]||(e[17]=[l("td",{colspan:"7",class:"text-center text-grey"},"Sin registros",-1)])))])]),_:1}),t(ie,{modelValue:o.dialog,"onUpdate:modelValue":e[8]||(e[8]=a=>o.dialog=a),persistent:"",maximized:""},{default:n(()=>[t(A,null,{default:n(()=>[t(Ue,{class:"bg-white text-dark"},{default:n(()=>[l("div",gl,f(o.mode==="view"?"Ver informe":o.form.id?"Editar informe":"Nuevo informe"),1),t(X),x(t(v,{flat:"",dense:"",round:"",icon:"close"},null,512),[[I]])]),_:1}),t(V),t(O,{class:"q-gutter-md"},{default:n(()=>[l("div",vl,[l("div",hl,[t(p,{modelValue:o.form.fecha,"onUpdate:modelValue":e[2]||(e[2]=a=>o.form.fecha=a),type:"date",dense:"",outlined:"",label:"Fecha",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),l("div",bl,[t(p,{modelValue:o.form.titulo,"onUpdate:modelValue":e[3]||(e[3]=a=>o.form.titulo=a),dense:"",outlined:"",label:"Título *",readonly:o.mode==="view",rules:[a=>!!a||"Requerido"]},null,8,["modelValue","readonly","rules"])]),l("div",yl,[t(Z,{modelValue:o.form.area,"onUpdate:modelValue":e[4]||(e[4]=a=>o.form.area=a),options:o.areas,dense:"",outlined:"",label:"Área",readonly:o.mode==="view","emit-value":"","map-options":""},null,8,["modelValue","options","readonly"])]),l("div",xl,[t(p,{modelValue:o.form.numero,"onUpdate:modelValue":e[5]||(e[5]=a=>o.form.numero=a),dense:"",outlined:"",label:"Nro",readonly:o.mode==="view"},null,8,["modelValue","readonly"])])]),o.mode!=="view"?(u(),N("div",Il,[t(Z,{modelValue:o.plantilla,"onUpdate:modelValue":[e[6]||(e[6]=a=>o.plantilla=a),d.applyTemplate],options:o.plantillasOptions,label:"Plantilla",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])])):C("",!0),l("div",null,[e[19]||(e[19]=l("div",{class:"text-caption text-grey-7 q-mb-xs"},"Contenido (WYSIWYG / guarda HTML)",-1)),t(Ae,{modelValue:o.form.contenido_html,"onUpdate:modelValue":e[7]||(e[7]=a=>o.form.contenido_html=a),readonly:o.mode==="view","min-height":"320px",placeholder:"Escriba el informe...",toolbar:[["left","center","right","justify"],["bold","italic","strike","underline"],["quote","unordered","ordered","outdent","indent"],["hr","link"],["undo","redo"],["removeFormat"]]},null,8,["modelValue","readonly"])])]),_:1}),t(V),t(J,{align:"right"},{default:n(()=>[x(t(v,{flat:"",label:"Cerrar"},null,512),[[I]]),o.mode!=="view"?(u(),g(v,{key:0,color:"primary",label:"Guardar",loading:o.saving,onClick:d.save},null,8,["loading","onClick"])):C("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ie,{modelValue:o.openSubirArchivo,"onUpdate:modelValue":e[11]||(e[11]=a=>o.openSubirArchivo=a),persistent:""},{default:n(()=>[t(A,{style:{"max-width":"500px",width:"90vw"}},{default:n(()=>[t(O,{class:"row items-center q-pb-none"},{default:n(()=>[e[20]||(e[20]=l("div",{class:"text-subtitle1"},"Subir informe",-1)),t(X),x(t(v,{flat:"",round:"",dense:"",icon:"close"},null,512),[[I]])]),_:1}),t(O,{class:"q-gutter-md"},{default:n(()=>[e[21]||(e[21]=l("div",{class:"text-body2 q-mb-sm"}," Aquí puede subir un informe psicológico ya elaborado (PDF, Word, etc.) y vincularlo al caso. ",-1)),t(p,{modelValue:o.form.titulo,"onUpdate:modelValue":e[9]||(e[9]=a=>o.form.titulo=a),dense:"",outlined:"",label:"Título informe *",rules:[a=>!!a||"Requerido"]},null,8,["modelValue","rules"]),t(Ie,{modelValue:o.file,"onUpdate:modelValue":[e[10]||(e[10]=a=>o.file=a),d.onFileChange],label:"Seleccionar archivo",outlined:"",dense:"",accept:".pdf,.doc,.docx,.odt,.png,.jpg,.jpeg"},null,8,["modelValue","onUpdate:modelValue"]),t(v,{color:"primary",label:"Guardar",disabled:!o.file||!o.form.titulo,onClick:d.guardarInforme},null,8,["disabled","onClick"])]),_:1}),t(V),t(J,{align:"right"},{default:n(()=>[x(t(v,{flat:"",label:"Cerrar"},null,512),[[I]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const wl=B(cl,[["render",Cl]]),El={name:"CodigoCaso",props:{caso:{type:Object,required:!0}},data(){return{editMode:!1,loading:!1,form:{nurej:null,cud:null}}},watch:{caso:{immediate:!0,deep:!0,handler(i){this.form.nurej=i?.nurej??null,this.form.cud=i?.cud??null}}},methods:{toggleEdit(){this.editMode&&(this.form.nurej=this.caso?.nurej??null,this.form.cud=this.caso?.cud??null),this.editMode=!this.editMode},async guardar(){this.loading=!0;try{const i={nurej:this.form.nurej,cud:this.form.cud};await this.$axios.put(`casos/${this.caso.id}/codigos`,i),this.$emit("actualizado"),this.editMode=!1,this.$q.notify({type:"positive",message:"Códigos actualizados correctamente."})}catch(i){console.error(i),this.$q.notify({type:"negative",message:"Error al actualizar los códigos."})}finally{this.loading=!1}}}},Dl={class:"row items-center q-gutter-sm q-mb-md"},Vl={class:"row q-col-gutter-md"},Nl={class:"col-12 col-md-6"},Al={class:"col-12 col-md-6"};function Sl(i,e,r,c,o,d){return u(),g(A,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[l("div",Dl,[t(je,{icon:"qr_code_2",color:"primary","text-color":"white"}),e[2]||(e[2]=l("div",null,[l("div",{class:"text-h6 text-weight-bold"},"Códigos del Caso"),l("div",{class:"text-caption text-grey-7"},"NUREJ y CUD")],-1)),t(X),t(v,{label:o.editMode?"Cancelar":"Editar",icon:o.editMode?"close":"edit",flat:"",color:"primary",onClick:d.toggleEdit},null,8,["label","icon","onClick"]),o.editMode?(u(),g(v,{key:0,color:"primary",icon:"save",label:"Guardar",loading:o.loading,onClick:d.guardar},null,8,["loading","onClick"])):C("",!0)]),t(V,{spaced:""}),l("div",Vl,[l("div",Nl,[t(p,{modelValue:o.form.nurej,"onUpdate:modelValue":e[0]||(e[0]=a=>o.form.nurej=a),readonly:!o.editMode,filled:"",label:"NUREJ",dense:i.$q.screen.lt.md},{prepend:n(()=>[t(D,{name:"tag"})]),_:1},8,["modelValue","readonly","dense"])]),l("div",Al,[t(p,{modelValue:o.form.cud,"onUpdate:modelValue":e[1]||(e[1]=a=>o.form.cud=a),readonly:!o.editMode,filled:"",label:"CUD",dense:i.$q.screen.lt.md},{prepend:n(()=>[t(D,{name:"confirmation_number"})]),_:1},8,["modelValue","readonly","dense"])])])]),_:1})}const Ol=B(El,[["render",Sl],["__scopeId","data-v-9cc36eb8"]]),kl={name:"CasoDetalle",components:{Codigo:Ol,CasoNuevoPROPREMI:eo,CasoNuevoUMADIS:Ke,CasoNuevoSLAM:Xe,CasoNuevoDNA:Je,SocialInformes:wl,SlimNuevo:Ze,Seguimiento:dl,HojaRuta:It,InfoGeneral:ei,Problematica:_i,SesionesPsicologico:ki,InformesLegal:Qi,ApoyoIntegral:Ji,DocumentosGeneral:nt,Fotografias:_t},data(){return{loading:!1,tab:"info",caso:null,defaultCountryCallingCode:"591"}},computed:{caseId(){return this.$route.params.id},role(){return this.$store.user?.role||""},hasAnyWa(){const i=this.caso||{};return!!(i?.psicologica_user?.celular||i?.legal_user?.celular||i?.trabajo_social_user?.celular)}},created(){this.fetchCaso()},methods:{eliminarCaso(){this.$q.dialog({title:"Confirmar eliminación",message:"¿Estás seguro de que deseas eliminar este caso? Esta acción no se puede deshacer.",cancel:!0,persistent:!0}).onOk(async()=>{try{await this.$axios.delete(`/casos/${this.caseId}`),this.$q.notify({type:"positive",message:"Caso eliminado exitosamente."}),this.$router.back()}catch(i){this.$alert.error(i?.response?.data?.message||"No se pudo eliminar el caso")}})},normalizePhone(i){if(!i)return"";let e=String(i).replace(/\D+/g,"");return/^(\d{11,13})$/.test(e)?e:e.length===8?this.defaultCountryCallingCode+e:e.length===9&&!e.startsWith(this.defaultCountryCallingCode)?this.defaultCountryCallingCode+e:e},waUrl(i,e){const r=this.normalizePhone(i),c=encodeURIComponent(e||"");return`https://wa.me/${r}${c?`?text=${c}`:""}`},waMessage(i){const e=this.caso||{},r=e.caso_numero?e.caso_numero.replace(/\\\//g,"/"):`#${this.caseId}`,c=(this.$axios?.defaults?.baseURL||"")+`/casos/${this.caseId}`,o=i==="psico"?"Psicología":i==="legal"?"Legal":"Trabajo Social";return["*SLIM - Notificación de Caso*",`Nro: ${r}`,`Área: ${o}`,`Denunciante: ${e.denunciante_nombre_completo||"—"}`,e.caso_tipologia?`Tipología: ${e.caso_tipologia}`:null,e.caso_modalidad?`Modalidad: ${e.caso_modalidad}`:null,e.caso_fecha_hecho?`Fecha del hecho: ${e.caso_fecha_hecho}`:null,"",`Ver caso: ${c}`].filter(Boolean).join(`
`)},sendWhatsApp(i){const e=this.caso||{},r=i==="psico"?e.psicologica_user:i==="legal"?e.legal_user:i==="social"?e.trabajo_social_user:null;if(!r?.celular){this.$q.notify({type:"warning",message:"No hay número de celular configurado para ese responsable"});return}const c=this.waUrl(r.celular,this.waMessage(i));window.open(c,"_blank")},async fetchCaso(){this.loading=!0;try{const i=await this.$axios.get(`/casos/${this.caseId}`);this.caso=i.data}catch(i){this.$alert.error(i?.response?.data?.message||"No se pudo cargar el caso")}finally{this.loading=!1}},printPdf(){const i=this.$axios.defaults.baseURL+`/casos/${this.caseId}/pdf`;window.open(i,"_blank")},printPdfHojaRuta(i="denunciante"){const e=this.$axios.defaults.baseURL+`/casos/${this.caseId}/pdf/hoja-ruta?tipo=${i}`;window.open(e,"_blank")}}},Ul={class:"row items-center q-mb-md"},Tl={class:"col-12 col-md-4"},ql={class:"text-h6 text-weight-bold"},Rl={class:"text-subtitle2 text-black-7"},Ll={key:0},Ml={class:"col-auto row q-gutter-sm"};function Pl(i,e,r,c,o,d){const a=M("SlimNuevo"),s=M("CasoNuevoDNA"),m=M("CasoNuevoSLAM"),k=M("CasoNuevoUMADIS"),U=M("CasoNuevoPROPREMI"),z=M("Seguimiento"),P=M("Problematica"),$=M("HojaRuta"),T=M("SesionesPsicologico"),E=M("InformesLegal"),q=M("SocialInformes"),F=M("ApoyoIntegral"),j=M("DocumentosGeneral"),H=M("Fotografias"),K=M("Codigo");return u(),g(Be,{class:"q-pa-md bg-grey-2"},{default:n(()=>[l("div",Ul,[l("div",Tl,[l("div",ql,f(o.caso?.tipo)+" "+f(o.caso?.caso_numero||"..."),1),l("div",Rl,[t(D,{name:"calendar_today",class:"q-mr-sm"}),y(" Abierto "+f(o.caso?.fecha_apertura_caso?new Date(o.caso.fecha_apertura_caso).toLocaleDateString():"...")+" ",1),o.caso?.fecha_apertura_caso?(u(),N("span",Ll," (hace "+f(Math.floor((new Date-new Date(o.caso.fecha_apertura_caso))/(1e3*60*60*24)))+" días)",1)):C("",!0)])]),l("div",Ml,[d.hasAnyWa?(u(),g(ve,{key:0,flat:"",color:"positive",icon:"chat",label:"WhatsApp"},{default:n(()=>[t(Ne,null,{default:n(()=>[o.caso?.psicologica_user?.celular?(u(),g(S,{key:0,clickable:"",onClick:e[0]||(e[0]=R=>d.sendWhatsApp("psico"))},{default:n(()=>[t(h,{avatar:""},{default:n(()=>[t(D,{name:"psychology"})]),_:1}),t(h,null,{default:n(()=>[y("Psicología ("+f(o.caso.psicologica_user.name)+")",1)]),_:1}),t(h,{side:"",class:"text-caption text-grey"},{default:n(()=>[y(f(o.caso.psicologica_user.celular),1)]),_:1})]),_:1})):C("",!0),o.caso?.legal_user?.celular?(u(),g(S,{key:1,clickable:"",onClick:e[1]||(e[1]=R=>d.sendWhatsApp("legal"))},{default:n(()=>[t(h,{avatar:""},{default:n(()=>[t(D,{name:"gavel"})]),_:1}),t(h,null,{default:n(()=>[y("Legal ("+f(o.caso.legal_user.name)+")",1)]),_:1}),t(h,{side:"",class:"text-caption text-grey"},{default:n(()=>[y(f(o.caso.legal_user.celular),1)]),_:1})]),_:1})):C("",!0),o.caso?.trabajo_social_user?.celular?(u(),g(S,{key:2,clickable:"",onClick:e[2]||(e[2]=R=>d.sendWhatsApp("social"))},{default:n(()=>[t(h,{avatar:""},{default:n(()=>[t(D,{name:"people"})]),_:1}),t(h,null,{default:n(()=>[y("Trabajo social ("+f(o.caso.trabajo_social_user.name)+")",1)]),_:1}),t(h,{side:"",class:"text-caption text-grey"},{default:n(()=>[y(f(o.caso.trabajo_social_user.celular),1)]),_:1})]),_:1})):C("",!0)]),_:1})]),_:1})):C("",!0),t(ve,{flat:"",color:"secondary",icon:"print",label:"Imprimir PDF"},{default:n(()=>[t(Ne,null,{default:n(()=>[x((u(),g(S,{clickable:"",onClick:d.printPdf},{default:n(()=>[t(h,null,{default:n(()=>e[8]||(e[8]=[y("Ficha del Caso")])),_:1})]),_:1},8,["onClick"])),[[I]]),t(V),x((u(),g(S,{clickable:"",onClick:e[3]||(e[3]=R=>d.printPdfHojaRuta("denunciante"))},{default:n(()=>[t(h,null,{default:n(()=>e[9]||(e[9]=[y("Ubicacion (Denunciante)")])),_:1})]),_:1})),[[I]]),x((u(),g(S,{clickable:"",onClick:e[4]||(e[4]=R=>d.printPdfHojaRuta("denunciado"))},{default:n(()=>[t(h,null,{default:n(()=>e[10]||(e[10]=[y("Ubicacion (Denunciado)")])),_:1})]),_:1})),[[I]])]),_:1})]),_:1}),t(v,{flat:"",color:"primary",icon:"refresh",onClick:d.fetchCaso,loading:o.loading},null,8,["onClick","loading"]),d.role==="Administrador"?(u(),g(v,{key:1,flat:"",color:"negative",icon:"delete",label:"Eliminar Caso",onClick:e[5]||(e[5]=R=>d.eliminarCaso()),"no-caps":""})):C("",!0)])]),t(A,{flat:"",bordered:"",class:"q-mb-md"},{default:n(()=>[t(Ge,{modelValue:o.tab,"onUpdate:modelValue":e[6]||(e[6]=R=>o.tab=R),class:"text-primary",dense:"",align:"left","active-color":"primary","indicator-color":"primary","outside-arrows":"","mobile-arrows":""},{default:n(()=>[t(ee,{name:"info",label:"1 Información General",icon:"dashboard","no-caps":""}),t(ee,{name:"seguimiento",label:"2 Seguimiento",icon:"track_changes","no-caps":""}),t(ee,{name:"hoja",label:"3 Hoja de Ruta",icon:"report_problem","no-caps":""}),d.role==="Administrador"||d.role==="Psicologo"?(u(),g(ee,{key:0,name:"psico",label:"4 Área Psicológico",icon:"psychology","no-caps":""})):C("",!0),d.role==="Administrador"||d.role==="Abogado"?(u(),g(ee,{key:1,name:"legal",label:"5 Área Legal",icon:"gavel","no-caps":""})):C("",!0),d.role==="Administrador"||d.role==="Social"?(u(),g(ee,{key:2,name:"social",label:"6 Área Social",icon:"people","no-caps":""})):C("",!0),t(ee,{name:"docs",label:"7 Documentos General",icon:"folder","no-caps":""}),t(ee,{name:"fotos",label:"8 Fotografías",icon:"photo_library","no-caps":""}),t(ee,{name:"codigo",label:"9 Codigos",icon:"code","no-caps":""})]),_:1},8,["modelValue"])]),_:1}),t(ze,{modelValue:o.tab,"onUpdate:modelValue":e[7]||(e[7]=R=>o.tab=R),animated:"","keep-alive":""},{default:n(()=>[t(Y,{name:"info"},{default:n(()=>[o.caso?.tipo==="SLIM"?(u(),g(a,{key:0,casoId:o.caso.id,showNumeroApoyoIntegral:o.caso?.numero_apoyo_integral,editable:!0},null,8,["casoId","showNumeroApoyoIntegral"])):o.caso?.tipo==="DNA"?(u(),g(s,{key:1,casoId:o.caso.id,showNumeroApoyoIntegral:o.caso?.numero_apoyo_integral,editable:!0},null,8,["casoId","showNumeroApoyoIntegral"])):o.caso?.tipo==="SLAM"?(u(),g(m,{key:2,casoId:o.caso.id,showNumeroApoyoIntegral:o.caso?.numero_apoyo_integral,editable:!0},null,8,["casoId","showNumeroApoyoIntegral"])):o.caso?.tipo==="UMADIS"?(u(),g(k,{key:3,casoId:o.caso.id,showNumeroApoyoIntegral:o.caso?.numero_apoyo_integral,editable:!0},null,8,["casoId","showNumeroApoyoIntegral"])):o.caso?.tipo==="PROPREMI"?(u(),g(U,{key:4,casoId:o.caso.id,showNumeroApoyoIntegral:o.caso?.numero_apoyo_integral,editable:!0},null,8,["casoId","showNumeroApoyoIntegral"])):C("",!0)]),_:1}),t(Y,{name:"seguimiento"},{default:n(()=>[t(z,{caso:o.caso},null,8,["caso"])]),_:1}),t(Y,{name:"problematica"},{default:n(()=>[t(P,{"case-id":d.caseId},null,8,["case-id"])]),_:1}),t(Y,{name:"hoja"},{default:n(()=>[t($,{"case-id":d.caseId},null,8,["case-id"])]),_:1}),t(Y,{name:"psico"},{default:n(()=>[t(T,{"case-id":d.caseId,caso:o.caso,onRefresh:d.fetchCaso},null,8,["case-id","caso","onRefresh"])]),_:1}),t(Y,{name:"legal"},{default:n(()=>[t(E,{"case-id":d.caseId,caso:o.caso,onRefresh:d.fetchCaso},null,8,["case-id","caso","onRefresh"])]),_:1}),t(Y,{name:"social"},{default:n(()=>[t(q,{caso:o.caso,onRefresh:d.fetchCaso,"case-id":d.caseId},null,8,["caso","onRefresh","case-id"])]),_:1}),t(Y,{name:"apoyo"},{default:n(()=>[t(F,{"case-id":d.caseId},null,8,["case-id"])]),_:1}),t(Y,{name:"docs"},{default:n(()=>[t(j,{"case-id":d.caseId,caso:o.caso,onRefresh:d.fetchCaso},null,8,["case-id","caso","onRefresh"])]),_:1}),t(Y,{name:"fotos"},{default:n(()=>[t(H,{"case-id":d.caseId,caso:o.caso,onRefresh:d.fetchCaso},null,8,["case-id","caso","onRefresh"])]),_:1}),t(Y,{name:"codigo"},{default:n(()=>[t(K,{"case-id":d.caseId,caso:o.caso,onRefresh:d.fetchCaso},null,8,["case-id","caso","onRefresh"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}const fa=B(kl,[["render",Pl],["__scopeId","data-v-4f04f947"]]);export{fa as default};
