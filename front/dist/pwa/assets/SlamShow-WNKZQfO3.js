import{_ as S,Y as E,a0 as V,o as c,b as i,$ as y,c as p,f as _,a1 as U,a as l,w as a,e as v,Z as m,t as r,Q as w,d as h,a3 as C,a6 as u,a7 as ae,aa as N,a2 as Y,W as x,h as H,a8 as Q}from"./index-DpunrW0G.js";import{a as q,d as g,Q as ee}from"./format-xuGwOK_p.js";import{Q as M,a as ie}from"./QList-BZgYmwuZ.js";import{S as L,Q as te,a as ne,b as de,c as re,d as P,e as ce,f as R}from"./QFile-BBDvUfkT.js";import{Q as ue}from"./QPage-2HawpGZ7.js";import{C as k}from"./ClosePopup-DnVcUdcO.js";import{Q as D}from"./QSelect-EjbEQcH9.js";import{M as me}from"./MapPicker-R1lUUj17.js";import{Q as oe}from"./QMarkupTable-DwTSUPts.js";import{Q as Z}from"./QPagination-VE9y3yOv.js";import{Q as W}from"./QSpace-BEkj4cUf.js";import{Q as fe}from"./QImg-DhKcwomB.js";import{Q as pe,a as F}from"./QTimeline-Q9S4_PXm.js";import{a as B,Q as ge}from"./QTable-BOc3fX33.js";import"./QResizeObserver-C8dgeB_o.js";import"./touch-BjYP5sR0.js";import"./QTooltip-Ca_pFLQf.js";import"./_commonjsHelpers-Cpj98o6Y.js";const _e={name:"InfoGeneral",components:{MapPicker:me},props:{caseId:{type:[String,Number],required:!0}},data(){return{documentos:[{label:"Carnet de identidad",value:"Carnet de identidad"},{label:"Pasaporte",value:"Pasaporte"},{label:"Libreta de servicio militar",value:"Libreta de servicio militar"},{label:"Libreta de conducir",value:"Libreta de conducir"}],loading:!1,editing:!1,form:{},backup:null,oruroCenter:[-17.9667,-67.1167],psicologos:[],abogados:[],sociales:[]}},computed:{canEdit(){const t=this.$store.user?.role||"";return t==="Administrador"||t==="Asistente"},denunciantePos:{get(){return{latitud:this.form.latitud,longitud:this.form.longitud}},set(t){this.form.latitud=t.latitud,this.form.longitud=t.longitud}},denunciadoPos:{get(){return{latitud:this.form.denunciado_latitud,longitud:this.form.denunciado_longitud}},set(t){this.form.denunciado_latitud=t.latitud,this.form.denunciado_longitud=t.longitud}},optPsicologos(){return this.psicologos.map(t=>({label:t.name,value:t.id}))},optAbogados(){return this.abogados.map(t=>({label:t.name,value:t.id}))},optSociales(){return this.sociales.map(t=>({label:t.name,value:t.id}))},nombreDenunciante(){const t=this.form||{},e=t.denunciante_nombre_completo&&t.denunciante_nombre_completo.trim();return e||[t.denunciante_nombres,t.denunciante_paterno,t.denunciante_materno].filter(Boolean).join(" ")||"—"}},created(){this.fetch(),this.fetchRoles()},methods:{req(t){return!!t||"Requerido"},orDash(t){return t||"—"},nombreUsuario(t,e,f){if(t&&t.name)return t.name;const b=(f||[]).find(o=>Number(o.id)===Number(e));return b?b.name||b.name:"—"},onBirthChange(t){const e=t==="denunciado"?"denunciado":"denunciante",f=this.form[`${e}_fecha_nacimiento`];if(!f){this.form[`${e}_edad`]="";return}const b=new Date(f),o=Date.now()-b.getTime(),n=new Date(o);this.form[`${e}_edad`]=Math.abs(n.getUTCFullYear()-1970)},async fetchRoles(){try{const{data:t}=await this.$axios.get("/usuariosRole");this.psicologos=t.psicologos||[],this.abogados=t.abogados||[],this.sociales=t.sociales||[]}catch{this.$alert.error("No se pudo cargar los usuarios por rol")}},async fetch(){this.loading=!0;try{const t=await this.$axios.get(`/slims/${this.caseId}`);this.form={...t.data},!this.form.psicologica_user_id&&this.form.psicologica_user?.id&&(this.form.psicologica_user_id=this.form.psicologica_user.id),!this.form.trabajo_social_user_id&&this.form.trabajo_social_user?.id&&(this.form.trabajo_social_user_id=this.form.trabajo_social_user.id),!this.form.legal_user_id&&this.form.legal_user?.id&&(this.form.legal_user_id=this.form.legal_user.id),this.backup={...this.form}}catch(t){this.$alert.error(t?.response?.data?.message||"No se pudo cargar el SLIM")}finally{this.loading=!1}},startEdit(){this.canEdit&&(this.editing=!0,this.backup={...this.form})},cancelEdit(){this.form={...this.backup},this.editing=!1,this.$q.notify({type:"info",message:"Cambios descartados"})},async save(){if(this.canEdit){this.loading=!0;try{const t=await this.$axios.put(`/slims/${this.caseId}`,this.form);this.form={...t.data.data},this.backup={...this.form},this.editing=!1,this.$alert.success("Información general actualizada")}catch(t){this.$alert.error(t?.response?.data?.message||"No se pudo actualizar")}finally{this.loading=!1}}}}},he={class:"row items-center q-mb-sm"},be={key:0,class:"col-auto row q-gutter-sm"},ve={class:"col-6 col-md-3"},ye={class:"col-6 col-md-3"},Ve={class:"col-12 col-md-6"},we={class:"col-6 col-md-4"},xe={class:"col-6 col-md-4"},ke={class:"col-12"},Ce={class:"ellipsis-3"},qe={class:"col-6 col-md-2"},Ue={class:"col-6 col-md-2"},Ie={class:"col-12 col-md-6"},De={class:"col-6 col-md-3"},Ee={class:"col-6 col-md-3"},Se={class:"col-6 col-md-3"},je={class:"col-6 col-md-3"},Re={class:"col-6 col-md-3"},Pe={class:"col-6 col-md-3"},Ne={class:"col-6 col-md-3"},Te={class:"col-6 col-md-3"},Ae={class:"col-12"},Le={class:"col-12 col-md-6"},Fe={class:"col-6 col-md-3"},Qe={class:"col-6 col-md-3"},Me={class:"col-6 col-md-3"},Oe={class:"col-6 col-md-3"},ze={class:"col-6 col-md-3"},Ge={class:"col-6 col-md-3"},Be={class:"col-12"},He={class:"col-12 col-md-4"},We={class:"col-12 col-md-4"},Ye={class:"col-12 col-md-4"},Ze={class:"row q-col-gutter-md"},Je={class:"col-12 col-md-3"},Xe={class:"col-12 col-md-3"},Ke={class:"col-12 col-md-6"},$e={class:"col-12 col-md-4"},eo={class:"col-12"},oo={class:"row q-col-gutter-md"},lo={class:"col-12 col-md-2"},io={class:"col-12 col-md-2"},to={class:"col-12 col-md-2"},so={class:"col-12 col-md-2"},ao={class:"col-12 col-md-2"},no={class:"col-6 col-md-3"},ro={class:"col-6 col-md-3"},co={class:"col-6 col-md-3"},uo={class:"col-6 col-md-3"},mo={class:"col-6 col-md-3"},fo={class:"col-6 col-md-3"},po={class:"col-6 col-md-3"},go={class:"col-6 col-md-3"},_o={class:"col-6 col-md-3"},ho={class:"col-6 col-md-3"},bo={class:"col-6 col-md-3"},vo={class:"col-12 col-md-3"},yo={class:"col-12 col-md-3"},Vo={class:"col-12"},wo={class:"col-12"},xo={class:"row q-col-gutter-md"},ko={class:"col-12 col-md-6"},Co={class:"col-6 col-md-3"},qo={class:"col-6 col-md-3"},Uo={class:"col-6 col-md-3"},Io={class:"col-6 col-md-3"},Do={class:"col-6 col-md-3"},Eo={class:"col-6 col-md-3"},So={class:"col-6 col-md-3"},jo={class:"col-6 col-md-3"},Ro={class:"col-6 col-md-3"},Po={class:"col-12"},No={class:"col-12"},To={class:"row q-col-gutter-md"},Ao={class:"col-12 col-md-4"},Lo={class:"col-12 col-md-4"},Fo={class:"col-12 col-md-4"},Qo={class:"row q-col-gutter-md"},Mo={class:"col-12 col-md-2"},Oo={class:"col-12 col-md-2"},zo={class:"col-12 col-md-2"},Go={class:"col-12 col-md-2"},Bo={class:"col-12 col-md-2"},Ho={class:"col-12 col-md-2"};function Wo(t,e,f,b,o,n){const s=E("MapPicker");return c(),V("div",null,[i("div",he,[e[48]||(e[48]=i("div",{class:"col"},[i("div",{class:"text-subtitle1 text-weight-medium"},"Información General")],-1)),n.canEdit?(c(),V("div",be,[o.editing?(c(),V(U,{key:1},[l(_,{flat:"",color:"negative",icon:"close",label:"Cancelar",onClick:n.cancelEdit,loading:o.loading},null,8,["onClick","loading"]),l(_,{color:"primary",icon:"save",label:"Guardar",onClick:n.save,loading:o.loading},null,8,["onClick","loading"])],64)):(c(),p(_,{key:0,color:"primary",icon:"edit",label:"Editar",onClick:n.startEdit,loading:o.loading},null,8,["onClick","loading"]))])):y("",!0)]),n.canEdit?(c(),V(U,{key:1},[l(w,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:a(()=>[l(v,null,{default:a(()=>[i("div",Ze,[i("div",Je,[l(u,{modelValue:o.form.caso_numero,"onUpdate:modelValue":e[0]||(e[0]=d=>o.form.caso_numero=d),readonly:!0,dense:"",outlined:"",label:"Nro de SLIM"},null,8,["modelValue"])]),i("div",Xe,[l(u,{modelValue:o.form.caso_fecha_hecho,"onUpdate:modelValue":e[1]||(e[1]=d=>o.form.caso_fecha_hecho=d),readonly:!o.editing,type:"date",dense:"",outlined:"",label:"Fecha del hecho"},null,8,["modelValue","readonly"])]),i("div",Ke,[l(u,{modelValue:o.form.caso_lugar_hecho,"onUpdate:modelValue":e[2]||(e[2]=d=>o.form.caso_lugar_hecho=d),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Lugar del hecho"},null,8,["modelValue","readonly"])]),i("div",$e,[l(u,{modelValue:o.form.caso_tipologia,"onUpdate:modelValue":e[3]||(e[3]=d=>o.form.caso_tipologia=d),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Tipología"},null,8,["modelValue","readonly"])]),i("div",eo,[l(u,{modelValue:o.form.caso_descripcion,"onUpdate:modelValue":e[4]||(e[4]=d=>o.form.caso_descripcion=d),readonly:!o.editing,type:"textarea",autogrow:"",outlined:"",dense:"",clearable:"",label:"Descripción del hecho",counter:"",maxlength:"3000"},null,8,["modelValue","readonly"])])])]),_:1})]),_:1}),l(w,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:a(()=>[l(v,{class:"row items-center"},{default:a(()=>[l(h,{name:"assignment_ind",class:"q-mr-sm"}),e[82]||(e[82]=i("div",{class:"text-subtitle1 text-weight-medium"},"Denunciante",-1))]),_:1}),l(C),l(v,null,{default:a(()=>[i("div",oo,[i("div",lo,[l(D,{modelValue:o.form.area,"onUpdate:modelValue":e[5]||(e[5]=d=>o.form.area=d),dense:"",outlined:"",readonly:!o.editing,options:t.$areas,label:"Área *",rules:[n.req]},null,8,["modelValue","readonly","options","rules"])]),i("div",io,[l(D,{modelValue:o.form.zona,"onUpdate:modelValue":e[6]||(e[6]=d=>o.form.zona=d),dense:"",outlined:"",readonly:!o.editing,options:t.$zonas,label:"Zona *",rules:[n.req]},null,8,["modelValue","readonly","options","rules"])]),i("div",to,[l(u,{modelValue:o.form.denunciante_nombres,"onUpdate:modelValue":e[7]||(e[7]=d=>o.form.denunciante_nombres=d),dense:"",outlined:"",clearable:"",readonly:!o.editing,label:"Nombres *",rules:[n.req]},null,8,["modelValue","readonly","rules"])]),i("div",so,[l(u,{modelValue:o.form.denunciante_paterno,"onUpdate:modelValue":e[8]||(e[8]=d=>o.form.denunciante_paterno=d),dense:"",outlined:"",clearable:"",readonly:!o.editing,label:"Apellido paterno"},null,8,["modelValue","readonly"])]),i("div",ao,[l(u,{modelValue:o.form.denunciante_materno,"onUpdate:modelValue":e[9]||(e[9]=d=>o.form.denunciante_materno=d),dense:"",outlined:"",clearable:"",readonly:!o.editing,label:"Apellido materno"},null,8,["modelValue","readonly"])]),i("div",no,[l(u,{modelValue:o.form.denunciante_lugar_nacimiento,"onUpdate:modelValue":e[10]||(e[10]=d=>o.form.denunciante_lugar_nacimiento=d),dense:"",outlined:"",clearable:"",label:"Lugar de nacimiento",readonly:!o.editing},null,8,["modelValue","readonly"])]),i("div",ro,[l(u,{modelValue:o.form.denunciante_fecha_nacimiento,"onUpdate:modelValue":[e[11]||(e[11]=d=>o.form.denunciante_fecha_nacimiento=d),e[12]||(e[12]=d=>n.onBirthChange("denunciante"))],type:"date",dense:"",outlined:"",label:"Fecha de nacimiento",readonly:!o.editing},null,8,["modelValue","readonly"])]),i("div",co,[l(u,{modelValue:o.form.denunciante_edad,"onUpdate:modelValue":e[13]||(e[13]=d=>o.form.denunciante_edad=d),modelModifiers:{number:!0},dense:"",outlined:"",type:"number",label:"Edad",readonly:!o.editing},null,8,["modelValue","readonly"])]),i("div",uo,[l(u,{modelValue:o.form.denunciante_telefono,"onUpdate:modelValue":e[14]||(e[14]=d=>o.form.denunciante_telefono=d),dense:"",outlined:"",clearable:"",label:"Teléfono/Celular",readonly:!o.editing},null,8,["modelValue","readonly"])]),i("div",mo,[l(u,{modelValue:o.form.denunciante_grado,"onUpdate:modelValue":e[15]||(e[15]=d=>o.form.denunciante_grado=d),dense:"",outlined:"",clearable:"",label:"Grado de instrucción",readonly:!o.editing},null,8,["modelValue","readonly"])]),i("div",fo,[l(u,{modelValue:o.form.denunciante_documento,"onUpdate:modelValue":e[16]||(e[16]=d=>o.form.denunciante_documento=d),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Documento"},null,8,["modelValue","readonly"])]),i("div",po,[l(u,{modelValue:o.form.denunciante_nro,"onUpdate:modelValue":e[17]||(e[17]=d=>o.form.denunciante_nro=d),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Nro documento"},null,8,["modelValue","readonly"])]),i("div",go,[l(u,{modelValue:o.form.denunciante_sexo,"onUpdate:modelValue":e[18]||(e[18]=d=>o.form.denunciante_sexo=d),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Sexo"},null,8,["modelValue","readonly"])]),i("div",_o,[l(u,{modelValue:o.form.denunciante_estado_civil,"onUpdate:modelValue":e[19]||(e[19]=d=>o.form.denunciante_estado_civil=d),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Estado civil"},null,8,["modelValue","readonly"])]),i("div",ho,[l(u,{modelValue:o.form.denunciante_residencia,"onUpdate:modelValue":e[20]||(e[20]=d=>o.form.denunciante_residencia=d),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Residencia"},null,8,["modelValue","readonly"])]),i("div",bo,[l(u,{modelValue:o.form.denunciante_idioma,"onUpdate:modelValue":e[21]||(e[21]=d=>o.form.denunciante_idioma=d),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Idioma"},null,8,["modelValue","readonly"])]),i("div",vo,[l(ae,{modelValue:o.form.denunciante_trabaja,"onUpdate:modelValue":e[22]||(e[22]=d=>o.form.denunciante_trabaja=d),disable:!o.editing,label:"Trabaja"},null,8,["modelValue","disable"])]),i("div",yo,[l(u,{modelValue:o.form.denunciante_ocupacion,"onUpdate:modelValue":e[23]||(e[23]=d=>o.form.denunciante_ocupacion=d),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Ocupación"},null,8,["modelValue","readonly"])]),i("div",Vo,[l(u,{modelValue:o.form.denunciante_domicilio_actual,"onUpdate:modelValue":e[24]||(e[24]=d=>o.form.denunciante_domicilio_actual=d),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Domicilio actual"},null,8,["modelValue","readonly"])]),i("div",wo,[e[83]||(e[83]=i("div",{class:"text-caption text-grey-7 q-mb-xs"},"Ubicación (denunciante)",-1)),l(s,{modelValue:n.denunciantePos,"onUpdate:modelValue":e[25]||(e[25]=d=>n.denunciantePos=d),center:o.oruroCenter},null,8,["modelValue","center"])])])]),_:1})]),_:1}),l(w,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:a(()=>[l(v,{class:"row items-center"},{default:a(()=>[l(h,{name:"person_pin_circle",class:"q-mr-sm"}),e[84]||(e[84]=i("div",{class:"text-subtitle1 text-weight-medium"},"Denunciado",-1))]),_:1}),l(C),l(v,null,{default:a(()=>[i("div",xo,[i("div",ko,[l(u,{modelValue:o.form.denunciado_nombre_completo,"onUpdate:modelValue":e[26]||(e[26]=d=>o.form.denunciado_nombre_completo=d),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Nombre completo"},null,8,["modelValue","readonly"])]),i("div",Co,[l(D,{modelValue:o.form.denunciado_documento,"onUpdate:modelValue":e[27]||(e[27]=d=>o.form.denunciado_documento=d),dense:"",outlined:"",readonly:!o.editing,"emit-value":"","map-options":"",options:o.documentos,label:"Documento"},null,8,["modelValue","readonly","options"])]),i("div",qo,[l(u,{modelValue:o.form.denunciado_nro,"onUpdate:modelValue":e[28]||(e[28]=d=>o.form.denunciado_nro=d),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Nro documento"},null,8,["modelValue","readonly"])]),i("div",Uo,[l(u,{modelValue:o.form.denunciado_sexo,"onUpdate:modelValue":e[29]||(e[29]=d=>o.form.denunciado_sexo=d),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Sexo"},null,8,["modelValue","readonly"])]),i("div",Io,[l(u,{modelValue:o.form.denunciado_lugar_nacimiento,"onUpdate:modelValue":e[30]||(e[30]=d=>o.form.denunciado_lugar_nacimiento=d),dense:"",outlined:"",clearable:"",label:"Lugar de nacimiento",readonly:!o.editing},null,8,["modelValue","readonly"])]),i("div",Do,[l(u,{modelValue:o.form.denunciado_fecha_nacimiento,"onUpdate:modelValue":[e[31]||(e[31]=d=>o.form.denunciado_fecha_nacimiento=d),e[32]||(e[32]=d=>n.onBirthChange("denunciado"))],type:"date",dense:"",outlined:"",label:"Fecha de nacimiento",readonly:!o.editing},null,8,["modelValue","readonly"])]),i("div",Eo,[l(u,{modelValue:o.form.denunciado_edad,"onUpdate:modelValue":e[33]||(e[33]=d=>o.form.denunciado_edad=d),modelModifiers:{number:!0},dense:"",outlined:"",type:"number",label:"Edad",readonly:!o.editing},null,8,["modelValue","readonly"])]),i("div",So,[l(u,{modelValue:o.form.denunciado_telefono,"onUpdate:modelValue":e[34]||(e[34]=d=>o.form.denunciado_telefono=d),dense:"",outlined:"",clearable:"",label:"Teléfono/Celular",readonly:!o.editing},null,8,["modelValue","readonly"])]),i("div",jo,[l(u,{modelValue:o.form.denunciado_grado,"onUpdate:modelValue":e[35]||(e[35]=d=>o.form.denunciado_grado=d),dense:"",outlined:"",clearable:"",label:"Grado de instrucción",readonly:!o.editing},null,8,["modelValue","readonly"])]),i("div",Ro,[l(u,{modelValue:o.form.denunciado_residencia,"onUpdate:modelValue":e[36]||(e[36]=d=>o.form.denunciado_residencia=d),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Residencia"},null,8,["modelValue","readonly"])]),i("div",Po,[l(u,{modelValue:o.form.denunciado_domicilio_actual,"onUpdate:modelValue":e[37]||(e[37]=d=>o.form.denunciado_domicilio_actual=d),readonly:!o.editing,dense:"",outlined:"",clearable:"",label:"Domicilio actual"},null,8,["modelValue","readonly"])]),i("div",No,[e[85]||(e[85]=i("div",{class:"text-caption text-grey-7 q-mb-xs"},"Ubicación (denunciado)",-1)),l(s,{modelValue:n.denunciadoPos,"onUpdate:modelValue":e[38]||(e[38]=d=>n.denunciadoPos=d),center:o.oruroCenter},null,8,["modelValue","center"])])])]),_:1})]),_:1}),l(w,{flat:"",bordered:"",class:"section-card q-mb-xl"},{default:a(()=>[l(v,{class:"row items-center"},{default:a(()=>[l(h,{name:"task_alt",class:"q-mr-sm"}),e[86]||(e[86]=i("div",{class:"text-subtitle1 text-weight-medium"},"Seguimiento",-1))]),_:1}),l(C),l(v,null,{default:a(()=>[i("div",To,[i("div",Ao,[l(D,{modelValue:o.form.psicologica_user_id,"onUpdate:modelValue":e[39]||(e[39]=d=>o.form.psicologica_user_id=d),dense:"",outlined:"","emit-value":"","map-options":"",options:n.optPsicologos,label:"Área psicológica (responsable)",readonly:!o.editing},null,8,["modelValue","options","readonly"])]),i("div",Lo,[l(D,{modelValue:o.form.trabajo_social_user_id,"onUpdate:modelValue":e[40]||(e[40]=d=>o.form.trabajo_social_user_id=d),dense:"",outlined:"","emit-value":"","map-options":"",options:n.optSociales,label:"Área social (responsable)",readonly:!o.editing},null,8,["modelValue","options","readonly"])]),i("div",Fo,[l(D,{modelValue:o.form.legal_user_id,"onUpdate:modelValue":e[41]||(e[41]=d=>o.form.legal_user_id=d),dense:"",outlined:"","emit-value":"","map-options":"",options:n.optAbogados,label:"Área legal (responsable)",readonly:!o.editing},null,8,["modelValue","options","readonly"])])])]),_:1})]),_:1}),l(w,{flat:"",bordered:"",class:"section-card q-mb-xl"},{default:a(()=>[l(v,{class:"row items-center"},{default:a(()=>[l(h,{name:"task_alt",class:"q-mr-sm"}),e[87]||(e[87]=i("div",{class:"text-subtitle1 text-weight-medium"},"Check documentos adjuntos",-1))]),_:1}),l(C),l(v,null,{default:a(()=>[i("div",Qo,[i("div",Mo,[l(N,{modelValue:o.form.documento_fotocopia_carnet_denunciante,"onUpdate:modelValue":e[42]||(e[42]=d=>o.form.documento_fotocopia_carnet_denunciante=d),label:"Fotocopia CI denunciante","false-value":"0","true-value":"1",disable:!o.editing},null,8,["modelValue","disable"])]),i("div",Oo,[l(N,{modelValue:o.form.documento_fotocopia_carnet_denunciado,"onUpdate:modelValue":e[43]||(e[43]=d=>o.form.documento_fotocopia_carnet_denunciado=d),label:"Fotocopia CI denunciado","false-value":"0","true-value":"1",disable:!o.editing},null,8,["modelValue","disable"])]),i("div",zo,[l(N,{modelValue:o.form.documento_placas_fotograficas_domicilio_denunciante,"onUpdate:modelValue":e[44]||(e[44]=d=>o.form.documento_placas_fotograficas_domicilio_denunciante=d),label:"Placas fotográficas dom. denunciante","false-value":"0","true-value":"1",disable:!o.editing},null,8,["modelValue","disable"])]),i("div",Go,[l(N,{modelValue:o.form.documento_croquis_direccion_denunciado,"onUpdate:modelValue":e[45]||(e[45]=d=>o.form.documento_croquis_direccion_denunciado=d),label:"Croquis dirección denunciado","false-value":"0","true-value":"1",disable:!o.editing},null,8,["modelValue","disable"])]),i("div",Bo,[l(N,{modelValue:o.form.documento_placas_fotograficas_domicilio_denunciado,"onUpdate:modelValue":e[46]||(e[46]=d=>o.form.documento_placas_fotograficas_domicilio_denunciado=d),label:"Placas fotográficas dom. denunciado","false-value":"0","true-value":"1",disable:!o.editing},null,8,["modelValue","disable"])]),i("div",Ho,[l(N,{modelValue:o.form.documento_ciudadania_digital,"onUpdate:modelValue":e[47]||(e[47]=d=>o.form.documento_ciudadania_digital=d),label:"Ciudadanía digital","false-value":"0","true-value":"1",disable:!o.editing},null,8,["modelValue","disable"])])])]),_:1})]),_:1})],64)):(c(),V(U,{key:0},[l(w,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:a(()=>[l(v,{class:"row q-col-gutter-md"},{default:a(()=>[i("div",ve,[e[49]||(e[49]=i("b",null,"N° SLIM:",-1)),m(" "+r(n.orDash(o.form.caso_numero)),1)]),i("div",ye,[e[50]||(e[50]=i("b",null,"Fecha del hecho:",-1)),m(" "+r(n.orDash(o.form.caso_fecha_hecho)),1)]),i("div",Ve,[e[51]||(e[51]=i("b",null,"Lugar del hecho:",-1)),m(" "+r(n.orDash(o.form.caso_lugar_hecho)),1)]),i("div",we,[e[52]||(e[52]=i("b",null,"Tipología:",-1)),m(" "+r(n.orDash(o.form.caso_tipologia)),1)]),i("div",xe,[e[53]||(e[53]=i("b",null,"Modalidad:",-1)),m(" "+r(n.orDash(o.form.caso_modalidad)),1)]),i("div",ke,[e[54]||(e[54]=i("b",null,"Descripción:",-1)),e[55]||(e[55]=m()),i("span",Ce,r(n.orDash(o.form.caso_descripcion)),1)])]),_:1})]),_:1}),l(w,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:a(()=>[l(v,{class:"row items-center"},{default:a(()=>[l(h,{name:"assignment_ind",class:"q-mr-sm"}),e[56]||(e[56]=i("div",{class:"text-subtitle1 text-weight-medium"},"Denunciante",-1))]),_:1}),l(C),l(v,{class:"row q-col-gutter-md"},{default:a(()=>[i("div",qe,[e[57]||(e[57]=i("b",null,"Área:",-1)),m(" "+r(n.orDash(o.form.area)),1)]),i("div",Ue,[e[58]||(e[58]=i("b",null,"Zona:",-1)),m(" "+r(n.orDash(o.form.zona)),1)]),i("div",Ie,[e[59]||(e[59]=i("b",null,"Nombre:",-1)),m(" "+r(n.nombreDenunciante),1)]),i("div",De,[e[60]||(e[60]=i("b",null,"Documento:",-1)),m(" "+r(n.orDash(o.form.denunciante_documento)),1)]),i("div",Ee,[e[61]||(e[61]=i("b",null,"Nro:",-1)),m(" "+r(n.orDash(o.form.denunciante_nro)),1)]),i("div",Se,[e[62]||(e[62]=i("b",null,"Sexo:",-1)),m(" "+r(n.orDash(o.form.denunciante_sexo)),1)]),i("div",je,[e[63]||(e[63]=i("b",null,"Estado civil:",-1)),m(" "+r(n.orDash(o.form.denunciante_estado_civil)),1)]),i("div",Re,[e[64]||(e[64]=i("b",null,"Edad:",-1)),m(" "+r(n.orDash(o.form.denunciante_edad)),1)]),i("div",Pe,[e[65]||(e[65]=i("b",null,"Teléfono:",-1)),m(" "+r(n.orDash(o.form.denunciante_telefono)),1)]),i("div",Ne,[e[66]||(e[66]=i("b",null,"Idioma:",-1)),m(" "+r(n.orDash(o.form.denunciante_idioma)),1)]),i("div",Te,[e[67]||(e[67]=i("b",null,"Ocupación:",-1)),m(" "+r(n.orDash(o.form.denunciante_ocupacion)),1)]),i("div",Ae,[e[68]||(e[68]=i("b",null,"Domicilio:",-1)),m(" "+r(n.orDash(o.form.denunciante_domicilio_actual)),1)])]),_:1})]),_:1}),l(w,{flat:"",bordered:"",class:"section-card q-mb-md"},{default:a(()=>[l(v,{class:"row items-center"},{default:a(()=>[l(h,{name:"person_pin_circle",class:"q-mr-sm"}),e[69]||(e[69]=i("div",{class:"text-subtitle1 text-weight-medium"},"Denunciado",-1))]),_:1}),l(C),l(v,{class:"row q-col-gutter-md"},{default:a(()=>[i("div",Le,[e[70]||(e[70]=i("b",null,"Nombre:",-1)),m(" "+r(n.orDash(o.form.denunciado_nombre_completo)),1)]),i("div",Fe,[e[71]||(e[71]=i("b",null,"Documento:",-1)),m(" "+r(n.orDash(o.form.denunciado_documento)),1)]),i("div",Qe,[e[72]||(e[72]=i("b",null,"Nro:",-1)),m(" "+r(n.orDash(o.form.denunciado_nro)),1)]),i("div",Me,[e[73]||(e[73]=i("b",null,"Sexo:",-1)),m(" "+r(n.orDash(o.form.denunciado_sexo)),1)]),i("div",Oe,[e[74]||(e[74]=i("b",null,"Edad:",-1)),m(" "+r(n.orDash(o.form.denunciado_edad)),1)]),i("div",ze,[e[75]||(e[75]=i("b",null,"Teléfono:",-1)),m(" "+r(n.orDash(o.form.denunciado_telefono)),1)]),i("div",Ge,[e[76]||(e[76]=i("b",null,"Grado:",-1)),m(" "+r(n.orDash(o.form.denunciado_grado)),1)]),i("div",Be,[e[77]||(e[77]=i("b",null,"Domicilio:",-1)),m(" "+r(n.orDash(o.form.denunciado_domicilio_actual)),1)])]),_:1})]),_:1}),l(w,{flat:"",bordered:"",class:"section-card q-mb-xl"},{default:a(()=>[l(v,{class:"row items-center"},{default:a(()=>[l(h,{name:"task_alt",class:"q-mr-sm"}),e[78]||(e[78]=i("div",{class:"text-subtitle1 text-weight-medium"},"Seguimiento",-1))]),_:1}),l(C),l(v,{class:"row q-col-gutter-md"},{default:a(()=>[i("div",He,[e[79]||(e[79]=i("b",null,"Psicología:",-1)),m(" "+r(n.nombreUsuario(o.form.psicologica_user,o.form.psicologica_user_id,o.psicologos)),1)]),i("div",We,[e[80]||(e[80]=i("b",null,"Trabajo social:",-1)),m(" "+r(n.nombreUsuario(o.form.trabajo_social_user,o.form.trabajo_social_user_id,o.sociales)),1)]),i("div",Ye,[e[81]||(e[81]=i("b",null,"Legal:",-1)),m(" "+r(n.nombreUsuario(o.form.legal_user,o.form.legal_user_id,o.abogados)),1)])]),_:1})]),_:1})],64))])}const Yo=S(_e,[["render",Wo],["__scopeId","data-v-e75301f0"]]),Zo={name:"SesionesPsicologico",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:null}},data(){return{loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dialog:!1,mode:"create",form:{id:null,fecha:"",titulo:"",duracion_min:null,lugar:"",tipo:"Individual",contenido_html:""},plantilla:null,plantillasOptions:[{label:"Consentimiento informado",value:"consentimiento"},{label:"Informe Psicológico (formato DIO)",value:"informe_dio"},{label:"Acta de sesión (DIO)",value:"acta"},{label:"Informe breve (psicológico)",value:"informe"},{label:"Constancia de asistencia",value:"constancia"}]}},computed:{role(){return this.$store.user?.role||""},canEdit(){return this.role==="Administrador"||this.role==="Psicologo"}},watch:{caseId(){this.page=1,this.fetchRows()},search(){this.page=1,this.fetchRows()}},created(){this.fetchRows()},methods:{today(){const t=new Date,e=f=>String(f).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`},async fetchRows(){if(this.caseId){this.loading=!0;try{const t=await this.$axios.get(`/slims/${this.caseId}/sesiones-psicologicas`,{params:{q:this.search,page:this.page,per_page:this.perPage}});this.rows=t.data||{data:[],last_page:1}}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"Error cargando sesiones"})}finally{this.loading=!1}}},openCreate(){this.canEdit&&(this.mode="create",this.plantilla="consentimiento",this.form={id:null,fecha:this.today(),titulo:"",duracion_min:null,lugar:"",tipo:"Individual",contenido_html:""},this.dialog=!0,this.$nextTick(()=>this.applyTemplate("consentimiento")))},openView(t){this.mode="view",this.form={...t},this.dialog=!0},openEdit(t){this.canEdit&&(this.mode="edit",this.form={...t},this.dialog=!0)},applyTemplate(t){if(this.mode==="view")return;const e=this.caso||{},f={nombres:e.denunciante_nombres||e.denunciante_nombre_completo||"",apellidos:[e.denunciante_paterno,e.denunciante_materno].filter(Boolean).join(" "),edad:e.denunciante_edad||"",fecha_nacimiento:e.denunciante_fecha_nacimiento||"",lugar_nacimiento:e.denunciante_lugar_nacimiento||"",grado:e.denunciante_grado||"",ocupacion:e.denunciante_ocupacion_exacto||e.denunciante_ocupacion||"",domicilio:e.denunciante_domicilio_actual||e.denunciante_residencia||"",documento:e.denunciante_documento||"Carnet de identidad",nro:e.denunciante_nro||"",telefono:e.denunciante_telefono||e.denunciante_movil||e.denunciante_fijo||"",estado_civil:e.denunciante_estado_civil||""},b=[];for(let j=1;j<=5;j++){const A=e[`familiar${j}_nombre_completo`],z=e[`familiar${j}_edad`],G=e[`familiar${j}_parentesco`],se=e[`familiar${j}_celular`];(A||z||G||se)&&b.push({nombre:A||"",edad:z||"",estado_civil:"",parentesco:G||"",ocupacion:""})}const o=(this.form.fecha||this.today()).slice(0,4),n=e.caso_numero&&String(e.caso_numero).trim()!==""?String(e.caso_numero):`${String(this.caseId).padStart(2,"0")}/${o}`,s=e.legal_user?.name||e.legal_user?.username||"",d=e.psicologica_user?.name||e.psicologica_user?.username||this.$store?.state?.user?.name||"",J=e.caso_tipologia||e.caso_modalidad?`Evaluación psicológica en el marco de presunta(s) ${[e.caso_tipologia,e.caso_modalidad].filter(Boolean).join(" / ")}.`:"Evaluación psicológica para determinar los efectos emocionales y psicológicos en la evaluada.",X=(()=>{const j=e.caso_fecha_hecho?`el ${e.caso_fecha_hecho}`:"en fecha no precisada",A=[e.caso_lugar_hecho,e.caso_zona,e.caso_direccion].filter(Boolean).join(", "),z=A?`, en ${A}`:"",G=e.caso_descripcion?` ${e.caso_descripcion}`:"";return`Según la apertura del caso, el hecho habría ocurrido ${j}${z}.${G}`})(),K=["Entrevista clínica y observación conductual","Aplicación de instrumentos psicométricos según pertinencia (Goldberg, IES-R, Rosenberg)"].join("; ")+".",O=[e.violencia_fisica?"violencia física":null,e.violencia_psicologica?"violencia psicológica":null,e.violencia_sexual?"violencia sexual":null,e.violencia_economica?"violencia económica/patrimonial":null].filter(Boolean),$="Se evidencian reacciones emocionales congruentes con el evento referido, con impacto en el equilibrio afectivo y la autoestima."+(O.length?` Se consideran indicadores asociados a ${O.join(", ")}.`:"")+" No se evidencian signos de psicosis. Se sugiere seguimiento clínico y contención.",I=["Intervención psicológica: terapia focalizada en manejo de ansiedad/estrés y fortalecimiento de recursos personales.","Orientación/asesoramiento legal para evitar revictimización y garantizar medidas de protección, si corresponde."].join(" "),T={casoId:this.caseId,fecha:this.form.fecha||this.today(),titulo:this.form.titulo||"Sesión psicológica",lugar:this.form.lugar||"",tipo:this.form.tipo||"Individual",nombre:e.denunciante_nombre_completo,documento:e.denunciante_nro,numeroCaso:n,abogadoNombre:s,psicologoNombre:d,denunciante:f,familiares:b,motivo:J,antecedentes:X,tecnicas:K,conclusiones:$,recomendaciones:I};t==="acta"?this.form.contenido_html=L.acta(T):t==="informe"?this.form.contenido_html=L.informe(T):t==="constancia"?this.form.contenido_html=L.constancia(T):t==="consentimiento"?this.form.contenido_html=L.consentimiento(T):t==="informe_dio"&&(this.form.contenido_html=L.informe_dio(T))},async save(){if(this.canEdit){if(!this.form.titulo){this.$q.notify({type:"negative",message:"El título es obligatorio"});return}if(!this.form.contenido_html){this.$q.notify({type:"negative",message:"El contenido está vacío"});return}this.saving=!0;try{this.form.id?await this.$axios.put(`/slims/sesiones-psicologicas/${this.form.id}`,this.form):await this.$axios.post(`/slims/${this.caseId}/sesiones-psicologicas`,this.form),this.$q.notify({type:"positive",message:"Guardado"}),this.dialog=!1,this.fetchRows()}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}}},remove(t){if(!this.canEdit)return;const e=async()=>{try{await this.$axios.delete(`/slims/sesiones-psicologicas/${t.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.fetchRows()}catch(f){this.$q.notify({type:"negative",message:f?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar la sesión?").onOk(e):confirm("¿Eliminar la sesión?")&&e()},printPdf(t){const e=this.$axios?.defaults?.baseURL||"";window.open(`${e}/slims/sesiones-psicologicas/${t.id}/pdf`,"_blank")}}},Jo={class:"row items-center q-mb-sm"},Xo={class:"col"},Ko={class:"text-caption text-grey-7"},$o={class:"col-auto row items-center q-gutter-sm"},el={class:"text-grey-8"},ol={key:0},ll={class:"row justify-end q-mt-sm"},il={class:"text-subtitle1"},tl={class:"row q-col-gutter-md"},sl={class:"col-12 col-md-3"},al={class:"col-12 col-md-5"},nl={class:"col-6 col-md-2"},dl={class:"col-6 col-md-2"},rl={class:"col-12"},cl={key:0};function ul(t,e,f,b,o,n){return c(),p(w,{flat:"",bordered:"",class:"q-pa-md"},{default:a(()=>[i("div",Jo,[i("div",Xo,[e[10]||(e[10]=i("div",{class:"text-subtitle1 text-weight-medium"},"Sesiones (Psicológico)",-1)),i("div",Ko,"Vinculadas al caso #"+r(f.caseId),1)]),i("div",$o,[l(u,{dense:"",outlined:"",modelValue:o.search,"onUpdate:modelValue":e[0]||(e[0]=s=>o.search=s),placeholder:"Buscar...",style:{width:"260px"}},{append:a(()=>[l(h,{name:"search"})]),_:1},8,["modelValue"]),l(_,{flat:"",color:"primary",icon:"refresh",loading:o.loading,onClick:n.fetchRows},null,8,["loading","onClick"]),n.canEdit?(c(),p(_,{key:0,color:"green",icon:"add_circle_outline","no-caps":"",label:"Crear sesión",onClick:n.openCreate},null,8,["onClick"])):y("",!0)])]),l(C),l(oe,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:a(()=>[e[16]||(e[16]=i("thead",null,[i("tr",{class:"bg-primary text-white"},[i("th",{style:{width:"70px"}},"ID"),i("th",{style:{width:"140px"}},"Acciones"),i("th",null,"Título"),i("th",{style:{width:"120px"}},"Fecha"),i("th",{style:{width:"120px"}},"Tipo"),i("th",{style:{width:"180px"}},"Usuario")])],-1)),i("tbody",null,[(c(!0),V(U,null,Y(o.rows.data,s=>(c(),V("tr",{key:s.id},[i("td",el,"#"+r(s.id),1),i("td",null,[l(M,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:a(()=>[x((c(),p(q,{clickable:"",onClick:d=>n.openView(s)},{default:a(()=>[l(g,{avatar:""},{default:a(()=>[l(h,{name:"visibility"})]),_:1}),l(g,null,{default:a(()=>e[11]||(e[11]=[m("Ver")])),_:1})]),_:2},1032,["onClick"])),[[k]]),x((c(),p(q,{clickable:"",onClick:d=>n.printPdf(s)},{default:a(()=>[l(g,{avatar:""},{default:a(()=>[l(h,{name:"print"})]),_:1}),l(g,null,{default:a(()=>e[12]||(e[12]=[m("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[k]]),n.canEdit?(c(),V(U,{key:0},[l(C),x((c(),p(q,{clickable:"",onClick:d=>n.openEdit(s)},{default:a(()=>[l(g,{avatar:""},{default:a(()=>[l(h,{name:"edit"})]),_:1}),l(g,null,{default:a(()=>e[13]||(e[13]=[m("Editar")])),_:1})]),_:2},1032,["onClick"])),[[k]]),x((c(),p(q,{clickable:"",onClick:d=>n.remove(s)},{default:a(()=>[l(g,{avatar:""},{default:a(()=>[l(h,{name:"delete",color:"negative"})]),_:1}),l(g,{class:"text-negative"},{default:a(()=>e[14]||(e[14]=[m("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[k]])],64)):y("",!0)]),_:2},1024)]),i("td",null,r(s.titulo),1),i("td",null,r(s.fecha||"s/f"),1),i("td",null,r(s.tipo||"—"),1),i("td",null,r(s.user?.name||s.user?.username||"—"),1)]))),128)),!o.rows.data.length&&!o.loading?(c(),V("tr",ol,e[15]||(e[15]=[i("td",{colspan:"6",class:"text-center text-grey"},"Sin registros",-1)]))):y("",!0)])]),_:1}),i("div",ll,[l(Z,{modelValue:o.page,"onUpdate:modelValue":[e[1]||(e[1]=s=>o.page=s),n.fetchRows],max:o.rows.last_page||1,"boundary-numbers":"","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])]),l(H,{modelValue:o.dialog,"onUpdate:modelValue":e[9]||(e[9]=s=>o.dialog=s),persistent:""},{default:a(()=>[l(w,{style:{"max-width":"900px",width:"95vw"}},{default:a(()=>[l(v,{class:"row items-center q-pb-none"},{default:a(()=>[i("div",il,r(o.mode==="view"?"Ver sesión":o.form.id?"Editar sesión":"Nueva sesión"),1),l(W),x(l(_,{flat:"",round:"",dense:"",icon:"close"},null,512),[[k]])]),_:1}),l(v,{class:"q-gutter-md"},{default:a(()=>[i("div",tl,[i("div",sl,[l(u,{modelValue:o.form.fecha,"onUpdate:modelValue":e[2]||(e[2]=s=>o.form.fecha=s),type:"date",dense:"",outlined:"",label:"Fecha",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),i("div",al,[l(u,{modelValue:o.form.titulo,"onUpdate:modelValue":e[3]||(e[3]=s=>o.form.titulo=s),dense:"",outlined:"",label:"Título *",readonly:o.mode==="view",rules:[s=>!!s||"Requerido"]},null,8,["modelValue","readonly","rules"])]),i("div",nl,[l(u,{modelValue:o.form.duracion_min,"onUpdate:modelValue":e[4]||(e[4]=s=>o.form.duracion_min=s),modelModifiers:{number:!0},type:"number",dense:"",outlined:"",label:"Minutos",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),i("div",dl,[l(u,{modelValue:o.form.tipo,"onUpdate:modelValue":e[5]||(e[5]=s=>o.form.tipo=s),dense:"",outlined:"",label:"Tipo",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),i("div",rl,[l(u,{modelValue:o.form.lugar,"onUpdate:modelValue":e[6]||(e[6]=s=>o.form.lugar=s),dense:"",outlined:"",label:"Lugar",readonly:o.mode==="view"},null,8,["modelValue","readonly"])])]),o.mode!=="view"?(c(),V("div",cl,[l(D,{modelValue:o.plantilla,"onUpdate:modelValue":[e[7]||(e[7]=s=>o.plantilla=s),n.applyTemplate],options:o.plantillasOptions,label:"Plantilla",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])])):y("",!0),i("div",null,[e[17]||(e[17]=i("div",{class:"text-caption text-grey-7 q-mb-xs"},"Contenido (WYSIWYG / se guarda HTML)",-1)),l(te,{modelValue:o.form.contenido_html,"onUpdate:modelValue":e[8]||(e[8]=s=>o.form.contenido_html=s),readonly:o.mode==="view","min-height":"320px",placeholder:"Escriba aquí el contenido de la sesión...",toolbar:[["left","center","right","justify"],["bold","italic","strike","underline"],["quote","unordered","ordered","outdent","indent"],["hr","link"],["undo","redo"],["removeFormat"]]},null,8,["modelValue","readonly"])])]),_:1}),l(C),l(Q,{align:"right"},{default:a(()=>[x(l(_,{flat:"",label:"Cerrar"},null,512),[[k]]),o.mode!=="view"&&n.canEdit?(c(),p(_,{key:0,color:"primary",label:"Guardar",loading:o.saving,onClick:n.save},null,8,["loading","onClick"])):y("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ml=S(Zo,[["render",ul]]),fl={name:"InformesLegal",props:{caseId:{type:[String,Number],required:!0},caso:{type:Object,default:null}},data(){return{loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dialog:!1,mode:"create",form:{id:null,fecha:"",titulo:"",numero:"",contenido_html:""},plantilla:"informe_legal",plantillasOptions:[{label:"Informe Legal (SLIM)",value:"informe_legal"},{label:"Memorial (simple)",value:"memorial"},{label:"Oficio / Nota",value:"oficio"},{label:"Acta de Compromiso",value:"acta"},{label:"Denuncia penal — Ministerio Público",value:"denuncia_mp"}]}},computed:{role(){return this.$store.user?.role||""},canEdit(){return this.role==="Administrador"||this.role==="Abogado"}},watch:{caseId(){this.page=1,this.fetchRows()},search(){this.page=1,this.fetchRows()}},created(){this.fetchRows()},methods:{today(){const t=new Date,e=f=>String(f).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`},async fetchRows(){if(this.caseId){this.loading=!0;try{const t=await this.$axios.get(`/slims/${this.caseId}/informes-legales`,{params:{q:this.search,page:this.page,per_page:this.perPage}});this.rows=t.data||{data:[],last_page:1}}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"Error cargando informes"})}finally{this.loading=!1}}},openCreate(){this.canEdit&&(this.mode="create",this.form={id:null,fecha:this.today(),titulo:"",numero:"",contenido_html:""},this.dialog=!0,this.$nextTick(()=>this.applyTemplate(this.plantilla)))},openView(t){this.mode="view",this.form={...t},this.dialog=!0},openEdit(t){this.canEdit&&(this.mode="edit",this.form={...t},this.dialog=!0)},applyTemplate(t){if(this.mode==="view")return;const e=this.form.fecha||this.today(),f=e.slice(0,4),o=`
        <div style="text-align:center; margin-bottom:8px;">
          <div style="font-size:16px; font-weight:bold;">DIRECCIÓN DE IGUALDAD DE OPORTUNIDADES</div>
          <div style="font-size:12px;">Gobierno Autónomo Municipal de Oruro</div>
          <div style="font-size:12px; font-weight:bold;">${this.form.numero?`N° ${this.form.numero}`:""}</div>
          <hr/>
        </div>
      `;if(t==="memorial"){this.form.contenido_html=o+`
          <p><b>Señor(a) Juez/Fiscal</b></p>
          <p>De mi consideración:</p>
          <p style="text-align:justify">Por medio del presente, ...</p>
          <p>Oruro, ${e}</p>
        `;return}if(t==="oficio"){this.form.contenido_html=o+`
          <p><b>Ref.:</b> Solicitud de información</p>
          <p>De nuestra consideración:</p>
          <p style="text-align:justify">Solicitamos remitir la información ...</p>
          <p>Oruro, ${e}</p>
        `;return}if(t==="acta"){this.form.contenido_html=o+`
          <p style="text-align:center"><b>ACTA DE COMPROMISO</b></p>
          <p style="text-align:justify">En la ciudad de Oruro, a ${e}, las partes acuerdan ...</p>
        `;return}if(t==="denuncia_mp"){const s=(this.caso||{}).denunciante_nombre_completo||"";this.form.contenido_html=o+`
          <p style="text-align:center"><b>SEÑOR(A) REPRESENTANTE DEL MINISTERIO PÚBLICO — ORURO</b></p>
          <p><b>DENUNCIANTE:</b> ${s||"—"}</p>
          <p style="text-align:justify">Que, en mérito a los antecedentes ...</p>
          <p>Oruro, ${e}</p>
        `;return}this.form.contenido_html=o+`
        <p><b>Informe Legal ${f}</b></p>
        <p style="text-align:justify">En atención a los antecedentes, se emite el presente informe con el siguiente análisis jurídico:</p>
        <p><b>Fundamentos de derecho:</b></p>
        <ul>
          <li>Ley N° 348 y reglamentación.</li>
          <li>Constitución Política del Estado.</li>
          <li>Normativa municipal vigente.</li>
        </ul>
        <p><b>Recomendaciones:</b> …</p>
        <p>Oruro, ${e}</p>
      `},async save(){if(this.canEdit){if(!this.form.titulo)return this.$q.notify({type:"negative",message:"El título es obligatorio"});if(!this.form.contenido_html)return this.$q.notify({type:"negative",message:"El contenido está vacío"});this.saving=!0;try{this.form.id?await this.$axios.put(`/slims/informes-legales/${this.form.id}`,this.form):await this.$axios.post(`/slims/${this.caseId}/informes-legales`,this.form),this.$q.notify({type:"positive",message:"Guardado"}),this.dialog=!1,this.fetchRows()}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}}},removeIt(t){if(!this.canEdit)return;const e=async()=>{try{await this.$axios.delete(`/slims/informes-legales/${t.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.fetchRows()}catch(f){this.$q.notify({type:"negative",message:f?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar el informe?").onOk(e):confirm("¿Eliminar el informe?")&&e()},printPdf(t){const e=this.$axios?.defaults?.baseURL||"";window.open(`${e}/slims/informes-legales/${t.id}/pdf`,"_blank")}}},pl={class:"row items-center q-mb-sm"},gl={class:"col"},_l={class:"text-caption text-grey-7"},hl={class:"col-auto row items-center q-gutter-sm"},bl={key:0},vl={class:"row justify-end q-mt-sm"},yl={class:"text-subtitle1"},Vl={class:"row q-col-gutter-md"},wl={class:"col-12 col-md-3"},xl={class:"col-12 col-md-7"},kl={class:"col-12 col-md-2"},Cl={key:0};function ql(t,e,f,b,o,n){return c(),p(w,{flat:"",bordered:"",class:"q-pa-md"},{default:a(()=>[i("div",pl,[i("div",gl,[e[8]||(e[8]=i("div",{class:"text-subtitle1 text-weight-medium"},"Informes legales",-1)),i("div",_l,"Vinculados al caso #"+r(f.caseId),1)]),i("div",hl,[l(u,{dense:"",outlined:"",modelValue:o.search,"onUpdate:modelValue":e[0]||(e[0]=s=>o.search=s),placeholder:"Buscar...",style:{width:"260px"}},{append:a(()=>[l(h,{name:"search"})]),_:1},8,["modelValue"]),l(_,{flat:"",color:"primary",icon:"refresh",loading:o.loading,onClick:n.fetchRows},null,8,["loading","onClick"]),n.canEdit?(c(),p(_,{key:0,color:"green",icon:"add_circle_outline","no-caps":"",label:"Crear informe",onClick:n.openCreate},null,8,["onClick"])):y("",!0)])]),l(C),l(oe,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:a(()=>[e[14]||(e[14]=i("thead",null,[i("tr",{class:"bg-primary text-white"},[i("th",{style:{width:"70px"}},"ID"),i("th",{style:{width:"140px"}},"Acciones"),i("th",null,"Título"),i("th",{style:{width:"120px"}},"Fecha"),i("th",{style:{width:"120px"}},"Nro"),i("th",{style:{width:"180px"}},"Usuario")])],-1)),i("tbody",null,[(c(!0),V(U,null,Y(o.rows.data,s=>(c(),V("tr",{key:s.id},[i("td",null,"#"+r(s.id),1),i("td",null,[l(M,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:a(()=>[x((c(),p(q,{clickable:"",onClick:d=>n.openView(s)},{default:a(()=>[l(g,{avatar:""},{default:a(()=>[l(h,{name:"visibility"})]),_:1}),l(g,null,{default:a(()=>e[9]||(e[9]=[m("Ver")])),_:1})]),_:2},1032,["onClick"])),[[k]]),x((c(),p(q,{clickable:"",onClick:d=>n.printPdf(s)},{default:a(()=>[l(g,{avatar:""},{default:a(()=>[l(h,{name:"picture_as_pdf"})]),_:1}),l(g,null,{default:a(()=>e[10]||(e[10]=[m("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[k]]),n.canEdit?(c(),V(U,{key:0},[l(C),x((c(),p(q,{clickable:"",onClick:d=>n.openEdit(s)},{default:a(()=>[l(g,{avatar:""},{default:a(()=>[l(h,{name:"edit"})]),_:1}),l(g,null,{default:a(()=>e[11]||(e[11]=[m("Editar")])),_:1})]),_:2},1032,["onClick"])),[[k]]),x((c(),p(q,{clickable:"",onClick:d=>n.removeIt(s)},{default:a(()=>[l(g,{avatar:""},{default:a(()=>[l(h,{name:"delete",color:"negative"})]),_:1}),l(g,{class:"text-negative"},{default:a(()=>e[12]||(e[12]=[m("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[k]])],64)):y("",!0)]),_:2},1024)]),i("td",null,r(s.titulo),1),i("td",null,r(s.fecha||"s/f"),1),i("td",null,r(s.numero||"—"),1),i("td",null,r(s.user?.name||s.user?.username||"—"),1)]))),128)),!o.rows.data.length&&!o.loading?(c(),V("tr",bl,e[13]||(e[13]=[i("td",{colspan:"6",class:"text-center text-grey"},"Sin registros",-1)]))):y("",!0)])]),_:1}),i("div",vl,[l(Z,{modelValue:o.page,"onUpdate:modelValue":[e[1]||(e[1]=s=>o.page=s),n.fetchRows],max:o.rows.last_page||1,"boundary-numbers":"","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])]),l(H,{modelValue:o.dialog,"onUpdate:modelValue":e[7]||(e[7]=s=>o.dialog=s),persistent:"",maximized:""},{default:a(()=>[l(w,null,{default:a(()=>[l(ne,{class:"bg-white text-dark"},{default:a(()=>[i("div",yl,r(o.mode==="view"?"Ver informe":o.form.id?"Editar informe":"Nuevo informe"),1),l(W),x(l(_,{flat:"",dense:"",round:"",icon:"close"},null,512),[[k]])]),_:1}),l(C),l(v,{class:"q-gutter-md"},{default:a(()=>[i("div",Vl,[i("div",wl,[l(u,{modelValue:o.form.fecha,"onUpdate:modelValue":e[2]||(e[2]=s=>o.form.fecha=s),type:"date",dense:"",outlined:"",label:"Fecha",readonly:o.mode==="view"},null,8,["modelValue","readonly"])]),i("div",xl,[l(u,{modelValue:o.form.titulo,"onUpdate:modelValue":e[3]||(e[3]=s=>o.form.titulo=s),dense:"",outlined:"",label:"Título *",readonly:o.mode==="view",rules:[s=>!!s||"Requerido"]},null,8,["modelValue","readonly","rules"])]),i("div",kl,[l(u,{modelValue:o.form.numero,"onUpdate:modelValue":e[4]||(e[4]=s=>o.form.numero=s),dense:"",outlined:"",label:"Nro",readonly:o.mode==="view"},null,8,["modelValue","readonly"])])]),o.mode!=="view"?(c(),V("div",Cl,[l(D,{modelValue:o.plantilla,"onUpdate:modelValue":[e[5]||(e[5]=s=>o.plantilla=s),n.applyTemplate],options:o.plantillasOptions,label:"Plantilla",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])])):y("",!0),i("div",null,[e[15]||(e[15]=i("div",{class:"text-caption text-grey-7 q-mb-xs"},"Contenido (WYSIWYG / guarda HTML)",-1)),l(te,{modelValue:o.form.contenido_html,"onUpdate:modelValue":e[6]||(e[6]=s=>o.form.contenido_html=s),readonly:o.mode==="view","min-height":"320px",placeholder:"Escriba el informe legal...",toolbar:[["left","center","right","justify"],["bold","italic","strike","underline"],["quote","unordered","ordered","outdent","indent"],["hr","link"],["undo","redo"],["removeFormat"]]},null,8,["modelValue","readonly"])])]),_:1}),l(C),l(Q,{align:"right"},{default:a(()=>[x(l(_,{flat:"",label:"Cerrar"},null,512),[[k]]),o.mode!=="view"&&n.canEdit?(c(),p(_,{key:0,color:"primary",label:"Guardar",loading:o.saving,onClick:n.save},null,8,["loading","onClick"])):y("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Ul=S(fl,[["render",ql]]),Il={name:"ApoyoIntegral",props:{caseId:{type:[String,Number],required:!0}}},Dl={class:"text-grey-7"};function El(t,e,f,b,o,n){return c(),p(w,{flat:"",bordered:"",class:"q-pa-md"},{default:a(()=>[e[0]||(e[0]=i("div",{class:"text-subtitle1 text-weight-medium q-mb-sm"},"Apoyo integral",-1)),i("div",Dl,"DIO personal, descripción, impresión (ID: "+r(f.caseId)+")",1)]),_:1})}const Sl=S(Il,[["render",El]]),jl={name:"DocumentosGeneral",props:{caseId:{type:[String,Number],required:!0}},data(){return{loading:!1,saving:!1,search:"",page:1,perPage:10,rows:{data:[],total:0,last_page:1},dlgUpload:!1,file:null,meta:{titulo:"",categoria:"",descripcion:""},accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.odt,.ods,.txt,.zip,.jpg,.jpeg,.png,.webp",dlgEdit:!1,edit:{},editingId:null}},watch:{caseId(){this.page=1,this.fetchRows()},search(){this.page=1,this.fetchRows()}},created(){this.fetchRows()},methods:{async fetchRows(){if(this.caseId){this.loading=!0;try{const t=await this.$axios.get(`/slims/${this.caseId}/documentos`,{params:{q:this.search,page:this.page,per_page:this.perPage}});this.rows=t.data||{data:[],last_page:1}}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"Error cargando documentos"})}finally{this.loading=!1}}},openUpload(){this.file=null,this.meta={titulo:"",categoria:"",descripcion:""},this.dlgUpload=!0},async upload(){if(!this.file){this.$q.notify({type:"negative",message:"Seleccione un archivo"});return}this.saving=!0;try{const t=new FormData;t.append("file",this.file),this.meta.titulo&&t.append("titulo",this.meta.titulo),this.meta.categoria&&t.append("categoria",this.meta.categoria),this.meta.descripcion&&t.append("descripcion",this.meta.descripcion),await this.$axios.post(`/slims/${this.caseId}/documentos`,t,{headers:{"Content-Type":"multipart/form-data"}}),this.$q.notify({type:"positive",message:"Archivo subido"}),this.dlgUpload=!1,this.fetchRows()}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"No se pudo subir"})}finally{this.saving=!1}},viewDoc(t){const e=this.$axios?.defaults?.baseURL||"";window.open(`${e}/slims/documentos/${t.id}/view`,"_blank")},downloadDoc(t){const e=this.$axios?.defaults?.baseURL||"";window.open(`${e}/slims/documentos/${t.id}/download`,"_blank")},editMeta(t){this.editingId=t.id,this.edit={titulo:t.titulo,categoria:t.categoria,descripcion:t.descripcion},this.dlgEdit=!0},async saveMeta(){this.saving=!0;try{await this.$axios.put(`/slims/documentos/${this.editingId}`,this.edit),this.$q.notify({type:"positive",message:"Actualizado"}),this.dlgEdit=!1,this.fetchRows()}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"No se pudo actualizar"})}finally{this.saving=!1}},removeDoc(t){const e=async()=>{try{await this.$axios.delete(`/slims/documentos/${t.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.fetchRows()}catch(f){this.$q.notify({type:"negative",message:f?.response?.data?.message||"No se pudo eliminar"})}};this.$alert?.dialog?this.$alert.dialog("¿Eliminar el documento?").onOk(e):confirm("¿Eliminar el documento?")&&e()}}},Rl={class:"row items-center q-mb-sm"},Pl={class:"col"},Nl={class:"text-caption text-grey-7"},Tl={class:"col-auto row items-center q-gutter-sm"},Al={class:"text-weight-medium"},Ll={key:0},Fl={class:"row justify-end q-mt-sm"};function Ql(t,e,f,b,o,n){return c(),p(w,{flat:"",bordered:"",class:"q-pa-md"},{default:a(()=>[i("div",Rl,[i("div",Pl,[e[11]||(e[11]=i("div",{class:"text-subtitle1 text-weight-medium"},"Documentos (General)",-1)),i("div",Nl,"Gestión de adjuntos del caso #"+r(f.caseId),1)]),i("div",Tl,[l(u,{dense:"",outlined:"",modelValue:o.search,"onUpdate:modelValue":e[0]||(e[0]=s=>o.search=s),placeholder:"Buscar...",style:{width:"260px"}},{append:a(()=>[l(h,{name:"search"})]),_:1},8,["modelValue"]),l(_,{flat:"",color:"primary",icon:"refresh",loading:o.loading,onClick:n.fetchRows},null,8,["loading","onClick"]),l(_,{color:"green",icon:"upload","no-caps":"",label:"Subir archivo",onClick:n.openUpload},null,8,["onClick"])])]),l(C),l(oe,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:a(()=>[e[17]||(e[17]=i("thead",null,[i("tr",{class:"bg-primary text-white"},[i("th",{style:{width:"70px"}},"ID"),i("th",{style:{width:"160px"}},"Acciones"),i("th",null,"Título"),i("th",{style:{width:"130px"}},"Categoría"),i("th",{style:{width:"120px"}},"Tamaño"),i("th",{style:{width:"160px"}},"Tipo"),i("th",{style:{width:"180px"}},"Usuario")])],-1)),i("tbody",null,[(c(!0),V(U,null,Y(o.rows.data,s=>(c(),V("tr",{key:s.id},[i("td",null,"#"+r(s.id),1),i("td",null,[l(M,{dense:"",color:"primary",size:"sm",label:"Opciones","no-caps":""},{default:a(()=>[x((c(),p(q,{clickable:"",onClick:d=>n.viewDoc(s)},{default:a(()=>[l(g,{avatar:""},{default:a(()=>[l(h,{name:"visibility"})]),_:1}),l(g,null,{default:a(()=>e[12]||(e[12]=[m("Ver")])),_:1})]),_:2},1032,["onClick"])),[[k]]),x((c(),p(q,{clickable:"",onClick:d=>n.downloadDoc(s)},{default:a(()=>[l(g,{avatar:""},{default:a(()=>[l(h,{name:"download"})]),_:1}),l(g,null,{default:a(()=>e[13]||(e[13]=[m("Descargar")])),_:1})]),_:2},1032,["onClick"])),[[k]]),l(C),x((c(),p(q,{clickable:"",onClick:d=>n.editMeta(s)},{default:a(()=>[l(g,{avatar:""},{default:a(()=>[l(h,{name:"edit"})]),_:1}),l(g,null,{default:a(()=>e[14]||(e[14]=[m("Editar")])),_:1})]),_:2},1032,["onClick"])),[[k]]),x((c(),p(q,{clickable:"",onClick:d=>n.removeDoc(s)},{default:a(()=>[l(g,{avatar:""},{default:a(()=>[l(h,{name:"delete",color:"negative"})]),_:1}),l(g,{class:"text-negative"},{default:a(()=>e[15]||(e[15]=[m("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[k]])]),_:2},1024)]),i("td",Al,r(s.titulo),1),i("td",null,r(s.categoria||"—"),1),i("td",null,r(s.size_human),1),i("td",null,r(s.mime||s.extension),1),i("td",null,r(s.user?.name||s.user?.username||"—"),1)]))),128)),!o.rows.data.length&&!o.loading?(c(),V("tr",Ll,e[16]||(e[16]=[i("td",{colspan:"7",class:"text-center text-grey"},"Sin registros",-1)]))):y("",!0)])]),_:1}),i("div",Fl,[l(Z,{modelValue:o.page,"onUpdate:modelValue":[e[1]||(e[1]=s=>o.page=s),n.fetchRows],max:o.rows.last_page||1,"boundary-numbers":"","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])]),l(H,{modelValue:o.dlgUpload,"onUpdate:modelValue":e[6]||(e[6]=s=>o.dlgUpload=s),persistent:""},{default:a(()=>[l(w,{style:{"max-width":"700px",width:"95vw"}},{default:a(()=>[l(v,{class:"row items-center q-pb-none"},{default:a(()=>[e[18]||(e[18]=i("div",{class:"text-subtitle1"},"Subir archivo",-1)),l(W),x(l(_,{flat:"",dense:"",round:"",icon:"close"},null,512),[[k]])]),_:1}),l(v,{class:"q-gutter-md"},{default:a(()=>[l(u,{modelValue:o.meta.titulo,"onUpdate:modelValue":e[2]||(e[2]=s=>o.meta.titulo=s),label:"Título",outlined:"",dense:""},null,8,["modelValue"]),l(u,{modelValue:o.meta.categoria,"onUpdate:modelValue":e[3]||(e[3]=s=>o.meta.categoria=s),label:"Categoría",outlined:"",dense:""},null,8,["modelValue"]),l(u,{modelValue:o.meta.descripcion,"onUpdate:modelValue":e[4]||(e[4]=s=>o.meta.descripcion=s),type:"textarea",label:"Descripción",outlined:"",dense:"",autogrow:""},null,8,["modelValue"]),l(de,{modelValue:o.file,"onUpdate:modelValue":e[5]||(e[5]=s=>o.file=s),outlined:"",dense:"","use-chips":"",clearable:!0,accept:o.accept,hint:"Hasta 20MB. PDF, Word, Excel, imágenes, etc."},null,8,["modelValue","accept"])]),_:1}),l(Q,{align:"right"},{default:a(()=>[x(l(_,{flat:"",label:"Cancelar"},null,512),[[k]]),l(_,{color:"primary",label:"Subir",loading:o.saving,onClick:n.upload},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(H,{modelValue:o.dlgEdit,"onUpdate:modelValue":e[10]||(e[10]=s=>o.dlgEdit=s)},{default:a(()=>[l(w,{style:{"max-width":"600px",width:"95vw"}},{default:a(()=>[l(v,{class:"row items-center q-pb-none"},{default:a(()=>[e[19]||(e[19]=i("div",{class:"text-subtitle1"},"Editar metadatos",-1)),l(W),x(l(_,{flat:"",dense:"",round:"",icon:"close"},null,512),[[k]])]),_:1}),l(v,{class:"q-gutter-md"},{default:a(()=>[l(u,{modelValue:o.edit.titulo,"onUpdate:modelValue":e[7]||(e[7]=s=>o.edit.titulo=s),label:"Título",outlined:"",dense:""},null,8,["modelValue"]),l(u,{modelValue:o.edit.categoria,"onUpdate:modelValue":e[8]||(e[8]=s=>o.edit.categoria=s),label:"Categoría",outlined:"",dense:""},null,8,["modelValue"]),l(u,{modelValue:o.edit.descripcion,"onUpdate:modelValue":e[9]||(e[9]=s=>o.edit.descripcion=s),type:"textarea",label:"Descripción",outlined:"",dense:"",autogrow:""},null,8,["modelValue"])]),_:1}),l(Q,{align:"right"},{default:a(()=>[x(l(_,{flat:"",label:"Cancelar"},null,512),[[k]]),l(_,{color:"primary",label:"Guardar",loading:o.saving,onClick:n.saveMeta},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Ml=S(jl,[["render",Ql]]),Ol={name:"Fotografias",props:{caseId:{type:[String,Number],required:!0}},data(){return{rows:{data:[],last_page:1},page:1,perPage:12,loading:!1,uploading:!1}},created(){this.fetchRows()},methods:{toPublicUrl(t){return console.log("url",t),t?/^https?:\/\//i.test(t)?t:`${(this.$axios?.defaults?.baseURL||"").replace(/\/api\/?$/,"")}${t}`:""},async fetchRows(){this.loading=!0;try{const t=await this.$axios.get(`/slims/${this.caseId}/fotografias`,{params:{page:this.page,per_page:this.perPage}});this.rows=t.data||{data:[],last_page:1}}catch(t){this.$q.notify({type:"negative",message:t?.response?.data?.message||"Error cargando fotos"})}finally{this.loading=!1}},pickFile(){this.$refs.file.click()},async upload(t){const e=t.target.files?.[0];if(e){this.uploading=!0;try{const f=new FormData;f.append("file",e),await this.$axios.post(`/slims/${this.caseId}/fotografias`,f,{headers:{"Content-Type":"multipart/form-data"}}),this.$q.notify({type:"positive",message:"Foto subida"}),this.fetchRows()}catch(f){this.$q.notify({type:"negative",message:f?.response?.data?.message||"No se pudo subir"})}finally{this.uploading=!1,this.$refs.file&&(this.$refs.file.value="")}}},async remove(t){if(confirm("¿Eliminar foto?"))try{await this.$axios.delete(`/slims/fotografias/${t.id}`),this.$q.notify({type:"positive",message:"Eliminada"}),this.fetchRows()}catch(e){this.$q.notify({type:"negative",message:e?.response?.data?.message||"No se pudo eliminar"})}},view(t){t&&window.open(t,"_blank")}}},zl={class:"row items-center q-mb-sm"},Gl={class:"col"},Bl={class:"text-caption text-grey-7"},Hl={class:"col-auto"},Wl={class:"row q-col-gutter-md q-mt-sm"},Yl={class:"absolute-bottom text-subtitle2 bg-black bg-opacity-40 q-pa-xs ellipsis"};function Zl(t,e,f,b,o,n){return c(),p(w,{flat:"",bordered:"",class:"q-pa-md"},{default:a(()=>[i("div",zl,[i("div",Gl,[e[2]||(e[2]=i("div",{class:"text-subtitle1 text-weight-medium"},"Fotografías",-1)),i("div",Bl,"Sube/ver fotos del caso #"+r(f.caseId),1)]),i("div",Hl,[l(_,{color:"primary",icon:"add_photo_alternate","no-caps":"",label:"Subir",onClick:n.pickFile,loading:o.uploading},null,8,["onClick","loading"]),i("input",{type:"file",ref:"file",accept:"image/*",class:"hidden",onChange:e[0]||(e[0]=(...s)=>n.upload&&n.upload(...s))},null,544)])]),l(C),i("div",Wl,[(c(!0),V(U,null,Y(o.rows.data,s=>(c(),V("div",{key:s.id,class:"col-6 col-sm-4 col-md-3"},[l(w,{flat:"",bordered:""},{default:a(()=>[l(fe,{src:n.toPublicUrl(s.thumb_url||s.url),ratio:4/3,onClick:d=>n.view(n.toPublicUrl(s.url)),style:{cursor:"pointer"}},{default:a(()=>[i("div",Yl,r(s.titulo),1)]),_:2},1032,["src","onClick"]),l(Q,{align:"between"},{default:a(()=>[l(_,{dense:"",flat:"",icon:"delete",color:"negative",onClick:d=>n.remove(s)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))]),l(Z,{modelValue:o.page,"onUpdate:modelValue":[e[1]||(e[1]=s=>o.page=s),n.fetchRows],max:o.rows.last_page||1,class:"q-mt-md flex justify-end"},null,8,["modelValue","max","onUpdate:modelValue"])]),_:1})}const Jl=S(Ol,[["render",Zl]]),Xl={name:"HojaRuta",props:{caseId:{type:[String,Number],required:!0}},data(){return{loading:!1,editing:!1,backup:null,form:{caso_numero:"",fecha_apertura_caso:"",fecha_derivacion_psicologica:"",fecha_informe_area_psicologica:"",fecha_informe_trabajo_social:"",fecha_derivacion_area_legal:""}}},computed:{canEdit(){const t=this.$store.user?.role||"";return t==="Administrador"||t==="Asistente"},isReadOnly(){return!this.editing||!this.canEdit},total(){return 5},done(){return["fecha_apertura_caso","fecha_derivacion_psicologica","fecha_informe_area_psicologica","fecha_informe_trabajo_social","fecha_derivacion_area_legal"].filter(e=>!!this.form[e]).length}},created(){this.fetch()},methods:{format(t){return t||"—"},async fetch(){this.loading=!0;try{const{data:t}=await this.$axios.get(`/slims/${this.caseId}`);this.form={caso_numero:t.caso_numero||"",fecha_apertura_caso:t.fecha_apertura_caso||"",fecha_derivacion_psicologica:t.fecha_derivacion_psicologica||"",fecha_informe_area_psicologica:t.fecha_informe_area_psicologica||"",fecha_informe_trabajo_social:t.fecha_informe_trabajo_social||"",fecha_derivacion_area_legal:t.fecha_derivacion_area_legal||""},this.backup={...this.form}}catch(t){this.$alert?.error(t?.response?.data?.message||"No se pudo cargar la hoja de ruta")}finally{this.loading=!1}},startEdit(){this.canEdit&&(this.editing=!0,this.backup={...this.form})},cancelEdit(){this.form={...this.backup},this.editing=!1,this.$q.notify({type:"info",message:"Cambios descartados"})},async save(){if(!this.canEdit)return;const t={fecha_derivacion_psicologica:this.form.fecha_derivacion_psicologica||null,fecha_informe_area_psicologica:this.form.fecha_informe_area_psicologica||null,fecha_informe_trabajo_social:this.form.fecha_informe_trabajo_social||null,fecha_derivacion_area_legal:this.form.fecha_derivacion_area_legal||null};this.loading=!0;try{const{data:e}=await this.$axios.put(`/slims/${this.caseId}`,t);this.form={...this.form,fecha_derivacion_psicologica:e.data?.fecha_derivacion_psicologica??this.form.fecha_derivacion_psicologica,fecha_informe_area_psicologica:e.data?.fecha_informe_area_psicologica??this.form.fecha_informe_area_psicologica,fecha_informe_trabajo_social:e.data?.fecha_informe_trabajo_social??this.form.fecha_informe_trabajo_social,fecha_derivacion_area_legal:e.data?.fecha_derivacion_area_legal??this.form.fecha_derivacion_area_legal},this.backup={...this.form},this.editing=!1,this.$alert?.success("Hoja de ruta actualizada")}catch(e){this.$alert?.error(e?.response?.data?.message||"No se pudo actualizar")}finally{this.loading=!1}}}},Kl={class:"row items-center q-mb-sm"},$l={class:"col"},ei={class:"text-caption text-grey-7"},oi={class:"col-auto row items-center q-gutter-sm"},li={class:"row q-col-gutter-md"},ii={class:"col-12 col-md-3"},ti={class:"col-12 col-md-3"},si={class:"col-12 col-md-3"},ai={class:"col-12 col-md-3"},ni={class:"col-12 col-md-3"},di={class:"col-12 col-md-3"};function ri(t,e,f,b,o,n){return c(),V("div",null,[i("div",Kl,[i("div",$l,[e[6]||(e[6]=i("div",{class:"text-subtitle1 text-weight-medium"},"Hoja de ruta",-1)),i("div",ei," Completa las fechas clave del caso ("+r(n.done)+"/"+r(n.total)+" completadas) ",1)]),i("div",oi,[n.canEdit?y("",!0):(c(),p(ee,{key:0,dense:"",color:"grey-3","text-color":"grey-9",icon:"visibility_off"},{default:a(()=>e[7]||(e[7]=[m(" Solo lectura ")])),_:1})),l(_,{flat:"",color:"secondary",icon:"refresh",loading:o.loading,onClick:n.fetch},null,8,["loading","onClick"]),n.canEdit?(c(),V(U,{key:1},[o.editing?(c(),V(U,{key:1},[l(_,{flat:"",color:"negative",icon:"close",label:"Cancelar",onClick:n.cancelEdit,loading:o.loading},null,8,["onClick","loading"]),l(_,{color:"primary",icon:"save",label:"Guardar",onClick:n.save,loading:o.loading},null,8,["onClick","loading"])],64)):(c(),p(_,{key:0,color:"primary",icon:"edit",label:"Editar",onClick:n.startEdit,loading:o.loading},null,8,["onClick","loading"]))],64)):y("",!0)])]),l(w,{flat:"",bordered:"",class:"section-card"},{default:a(()=>[l(v,null,{default:a(()=>[i("div",li,[i("div",ii,[l(u,{modelValue:o.form.caso_numero,"onUpdate:modelValue":e[0]||(e[0]=s=>o.form.caso_numero=s),label:"Código de caso",dense:"",outlined:"",readonly:""},null,8,["modelValue"])]),i("div",ti,[l(u,{modelValue:o.form.fecha_apertura_caso,"onUpdate:modelValue":e[1]||(e[1]=s=>o.form.fecha_apertura_caso=s),type:"date",label:"Fecha de apertura del caso",dense:"",outlined:"",readonly:""},null,8,["modelValue"])]),i("div",si,[l(u,{modelValue:o.form.fecha_derivacion_psicologica,"onUpdate:modelValue":e[2]||(e[2]=s=>o.form.fecha_derivacion_psicologica=s),type:"date",readonly:n.isReadOnly,dense:"",outlined:"",label:"Fecha de derivación psicológica"},null,8,["modelValue","readonly"])]),i("div",ai,[l(u,{modelValue:o.form.fecha_informe_area_psicologica,"onUpdate:modelValue":e[3]||(e[3]=s=>o.form.fecha_informe_area_psicologica=s),type:"date",readonly:n.isReadOnly,dense:"",outlined:"",label:"Fecha de entrega informe (Área psicológica)"},null,8,["modelValue","readonly"])]),i("div",ni,[l(u,{modelValue:o.form.fecha_informe_trabajo_social,"onUpdate:modelValue":e[4]||(e[4]=s=>o.form.fecha_informe_trabajo_social=s),type:"date",readonly:n.isReadOnly,dense:"",outlined:"",label:"Fecha de entrega (Trabajo social)"},null,8,["modelValue","readonly"])]),i("div",di,[l(u,{modelValue:o.form.fecha_derivacion_area_legal,"onUpdate:modelValue":e[5]||(e[5]=s=>o.form.fecha_derivacion_area_legal=s),type:"date",readonly:n.isReadOnly,dense:"",outlined:"",label:"Fecha de derivación (Área legal)"},null,8,["modelValue","readonly"])])])]),_:1}),l(C),l(v,null,{default:a(()=>[l(pe,{color:"primary",layout:"comfortable",side:"right"},{default:a(()=>[l(F,{title:"Apertura del caso",subtitle:n.format(o.form.fecha_apertura_caso),icon:"flag"},null,8,["subtitle"]),l(F,{title:"Derivación psicológica",subtitle:n.format(o.form.fecha_derivacion_psicologica),icon:"psychology",color:o.form.fecha_derivacion_psicologica?"primary":"grey-5"},null,8,["subtitle","color"]),l(F,{title:"Informe área psicológica",subtitle:n.format(o.form.fecha_informe_area_psicologica),icon:"assignment_turned_in",color:o.form.fecha_informe_area_psicologica?"primary":"grey-5"},null,8,["subtitle","color"]),l(F,{title:"Entrega trabajo social",subtitle:n.format(o.form.fecha_informe_trabajo_social),icon:"diversity_3",color:o.form.fecha_informe_trabajo_social?"primary":"grey-5"},null,8,["subtitle","color"]),l(F,{title:"Derivación área legal",subtitle:n.format(o.form.fecha_derivacion_area_legal),icon:"gavel",color:o.form.fecha_derivacion_area_legal?"primary":"grey-5"},null,8,["subtitle","color"])]),_:1})]),_:1})]),_:1})])}const ci=S(Xl,[["render",ri],["__scopeId","data-v-601f57f4"]]),ui={name:"Seguimiento",props:{caseId:{type:[String,Number],required:!0}},data(){return{loading:!1,header:{},rows:[],filters:{q:"",tipo:"Todos",modulo:"Todos",desde:"",hasta:""},tipos:["Todos","Informe","Sesión","Documento","Fotografía"],modulos:["Todos","General","Psicológico","Legal","Social","Documentos","Multimedia"],columns:[{name:"actividad",label:"Actividad",field:"actividad",align:"left",sortable:!1},{name:"fecha",label:"Fecha / Usuario",field:"fecha",align:"left",sortable:!0},{name:"modulo",label:"Módulo",field:"modulo",align:"left",sortable:!0},{name:"acciones",label:"",field:"acciones",align:"right",sortable:!1,style:"width: 140px"}]}},computed:{rowsFiltered(){let t=this.rows.slice();if(this.filters.q){const e=this.filters.q.toLowerCase();t=t.filter(f=>(f.titulo||"").toLowerCase().includes(e)||(f.descripcion||"").toLowerCase().includes(e)||(f.usuario||"").toLowerCase().includes(e))}return this.filters.tipo&&this.filters.tipo!=="Todos"&&(t=t.filter(e=>e.tipo===this.filters.tipo)),this.filters.modulo&&this.filters.modulo!=="Todos"&&(t=t.filter(e=>(e.modulo||"").toLowerCase()===this.filters.modulo.toLowerCase())),this.filters.desde&&(t=t.filter(e=>(e.fecha||"0000-00-00")>=this.filters.desde)),this.filters.hasta&&(t=t.filter(e=>(e.fecha||"9999-12-31")<=this.filters.hasta)),t}},mounted(){this.fetch()},methods:{async fetch(){this.loading=!0;try{const{data:t}=await this.$axios.get(`/slims/${this.caseId}/seguimiento`);this.header=t.header||{},this.rows=t.items||[]}catch(t){this.$alert?.error?.(t?.response?.data?.message||"No se pudo cargar el seguimiento")}finally{this.loading=!1}},toPublicUrl(t){return t?/^https?:\/\//i.test(t)?t:`${(this.$axios?.defaults?.baseURL||"").replace(/\/api\/?$/,"")}${t}`:""},open(t){const e=this.toPublicUrl(t);e&&window.open(e,"_blank")}}},mi={class:"row items-start q-col-gutter-sm"},fi={class:"col-12 col-md-8"},pi={class:"text-caption text-grey-7"},gi={class:"col-12 col-md-4 flex items-center justify-end"},_i={class:"row q-col-gutter-sm"},hi={class:"col-12 col-md-3"},bi={class:"val"},vi={class:"col-12 col-md-3"},yi={class:"val"},Vi={class:"col-12 col-md-3"},wi={class:"val"},xi={class:"col-12 col-md-3"},ki={class:"val ellipsis"},Ci={class:"col-12 col-md-3"},qi={class:"val"},Ui={class:"col-12 col-md-3"},Ii={class:"val"},Di={class:"col-12 col-md-3"},Ei={class:"val"},Si={class:"col-12 col-md-3"},ji={class:"val"},Ri={class:"row items-center q-col-gutter-sm"},Pi={class:"col-12 col-md-4"},Ni={class:"col-6 col-md-2"},Ti={class:"col-6 col-md-2"},Ai={class:"col-6 col-md-2"},Li={class:"col-6 col-md-2"},Fi={class:"row no-wrap items-center q-gutter-xs"},Qi={class:"text-weight-medium"},Mi={class:"text-caption text-grey-7 ellipsis-2-lines",style:{"max-width":"520px"}},Oi={class:"text-weight-medium"},zi={class:"text-caption text-grey-7"};function Gi(t,e,f,b,o,n){return c(),V("div",null,[l(w,{flat:"",bordered:"",class:"q-pa-sm q-mb-md"},{default:a(()=>[i("div",mi,[i("div",fi,[e[7]||(e[7]=i("div",{class:"text-subtitle1 text-weight-bold"},"Seguimiento del Caso",-1)),i("div",pi,[e[5]||(e[5]=m(" SLIM ")),i("b",null,"#"+r(o.header.slim_id||o.header.caso_id),1),e[6]||(e[6]=m(" · N° ")),i("b",null,r(o.header.caso_numero||"—"),1)])]),i("div",gi,[l(ee,{dense:"",color:"indigo-1","text-color":"indigo-9",class:"q-mr-xs"},{default:a(()=>[m(r(o.header.fecha_registro||"—"),1)]),_:1}),l(_,{flat:"",color:"primary",icon:"refresh",onClick:n.fetch,loading:o.loading,title:"Actualizar",label:o.loading?"":"Actualizar","no-caps":"",dense:""},null,8,["onClick","loading","label"])])]),l(C,{class:"q-my-sm"}),i("div",_i,[i("div",hi,[e[8]||(e[8]=i("div",{class:"lbl"},"Tipología",-1)),i("div",bi,r(o.header.tipologia||"—"),1)]),i("div",vi,[e[9]||(e[9]=i("div",{class:"lbl"},"Modalidad",-1)),i("div",yi,r(o.header.modalidad||"—"),1)]),i("div",Vi,[e[10]||(e[10]=i("div",{class:"lbl"},"Zona",-1)),i("div",wi,r(o.header.zona||"—"),1)]),i("div",xi,[e[11]||(e[11]=i("div",{class:"lbl"},"Dirección",-1)),i("div",ki,r(o.header.direccion||"—"),1)]),i("div",Ci,[e[12]||(e[12]=i("div",{class:"lbl"},"Denunciante",-1)),i("div",qi,r(o.header.denunciante||"—"),1)]),i("div",Ui,[e[13]||(e[13]=i("div",{class:"lbl"},"Denunciado",-1)),i("div",Ii,r(o.header.denunciado||"—"),1)]),i("div",Di,[e[14]||(e[14]=i("div",{class:"lbl"},"Fecha del hecho",-1)),i("div",Ei,r(o.header.fecha_hecho||"—"),1)]),i("div",Si,[e[15]||(e[15]=i("div",{class:"lbl"},"Registrado por",-1)),i("div",ji,r(o.header.registrado_por||"—"),1)])])]),_:1}),l(w,{flat:"",bordered:"",class:"q-pa-sm q-mb-sm"},{default:a(()=>[i("div",Ri,[i("div",Pi,[l(u,{modelValue:o.filters.q,"onUpdate:modelValue":e[0]||(e[0]=s=>o.filters.q=s),dense:"",outlined:"",placeholder:"Buscar (título, descripción, usuario)"},{append:a(()=>[l(h,{name:"search"})]),_:1},8,["modelValue"])]),i("div",Ni,[l(D,{modelValue:o.filters.tipo,"onUpdate:modelValue":e[1]||(e[1]=s=>o.filters.tipo=s),options:o.tipos,dense:"",outlined:"",label:"Tipo"},null,8,["modelValue","options"])]),i("div",Ti,[l(D,{modelValue:o.filters.modulo,"onUpdate:modelValue":e[2]||(e[2]=s=>o.filters.modulo=s),options:o.modulos,dense:"",outlined:"",label:"Módulo"},null,8,["modelValue","options"])]),i("div",Ai,[l(u,{modelValue:o.filters.desde,"onUpdate:modelValue":e[3]||(e[3]=s=>o.filters.desde=s),type:"date",dense:"",outlined:"",label:"Desde"},null,8,["modelValue"])]),i("div",Li,[l(u,{modelValue:o.filters.hasta,"onUpdate:modelValue":e[4]||(e[4]=s=>o.filters.hasta=s),type:"date",dense:"",outlined:"",label:"Hasta"},null,8,["modelValue"])])])]),_:1}),l(ge,{flat:"",bordered:"",rows:n.rowsFiltered,columns:o.columns,"row-key":"uid",loading:o.loading,"hide-bottom":"","rows-per-page-options":[0],class:"rounded-borders"},{"body-cell-actividad":a(s=>[l(B,{props:s},{default:a(()=>[i("div",Fi,[l(h,{name:s.row.icon||"feed",size:"18px",class:"text-primary"},null,8,["name"]),i("div",null,[i("div",Qi,[m(r(s.row.tipo)+" ",1),e[16]||(e[16]=i("span",{class:"text-grey-7"},"·",-1)),m(" "+r(s.row.titulo||"—"),1)]),i("div",Mi,r(s.row.descripcion||"—"),1)])])]),_:2},1032,["props"])]),"body-cell-fecha":a(s=>[l(B,{props:s},{default:a(()=>[i("div",Oi,r(s.row.fecha||"—"),1),i("div",zi,r(s.row.usuario||"—"),1)]),_:2},1032,["props"])]),"body-cell-modulo":a(s=>[l(B,{props:s},{default:a(()=>[l(ee,{dense:"",square:""},{default:a(()=>[m(r(s.row.modulo||"—"),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-acciones":a(s=>[l(B,{props:s,class:"q-gutter-xs"},{default:a(()=>[s.row.links?.pdf?(c(),p(_,{key:0,dense:"",flat:"",icon:"picture_as_pdf",onClick:d=>n.open(s.row.links.pdf),title:"Ver PDF"},null,8,["onClick"])):y("",!0),s.row.links?.view?(c(),p(_,{key:1,dense:"",flat:"",icon:"visibility",onClick:d=>n.open(s.row.links.view),title:"Ver"},null,8,["onClick"])):y("",!0),s.row.links?.download?(c(),p(_,{key:2,dense:"",flat:"",icon:"download",onClick:d=>n.open(s.row.links.download),title:"Descargar"},null,8,["onClick"])):y("",!0),s.row.links?.open?(c(),p(_,{key:3,dense:"",flat:"",icon:"open_in_new",onClick:d=>n.open(s.row.links.open),title:"Abrir"},null,8,["onClick"])):y("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])])}const Bi=S(ui,[["render",Gi],["__scopeId","data-v-c9019dbd"]]),Hi={name:"SlimDetalle",components:{InfoGeneral:Yo,SesionesPsicologico:ml,InformesLegal:Ul,ApoyoIntegral:Sl,DocumentosGeneral:Ml,Fotografias:Jl,HojaRuta:ci,Seguimiento:Bi},data(){return{loading:!1,tab:"info",slim:null,defaultCountryCallingCode:"591"}},computed:{caseId(){return this.$route.params.id},role(){return this.$store.user?.role||""},hasAnyWa(){const t=this.slim||{};return!!(t?.psicologica_user?.celular||t?.legal_user?.celular||t?.trabajo_social_user?.celular)}},created(){this.fetchSlim()},methods:{normalizePhone(t){if(!t)return"";let e=String(t).replace(/\D+/g,"");return/^(\d{11,13})$/.test(e)?e:e.length===8?this.defaultCountryCallingCode+e:e.length===9&&!e.startsWith(this.defaultCountryCallingCode)?this.defaultCountryCallingCode+e:e},waUrl(t,e){const f=this.normalizePhone(t),b=encodeURIComponent(e||"");return`https://wa.me/${f}${b?`?text=${b}`:""}`},waMessage(t){const e=this.slim||{},f=e.caso_numero?e.caso_numero.replace(/\\\//g,"/"):`#${this.caseId}`,b=(this.$axios?.defaults?.baseURL||"")+`/slims/${this.caseId}`,o=t==="psico"?"Psicología":t==="legal"?"Legal":"Trabajo Social";return["*SLIM - Notificación de Caso*",`Nro: ${f}`,`Área: ${o}`,`Denunciante: ${e.denunciante_nombre_completo||"—"}`,e.caso_tipologia?`Tipología: ${e.caso_tipologia}`:null,e.caso_modalidad?`Modalidad: ${e.caso_modalidad}`:null,e.caso_fecha_hecho?`Fecha del hecho: ${e.caso_fecha_hecho}`:null,"",`Ver SLIM: ${b}`].filter(Boolean).join(`
`)},sendWhatsApp(t){const e=this.slim||{},f=t==="psico"?e.psicologica_user:t==="legal"?e.legal_user:t==="social"?e.trabajo_social_user:null;if(!f?.celular){this.$q.notify({type:"warning",message:"No hay número de celular configurado para ese responsable"});return}const b=this.waUrl(f.celular,this.waMessage(t));window.open(b,"_blank")},async fetchSlim(){this.loading=!0;try{const t=await this.$axios.get(`/slims/${this.caseId}`);this.slim=t.data}catch(t){this.$alert.error(t?.response?.data?.message||"No se pudo cargar el SLIM")}finally{this.loading=!1}},printPdf(){const t=this.$axios.defaults.baseURL+`/slims/${this.caseId}/pdf`;window.open(t,"_blank")},printPdfHojaRuta(t="denunciante"){const e=this.$axios.defaults.baseURL+`/slims/${this.caseId}/pdf/hoja-ruta?tipo=${t}`;window.open(e,"_blank")}}},Wi={class:"row items-center q-mb-md"},Yi={class:"col"},Zi={class:"text-h6 text-weight-bold"},Ji={class:"col-auto row q-gutter-sm"};function Xi(t,e,f,b,o,n){const s=E("InfoGeneral"),d=E("Seguimiento"),J=E("HojaRuta"),X=E("SesionesPsicologico"),K=E("InformesLegal"),O=E("ApoyoIntegral"),le=E("DocumentosGeneral"),$=E("Fotografias");return c(),p(ue,{class:"q-pa-md bg-grey-2"},{default:a(()=>[i("div",Wi,[i("div",Yi,[i("div",Zi,"SLIM #"+r(o.slim?.id||"..."),1),e[7]||(e[7]=i("div",{class:"text-caption text-grey-7"},"Detalle y gestión integral",-1))]),i("div",Ji,[n.hasAnyWa?(c(),p(M,{key:0,flat:"",color:"positive",icon:"chat",label:"WhatsApp"},{default:a(()=>[l(ie,null,{default:a(()=>[o.slim?.psicologica_user?.celular?(c(),p(q,{key:0,clickable:"",onClick:e[0]||(e[0]=I=>n.sendWhatsApp("psico"))},{default:a(()=>[l(g,{avatar:""},{default:a(()=>[l(h,{name:"psychology"})]),_:1}),l(g,null,{default:a(()=>[m("Psicología ("+r(o.slim.psicologica_user.name)+")",1)]),_:1}),l(g,{side:"",class:"text-caption text-grey"},{default:a(()=>[m(r(o.slim.psicologica_user.celular),1)]),_:1})]),_:1})):y("",!0),o.slim?.legal_user?.celular?(c(),p(q,{key:1,clickable:"",onClick:e[1]||(e[1]=I=>n.sendWhatsApp("legal"))},{default:a(()=>[l(g,{avatar:""},{default:a(()=>[l(h,{name:"gavel"})]),_:1}),l(g,null,{default:a(()=>[m("Legal ("+r(o.slim.legal_user.name)+")",1)]),_:1}),l(g,{side:"",class:"text-caption text-grey"},{default:a(()=>[m(r(o.slim.legal_user.celular),1)]),_:1})]),_:1})):y("",!0),o.slim?.trabajo_social_user?.celular?(c(),p(q,{key:2,clickable:"",onClick:e[2]||(e[2]=I=>n.sendWhatsApp("social"))},{default:a(()=>[l(g,{avatar:""},{default:a(()=>[l(h,{name:"people"})]),_:1}),l(g,null,{default:a(()=>[m("Trabajo social ("+r(o.slim.trabajo_social_user.name)+")",1)]),_:1}),l(g,{side:"",class:"text-caption text-grey"},{default:a(()=>[m(r(o.slim.trabajo_social_user.celular),1)]),_:1})]),_:1})):y("",!0)]),_:1})]),_:1})):y("",!0),l(M,{flat:"",color:"secondary",icon:"print",label:"Imprimir PDF"},{default:a(()=>[l(ie,null,{default:a(()=>[x((c(),p(q,{clickable:"",onClick:n.printPdf},{default:a(()=>[l(g,null,{default:a(()=>e[8]||(e[8]=[m("Ficha del SLIM")])),_:1})]),_:1},8,["onClick"])),[[k]]),l(C),x((c(),p(q,{clickable:"",onClick:e[3]||(e[3]=I=>n.printPdfHojaRuta("denunciante"))},{default:a(()=>[l(g,null,{default:a(()=>e[9]||(e[9]=[m("Ubicación (Denunciante)")])),_:1})]),_:1})),[[k]]),x((c(),p(q,{clickable:"",onClick:e[4]||(e[4]=I=>n.printPdfHojaRuta("denunciado"))},{default:a(()=>[l(g,null,{default:a(()=>e[10]||(e[10]=[m("Ubicación (Denunciado)")])),_:1})]),_:1})),[[k]])]),_:1})]),_:1}),l(_,{flat:"",color:"primary",icon:"refresh",onClick:n.fetchSlim,loading:o.loading},null,8,["onClick","loading"])])]),l(w,{flat:"",bordered:"",class:"q-mb-md"},{default:a(()=>[l(re,{modelValue:o.tab,"onUpdate:modelValue":e[5]||(e[5]=I=>o.tab=I),class:"text-primary",dense:"",align:"left","active-color":"primary","indicator-color":"primary","outside-arrows":"","mobile-arrows":""},{default:a(()=>[l(P,{name:"info",label:"1 Información General",icon:"dashboard","no-caps":""}),l(P,{name:"seguimiento",label:"2 Seguimiento",icon:"track_changes","no-caps":""}),n.role==="Administrador"||n.role==="Asistente"?(c(),p(P,{key:0,name:"hoja",label:"3 Hoja de Ruta",icon:"report_problem","no-caps":""})):y("",!0),n.role==="Administrador"||n.role==="Psicologo"?(c(),p(P,{key:1,name:"psico",label:"4 Área Psicológico",icon:"psychology","no-caps":""})):y("",!0),n.role==="Administrador"||n.role==="Abogado"?(c(),p(P,{key:2,name:"legal",label:"5 Área Legal",icon:"gavel","no-caps":""})):y("",!0),l(P,{name:"docs",label:"6 Documentos General",icon:"folder","no-caps":""}),l(P,{name:"fotos",label:"7 Fotografías",icon:"photo_library","no-caps":""})]),_:1},8,["modelValue"])]),_:1}),l(ce,{modelValue:o.tab,"onUpdate:modelValue":e[6]||(e[6]=I=>o.tab=I),animated:"","keep-alive":""},{default:a(()=>[l(R,{name:"info"},{default:a(()=>[l(s,{"case-id":n.caseId},null,8,["case-id"])]),_:1}),l(R,{name:"seguimiento"},{default:a(()=>[l(d,{"case-id":n.caseId},null,8,["case-id"])]),_:1}),l(R,{name:"hoja"},{default:a(()=>[l(J,{"case-id":n.caseId},null,8,["case-id"])]),_:1}),l(R,{name:"psico"},{default:a(()=>[l(X,{"case-id":n.caseId,caso:o.slim},null,8,["case-id","caso"])]),_:1}),l(R,{name:"legal"},{default:a(()=>[l(K,{"case-id":n.caseId},null,8,["case-id"])]),_:1}),l(R,{name:"apoyo"},{default:a(()=>[l(O,{"case-id":n.caseId},null,8,["case-id"])]),_:1}),l(R,{name:"docs"},{default:a(()=>[l(le,{"case-id":n.caseId},null,8,["case-id"])]),_:1}),l(R,{name:"fotos"},{default:a(()=>[l($,{"case-id":n.caseId},null,8,["case-id"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}const _t=S(Hi,[["render",Xi],["__scopeId","data-v-2bc6c22d"]]);export{_t as default};
