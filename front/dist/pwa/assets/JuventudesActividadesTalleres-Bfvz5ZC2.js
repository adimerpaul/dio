import{_ as y,Y as C,c as g,o as f,w as d,b as s,a,f as m,Q as v,e as h,h as V,d as w,t as A,a3 as x,a6 as c,ac as D,a0 as _,a1 as E,a2 as q,a9 as k,a8 as S,W as T,$ as I}from"./index-DZYiGuTU.js";import{Q as F}from"./QSpace-Bv77G--c.js";import{Q}from"./QSelect-DUeELk0Z.js";import{Q as L}from"./QMenu-Bh0zJ2Vn.js";import{Q as B}from"./QPage-BmToZd79.js";import{C as U}from"./ClosePopup-B2gXgGxx.js";import{F as M,l as N,i as O,a as z,b as j}from"./es-CdJe4Qy-.js";import"./format-Le207BFP.js";const G={name:"JuventudTalleresCalendar",components:{FullCalendar:M},data(){return{dialog:{open:!1,isEdit:!1,currentId:null},areaOpts:["Formación","Medio ambiente","Desarrollo","Salud","Conmemoración","Emprendimiento","Cultura","Deporte"],colorOptions:["#1976D2","#2E7D32","#FB8C00","#C62828","#6A1B9A","#0097A7","#C2185B","#7B1FA2","#455A64","#8E24AA"],form:{actividad:"",area:"",descripcion:"",poblacion:"",lugar:"",responsables:"",colaboracion:"",observaciones:"",fecha_inicio:"",fecha_final:"",color:"#1976D2",all_day:!1},saving:!1,deleting:!1,calendarOptions:{plugins:[O,z,j],locale:N,timeZone:"local",initialView:"timeGridWeek",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},slotMinTime:"06:00:00",slotMaxTime:"22:00:00",selectable:!0,editable:!0,eventOverlap:!1,eventDisplay:"block",nowIndicator:!0,height:"auto",events:(o,e,n)=>this.fetchEvents(o,e,n),select:o=>this.handleSelect(o),eventClick:o=>this.openEdit(o.event),eventDrop:o=>this.handleEventMove(o,"drop"),eventResize:o=>this.handleEventMove(o,"resize")}}},methods:{textColor(o){if(!o)return"white";const e=o.replace("#",""),n=parseInt(e.slice(0,2),16),r=parseInt(e.slice(2,4),16),t=parseInt(e.slice(4,6),16);return(.299*n+.587*r+.114*t)/255>.58?"black":"white"},colorByArea(o){return{Formación:"#1976D2","Medio ambiente":"#2E7D32",Desarrollo:"#FB8C00",Salud:"#C62828",Conmemoración:"#6A1B9A",Emprendimiento:"#0097A7",Cultura:"#C2185B",Deporte:"#455A64"}[o]||"#1976D2"},req(o){return!!o||"Requerido"},onToggleAllDay(o){if(o){if(this.form.fecha_inicio?.length>=10){const e=this.form.fecha_inicio.slice(0,10);this.form.fecha_inicio=`${e}T00:00`}if(this.form.fecha_final?.length>=10){const e=this.form.fecha_final.slice(0,10);this.form.fecha_final=`${e}T23:59`}}},toApiLocal(o,e=!1){if(!o)return null;const n=o.includes("T")?o:`${o}T${e?"23:59":"00:00"}`;return(n.length===16?`${n}:00`:n).replace("T"," ")},toLocalInputValue(o){return(o||"").slice(0,16)},dateToLocalString(o){const e=o instanceof Date?o:new Date(o),n=r=>String(r).padStart(2,"0");return`${e.getFullYear()}-${n(e.getMonth()+1)}-${n(e.getDate())} ${n(e.getHours())}:${n(e.getMinutes())}:${n(e.getSeconds())}`},handleSelect({startStr:o,endStr:e}){this.openCreate(o,e)},async handleEventMove(o,e){try{const n={fecha_inicio:this.dateToLocalString(o.event.start),fecha_final:o.event.end?this.dateToLocalString(o.event.end):null};await this.$axios.put(`/juventud-talleres/${o.event.id}`,n),this.$q.notify({type:"positive",message:e==="drop"?"Actividad reprogramada":"Duración actualizada"}),await this.refetch()}catch{o.revert(),this.$q.notify({type:"negative",message:"No se pudo actualizar"})}},async fetchEvents(o,e,n){try{const{data:r}=await this.$axios.get("/juventud-talleres"),t=r.map(i=>{const u=i.color||this.colorByArea(i.area),l=i.actividad||"Actividad",p=i.lugar?` — ${i.lugar}`:"",b=(i.fecha_inicio?.includes(" 00:00:00")||i.fecha_inicio?.includes("T00:00"))&&(i.fecha_final?i.fecha_final.includes(" 23:59:59")||i.fecha_final.includes("T23:59"):!0);return{id:i.id,title:`${l}${p}`,start:i.fecha_inicio,end:i.fecha_final,allDay:b,backgroundColor:u,borderColor:u,textColor:this.textColor(u),extendedProps:{...i}}});e(t)}catch(r){this.$q.notify({type:"negative",message:"No se pudo cargar"}),n(r)}},clearForm(){this.form={actividad:"",area:"",descripcion:"",poblacion:"",lugar:"",responsables:"",colaboracion:"",observaciones:"",fecha_inicio:"",fecha_final:"",color:"#1976D2",all_day:!1}},openCreate(o,e){this.clearForm(),this.dialog.isEdit=!1,this.dialog.currentId=null,this.form.fecha_inicio=this.toLocalInputValue(o),this.form.fecha_final=e?this.toLocalInputValue(e):"",this.dialog.open=!0},openCreateForNow(){const o=new Date,e=i=>String(i).padStart(2,"0"),n=`${o.getFullYear()}-${e(o.getMonth()+1)}-${e(o.getDate())}`,r=`${e(o.getHours())}:${e(o.getMinutes())}`,t=this.form.all_day?`${n}T00:00`:`${n}T${r}`;this.openCreate(t,"")},openEdit(o){this.clearForm(),this.dialog.isEdit=!0,this.dialog.currentId=o.id;const e=o.extendedProps||{};this.form.actividad=e.actividad||o.title||"",this.form.area=e.area||"",this.form.descripcion=e.descripcion||"",this.form.poblacion=e.poblacion||"",this.form.lugar=e.lugar||"",this.form.responsables=e.responsables||"",this.form.colaboracion=e.colaboracion||"",this.form.observaciones=e.observaciones||"",this.form.color=e.color||o.backgroundColor||"#1976D2";const n=o.startStr,r=o.endStr||"",t=/T00:00/.test(n),i=/T23:59/.test(r);this.form.all_day=!!(o.allDay||t&&(!r||i)),this.form.fecha_inicio=this.toLocalInputValue(n),this.form.fecha_final=r?this.toLocalInputValue(r):"",this.dialog.open=!0},async saveEvent(){if(!this.form.actividad||!this.form.fecha_inicio){this.$q.notify({type:"warning",message:"Completa Actividad y Fecha inicio"});return}this.saving=!0;try{const o={...this.form};this.form.all_day?(o.fecha_inicio=this.toApiLocal(this.form.fecha_inicio,!1),o.fecha_final=this.form.fecha_final?this.toApiLocal(this.form.fecha_final,!0):null):(o.fecha_inicio=this.toApiLocal(this.form.fecha_inicio),o.fecha_final=this.form.fecha_final?this.toApiLocal(this.form.fecha_final):null),delete o.all_day,this.dialog.isEdit&&this.dialog.currentId?(await this.$axios.put(`/juventud-talleres/${this.dialog.currentId}`,o),this.$q.notify({type:"positive",message:"Actividad actualizada"})):(await this.$axios.post("/juventud-talleres",o),this.$q.notify({type:"positive",message:"Actividad creada"})),this.dialog.open=!1,await this.refetch()}catch(o){this.$q.notify({type:"negative",message:o?.response?.data?.message||"Error al guardar"})}finally{this.saving=!1}},async deleteEvent(){this.dialog.currentId&&this.$q.dialog({title:"Confirmar",message:"¿Eliminar esta actividad?",cancel:!0,persistent:!0}).onOk(async()=>{this.deleting=!0;try{await this.$axios.delete(`/juventud-talleres/${this.dialog.currentId}`),this.$q.notify({type:"warning",message:"Actividad eliminada"}),this.dialog.open=!1,await this.refetch()}catch{this.$q.notify({type:"negative",message:"No se pudo eliminar"})}finally{this.deleting=!1}})},async refetch(){const o=this.$refs.calendar?.getApi?.();o&&o.refetchEvents()}}},P={class:"row items-center q-mb-md"},$={class:"col-auto"},H={class:"text-subtitle1 text-weight-medium"},J={class:"row q-col-gutter-sm"},R={class:"col-12 col-md-8"},W={class:"col-12 col-md-4"},Y={class:"row q-col-gutter-sm"},X={class:"col-12 col-md-6"},Z={class:"col-12 col-md-6"},K={class:"row q-col-gutter-sm"},ee={class:"col-12 col-md-6"},oe={class:"col-12 col-md-6"},te={class:"row q-col-gutter-sm"},le={class:"col-12"},ie={class:"row q-col-gutter-sm"},ae={class:"col-12 col-md-6"},se={class:"col-12 col-md-6"},ne={class:"row items-center q-col-gutter-sm"},re={class:"col"},ce={class:"row q-col-gutter-xs items-center"},de={class:"col-auto"};function ue(o,e,n,r,t,i){const u=C("FullCalendar");return f(),g(B,{class:"q-pa-md bg-grey-2"},{default:d(()=>[s("div",P,[e[13]||(e[13]=s("div",{class:"col"},[s("div",{class:"text-h6 text-weight-bold"},"Juventudes — Actividades / Talleres"),s("div",{class:"text-caption text-grey-7"},"Gestión en calendario")],-1)),s("div",$,[a(m,{color:"primary",icon:"add_circle",label:"Nuevo",onClick:i.openCreateForNow,"no-caps":""},null,8,["onClick"]),a(m,{flat:"",icon:"refresh",class:"q-ml-sm",onClick:i.refetch},null,8,["onClick"])])]),a(v,{flat:"",bordered:"",class:"section-card"},{default:d(()=>[a(h,null,{default:d(()=>[a(u,{ref:"calendar",options:t.calendarOptions},null,8,["options"])]),_:1})]),_:1}),a(V,{modelValue:t.dialog.open,"onUpdate:modelValue":e[12]||(e[12]=l=>t.dialog.open=l),persistent:""},{default:d(()=>[a(v,{style:{"min-width":"640px","max-width":"900px"}},{default:d(()=>[a(h,{class:"row items-center q-gutter-sm"},{default:d(()=>[a(w,{name:"event_note"}),s("div",H,A(t.dialog.isEdit?"Editar actividad/taller":"Nueva actividad/taller"),1),a(F)]),_:1}),a(x),a(h,{class:"q-gutter-md"},{default:d(()=>[s("div",J,[s("div",R,[a(c,{modelValue:t.form.actividad,"onUpdate:modelValue":e[0]||(e[0]=l=>t.form.actividad=l),label:"Actividad *",dense:"",outlined:"",rules:[i.req]},null,8,["modelValue","rules"])]),s("div",W,[a(Q,{modelValue:t.form.area,"onUpdate:modelValue":e[1]||(e[1]=l=>t.form.area=l),options:t.areaOpts,label:"Área",dense:"",outlined:"",clearable:"","use-input":"","fill-input":""},null,8,["modelValue","options"])])]),s("div",Y,[s("div",X,[a(c,{modelValue:t.form.poblacion,"onUpdate:modelValue":e[2]||(e[2]=l=>t.form.poblacion=l),label:"Población",dense:"",outlined:""},null,8,["modelValue"])]),s("div",Z,[a(c,{modelValue:t.form.lugar,"onUpdate:modelValue":e[3]||(e[3]=l=>t.form.lugar=l),label:"Lugar",dense:"",outlined:""},null,8,["modelValue"])])]),s("div",K,[s("div",ee,[a(c,{modelValue:t.form.responsables,"onUpdate:modelValue":e[4]||(e[4]=l=>t.form.responsables=l),label:"Responsables",dense:"",outlined:""},null,8,["modelValue"])]),s("div",oe,[a(c,{modelValue:t.form.colaboracion,"onUpdate:modelValue":e[5]||(e[5]=l=>t.form.colaboracion=l),label:"Colaboración",dense:"",outlined:""},null,8,["modelValue"])])]),a(c,{modelValue:t.form.descripcion,"onUpdate:modelValue":e[6]||(e[6]=l=>t.form.descripcion=l),type:"textarea",autogrow:"",label:"Descripción",dense:"",outlined:""},null,8,["modelValue"]),a(c,{modelValue:t.form.observaciones,"onUpdate:modelValue":e[7]||(e[7]=l=>t.form.observaciones=l),type:"textarea",autogrow:"",label:"Observaciones",dense:"",outlined:""},null,8,["modelValue"]),s("div",te,[s("div",le,[a(D,{modelValue:t.form.all_day,"onUpdate:modelValue":[e[8]||(e[8]=l=>t.form.all_day=l),i.onToggleAllDay],label:"Todo el día"},null,8,["modelValue","onUpdate:modelValue"])])]),s("div",ie,[s("div",ae,[a(c,{modelValue:t.form.fecha_inicio,"onUpdate:modelValue":e[9]||(e[9]=l=>t.form.fecha_inicio=l),type:"datetime-local",label:"Fecha inicio *",dense:"",outlined:"",rules:[i.req]},null,8,["modelValue","rules"])]),s("div",se,[a(c,{modelValue:t.form.fecha_final,"onUpdate:modelValue":e[10]||(e[10]=l=>t.form.fecha_final=l),type:"datetime-local",label:"Fecha final",dense:"",outlined:""},null,8,["modelValue"])])]),s("div",ne,[e[14]||(e[14]=s("div",{class:"col-auto"},[s("div",{class:"text-caption text-grey-7"},"Color")],-1)),s("div",re,[s("div",ce,[(f(!0),_(E,null,q(t.colorOptions,l=>(f(),_("div",{key:l,class:"col-auto"},[a(L,{clickable:"",square:"",style:k({background:l,color:i.textColor(l),width:"28px",height:"28px",padding:0,border:t.form.color===l?"2px solid rgba(0,0,0,0.35)":"1px solid rgba(0,0,0,0.12)",boxShadow:t.form.color===l?"0 0 0 2px rgba(0,0,0,0.08)":"none"}),onClick:p=>t.form.color=l},null,8,["style","onClick"])]))),128)),s("div",de,[a(c,{modelValue:t.form.color,"onUpdate:modelValue":e[11]||(e[11]=l=>t.form.color=l),dense:"",outlined:"",style:{width:"140px"},label:"#HEX"},null,8,["modelValue"])])])])])]),_:1}),a(S,{align:"right"},{default:d(()=>[T(a(m,{flat:"",label:"Cancelar"},null,512),[[U]]),a(m,{color:"primary",label:t.dialog.isEdit?"Actualizar":"Crear",loading:t.saving,onClick:i.saveEvent},null,8,["label","loading","onClick"]),t.dialog.isEdit?(f(),g(m,{key:0,flat:"",color:"negative",label:"Eliminar",loading:t.deleting,onClick:i.deleteEvent},null,8,["loading","onClick"])):I("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ye=y(G,[["render",ue],["__scopeId","data-v-ece4c254"]]);export{ye as default};
