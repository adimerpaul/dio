import{_ as f,c as g,o as l,w as u,b as t,a as i,a6 as y,$ as c,f as h,d as x,a0 as n,a1 as p,a2 as b,t as a,Z as r}from"./index-D0gNhc4E.js";import{Q as k}from"./QSelect-cXMen7PN.js";import{Q as _}from"./QBadge-CwJPItzv.js";import{Q as C}from"./QTooltip-DBKgzYYp.js";import{Q as w}from"./QSpinnerDots-DRuet_KC.js";import{Q}from"./QMarkupTable-p533hvkK.js";import{Q as V}from"./QPagination-C__rR_zX.js";import{Q as v}from"./QPage-Iy4Bm9Rf.js";import"./format-B6bkFdHr.js";const P={name:"CasosPage",data(){return{casos:[],loading:!1,page:1,perPage:10,meta:{current_page:1,last_page:1,total:0,from:0,to:0},search:"",_searchTimer:null}},mounted(){this.fetchCasos()},methods:{fetchCasos(){this.loading=!0,this.$axios.get("casos",{params:{q:this.search||"",page:this.page,per_page:this.perPage}}).then(d=>{const e=d.data||{};this.casos=e.data||[],this.meta={current_page:e.current_page||1,last_page:e.last_page||1,total:e.total||0,from:e.from||0,to:e.to||0},this.page=this.meta.current_page}).catch(d=>this.$alert.error(d.response?.data?.message||"Error cargando casos")).finally(()=>{this.loading=!1})},onSearch(){this.page=1,this.fetchCasos()},clearSearch(){this.search="",this.onSearch()},goFirstPage(){this.page=1,this.fetchCasos()},rowIndex(d){return(this.meta.from||0)+d}}},q={class:"row items-center q-col-gutter-md q-mb-md"},S={class:"col-12 col-md"},B={class:"col-auto"},I={class:"col-auto"},N={key:0},F=["onClick"],T={class:"text-no-wrap"},U={class:"text-no-wrap"},D={class:"text-weight-medium"},z={key:0,class:"text-caption text-grey-7"},A={class:"text-weight-medium"},j={key:0,class:"text-caption text-grey-7"},M={key:1,class:"text-grey-6"},E={key:1},Z={key:2},L={colspan:"8",class:"text-center"},R={class:"row items-center justify-between q-mt-md"},G={class:"text-caption text-grey-7"};function H(d,e,J,K,s,m){return l(),g(v,{class:"q-pa-md"},{default:u(()=>[t("div",q,[t("div",S,[i(y,{modelValue:s.search,"onUpdate:modelValue":[e[0]||(e[0]=o=>s.search=o),m.onSearch],outlined:"",dense:"",debounce:"400",placeholder:"Buscar por N° de caso, denunciante, denunciado, tipología, zona…"},{prepend:u(()=>[i(x,{name:"search"})]),append:u(()=>[s.search?(l(),g(h,{key:0,flat:"",dense:"",round:"",icon:"close",onClick:m.clearSearch},null,8,["onClick"])):c("",!0)]),_:1},8,["modelValue","onUpdate:modelValue"])]),t("div",B,[i(k,{modelValue:s.perPage,"onUpdate:modelValue":[e[1]||(e[1]=o=>s.perPage=o),m.goFirstPage],options:[10,20,50],dense:"",outlined:"",style:{width:"120px"},label:"Por página"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",I,[i(h,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",onClick:e[2]||(e[2]=o=>m.fetchCasos()),loading:s.loading},null,8,["loading"])])]),i(Q,{flat:"",bordered:"",dense:""},{default:u(()=>[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",{style:{width:"60px"}},"#"),t("th",null,"Nº Caso"),t("th",null,"Fecha"),t("th",null,"Denunciante"),t("th",null,"Denunciado"),t("th",null,"Tipología"),t("th",null,"Zona"),t("th",null,"Tipo"),t("th",null,"Alerta")])],-1)),!s.loading&&s.casos.length?(l(),n("tbody",N,[(l(!0),n(p,null,b(s.casos,(o,O)=>(l(),n("tr",{key:o.id,onClick:W=>d.$router.push("/casos/"+o.id),class:"cursor-pointer"},[t("td",null,a(o.id),1),t("td",T,a(o.caso_numero||"—"),1),t("td",U,a(d.$filters.date(o.fecha_apertura_caso)),1),t("td",null,[t("div",D,a(o.denunciante_nombre_completo),1),o.denunciante_nro?(l(),n("div",z,"CI: "+a(o.denunciante_nro),1)):c("",!0)]),t("td",null,[t("div",A,a(o.denunciado_nombre_completo||"—"),1),o.denunciado_nro?(l(),n("div",j,"CI: "+a(o.denunciado_nro),1)):c("",!0)]),t("td",null,a(o.caso_tipologia||"—"),1),t("td",null,a(o.zona||"—"),1),t("td",null,[i(_,{color:o.numero_apoyo_integral?"green":"grey-5","text-color":o.numero_apoyo_integral?"white":"black",label:o.numero_apoyo_integral?"Apoyo Integral":"Regular",rounded:"",dense:""},null,8,["color","text-color","label"])]),t("td",null,[o.mi_estado?.me_asignado?(l(),n(p,{key:0},[o.mi_estado.primer_informe_hecho?(l(),g(_,{key:0,color:"green","text-color":"white",class:"q-mr-xs"},{default:u(()=>[r(a(o.mi_estado.label_listo||"Primer informe listo"),1)]),_:2},1024)):(l(),n(p,{key:1},[i(_,{color:o.mi_estado.atrasado?"red":"orange","text-color":o.mi_estado.atrasado?"white":"black",class:"q-mr-xs"},{default:u(()=>[o.mi_estado.atrasado?(l(),n(p,{key:0},[r(" Atrasado "+a(Math.abs(o.mi_estado.dias_restantes))+" d ",1)],64)):(l(),n(p,{key:1},[r(" Faltan "+a(o.mi_estado.dias_restantes)+" d ",1)],64))]),_:2},1032,["color","text-color"]),i(C,{"transition-show":"jump-down","transition-hide":"jump-up"},{default:u(()=>[e[4]||(e[4]=r(" Debes cargar tu ")),t("b",null,a(o.mi_estado.rol==="Psicologo"?"primera sesión":"primer informe"),1),e[5]||(e[5]=r(".")),e[6]||(e[6]=t("br",null,null,-1)),e[7]||(e[7]=r(" Fecha límite: ")),t("b",null,a(o.mi_estado.deadline),1),e[8]||(e[8]=r(". "))]),_:2},1024)],64))],64)):(l(),n("span",M,"—"))])],8,F))),128))])):!s.loading&&!s.casos.length?(l(),n("tbody",E,e[9]||(e[9]=[t("tr",null,[t("td",{colspan:"8",class:"text-center text-grey"}," No hay resultados para tu búsqueda. ")],-1)]))):(l(),n("tbody",Z,[t("tr",null,[t("td",L,[i(w,{size:"24px",class:"q-mr-sm"}),e[10]||(e[10]=r(" Cargando… "))])])]))]),_:1}),t("div",R,[t("div",G,[e[12]||(e[12]=r(" Mostrando ")),t("b",null,a(s.meta.from||0),1),e[13]||(e[13]=r(" – ")),t("b",null,a(s.meta.to||0),1),e[14]||(e[14]=r(" de ")),t("b",null,a(s.meta.total||0),1),e[15]||(e[15]=r(" registros "))]),i(V,{modelValue:s.page,"onUpdate:modelValue":[e[3]||(e[3]=o=>s.page=o),m.fetchCasos],max:s.meta.last_page||1,"max-pages":"10","boundary-numbers":"","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])])]),_:1})}const ne=f(P,[["render",H],["__scopeId","data-v-86df065e"]]);export{ne as default};
