import{_ as x,Y as y,c as g,o as u,w as l,a,b as t,$ as C,Q as n,e as f,a6 as b,f as _,a0 as v,a1 as w,a2 as T,t as p,a3 as q,Z as k}from"./index-BP3Sy_Vn.js";import{Q as D}from"./QSelect-b2PhM9eS.js";import{Q,a as V}from"./QTable-D0FBQRyE.js";import{Q as E}from"./QPage-CaKVPTrr.js";import{m as O}from"./vue3-apexcharts-C6ynXgJe.js";import"./QMenu-DlV7zFtQ.js";import"./format-Dgr2a6c2.js";import"./QItemLabel-DN-kSOpd.js";import"./QList-DjrXdhLu.js";import"./QMarkupTable-d4Zz5VKK.js";import"./use-fullscreen-C5mp_Iol.js";const S={name:"IndexPage",components:{apexchart:O},data(){return{loading:!1,filters:{from:"",to:"",area:null},rango:{from:null,to:null},totales:{casos:0,denunciantes:0,denunciados:0},porArea:{labels:[],data:[]},porTipo:{labels:[],data:[]},porTipologia:{labels:[],data:[]},porEdad:{labels:[],data:[]},seriesTiempo:{labels:[],data:[]},porFragancia:{labels:[],data:[]},filterOptions:{areas:[]},detalle:{titulo:"",rows:[],loading:!1},detalleColumns:[{name:"id",label:"ID",field:"id",sortable:!0,align:"left"},{name:"area",label:"Área",field:"area",align:"left"},{name:"tipo",label:"Tipo",field:"tipo",align:"left"},{name:"caso_tipologia",label:"Tipología",field:"caso_tipologia",align:"left"},{name:"caso_numero",label:"N° Caso",field:"caso_numero",align:"left"},{name:"caso_fecha_hecho",label:"Fecha hecho",field:"caso_fecha_hecho",align:"left"},{name:"caso_lugar_hecho",label:"Lugar",field:"caso_lugar_hecho",align:"left"},{name:"principal",label:"Principal",field:"principal",align:"left"}]}},computed:{cards(){return[{key:"casos",label:"Casos",value:this.totales.casos},{key:"denunciante",label:"Denunciantes",value:this.totales.denunciantes},{key:"denunciado",label:"Denunciados",value:this.totales.denunciados}]},rangoTexto(){return!this.rango.from||!this.rango.to?"":`Del ${this.rango.from} al ${this.rango.to}`},barEdadOptions(){return{chart:{toolbar:{show:!1}},xaxis:{categories:this.porEdad.labels},dataLabels:{enabled:!1},plotOptions:{bar:{horizontal:!1,columnWidth:"40%"}},grid:{borderColor:"#eee"}}},barEdadSeries(){return[{name:"Casos",data:this.porEdad.data}]},areaOptions(){return{chart:{toolbar:{show:!1}},stroke:{curve:"smooth",width:2},dataLabels:{enabled:!1},xaxis:{categories:this.seriesTiempo.labels},grid:{borderColor:"#eee"},legend:{position:"top"}}},areaSeries(){return[{name:"Casos",data:this.seriesTiempo.data}]}},mounted(){this.fetchDashboard()},methods:{formatDate(r){return r||""},getDonutOptions(r,e,c){const h=this;return{labels:e,legend:{position:"bottom"},dataLabels:{enabled:!0},chart:{toolbar:{show:!1},events:{dataPointSelection(o,i,d){const s=d.dataPointIndex,m=e[s];m&&h.onDonutClick(c,m)}}},title:{text:"",align:"left"}}},async onDonutClick(r,e){this.detalle.titulo=r==="tipo"?`Casos - Tipo: ${e}`:r==="tipologia"?`Casos - Tipología: ${e}`:`Casos - ${e}`,this.detalle.loading=!0,this.detalle.rows=[];try{const c=await this.$axios.get("dashboard-casos-detalle",{params:{from:this.filters.from,to:this.filters.to,area:this.filters.area,group_by:r,value:e}});this.detalle.rows=c.data||[]}catch(c){console.error(c),this.$q.notify({type:"negative",message:"Error cargando detalle de casos"})}finally{this.detalle.loading=!1}},async fetchDashboard(){this.loading=!0;try{const e=(await this.$axios.get("dashboard-casos",{params:this.filters})).data||{};this.totales=e.totales||this.totales,this.porArea=e.por_area||this.porArea,this.porTipo=e.por_tipo||this.porTipo,this.porTipologia=e.por_tipologia||this.porTipologia,this.porEdad=e.por_edad||this.porEdad,this.seriesTiempo=e.series_tiempo||this.seriesTiempo,this.porFragancia=e.por_fragancia||this.porFragancia,this.filterOptions.areas=e.filtros?.areas||[],this.rango=e.rango||this.rango}catch(r){console.error(r),this.$q.notify({type:"negative",message:"Error cargando dashboard de casos"})}finally{this.loading=!1}}}},F={class:"col-12 col-sm-3"},I={class:"col-12 col-sm-3"},L={class:"col-12 col-sm-3"},N={class:"col-12 col-sm-auto"},P={class:"row q-col-gutter-md q-mb-md"},A={class:"text-caption text-grey-7"},B={class:"text-h4 q-my-sm"},U={class:"text-caption text-positive"},H={class:"row q-col-gutter-md q-mb-md"},M={class:"col-12 col-md-4"},j={class:"col-12 col-md-4"},z={class:"col-12 col-md-4"},R={class:"row q-col-gutter-md"},W={class:"col-12 col-md-6"},Y={class:"col-12 col-md-6"},Z={class:"text-subtitle2"},G={class:"text-caption text-grey-7"};function J(r,e,c,h,o,i){const d=y("apexchart");return u(),g(E,{class:"q-pa-md bg-grey-2"},{default:l(()=>[a(n,{flat:"",bordered:"",class:"q-mb-md"},{default:l(()=>[a(f,{class:"row q-col-gutter-sm items-end"},{default:l(()=>[t("div",F,[a(b,{modelValue:o.filters.from,"onUpdate:modelValue":e[0]||(e[0]=s=>o.filters.from=s),type:"date",label:"Desde",dense:"",outlined:""},null,8,["modelValue"])]),t("div",I,[a(b,{modelValue:o.filters.to,"onUpdate:modelValue":e[1]||(e[1]=s=>o.filters.to=s),type:"date",label:"Hasta",dense:"",outlined:""},null,8,["modelValue"])]),t("div",L,[a(D,{modelValue:o.filters.area,"onUpdate:modelValue":e[2]||(e[2]=s=>o.filters.area=s),options:o.filterOptions.areas,label:"Área",dense:"",outlined:"",clearable:""},null,8,["modelValue","options"])]),t("div",N,[a(_,{color:"primary",icon:"search",label:"Filtrar","no-caps":"",loading:o.loading,onClick:i.fetchDashboard},null,8,["loading","onClick"])])]),_:1})]),_:1}),t("div",P,[(u(!0),v(w,null,T(i.cards,s=>(u(),v("div",{class:"col-12 col-sm-4",key:s.key},[a(n,{flat:"",bordered:"",class:"q-pa-md text-center"},{default:l(()=>[t("div",A,p(s.label),1),t("div",B,p(s.value??"—"),1),t("div",U,p(i.rangoTexto),1)]),_:2},1024)]))),128))]),t("div",H,[t("div",M,[a(n,{flat:"",bordered:"",class:"q-pa-md"},{default:l(()=>[e[5]||(e[5]=t("div",{class:"text-subtitle2 q-mb-sm"}," DNA / SLIM: Hechos de fragancia vs denuncia ",-1)),a(d,{type:"donut",height:"260",options:i.getDonutOptions("DNA / SLIM: fragancia vs denuncia",o.porFragancia.labels,"fragancia"),series:o.porFragancia.data},null,8,["options","series"])]),_:1})]),t("div",j,[a(n,{flat:"",bordered:"",class:"q-pa-md"},{default:l(()=>[e[6]||(e[6]=t("div",{class:"text-subtitle2 q-mb-sm"},"Casos por tipo (click para ver detalle)",-1)),a(d,{type:"donut",height:"260",options:i.getDonutOptions("Casos por tipo",o.porTipo.labels,"tipo"),series:o.porTipo.data},null,8,["options","series"])]),_:1})]),t("div",z,[a(n,{flat:"",bordered:"",class:"q-pa-md"},{default:l(()=>[e[7]||(e[7]=t("div",{class:"text-subtitle2 q-mb-sm"},"Casos por tipología (click para ver detalle)",-1)),a(d,{type:"donut",height:"260",options:i.getDonutOptions("Casos por tipología",o.porTipologia.labels,"tipologia"),series:o.porTipologia.data},null,8,["options","series"])]),_:1})])]),t("div",R,[t("div",W,[a(n,{flat:"",bordered:"",class:"q-pa-md"},{default:l(()=>[e[8]||(e[8]=t("div",{class:"text-subtitle2 q-mb-sm"},"Casos por rango de edad (denunciante)",-1)),a(d,{type:"bar",height:"300",options:i.barEdadOptions,series:i.barEdadSeries},null,8,["options","series"])]),_:1})]),t("div",Y,[a(n,{flat:"",bordered:"",class:"q-pa-md"},{default:l(()=>[e[9]||(e[9]=t("div",{class:"text-subtitle2 q-mb-sm"},"Casos por mes",-1)),a(d,{type:"area",height:"300",options:i.areaOptions,series:i.areaSeries},null,8,["options","series"])]),_:1})])]),o.detalle.rows.length?(u(),g(n,{key:0,flat:"",bordered:"",class:"q-mt-md"},{default:l(()=>[a(f,{class:"row items-center justify-between"},{default:l(()=>[t("div",null,[t("div",Z,p(o.detalle.titulo),1),t("div",G," Total: "+p(o.detalle.rows.length)+" registro(s) ",1)]),a(_,{dense:"",flat:"",icon:"close",round:"",onClick:e[3]||(e[3]=s=>o.detalle.rows=[])})]),_:1}),a(q),a(f,null,{default:l(()=>[a(Q,{rows:o.detalle.rows,columns:o.detalleColumns,"row-key":"id",dense:"",flat:"",bordered:"",loading:o.detalle.loading,"no-data-label":"Sin casos para mostrar",onRowClick:e[4]||(e[4]=(s,m,K)=>{this.$router.push("/casos/"+m.id)})},{"body-cell-caso_fecha_hecho":l(s=>[a(V,{props:s},{default:l(()=>[k(p(i.formatDate(s.row.caso_fecha_hecho)),1)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])]),_:1})]),_:1})):C("",!0)]),_:1})}const de=x(S,[["render",J]]);export{de as default};
