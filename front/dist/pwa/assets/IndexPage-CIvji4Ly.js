import{_ as y,Y as C,c as g,o as u,w as l,a,b as o,$ as w,Q as n,e as f,a6 as b,f as _,a0 as v,a1 as T,a2 as q,t as p,a3 as D,Z as k}from"./index-Ck1IPAoR.js";import{Q}from"./QSelect-xPZFifrf.js";import{Q as V,a as E}from"./QTable-B9PlfPuq.js";import{Q as O}from"./QPage-CpqTTILT.js";import{m as S}from"./vue3-apexcharts-BnV6wv9m.js";import{h as x}from"./moment-C5S46NFB.js";import"./QMenu-__-4PpXr.js";import"./format-BuuyVaDy.js";import"./QItemLabel-BaLiswTg.js";import"./QList-7Dz0i_-n.js";import"./QMarkupTable-BlKZP-aA.js";import"./use-fullscreen-u9k9x_SY.js";const Y={name:"IndexPage",components:{apexchart:S},data(){return{loading:!1,filters:{from:x().format("YYYY-MM-DD"),to:x().format("YYYY-MM-DD"),area:null},rango:{from:null,to:null},totales:{casos:0,denunciantes:0,denunciados:0},porArea:{labels:[],data:[]},porTipo:{labels:[],data:[]},porTipologia:{labels:[],data:[]},porEdad:{labels:[],data:[]},seriesTiempo:{labels:[],data:[]},porFragancia:{labels:[],data:[]},filterOptions:{areas:[]},detalle:{titulo:"",rows:[],loading:!1},detalleColumns:[{name:"id",label:"ID",field:"id",sortable:!0,align:"left"},{name:"area",label:"Área",field:"area",align:"left"},{name:"tipo",label:"Tipo",field:"tipo",align:"left"},{name:"caso_tipologia",label:"Tipología",field:"caso_tipologia",align:"left"},{name:"caso_numero",label:"N° Caso",field:"caso_numero",align:"left"},{name:"caso_fecha_hecho",label:"Fecha hecho",field:"caso_fecha_hecho",align:"left"},{name:"caso_lugar_hecho",label:"Lugar",field:"caso_lugar_hecho",align:"left"},{name:"principal",label:"Principal",field:"principal",align:"left"}]}},computed:{cards(){return[{key:"casos",label:"Casos",value:this.totales.casos},{key:"denunciante",label:"Denunciantes",value:this.totales.denunciantes},{key:"denunciado",label:"Denunciados",value:this.totales.denunciados}]},rangoTexto(){return!this.rango.from||!this.rango.to?"":`Del ${this.rango.from} al ${this.rango.to}`},barEdadOptions(){return{chart:{toolbar:{show:!1}},xaxis:{categories:this.porEdad.labels},dataLabels:{enabled:!1},plotOptions:{bar:{horizontal:!1,columnWidth:"40%"}},grid:{borderColor:"#eee"}}},barEdadSeries(){return[{name:"Casos",data:this.porEdad.data}]},areaOptions(){return{chart:{toolbar:{show:!1}},stroke:{curve:"smooth",width:2},dataLabels:{enabled:!1},xaxis:{categories:this.seriesTiempo.labels},grid:{borderColor:"#eee"},legend:{position:"top"}}},areaSeries(){return[{name:"Casos",data:this.seriesTiempo.data}]}},mounted(){this.fetchDashboard()},methods:{formatDate(r){return r||""},getDonutOptions(r,e,c){const h=this;return{labels:e,legend:{position:"bottom"},dataLabels:{enabled:!0},chart:{toolbar:{show:!1},events:{dataPointSelection(t,i,d){const s=d.dataPointIndex,m=e[s];m&&h.onDonutClick(c,m)}}},title:{text:"",align:"left"}}},async onDonutClick(r,e){this.detalle.titulo=r==="tipo"?`Casos - Tipo: ${e}`:r==="tipologia"?`Casos - Tipología: ${e}`:`Casos - ${e}`,this.detalle.loading=!0,this.detalle.rows=[];try{const c=await this.$axios.get("dashboard-casos-detalle",{params:{from:this.filters.from,to:this.filters.to,area:this.filters.area,group_by:r,value:e}});this.detalle.rows=c.data||[]}catch(c){console.error(c),this.$q.notify({type:"negative",message:"Error cargando detalle de casos"})}finally{this.detalle.loading=!1}},async fetchDashboard(){this.loading=!0;try{const e=(await this.$axios.get("dashboard-casos",{params:this.filters})).data||{};this.totales=e.totales||this.totales,this.porArea=e.por_area||this.porArea,this.porTipo=e.por_tipo||this.porTipo,this.porTipologia=e.por_tipologia||this.porTipologia,this.porEdad=e.por_edad||this.porEdad,this.seriesTiempo=e.series_tiempo||this.seriesTiempo,this.porFragancia=e.por_fragancia||this.porFragancia,this.filterOptions.areas=e.filtros?.areas||[],this.rango=e.rango||this.rango}catch(r){console.error(r),this.$q.notify({type:"negative",message:"Error cargando dashboard de casos"})}finally{this.loading=!1}}}},F={class:"col-12 col-sm-3"},I={class:"col-12 col-sm-3"},L={class:"col-12 col-sm-3"},N={class:"col-12 col-sm-auto"},M={class:"row q-col-gutter-md q-mb-md"},P={class:"text-caption text-grey-7"},A={class:"text-h4 q-my-sm"},B={class:"text-caption text-positive"},U={class:"row q-col-gutter-md q-mb-md"},H={class:"col-12 col-md-4"},j={class:"col-12 col-md-4"},z={class:"col-12 col-md-4"},R={class:"row q-col-gutter-md"},W={class:"col-12 col-md-6"},Z={class:"col-12 col-md-6"},G={class:"text-subtitle2"},J={class:"text-caption text-grey-7"};function K(r,e,c,h,t,i){const d=C("apexchart");return u(),g(O,{class:"q-pa-md bg-grey-2"},{default:l(()=>[a(n,{flat:"",bordered:"",class:"q-mb-md"},{default:l(()=>[a(f,{class:"row q-col-gutter-sm items-end"},{default:l(()=>[o("div",F,[a(b,{modelValue:t.filters.from,"onUpdate:modelValue":e[0]||(e[0]=s=>t.filters.from=s),type:"date",label:"Desde",dense:"",outlined:""},null,8,["modelValue"])]),o("div",I,[a(b,{modelValue:t.filters.to,"onUpdate:modelValue":e[1]||(e[1]=s=>t.filters.to=s),type:"date",label:"Hasta",dense:"",outlined:""},null,8,["modelValue"])]),o("div",L,[a(Q,{modelValue:t.filters.area,"onUpdate:modelValue":e[2]||(e[2]=s=>t.filters.area=s),options:t.filterOptions.areas,label:"Área",dense:"",outlined:"",clearable:""},null,8,["modelValue","options"])]),o("div",N,[a(_,{color:"primary",icon:"search",label:"Filtrar","no-caps":"",loading:t.loading,onClick:i.fetchDashboard},null,8,["loading","onClick"])])]),_:1})]),_:1}),o("div",M,[(u(!0),v(T,null,q(i.cards,s=>(u(),v("div",{class:"col-12 col-sm-4",key:s.key},[a(n,{flat:"",bordered:"",class:"q-pa-md text-center"},{default:l(()=>[o("div",P,p(s.label),1),o("div",A,p(s.value??"—"),1),o("div",B,p(i.rangoTexto),1)]),_:2},1024)]))),128))]),o("div",U,[o("div",H,[a(n,{flat:"",bordered:"",class:"q-pa-md"},{default:l(()=>[e[5]||(e[5]=o("div",{class:"text-subtitle2 q-mb-sm"}," DNA / SLIM: Hechos de fragancia vs denuncia ",-1)),a(d,{type:"donut",height:"260",options:i.getDonutOptions("DNA / SLIM: fragancia vs denuncia",t.porFragancia.labels,"fragancia"),series:t.porFragancia.data},null,8,["options","series"])]),_:1})]),o("div",j,[a(n,{flat:"",bordered:"",class:"q-pa-md"},{default:l(()=>[e[6]||(e[6]=o("div",{class:"text-subtitle2 q-mb-sm"},"Casos por tipo (click para ver detalle)",-1)),a(d,{type:"donut",height:"260",options:i.getDonutOptions("Casos por tipo",t.porTipo.labels,"tipo"),series:t.porTipo.data},null,8,["options","series"])]),_:1})]),o("div",z,[a(n,{flat:"",bordered:"",class:"q-pa-md"},{default:l(()=>[e[7]||(e[7]=o("div",{class:"text-subtitle2 q-mb-sm"},"Casos por tipología (click para ver detalle)",-1)),a(d,{type:"donut",height:"260",options:i.getDonutOptions("Casos por tipología",t.porTipologia.labels,"tipologia"),series:t.porTipologia.data},null,8,["options","series"])]),_:1})])]),o("div",R,[o("div",W,[a(n,{flat:"",bordered:"",class:"q-pa-md"},{default:l(()=>[e[8]||(e[8]=o("div",{class:"text-subtitle2 q-mb-sm"},"Casos por rango de edad (denunciante)",-1)),a(d,{type:"bar",height:"300",options:i.barEdadOptions,series:i.barEdadSeries},null,8,["options","series"])]),_:1})]),o("div",Z,[a(n,{flat:"",bordered:"",class:"q-pa-md"},{default:l(()=>[e[9]||(e[9]=o("div",{class:"text-subtitle2 q-mb-sm"},"Casos por mes",-1)),a(d,{type:"area",height:"300",options:i.areaOptions,series:i.areaSeries},null,8,["options","series"])]),_:1})])]),t.detalle.rows.length?(u(),g(n,{key:0,flat:"",bordered:"",class:"q-mt-md"},{default:l(()=>[a(f,{class:"row items-center justify-between"},{default:l(()=>[o("div",null,[o("div",G,p(t.detalle.titulo),1),o("div",J," Total: "+p(t.detalle.rows.length)+" registro(s) ",1)]),a(_,{dense:"",flat:"",icon:"close",round:"",onClick:e[3]||(e[3]=s=>t.detalle.rows=[])})]),_:1}),a(D),a(f,null,{default:l(()=>[a(V,{rows:t.detalle.rows,columns:t.detalleColumns,"row-key":"id",dense:"",flat:"",bordered:"",loading:t.detalle.loading,"no-data-label":"Sin casos para mostrar",onRowClick:e[4]||(e[4]=(s,m,X)=>{this.$router.push("/casos/"+m.id)})},{"body-cell-caso_fecha_hecho":l(s=>[a(E,{props:s},{default:l(()=>[k(p(i.formatDate(s.row.caso_fecha_hecho)),1)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])]),_:1})]),_:1})):w("",!0)]),_:1})}const pe=y(Y,[["render",K]]);export{pe as default};
