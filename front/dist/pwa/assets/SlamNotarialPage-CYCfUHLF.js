import{_ as C,c as p,o as r,w as a,b as i,a as o,a6 as n,d as _,f as m,a0 as h,$ as b,a1 as x,a2 as D,W as V,Z as y,a4 as v,t as c,h as Q,Q as M,e as w}from"./index-BytFJZqo.js";import{b as k,c as g}from"./QMenu-B8wlO4BN.js";import{a as N,Q as E}from"./QBtnDropdown-BCEzdS7o.js";import{Q as U}from"./QBadge-CYPGQ_Km.js";import{Q as F}from"./QMarkupTable-K8HlLNlJ.js";import{Q as S}from"./QSpace-B6fLoM6n.js";import{Q as L}from"./QFile-8sUYnmrJ.js";import{Q as O}from"./QForm-sc1wmGyZ.js";import{Q as q}from"./QPage-DNKhu0wz.js";import{h as u}from"./moment-C5S46NFB.js";import"./format-PQhwzCsV.js";import"./QBtnGroup-D1zK-lh7.js";const B={name:"SlamNotarialPage",data(){return{loading:!1,filter:"",start:u().startOf("week").add(1,"day").format("YYYY-MM-DD"),end:u().endOf("week").add(1,"day").format("YYYY-MM-DD"),rows:[],dialog:!1,file:null,form:this.emptyForm()}},computed:{filteredRows(){if(!this.filter)return this.rows;const s=this.filter.toLowerCase();return this.rows.filter(e=>(e.nombre_completo||"").toLowerCase().includes(s)||(e.ci||"").toLowerCase().includes(s)||(e.estado_civil||"").toLowerCase().includes(s)||(e.ocupacion||"").toLowerCase().includes(s)||(e.fecha||"").toLowerCase().includes(s))}},mounted(){this.fetch()},methods:{edadCalculate(){if(this.form.fecha_nacimiento){const s=u(this.form.fecha_nacimiento,"YYYY-MM-DD"),f=u().diff(s,"years");this.form.edad=f}else this.form.edad=""},emptyForm(){return{id:null,fecha:u().format("YYYY-MM-DD"),nombre_completo:"",edad:"",fecha_nacimiento:"",estado_civil:"",ci:"",grado_instruccion:"",ocupacion:"",direccion_domicilio:"",url:null}},setThisWeek(){this.start=u().startOf("week").add(1,"day").format("YYYY-MM-DD"),this.end=u().endOf("week").add(1,"day").format("YYYY-MM-DD"),this.fetch()},setWeekend(){const s=u().startOf("week").add(6,"day"),e=u().startOf("week").add(7,"day");this.start=s.format("YYYY-MM-DD"),this.end=e.format("YYYY-MM-DD"),this.fetch()},async fetch(){this.loading=!0;try{const s={};this.start&&this.end&&(s.start=this.start,s.end=this.end);const{data:e}=await this.$axios.get("slam-notariales",{params:s});this.rows=e}catch(s){this.$alert?.error(s.response?.data?.message||"Error cargando registros")}finally{this.loading=!1}},openNew(){this.dialog=!0,this.file=null,this.form=this.emptyForm()},openEdit(s){this.dialog=!0,this.file=null,this.form={...this.emptyForm(),...s}},async save(){this.loading=!0;try{const s=new FormData;["fecha","nombre_completo","edad","fecha_nacimiento","estado_civil","ci","grado_instruccion","ocupacion","direccion_domicilio"].forEach(f=>s.append(f,this.form[f]??"")),this.file&&s.append("url",this.file),this.form.id?await this.$axios.put(`slam-notariales/${this.form.id}`,s,{headers:{"Content-Type":"multipart/form-data"}}):await this.$axios.post("slam-notariales",s,{headers:{"Content-Type":"multipart/form-data"}}),this.dialog=!1,this.$alert?.success("Guardado"),this.fetch()}catch(s){this.$alert?.error(s.response?.data?.message||"No se pudo guardar")}finally{this.loading=!1}},onDelete(s){this.$alert?.dialog("¿Eliminar registro?").onOk(async()=>{this.loading=!0;try{await this.$axios.delete(`slam-notariales/${s}`),this.$alert?.success("Eliminado"),this.fetch()}catch(e){this.$alert?.error(e.response?.data?.message||"No se pudo eliminar")}finally{this.loading=!1}})}}},A={class:"row items-center q-gutter-sm q-mb-md"},I={class:"text-center"},T={key:0},W={class:"text-h6"},R={class:"row q-col-gutter-md"},G={class:"col-12 col-md-8"},P={class:"col-6 col-md-3"},z={class:"col-6 col-md-3"},K={class:"col-12 col-md-6"},Z={class:"col-6 col-md-3"},j={class:"col-6 col-md-3"},H={class:"col-12 col-md-6"},J={class:"col-12"},X={class:"col-12"},$={class:"row items-center"},ee={class:"col"},le={key:0,class:"col-auto"},oe={class:"text-right q-mt-md"};function te(s,e,f,ie,t,d){return r(),p(q,{class:"q-pa-md"},{default:a(()=>[i("div",A,[o(n,{dense:"",outlined:"",modelValue:t.filter,"onUpdate:modelValue":e[0]||(e[0]=l=>t.filter=l),label:"Buscar",style:{"min-width":"220px"}},{append:a(()=>[o(_,{name:"search"})]),_:1},8,["modelValue"]),o(n,{dense:"",outlined:"",type:"date",modelValue:t.start,"onUpdate:modelValue":e[1]||(e[1]=l=>t.start=l),label:"Inicio",style:{width:"150px"}},null,8,["modelValue"]),o(n,{dense:"",outlined:"",type:"date",modelValue:t.end,"onUpdate:modelValue":e[2]||(e[2]=l=>t.end=l),label:"Fin",style:{width:"150px"}},null,8,["modelValue"]),o(m,{dense:"",outline:"",color:"primary",label:"Esta semana",onClick:d.setThisWeek},null,8,["onClick"]),o(m,{dense:"",outline:"",color:"indigo",label:"Fin de semana",onClick:d.setWeekend},null,8,["onClick"]),o(m,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",loading:t.loading,onClick:d.fetch},null,8,["loading","onClick"]),o(m,{color:"positive",icon:"add_circle_outline",label:"Nuevo","no-caps":"",loading:t.loading,onClick:d.openNew},null,8,["loading","onClick"])]),o(F,{flat:"",bordered:"",dense:"","wrap-cells":""},{default:a(()=>[e[20]||(e[20]=i("thead",null,[i("tr",null,[i("th",{class:"text-center"},"Acciones"),i("th",{class:"text-left"},"Fecha"),i("th",{class:"text-left"},"Nombre"),i("th",{class:"text-left"},"CI"),i("th",{class:"text-left"},"Estado civil"),i("th",{class:"text-left"},"Ocupación"),i("th",{class:"text-left"},"Archivo")])],-1)),i("tbody",null,[(r(!0),h(x,null,D(d.filteredRows,l=>(r(),h("tr",{key:l.id},[i("td",I,[o(N,{label:"Acciones",dense:"","no-caps":"",size:"10px",color:"primary"},{default:a(()=>[o(E,null,{default:a(()=>[V((r(),p(k,{clickable:"",onClick:Y=>d.openEdit(l)},{default:a(()=>[o(g,{avatar:""},{default:a(()=>[o(_,{name:"edit"})]),_:1}),o(g,null,{default:a(()=>e[16]||(e[16]=[y("Editar")])),_:1})]),_:2},1032,["onClick"])),[[v]]),V((r(),p(k,{clickable:"",onClick:Y=>d.onDelete(l.id)},{default:a(()=>[o(g,{avatar:""},{default:a(()=>[o(_,{name:"delete"})]),_:1}),o(g,null,{default:a(()=>e[17]||(e[17]=[y("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[v]])]),_:2},1024)]),_:2},1024)]),i("td",null,c(l.fecha),1),i("td",null,c(l.nombre_completo),1),i("td",null,c(l.ci),1),i("td",null,c(l.estado_civil),1),i("td",null,c(l.ocupacion),1),i("td",null,[l.url?(r(),p(m,{key:0,dense:"",outline:"",icon:"attach_file",label:"Archivo",href:`${s.$url}/../storage/${l.url}`,target:"_blank"},null,8,["href"])):(r(),p(U,{key:1,color:"grey-5",outline:""},{default:a(()=>e[18]||(e[18]=[y("—")])),_:1}))])]))),128)),d.filteredRows.length?b("",!0):(r(),h("tr",T,e[19]||(e[19]=[i("td",{colspan:"7",class:"text-center text-grey"},"Sin registros",-1)])))])]),_:1}),o(Q,{modelValue:t.dialog,"onUpdate:modelValue":e[15]||(e[15]=l=>t.dialog=l),persistent:""},{default:a(()=>[o(M,{style:{width:"720px","max-width":"95vw"}},{default:a(()=>[o(w,{class:"row items-center q-pb-none"},{default:a(()=>[i("div",W,c(t.form.id?"Editar":"Nuevo")+" SLAM Notarial",1),o(S),o(m,{flat:"",round:"",dense:"",icon:"close",onClick:e[3]||(e[3]=l=>t.dialog=!1)})]),_:1}),o(w,{class:"q-pt-none"},{default:a(()=>[o(O,{onSubmit:d.save},{default:a(()=>[i("div",R,[i("div",G,[o(n,{dense:"",outlined:"",modelValue:t.form.nombre_completo,"onUpdate:modelValue":e[4]||(e[4]=l=>t.form.nombre_completo=l),label:"Nombre completo"},null,8,["modelValue"])]),i("div",P,[o(n,{dense:"",outlined:"",type:"date",modelValue:t.form.fecha_nacimiento,"onUpdate:modelValue":[e[5]||(e[5]=l=>t.form.fecha_nacimiento=l),e[6]||(e[6]=l=>d.edadCalculate())],label:"F. nacimiento"},null,8,["modelValue"])]),i("div",z,[o(n,{dense:"",outlined:"",modelValue:t.form.edad,"onUpdate:modelValue":e[7]||(e[7]=l=>t.form.edad=l),label:"Edad"},null,8,["modelValue"])]),i("div",K,[o(n,{dense:"",outlined:"",modelValue:t.form.estado_civil,"onUpdate:modelValue":e[8]||(e[8]=l=>t.form.estado_civil=l),label:"Estado civil"},null,8,["modelValue"])]),i("div",Z,[o(n,{dense:"",outlined:"",modelValue:t.form.ci,"onUpdate:modelValue":e[9]||(e[9]=l=>t.form.ci=l),label:"CI"},null,8,["modelValue"])]),i("div",j,[o(n,{dense:"",outlined:"",modelValue:t.form.grado_instruccion,"onUpdate:modelValue":e[10]||(e[10]=l=>t.form.grado_instruccion=l),label:"Grado de instr."},null,8,["modelValue"])]),i("div",H,[o(n,{dense:"",outlined:"",modelValue:t.form.ocupacion,"onUpdate:modelValue":e[11]||(e[11]=l=>t.form.ocupacion=l),label:"Ocupación"},null,8,["modelValue"])]),i("div",J,[o(n,{dense:"",outlined:"",modelValue:t.form.direccion_domicilio,"onUpdate:modelValue":e[12]||(e[12]=l=>t.form.direccion_domicilio=l),label:"Dirección"},null,8,["modelValue"])]),i("div",X,[i("div",$,[i("div",ee,[o(L,{modelValue:t.file,"onUpdate:modelValue":e[13]||(e[13]=l=>t.file=l),dense:"",outlined:"",label:"Archivo (url)"},null,8,["modelValue"])]),t.form.url?(r(),h("div",le,[o(m,{dense:"",outline:"",icon:"open_in_new",label:"Ver actual",href:`${s.$url}/storage/${t.form.url}`,target:"_blank"},null,8,["href"])])):b("",!0)])])]),i("div",oe,[o(m,{color:"negative",flat:"",label:"Cancelar",onClick:e[14]||(e[14]=l=>t.dialog=!1),loading:t.loading},null,8,["loading"]),o(m,{color:"primary",label:"Guardar",type:"submit",class:"q-ml-sm",loading:t.loading},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const _e=C(B,[["render",te]]);export{_e as default};
