import{_ as C,Y as w,c as f,o as m,w as l,a as t,b as a,$ as b,Q as n,e as h,a6 as _,f as v,a0 as x,a1 as T,a2 as q,t as p,a3 as D,Z as k}from"./index-D0S-rX00.js";import{Q}from"./QSelect-Dh6kq6HR.js";import{Q as V,a as E}from"./QTable-iUevV1pc.js";import{Q as O}from"./QPage-C2SXv50a.js";import{m as S}from"./vue3-apexcharts-C6P2eMuy.js";import{h as y}from"./moment-C5S46NFB.js";import"./QMenu-CrUSsrzd.js";import"./format-NU-rhY3o.js";import"./QItem-D-GUHBXm.js";import"./QItemLabel-C_q-g8D3.js";import"./QList-Bt3Y69gt.js";import"./QMarkupTable-BXap6ops.js";import"./use-fullscreen-CsFf5fCz.js";const Y={name:"IndexPage",components:{apexchart:S},data(){return{loading:!1,filters:{from:y().format("YYYY-MM-DD"),to:y().format("YYYY-MM-DD"),area:null},rango:{from:null,to:null},totales:{casos:0,denunciantes:0,denunciados:0},porArea:{labels:[],data:[]},porTipo:{labels:[],data:[]},porTipologia:{labels:[],data:[]},porEdad:{labels:[],data:[]},seriesTiempo:{labels:[],data:[]},porFragancia:{labels:[],data:[]},filterOptions:{areas:[]},detalle:{titulo:"",rows:[],loading:!1},detalleColumns:[{name:"id",label:"ID",field:"id",sortable:!0,align:"left"},{name:"area",label:"Área",field:"area",align:"left"},{name:"tipo",label:"Tipo",field:"tipo",align:"left"},{name:"caso_tipologia",label:"Tipología",field:"caso_tipologia",align:"left"},{name:"caso_numero",label:"N° Caso",field:"caso_numero",align:"left"},{name:"caso_fecha_hecho",label:"Fecha hecho",field:"caso_fecha_hecho",align:"left"},{name:"caso_lugar_hecho",label:"Lugar",field:"caso_lugar_hecho",align:"left"},{name:"principal",label:"Principal",field:"principal",align:"left"}]}},computed:{cards(){return[{key:"casos",label:"Casos",value:this.totales.casos},{key:"denunciante",label:"Denunciantes",value:this.totales.denunciantes},{key:"denunciado",label:"Denunciados",value:this.totales.denunciados}]},rangoTexto(){return!this.rango.from||!this.rango.to?"":`Del ${this.rango.from} al ${this.rango.to}`},barEdadOptions(){return{chart:{toolbar:{show:!1}},xaxis:{categories:this.porEdad.labels},dataLabels:{enabled:!1},plotOptions:{bar:{horizontal:!1,columnWidth:"40%"}},grid:{borderColor:"#eee"}}},barEdadSeries(){return[{name:"Casos",data:this.porEdad.data}]},areaOptions(){return{chart:{toolbar:{show:!1}},stroke:{curve:"smooth",width:2},dataLabels:{enabled:!1},xaxis:{categories:this.seriesTiempo.labels},grid:{borderColor:"#eee"},legend:{position:"top"}}},areaSeries(){return[{name:"Casos",data:this.seriesTiempo.data}]}},mounted(){this.fetchDashboard()},methods:{formatDate(i){return i||""},getDonutOptions(i,e,c){const g=this;return{labels:e,legend:{position:"bottom"},dataLabels:{enabled:!0},chart:{toolbar:{show:!1},events:{dataPointSelection(o,r,d){const s=d.dataPointIndex,u=e[s];u&&g.onDonutClick(c,u)}}},title:{text:"",align:"left"}}},async onDonutClick(i,e){this.detalle.titulo=i==="tipo"?`Casos - Tipo: ${e}`:i==="tipologia"?`Casos - Tipología: ${e}`:`Casos - ${e}`,this.detalle.loading=!0,this.detalle.rows=[];try{const c=await this.$axios.get("dashboard-casos-detalle",{params:{from:this.filters.from,to:this.filters.to,area:this.filters.area,group_by:i,value:e}});this.detalle.rows=c.data||[]}catch(c){console.error(c),this.$q.notify({type:"negative",message:"Error cargando detalle de casos"})}finally{this.detalle.loading=!1}},async fetchDashboard(){this.loading=!0;try{const e=(await this.$axios.get("dashboard-casos",{params:this.filters})).data||{};this.totales=e.totales||this.totales,this.porArea=e.por_area||this.porArea,this.porTipo=e.por_tipo||this.porTipo,this.porTipologia=e.por_tipologia||this.porTipologia,this.porEdad=e.por_edad||this.porEdad,this.seriesTiempo=e.series_tiempo||this.seriesTiempo,this.porFragancia=e.por_fragancia||this.porFragancia,this.filterOptions.areas=e.filtros?.areas||[],this.rango=e.rango||this.rango}catch(i){console.error(i),this.$q.notify({type:"negative",message:"Error cargando dashboard de casos"})}finally{this.loading=!1}}}},F={class:"col-12 col-sm-3"},I={class:"col-12 col-sm-3"},L={class:"col-12 col-sm-3"},N={class:"col-12 col-sm-auto"},A={class:"row q-col-gutter-md q-mb-md"},M={class:"text-caption text-grey-7"},P={class:"text-h4 q-my-sm"},B={class:"text-caption text-positive"},U={class:"row q-col-gutter-md q-mb-md"},H={class:"col-12 col-md-4"},j={class:"col-12 col-md-4"},z={class:"col-12 col-md-4"},R={class:"row q-col-gutter-md"},W={class:"col-12 col-md-6"},Z={class:"col-12 col-md-6"},G={class:"text-subtitle2"},J={class:"text-caption text-grey-7"};function K(i,e,c,g,o,r){const d=w("apexchart");return m(),f(O,{class:"q-pa-md bg-grey-2"},{default:l(()=>[t(n,{flat:"",bordered:"",class:"q-mb-md"},{default:l(()=>[t(h,{class:"row q-col-gutter-sm items-end"},{default:l(()=>[a("div",F,[t(_,{modelValue:o.filters.from,"onUpdate:modelValue":e[0]||(e[0]=s=>o.filters.from=s),type:"date",label:"Desde",dense:"",outlined:""},null,8,["modelValue"])]),a("div",I,[t(_,{modelValue:o.filters.to,"onUpdate:modelValue":e[1]||(e[1]=s=>o.filters.to=s),type:"date",label:"Hasta",dense:"",outlined:""},null,8,["modelValue"])]),a("div",L,[i.$store.user?.role=="Administrador"?(m(),f(Q,{key:0,modelValue:o.filters.area,"onUpdate:modelValue":e[2]||(e[2]=s=>o.filters.area=s),options:o.filterOptions.areas,label:"Área",dense:"",outlined:"",clearable:""},null,8,["modelValue","options"])):b("",!0)]),a("div",N,[t(v,{color:"primary",icon:"search",label:"Filtrar","no-caps":"",loading:o.loading,onClick:r.fetchDashboard},null,8,["loading","onClick"])])]),_:1})]),_:1}),a("div",A,[(m(!0),x(T,null,q(r.cards,s=>(m(),x("div",{class:"col-12 col-sm-4",key:s.key},[t(n,{flat:"",bordered:"",class:"q-pa-md text-center"},{default:l(()=>[a("div",M,p(s.label),1),a("div",P,p(s.value??"—"),1),a("div",B,p(r.rangoTexto),1)]),_:2},1024)]))),128))]),a("div",U,[a("div",H,[t(n,{flat:"",bordered:"",class:"q-pa-md"},{default:l(()=>[e[5]||(e[5]=a("div",{class:"text-subtitle2 q-mb-sm"}," DNA / SLIM: Hechos de fragancia vs denuncia ",-1)),t(d,{type:"donut",height:"260",options:r.getDonutOptions("DNA / SLIM: fragancia vs denuncia",o.porFragancia.labels,"fragancia"),series:o.porFragancia.data},null,8,["options","series"])]),_:1})]),a("div",j,[t(n,{flat:"",bordered:"",class:"q-pa-md"},{default:l(()=>[e[6]||(e[6]=a("div",{class:"text-subtitle2 q-mb-sm"},"Casos por tipo (click para ver detalle)",-1)),t(d,{type:"donut",height:"260",options:r.getDonutOptions("Casos por tipo",o.porTipo.labels,"tipo"),series:o.porTipo.data},null,8,["options","series"])]),_:1})]),a("div",z,[t(n,{flat:"",bordered:"",class:"q-pa-md"},{default:l(()=>[e[7]||(e[7]=a("div",{class:"text-subtitle2 q-mb-sm"},"Casos por tipología (click para ver detalle)",-1)),t(d,{type:"donut",height:"260",options:r.getDonutOptions("Casos por tipología",o.porTipologia.labels,"tipologia"),series:o.porTipologia.data},null,8,["options","series"])]),_:1})])]),a("div",R,[a("div",W,[t(n,{flat:"",bordered:"",class:"q-pa-md"},{default:l(()=>[e[8]||(e[8]=a("div",{class:"text-subtitle2 q-mb-sm"},"Casos por rango de edad (denunciante)",-1)),t(d,{type:"bar",height:"300",options:r.barEdadOptions,series:r.barEdadSeries},null,8,["options","series"])]),_:1})]),a("div",Z,[t(n,{flat:"",bordered:"",class:"q-pa-md"},{default:l(()=>[e[9]||(e[9]=a("div",{class:"text-subtitle2 q-mb-sm"},"Casos por mes",-1)),t(d,{type:"area",height:"300",options:r.areaOptions,series:r.areaSeries},null,8,["options","series"])]),_:1})])]),o.detalle.rows.length?(m(),f(n,{key:0,flat:"",bordered:"",class:"q-mt-md"},{default:l(()=>[t(h,{class:"row items-center justify-between"},{default:l(()=>[a("div",null,[a("div",G,p(o.detalle.titulo),1),a("div",J," Total: "+p(o.detalle.rows.length)+" registro(s) ",1)]),t(v,{dense:"",flat:"",icon:"close",round:"",onClick:e[3]||(e[3]=s=>o.detalle.rows=[])})]),_:1}),t(D),t(h,null,{default:l(()=>[t(V,{rows:o.detalle.rows,columns:o.detalleColumns,"row-key":"id",dense:"",flat:"",bordered:"",loading:o.detalle.loading,"no-data-label":"Sin casos para mostrar",onRowClick:e[4]||(e[4]=(s,u,X)=>{this.$router.push("/casos/"+u.id)})},{"body-cell-caso_fecha_hecho":l(s=>[t(E,{props:s},{default:l(()=>[k(p(r.formatDate(s.row.caso_fecha_hecho)),1)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])]),_:1})]),_:1})):b("",!0)]),_:1})}const me=C(Y,[["render",K]]);export{me as default};
